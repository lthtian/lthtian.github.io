<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ç®—æ³•å¤å¥ ä¸ç­‰å¼ åŒä½™ + ç ´æ¢æˆé“¾</title>
    <link href="/2025/02/28/%5B%E7%AE%97%E6%B3%95%E5%A4%8D%E5%81%A5%5D%20%E4%B8%8D%E7%AD%89%E5%BC%8F%20%20%E5%90%8C%E4%BD%99%20+%20%E7%A0%B4%E6%8D%A2%E6%88%90%E9%93%BE/"/>
    <url>/2025/02/28/%5B%E7%AE%97%E6%B3%95%E5%A4%8D%E5%81%A5%5D%20%E4%B8%8D%E7%AD%89%E5%BC%8F%20%20%E5%90%8C%E4%BD%99%20+%20%E7%A0%B4%E6%8D%A2%E6%88%90%E9%93%BE/</url>
    
    <content type="html"><![CDATA[<blockquote><p><acwing5439>ç»™å®š ğ‘› ä¸ªæ•´æ•° â„ğ‘–ï¼Œæ¯æ¬¡æ“ä½œä¼šä½¿ â„ğ‘–â†â„ğ‘–+ğ‘ğ‘–ï¼Œæ±‚èƒ½å¦åœ¨è‹¥å¹²æ¬¡æ“ä½œåä½¿å¾— â„ğ‘– çš„æ’åï¼ˆä»å¤§åˆ°å°ï¼‰ä¸º ğ‘¡ğ‘–+1(å°±æ˜¯å‰é¢æœ‰tiä¸ª)ï¼Œå¦‚æœå¯ä»¥ï¼Œæ±‚æœ€å°æ“ä½œæ¬¡æ•°ï¼Œå¦åˆ™è¾“å‡º-1ã€‚</p></blockquote><p>è¿™ä¸ªå…³é”®åœ¨ç»´æŠ¤ä¸€ä¸ªåŒºé—´é›†, åˆ©ç”¨ç»™å‡ºçš„ç›®æ ‡æ’åç¡®å®šä¸ç­‰å¼, æ¯ä¸ªä¸ç­‰å¼æˆç«‹éƒ½ä¼šç»™å‡ºä¸€ä¸ªåŒºé—´, ç„¶ååŠ åˆ°è¿™ä¸ªåŒºé—´é›†ä¸­</p><p>æœ€åå¾—åˆ°çš„åŒºé—´é›†å¦‚æœæˆç«‹, å°±æ˜¯ç¬¦åˆæ‰€æœ‰ä¸ç­‰å¼çš„ç­”æ¡ˆ</p><ul><li><p>è®¾ç»è¿‡çš„å¤©æ•°ä¸ºx</p></li><li><p>ä¸ç­‰å¼ä¸­æŒ‰ç…§é¡ºåºæ¯ä¸ªä¸ç­‰å¼éƒ½æ˜¯è¿™æ ·çš„å½¢å¼ : <code>h1 + x * a1 &gt; h2 + x * a2</code></p></li><li><p>å¯ä»¥è½¬åŒ–ä¸º : <code>x &lt; (h1 - h2) / (a2 - a1)</code></p></li><li><p>äºæ˜¯å°±è¦åˆ¤æ–­<code>a2 - a1</code>, æ˜¯å¦å¤§äº0 : </p><ul><li><p><code>&gt; 0</code>  :  <code>x &lt; (h1 - h2) / (a2 - a1)</code> , å°äºç¼©å³åŒºé—´.</p></li><li><p><code>&lt; 0</code> : <code>x &gt; (h1 - h2) / (a2 - a1)</code>, å¤§äºç¼©å·¦åŒºé—´.</p></li><li><p><code>= 0</code> : è¿™æ—¶æ¯”è¾ƒh1å’Œh2, å¦‚æœh1 &gt; h2, åˆ™ <code>x * 0 &lt; (h1 - h2)</code>æ°¸è¿œæˆç«‹, å¦‚æœh1 &lt; h2, åˆ™<code>x * 0 &lt; (h1 - h2)</code>æ°¸è¿œæ— è§£.</p><p>æ— è§£çš„è¯åˆ™æ’åä¸å¯èƒ½å®ç°, ç›´æ¥é€€å‡ºå°±è¡Œ.</p></li></ul></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rep(i,a,b) for(int i = (a); i &lt;= (b); i ++ )</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N = <span class="hljs-number">200010</span>;<br><span class="hljs-type">int</span> n; <br><span class="hljs-type">int</span> h[N], a[N], rk[N];<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">solve</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    cin &gt;&gt; n;<br>    <span class="hljs-built_in">rep</span>(i, <span class="hljs-number">1</span>, n) cin &gt;&gt; h[i];   <span class="hljs-comment">// é«˜åº¦</span><br>    <span class="hljs-built_in">rep</span>(i, <span class="hljs-number">1</span>, n) cin &gt;&gt; a[i];   <span class="hljs-comment">// å¢é‡</span><br>    <span class="hljs-built_in">rep</span>(i, <span class="hljs-number">1</span>, n)                <br>    &#123;<br>        <span class="hljs-type">int</span> w;<br>        cin &gt;&gt; w;<br>        rk[w + <span class="hljs-number">1</span>] = i;  <span class="hljs-comment">// iç›®æ ‡çš„ç›®æ ‡æ’å</span><br>    &#125;<br>    <br>    <span class="hljs-type">int</span> l = <span class="hljs-number">0</span>, r = <span class="hljs-number">1e9</span>;<br>    <span class="hljs-built_in">rep</span>(i, <span class="hljs-number">1</span>, n - <span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-type">int</span> A = h[rk[i]] - h[rk[i + <span class="hljs-number">1</span>]];<br>        <span class="hljs-type">int</span> B = a[rk[i + <span class="hljs-number">1</span>]] - a[rk[i]];<br>        <span class="hljs-comment">// æˆ‘ä»¬å¯¹äºè¾¹ç•Œåªå–æ•´æ•°</span><br>        <span class="hljs-comment">// x &lt; w -&gt; x &lt;= ceil(w) - 1  (x &lt; 1.1 -&gt; x &lt;= 1)</span><br>        <span class="hljs-keyword">if</span>(B &gt; <span class="hljs-number">0</span>) r = <span class="hljs-built_in">min</span>(r, (<span class="hljs-type">int</span>)<span class="hljs-built_in">ceil</span>((<span class="hljs-type">double</span>)A / B) - <span class="hljs-number">1</span>);<br>        <span class="hljs-comment">// x &gt; w -&gt; x &gt;= floor(w) + 1  (x &gt; 1.1 -&gt; x &gt;= 2)</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(B &lt; <span class="hljs-number">0</span>) l = <span class="hljs-built_in">max</span>(l, (<span class="hljs-type">int</span>)<span class="hljs-built_in">floor</span>((<span class="hljs-type">double</span>)A / B) + <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(A &lt;= <span class="hljs-number">0</span>)<br>        &#123;<br>            r = <span class="hljs-number">-1</span>;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(l &lt;= r) cout &lt;&lt; l &lt;&lt; endl;<br>    <span class="hljs-keyword">else</span> cout &lt;&lt; <span class="hljs-number">-1</span> &lt;&lt; endl;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> t;<br>    cin &gt;&gt; t;<br>    <span class="hljs-keyword">while</span>(t -- )<br>    &#123;<br>        <span class="hljs-built_in">solve</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><blockquote><p><acwing6131>ç»™å®šä¸€ä¸ªåºåˆ— ğ‘ğ‘–ï¼Œæ¯æ¬¡æ“ä½œå¯ä»¥è®©åºåˆ—ä¸­ä¸€ä¸ªå…ƒç´ åŠ ä¸€æˆ–è€…å‡ä¸€ï¼Œæ±‚è®©æ‰€æœ‰å…ƒç´ å‡å»æŸä¸ªæ•° ğ‘¥ ä¹‹åå¯ä»¥è¢« ğ‘š æ•´é™¤çš„æœ€å°æ“ä½œæ•°ã€‚</p></blockquote><p>è¿™é“é¢˜çš„å…³é”®åœ¨äºæ•´é™¤å¯ä»¥è½¬åŒ–ä¸ºåŒä½™å…³ç³», åœ¨åŒä½™ä¸‹å¯¹å…ƒç´ çš„åŠ å‡ä¸€å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªå¾ªç¯.</p><p>ç”±é¢˜å¯å¾—, <code>a - x â‰¡ 0 (mod m)</code> , æ‰€ä»¥<code>a â‰¡ x(mod m)</code>.</p><p>ç°åœ¨é—®é¢˜å°±è½¬åŒ–ä¸ºäº†æ±‚ä½¿aiå…¨éƒ¨å˜æˆxè¦çš„æœ€å°æ“ä½œæ•°.</p><p>è¿™ç§é—®é¢˜æœ‰å¸¸è§„è§£æ³•, å°±æ˜¯æ’åºå–ä¸­ä½æ•°, ç„¶åä¸¤è¾¹å¯ä»¥ç”¨å‰ç¼€å’Œæ±‚.</p><p>ä½†è¿™é“é¢˜æ˜¯å»ºç«‹åœ¨åŒä½™çš„å‰æä¸‹çš„, æˆ‘ä»¬å…¶å®æ— æ³•å‡†ç¡®åˆ¤æ–­ä¸­ä½æ•°åˆ°åº•æ˜¯å“ªä¸ª, å› ä¸ºæ¯ä¸ªaçš„å¾ªç¯çš„, åˆ°è¾¾åŒä¸€ä¸ªæ•°å¯ä»¥æ˜¯åŠ ä¹Ÿå¯ä»¥æ˜¯å‡, æ‰€ä»¥æˆ‘ä»¬æ— æ³•æŒ‰ç…§ä¸­ä½æ•°çš„æ¥å†³å®šæ¯ä¸ªaå¿…å®šæ˜¯åŠ è¿˜æ˜¯å‡.</p><p>äºæ˜¯æˆ‘ä»¬å°±è¦éå†æ¯ä¸ªç‚¹, æŠŠæ¯ä¸ªç‚¹éƒ½å½“ä½œä¸­ä½æ•°è¿›è¡Œä¸€æ¬¡åˆ¤æ–­, è¿™ç§æ“ä½œåœ¨é•¿åº¦ä¸ºnçš„æ•°ç»„çš„ä¸­å¾ˆéš¾å®ç°, æ‰€ä»¥å¯ä»¥æŠŠæ•°ç»„å¤åˆ¶åˆ°åé¢, ä½¿é•¿åº¦å˜æˆ2n, è¿™æ ·å°±å¯ä»¥å›ºå®šä¸€å®šåŒºé—´é•¿åº¦, ç§»åŠ¨åŒºé—´æ¥è¿›è¡Œåˆ¤æ–­.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rep(i, a, b) for(int i = (a); i &lt;= (b); i ++ )</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N = <span class="hljs-number">200010</span>;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">solve</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> n, m;<br>    cin &gt;&gt; n &gt;&gt; m;<br>    <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">a</span><span class="hljs-params">(<span class="hljs-number">2</span> * n + <span class="hljs-number">10</span>)</span></span>;<br>    <span class="hljs-built_in">rep</span>(i, <span class="hljs-number">1</span>, n) cin &gt;&gt; a[i], a[i] %= m; <span class="hljs-comment">// ç”±äºaå’ŒxåŒä½™m, æ‰€ä»¥å¯ä»¥å…ˆéƒ½ % m</span><br>    <span class="hljs-built_in">sort</span>(a.<span class="hljs-built_in">begin</span>() + <span class="hljs-number">1</span>, a.<span class="hljs-built_in">begin</span>() + n + <span class="hljs-number">1</span>);<br>    <span class="hljs-comment">// ç ´ç¯æˆé“¾</span><br>    <span class="hljs-comment">// è¿™é‡Œè‡³äºä¸ºä»€ä¹ˆåŠ m, å…¶å®æ¯”è¾ƒæ¨¡ç³Š</span><br>    <span class="hljs-comment">// å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸ºäº†ä¿è¯aå‡åº, ä¹‹åçš„å‰ç¼€å’Œè®¡ç®—å¯ä»¥æ­£ç¡®è¿›è¡Œ</span><br>    <span class="hljs-comment">// æˆ‘çš„æ„Ÿè§‰å°±æ˜¯ç”±äºæ‰€æœ‰aéƒ½æ˜¯åœ¨0åˆ°m-1ä¹‹é—´å¾ªç¯, è™½ç„¶ä¸ç¡®å®šåœ¨æ­£ç¡®ç­”æ¡ˆä¸­æ˜¯å‘ä¸ŠåŠ è¿˜æ˜¯å‘ä¸‹å‡, </span><br>    <span class="hljs-comment">// ä½†æ˜¯è¿˜æ˜¯ä¸€å®šåªæœ‰ä¸¤ä¸ªæ–¹å‘, è¿™æ ·å¤åˆ¶æ•°ç»„å†æ•´ä½“åŠ mçš„åšæ³•å…¶å®å°±æ˜¯ä¿ƒæˆä¸€ä¸ªåŠ ä¸€ä¸ªå‡.</span><br>    <span class="hljs-built_in">rep</span>(i, n + <span class="hljs-number">1</span>, <span class="hljs-number">2</span> * n) a[i] = a[i - n] + m;<br>    <span class="hljs-comment">// è®°å½•å‰ç¼€å’Œ</span><br>    <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">pre</span><span class="hljs-params">(<span class="hljs-number">2</span> * n + <span class="hljs-number">10</span>)</span></span>;<br>    <span class="hljs-built_in">rep</span>(i, <span class="hljs-number">1</span>, <span class="hljs-number">2</span> * n) pre[i] = a[i] + pre[i - <span class="hljs-number">1</span>];<br>    <span class="hljs-type">int</span> ans = <span class="hljs-number">1E18</span>;<br>    <span class="hljs-comment">// æšä¸¾ç¯ä¸Šæ¯ä¸ªç‚¹</span><br>    <span class="hljs-built_in">rep</span>(i, <span class="hljs-number">1</span>, n)<br>    &#123;<br>        <span class="hljs-type">int</span> l = i, r = i + n - <span class="hljs-number">1</span>;<br>        <span class="hljs-type">int</span> mid = (l + r + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>;<br>        <span class="hljs-type">int</span> res;<br>        <span class="hljs-keyword">if</span> (n % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// å¶æ•°çš„æ—¶å€™ï¼Œ[mid, r] - [l, mid - 1];</span><br>            res = pre[r] - <span class="hljs-number">2</span> * pre[mid - <span class="hljs-number">1</span>] + pre[l - <span class="hljs-number">1</span>];<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// å¥‡æ•°çš„æ—¶å€™ï¼Œ[mid + 1, r] - [l, mid - 1]; </span><br>            res = pre[r] - pre[mid] - pre[mid - <span class="hljs-number">1</span>] + pre[l - <span class="hljs-number">1</span>];<br>        &#125;<br>        ans = std::<span class="hljs-built_in">min</span>(ans, res);<br>    &#125;<br>    cout &lt;&lt; ans &lt;&lt; endl;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> t;<br>    cin &gt;&gt; t;<br>    <span class="hljs-keyword">while</span>(t -- )<br>    &#123;<br>        <span class="hljs-built_in">solve</span>();<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>ç®—æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>C++çº¿ç¨‹åº“ä½¿ç”¨è¯¦è§£</title>
    <link href="/2025/02/27/C++%E7%BA%BF%E7%A8%8B%E5%BA%93%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/"/>
    <url>/2025/02/27/C++%E7%BA%BF%E7%A8%8B%E5%BA%93%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h2 id="æ ¸å¿ƒæ“ä½œ"><a href="#æ ¸å¿ƒæ“ä½œ" class="headerlink" title="æ ¸å¿ƒæ“ä½œ"></a>æ ¸å¿ƒæ“ä½œ</h2><h3 id="çº¿ç¨‹åˆ›å»º"><a href="#çº¿ç¨‹åˆ›å»º" class="headerlink" title="çº¿ç¨‹åˆ›å»º"></a>çº¿ç¨‹åˆ›å»º</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// éœ€è¦ä¼ å…¥å›è°ƒå‡½æ•°, å¦‚æœæœ‰å‚æ•°ç´§è·Ÿåœ¨åé¢</span><br><span class="hljs-function">std::thread <span class="hljs-title">t1</span><span class="hljs-params">(print_hello, <span class="hljs-number">1</span>)</span></span>;  <br><span class="hljs-comment">// å½“ç„¶lambdaä¹Ÿå¯ä»¥å½“ä½œå›è°ƒå‡½æ•°ä¼ è¿›å»</span><br><span class="hljs-function">std::thread <span class="hljs-title">t</span><span class="hljs-params">([]() &#123;</span></span><br><span class="hljs-params"><span class="hljs-function">    std::cout &lt;&lt; <span class="hljs-string">&quot;Hello from lambda thread!&quot;</span> &lt;&lt; std::endl;</span></span><br><span class="hljs-params"><span class="hljs-function">&#125;)</span></span>;<br><span class="hljs-comment">// ä¹Ÿå¯ä»¥åˆ›å»ºæ—¶ä¼ å…¥å›è°ƒå‡½æ•°</span><br><span class="hljs-function">std::thread <span class="hljs-title">t</span><span class="hljs-params">(calculate_sum, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, print_result)</span></span>;<br></code></pre></td></tr></table></figure><h3 id="çº¿ç¨‹ç­‰å¾…"><a href="#çº¿ç¨‹ç­‰å¾…" class="headerlink" title="çº¿ç¨‹ç­‰å¾…"></a>çº¿ç¨‹ç­‰å¾…</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">t<span class="hljs-number">1.</span><span class="hljs-built_in">join</span>();<br></code></pre></td></tr></table></figure><ul><li><p>ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹ç­‰å¾…?</p><p>ç›®çš„åœ¨äº<strong>æ¥æ”¶ä¿¡æ¯å’ŒåŒæ­¥</strong>.</p><p> joinä¸­å¹¶æ²¡æœ‰å®é™…å’Œæ¥æ”¶ä¿¡æ¯ç›¸å…³çš„æ“ä½œ, ä¿¡æ¯äº¤æµæ˜¯é å…¶ä»–å‡ ç§çº¿ç¨‹é—´é€šä¿¡çš„æ–¹å¼æ¥å®ç°çš„. å…³é”®åœ¨äºå¦‚æœä¸ç”¨join, å°†æ— æ³•å®‰å…¨ä½¿ç”¨çº¿ç¨‹é—´é€šä¿¡å¾—æ¥çš„ä¿¡æ¯, å› ä¸ºå¦‚æœä¸ç­‰å¾…å­çº¿ç¨‹è¿è¡Œç»“æŸ, ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹å¹¶å‘è¿è¡Œ, ä¸»çº¿ç¨‹æ²¡æœ‰åŠæ³•ç¡®å®šä»€ä¹ˆæ—¶å€™å­çº¿ç¨‹ä¼šå¾—åˆ°ç»“æœå¹¶å‘é€è¿‡æ¥, ç®€å•æ¥è¯´å°±æ˜¯æ— æ³•å®ç°åŒæ­¥.</p></li><li><p>å¯ä»¥é€šè¿‡joinable()å‡½æ•°æ¥ç¡®å®šçº¿ç¨‹æ˜¯å¦å¯joinè€Œæœªè¢«åˆ†ç¦».</p></li></ul><h3 id="çº¿ç¨‹åˆ†ç¦»"><a href="#çº¿ç¨‹åˆ†ç¦»" class="headerlink" title="çº¿ç¨‹åˆ†ç¦»"></a>çº¿ç¨‹åˆ†ç¦»</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">t<span class="hljs-number">1.</span><span class="hljs-built_in">detach</span>();<br></code></pre></td></tr></table></figure><p>çº¿ç¨‹åˆ†ç¦»å°±æ˜¯ä¸ºäº†å®ç°å’Œçº¿ç¨‹ç­‰å¾…ç›¸åçš„ç›®çš„, ä¹Ÿå°±æ˜¯ä¸éœ€è¦åŒæ­¥çš„æƒ…å†µ, å½“ä»£ç ä¸éœ€è¦å’Œä¸»çº¿ç¨‹äº’é€šæœ‰æ— çš„æ—¶å€™ä¾¿å¯ä»¥è°ƒç”¨detach, è®©çº¿ç¨‹è‡ªå·±å¹²è‡ªå·±çš„å».</p><hr><h2 id="çº¿ç¨‹é—´é€šä¿¡"><a href="#çº¿ç¨‹é—´é€šä¿¡" class="headerlink" title="çº¿ç¨‹é—´é€šä¿¡"></a>çº¿ç¨‹é—´é€šä¿¡</h2><p>è¿™é‡Œçº¿ç¨‹é—´é€šä¿¡çš„å®šä¹‰å…¶å®å¾ˆå¹¿æ³›, å¯ä»¥ç»†åŒ–ä¸ºçº¿ç¨‹é—´æƒé™ç”³è¯·, æ•°æ®äº¤äº’, å‡½æ•°è°ƒç”¨ç­‰.</p><h3 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h3><ul><li>äº’æ–¥é”</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp">mutex mtx;<br>mtx.<span class="hljs-built_in">lock</span>();<br><span class="hljs-comment">//....</span><br>mtx.<span class="hljs-built_in">unlock</span>();<br></code></pre></td></tr></table></figure><ul><li>RAIIé£æ ¼çš„é”</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp">mutex mtx;<br>&#123;<br><span class="hljs-function">lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx)</span></span>; <span class="hljs-comment">// ç¦»å¼€ä½œç”¨åŸŸè‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•°è§£é”</span><br> <span class="hljs-comment">// ... ä½¿ç”¨lock_guardéœ€è¦æ§åˆ¶ä½œç”¨åŸŸ   </span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ¡ä»¶å˜é‡"><a href="#æ¡ä»¶å˜é‡" class="headerlink" title="æ¡ä»¶å˜é‡"></a>æ¡ä»¶å˜é‡</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Predicate&gt;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">wait</span><span class="hljs-params">(std::unique_lock&lt;std::mutex&gt;&amp; lock, Predicate pred)</span></span>;<br></code></pre></td></tr></table></figure><p>æ¡ä»¶å˜é‡éœ€è¦å’Œäº’æ–¥é”ç»‘å®š, å¹¶ä¸”éœ€è¦æ¡ä»¶æ’‘è…°, åœ¨ç­‰å¾…æ—¶æ˜¯å¦åŸå…ˆæŒæœ‰çš„é”, è¢«å”¤é†’æ—¶é‡æ–°å–å›æ‹¥æœ‰çš„é”å¹¶è¿›è¡Œä¹‹åçš„ä»£ç , æœ‰ä¸¤ç§æ–¹å¼åˆ¤æ–­æ¡ä»¶ : </p><ul><li>ç›´æ¥å¥—åœ¨whileå¾ªç¯é‡Œ, åªæœ‰ç¬¦åˆæ¡ä»¶æ‰èƒ½ç¦»å¼€å¾ªç¯, è¿™é‡Œå¾ªç¯ä¸æ˜¯æ„å‘³ç€è¦é¢‘ç¹åˆ¤æ–­, waitæœ¬èº«æ˜¯é˜»å¡çš„, è€Œæ˜¯ä¸ºäº†é¿å…è™šå‡å”¤é†’çš„æƒ…å†µ, å¯ä»¥ç†è§£ä¸ºç³»ç»Ÿé—®é¢˜.</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp">std::mutex mtx;                    <span class="hljs-comment">// äº’æ–¥é‡</span><br>std::condition_variable cv;         <span class="hljs-comment">// æ¡ä»¶å˜é‡</span><br><span class="hljs-comment">// ...</span><br><span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lck</span><span class="hljs-params">(mtx)</span></span>;<br><span class="hljs-keyword">while</span> (!ready) &#123;               <span class="hljs-comment">// ä½¿ç”¨whileå¾ªç¯é¿å…è™šå‡å”¤é†’</span><br>    cv.<span class="hljs-built_in">wait</span>(lck);               <span class="hljs-comment">// ç­‰å¾…é€šçŸ¥</span><br>&#125;<br><span class="hljs-comment">// ... å¦ä¸€ä¸ªçº¿ç¨‹</span><br>cv.<span class="hljs-built_in">notify_all</span>(); <br>cv.<span class="hljs-built_in">notify_one</span>();<br></code></pre></td></tr></table></figure><ul><li><p>ä½¿ç”¨waitçš„ç¬¬äºŒä¸ªå‚æ•°, ä¼ å…¥ä¸€ä¸ªè¿”å›å€¼ä¸ºboolç±»å‹çš„å›è°ƒå‡½æ•°, å®˜æ–¹ç§°å…¶ä¸ºè°“è¯.</p><p>è°“è¯åªåœ¨ç¬¬ä¸€æ¬¡è§¦å‘waitå’Œè¢«å”¤é†’ä¹‹åå‘ç”Ÿ, å¦‚æœè°“è¯è¿”å›å€¼ä¸ºtrue, åˆ™ç»§ç»­åé¢çš„ä»£ç , åä¹‹ç»§ç»­é˜»å¡æŒ‚èµ·.</p></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp">condition.<span class="hljs-built_in">wait</span>(lock, [<span class="hljs-keyword">this</span>] &#123;  <span class="hljs-comment">// æ•è·this,ä½¿ä¹‹å¯ä»¥ä½¿ç”¨æˆå‘˜å‡½æ•°å’Œå˜é‡</span><br>    <span class="hljs-keyword">return</span> stop || !taskQueue.<span class="hljs-built_in">empty</span>();<br>&#125;);<br></code></pre></td></tr></table></figure><p>å…¶å®åº•å±‚å°±æ˜¯å¯¹Cé£æ ¼äº’æ–¥é”å’Œæ¡ä»¶å˜é‡çš„å°è£….</p><h3 id="å…±äº«å†…å­˜"><a href="#å…±äº«å†…å­˜" class="headerlink" title="å…±äº«å†…å­˜"></a>å…±äº«å†…å­˜</h3><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸å®½æ³›çš„æ¦‚å¿µ, æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªè¿›ç¨‹çš„ä¸åŒçº¿ç¨‹é—´æ•°æ®å—,å †éƒ½æ˜¯å…±äº«çš„, æ‰€ä»¥åœ¨å…¶ä¸­ç”³è¯·çš„èµ„æºéƒ½æ˜¯å…±äº«å†…å­˜, é”ä¹Ÿæ˜¯ä¸ºäº†åº”å¯¹ä½¿ç”¨å…±äº«å†…å­˜çš„æƒ…å†µè€Œè¢«è®¾è®¡çš„.</p><h3 id="æ¶ˆæ¯é˜Ÿåˆ—"><a href="#æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—"></a>æ¶ˆæ¯é˜Ÿåˆ—</h3><p>å…¶å®å°±æ˜¯STLä¸­çš„queue, è¿™ä¸ªå®¹å™¨å…¶å®éå¸¸å¼ºå¤§, å› ä¸ºå…¶æ˜¯çº¿ç¨‹å®‰å…¨çš„, ä¾‹å¦‚æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨ç”Ÿäº§è€…çº¿ç¨‹ä¸­å°†äº§ç‰©pushè¿›queue, ç„¶åç›´æ¥åœ¨æ¶ˆè´¹è€…çº¿ç¨‹ä¸­ä»queueä¸­å–å‡º, è¿™å…¶ä¸­æ²¡æœ‰ä»»ä½•çº¿ç¨‹å®‰å…¨é—®é¢˜!</p><h3 id="futureå’Œpromise"><a href="#futureå’Œpromise" class="headerlink" title="futureå’Œpromise"></a>futureå’Œpromise</h3><p>futureå¯ä»¥å¾—åˆ°æœªæ¥ä»å…¶ä»–çº¿ç¨‹ä¼ æ¥çš„ä¸€ä¸ªç»“æœ. </p><p>è¿™é‡Œåªä»‹ç»futureåœ¨çº¿ç¨‹ä¸­çš„æ™®é€šç”¨æ³•, ä¸€èˆ¬å’Œpromiseå…±ç”¨.</p><ul><li>future : æœªæ¥, ç”¨äºè¡¨ç¤ºåœ¨æœªæ¥è¿™é‡Œä¼šè·å–ä¸€ä¸ªç»“æœ.</li><li>promise : æ‰¿è¯º, å¯ä»¥å’Œfutureå…³è”, æ‰¿è¯ºä¼šè®¾ç½®futureè¦è·å–çš„ç»“æœ.</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp">std::promise&lt;<span class="hljs-type">int</span>&gt; prom;  <br>std::future&lt;<span class="hljs-type">int</span>&gt; fut = prom.<span class="hljs-built_in">get_future</span>(); <span class="hljs-comment">// å°†promiseå’Œfutureå…³è”</span><br><br><span class="hljs-function">std::thread <span class="hljs-title">t</span><span class="hljs-params">([&amp;prom]() &#123; <span class="hljs-comment">// æ•è·promä¼ å…¥çº¿ç¨‹</span></span></span><br><span class="hljs-params"><span class="hljs-function">    <span class="hljs-type">int</span> result = <span class="hljs-number">42</span>; <span class="hljs-comment">// æ¨¡æ‹Ÿè®¡ç®—</span></span></span><br><span class="hljs-params"><span class="hljs-function">    prom.set_value(result); <span class="hljs-comment">// promiseå°†ç»“æœä¼ é€’ç»™future</span></span></span><br><span class="hljs-params"><span class="hljs-function">&#125;)</span></span>;<br><br><span class="hljs-type">int</span> value = fut.<span class="hljs-built_in">get</span>(); <span class="hljs-comment">// é˜»å¡ç›´åˆ°è·å–ç»“æœ</span><br>t.<span class="hljs-built_in">join</span>();<br>std::cout &lt;&lt; <span class="hljs-string">&quot;Result: &quot;</span> &lt;&lt; value &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;<br></code></pre></td></tr></table></figure><ul><li><p>async  : <code>async</code> æ˜¯ <strong>asynchronous</strong> çš„ç¼©å†™ï¼Œè¡¨ç¤ºâ€œå¼‚æ­¥â€çš„æ„æ€. ä¸è¿‡å¼‚æ­¥è¿™ä¸ªæ„ä¹‰å¾ˆå®½æ³›, å¾ˆå¤šéƒ½å¯ä»¥è¢«è§†ä¸ºå¼‚æ­¥. æœ‰äº›å¼‚æ­¥ç›¸å¯¹å¤æ‚, æ¯”å¦‚å¼‚æ­¥I&#x2F;O, æœ‰äº›æœ‰ååˆ†ç®€å•, æ¯”å¦‚æˆ‘ä»¬ç°åœ¨å­¦çš„async.</p><p>å…¶å®å®ƒçš„å®é™…åŠŸæ•ˆå°±æ˜¯ä¸Šé¢future + promise + threadçš„ç»Ÿåˆ, å¯ä»¥ç†è§£ä¸º<strong>å’Œfutureå¼ºç»‘å®šçš„thread</strong>.</p><p>å¯ä»¥å‘asyncä¸­ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°, asyncä¼šç›´æ¥åœ¨ä¸€ä¸ªæ–°çº¿ç¨‹ä¸­è¿è¡Œå®ƒ, ä¼šè¿”å›ä¸€ä¸ªfutureå¯¹è±¡, æ–°çº¿ç¨‹è¿è¡Œç»“æŸä¼šå°†ç»“æœè®¾ç½®åˆ°futureå¯¹è±¡ä¸­.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt; <span class="hljs-keyword">class</span> <span class="hljs-title class_">F</span>, <span class="hljs-keyword">class</span>... Args &gt;<br>std::future&lt;std::<span class="hljs-type">invoke_result_t</span>&lt;F, Args...&gt;&gt; <br>  <span class="hljs-built_in">async</span>(F&amp;&amp; f, Args&amp;&amp;... args);<br></code></pre></td></tr></table></figure><ul><li>f : ç”¨äºç¡®å®šasyncçš„å¯åŠ¨ç­–ç•¥, ä¸€èˆ¬å†™<code>std::launch::async</code>, ä»£è¡¨å¼ºåˆ¶ä»»åŠ¡åœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œ.</li><li>args : å¯å˜å‚æ•°, ä¼ å…¥å›è°ƒå‡½æ•°éœ€è¦çš„å‚æ•°.</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// ä½¿ç”¨ std::async å¯åŠ¨ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡</span><br>std::future&lt;<span class="hljs-type">int</span>&gt; fut = std::<span class="hljs-built_in">async</span>(std::launch::async, []() &#123;<br>    <span class="hljs-type">int</span> result = <span class="hljs-number">42</span>; <span class="hljs-comment">// æ¨¡æ‹Ÿè®¡ç®—</span><br>    <span class="hljs-keyword">return</span> result;   <span class="hljs-comment">// è¿”å›ç»“æœ</span><br>&#125;);<br><span class="hljs-comment">// è·å–ç»“æœï¼ˆä¼šé˜»å¡ç›´åˆ°ä»»åŠ¡å®Œæˆï¼‰</span><br><span class="hljs-type">int</span> value = fut.<span class="hljs-built_in">get</span>();<br>std::cout &lt;&lt; <span class="hljs-string">&quot;Result: &quot;</span> &lt;&lt; value &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;<br></code></pre></td></tr></table></figure></li></ul><h3 id="å…±äº«å†…å­˜-vs-æ¶ˆæ¯é˜Ÿåˆ—-vs-future"><a href="#å…±äº«å†…å­˜-vs-æ¶ˆæ¯é˜Ÿåˆ—-vs-future" class="headerlink" title="å…±äº«å†…å­˜ vs æ¶ˆæ¯é˜Ÿåˆ— vs future"></a>å…±äº«å†…å­˜ vs æ¶ˆæ¯é˜Ÿåˆ— vs future</h3><p>è¿™ä¸‰ä¸ªå…¶å®éƒ½å¯ä»¥åšåˆ°çº¿ç¨‹é—´ä¼ é€’æ•°æ®, ä½†æ˜¯åº”ç”¨åœºæ™¯ä¸åŒ.</p><ul><li>å…±äº«å†…å­˜ : ç”¨äºå¤šæ•°æ®, éœ€æ±‚å¤æ‚çš„æƒ…å†µ, éœ€è¦äº’æ–¥é”å’Œæ¡ä»¶å˜é‡ç»´æŠ¤.</li><li>æ¶ˆæ¯é˜Ÿåˆ— : é€‚åˆç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹, ç®€å•æ˜“ç”¨, çº¿ç¨‹å®‰å…¨, ä½†æ˜¯éœ€è¦æ’é˜Ÿ, å¯èƒ½éœ€è¦æ¡ä»¶å˜é‡é…åˆ.</li><li>future : åªä¼ é€’å•æ•°æ®, ç®€å•æ˜“ç”¨, å¹¶ä¸”çº¿ç¨‹å®‰å…¨ä¸éœ€è¦è€ƒè™‘é¢å¤–å†…å®¹.</li></ul><h3 id="atomic"><a href="#atomic" class="headerlink" title="atomic"></a>atomic</h3><p>åŸå­æ“ä½œæœ¬èº«å’Œçº¿ç¨‹é—´é€šä¿¡æ²¡å…³ç³», åªæ˜¯å®ƒæœ¬èº«å°±æ˜¯ä¸ºäº†æœåŠ¡å¤šçº¿ç¨‹ç¯å¢ƒçš„ä¸€ç§è¯­æ³•, å¯ä»¥å‡å°‘çº¿ç¨‹é—´é€šä¿¡çš„å‘ç”Ÿ, å–æ¶ˆéƒ¨åˆ†èµ„æºå¯¹äº’æ–¥é”çš„ä½¿ç”¨, æ¯•ç«Ÿå®ƒæ˜¯åŸå­çš„, æ ¹æœ¬ä¸éœ€è¦é”.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp">std::atomic&lt;<span class="hljs-type">int</span>&gt; x&#123;<span class="hljs-number">0</span>&#125;;  <span class="hljs-comment">// åˆå§‹åŒ–åŸå­å˜é‡</span><br>x.<span class="hljs-built_in">store</span>(<span class="hljs-number">10</span>);  <span class="hljs-comment">// ä½¿ç”¨ store è¿›è¡Œèµ‹å€¼</span><br><span class="hljs-type">int</span> value = x.<span class="hljs-built_in">load</span>();  <span class="hljs-comment">// è¿”å›åŸå­å˜é‡ x çš„å€¼</span><br><span class="hljs-type">int</span> old1 = x.<span class="hljs-built_in">fetch_add</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// å…ˆè¿”å› x çš„å€¼ï¼Œç„¶åå°†å…¶åŠ  1</span><br><span class="hljs-type">int</span> old2 = x.<span class="hljs-built_in">fetch_sub</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// å…ˆè¿”å› x çš„å€¼ï¼Œç„¶åå°†å…¶å‡ 1</span><br><span class="hljs-type">int</span> old_value = x.<span class="hljs-built_in">exchange</span>(<span class="hljs-number">20</span>);  <span class="hljs-comment">// å°† x çš„å€¼è®¾ä¸º 20ï¼Œè¿”å›åŸæ¥çš„å€¼</span><br><span class="hljs-comment">// å¦‚æœå½“å‰å€¼ç­‰äº expectedï¼Œåˆ™å°†å…¶æ›¿æ¢ä¸º desiredï¼Œè¿”å›æ˜¯å¦æˆåŠŸ</span><br><span class="hljs-type">bool</span> success = x.<span class="hljs-built_in">compare_exchange_strong</span>(expected, desired); <br><span class="hljs-type">int</span> old3 = x.<span class="hljs-built_in">fetch_and</span>(<span class="hljs-number">0xFF</span>);  <span class="hljs-comment">// ä¸ 0xFF è¿›è¡ŒæŒ‰ä½ä¸æ“ä½œ</span><br><span class="hljs-type">int</span> old4 = x.<span class="hljs-built_in">fetch_or</span>(<span class="hljs-number">0xFF</span>);  <span class="hljs-comment">// ä¸ 0xFF è¿›è¡ŒæŒ‰ä½æˆ–æ“ä½œ</span><br><span class="hljs-type">int</span> old5 = x.<span class="hljs-built_in">fetch_xor</span>(<span class="hljs-number">0xFF</span>);  <span class="hljs-comment">// ä¸ 0xFF è¿›è¡ŒæŒ‰ä½å¼‚æˆ–æ“ä½œ</span><br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„atomicçš„æ¨¡æ¿ç±»å¿…é¡»æ˜¯æ™®é€šç±»å‹, è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ : åœ¨ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹ä¸­å…¨æ˜¯æ™®é€šç±»å‹å…è®¸å¡«å…¥, æœ¯è¯­å«åšPOD.</p><hr><h2 id="this-thread"><a href="#this-thread" class="headerlink" title="this_thread"></a>this_thread</h2><p>è¿™æ˜¯ C++11 å¼•å…¥çš„ä¸€ä¸ªå‘½åç©ºé—´ï¼Œç”¨æ¥æä¾›ä¸€äº›å’Œå½“å‰çº¿ç¨‹ç›¸å…³çš„æ“ä½œ.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sleep_for</span><span class="hljs-params">(<span class="hljs-type">const</span> std::chrono::duration&amp; d)</span></span>; <span class="hljs-comment">// ä½¿å½“å‰çº¿ç¨‹æŒ‚èµ·æŒ‡å®šçš„æ—¶é—´</span><br>std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">seconds</span>(<span class="hljs-number">2</span>));  <span class="hljs-comment">// ä¼‘çœ 2ç§’</span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sleep_until</span><span class="hljs-params">(<span class="hljs-type">const</span> std::chrono::time_point&amp; t)</span></span>;  <span class="hljs-comment">// ä½¿è¿›ç¨‹æŒ‚èµ·åˆ°æŒ‡å®šçš„æ—¶é—´</span><br><span class="hljs-keyword">auto</span> wakeup_time = std::chrono::system_clock::<span class="hljs-built_in">now</span>() + std::chrono::<span class="hljs-built_in">seconds</span>(<span class="hljs-number">3</span>);  <span class="hljs-comment">// 3ç§’å</span><br>std::this_thread::<span class="hljs-built_in">sleep_until</span>(wakeup_time);  <span class="hljs-comment">// ä¼‘çœ ç›´åˆ°æŒ‡å®šæ—¶é—´</span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">yield</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">// ä¸€ä¸ªè¯·æ±‚, è¡¨ç¤ºå½“å‰çº¿ç¨‹æ„¿æ„è®©å‡ºcpuçš„æ—¶é—´ç‰‡, å‡å¦‚çº¿ç¨‹é—´çš„ä¼˜å…ˆåº¦ä¸åŒå¯ä»¥ä½¿ç”¨</span><br>std::this_thread::<span class="hljs-built_in">yield</span>();<br></code></pre></td></tr></table></figure><hr><h2 id="threadçš„ç§»åŠ¨è¯­ä¹‰"><a href="#threadçš„ç§»åŠ¨è¯­ä¹‰" class="headerlink" title="threadçš„ç§»åŠ¨è¯­ä¹‰"></a>threadçš„ç§»åŠ¨è¯­ä¹‰</h2><p>çº¿ç¨‹å¯¹è±¡ä¸å¯å¤åˆ¶, å› ä¸ºçº¿ç¨‹æœ¬èº«å°±ä¸å¥½å¤åˆ¶, ä»åº•å±‚æ¥è®²threadç±»çš„æ‹·è´æ„é€ å‡½æ•°æœ¬èº«å°±æ˜¯åˆ é™¤çš„.</p><p>ä½†æ˜¯threadç±»å¯ä»¥è¢«ç§»åŠ¨, å…¶å®å°±ç›¸å½“äºè½¬ç§»æ§åˆ¶æƒ, å¯ä»¥ä½¿ç”¨moveè½¬æ¢.</p><p>å‡å¦‚æˆ‘ä»¬æƒ³æŠŠå¤šä¸ªçº¿ç¨‹å­˜å…¥ä¸€ä¸ªvectorä¸­, å¯ä»¥ä½¿ç”¨emplace_backåœ¨vectorä¸­ç›´æ¥æ„å»º, ä¹Ÿå¯ä»¥é€‰æ‹©åœ¨å¤–éƒ¨æ„å»ºç„¶åç”¨moveç§»åŠ¨è¿›å».</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">std::thread <span class="hljs-title">t</span><span class="hljs-params">(task)</span></span>;  <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ t</span><br>threads.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">move</span>(t));<br></code></pre></td></tr></table></figure><hr><h2 id="ç®€æ˜“çº¿ç¨‹æ± "><a href="#ç®€æ˜“çº¿ç¨‹æ± " class="headerlink" title="ç®€æ˜“çº¿ç¨‹æ± "></a>ç®€æ˜“çº¿ç¨‹æ± </h2><p>AIç”Ÿæˆä»…ä¾›å­¦ä¹  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;functional&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;condition_variable&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;atomic&gt;</span></span><br><br><span class="hljs-comment">// çº¿ç¨‹æ± ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPool</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">ThreadPool</span>(<span class="hljs-type">size_t</span> numThreads) &#123;<br>        <span class="hljs-comment">// å¯åŠ¨æŒ‡å®šæ•°é‡çš„å·¥ä½œçº¿ç¨‹</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; numThreads; ++i) &#123;<br>            workers.<span class="hljs-built_in">emplace_back</span>([<span class="hljs-keyword">this</span>] &#123;<br>                <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>                    std::function&lt;<span class="hljs-built_in">void</span>()&gt; task;<br>                    &#123;<br>                        std::unique_lock&lt;std::mutex&gt; <span class="hljs-built_in">lock</span>(queueMutex);<br>                        condition.<span class="hljs-built_in">wait</span>(lock, [<span class="hljs-keyword">this</span>] &#123;<br>                            <span class="hljs-keyword">return</span> stop || !taskQueue.<span class="hljs-built_in">empty</span>();<br>                        &#125;); <span class="hljs-comment">// ç›´åˆ°return è¿”å› tureæ‰èƒ½è¿›è¡Œ</span><br>                        <br>                        <span class="hljs-comment">// å¦‚æœçº¿ç¨‹æ± åœæ­¢ä¸”ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºï¼Œé€€å‡ºçº¿ç¨‹</span><br>                        <span class="hljs-keyword">if</span> (stop &amp;&amp; taskQueue.<span class="hljs-built_in">empty</span>()) &#123;<br>                            <span class="hljs-keyword">return</span>;<br>                        &#125;<br><span class="hljs-comment">// å–å‡ºé˜Ÿåˆ—ä¸èƒ½æ‹·è´, è¦ç§»åŠ¨</span><br>                        task = std::<span class="hljs-built_in">move</span>(taskQueue.<span class="hljs-built_in">front</span>()); <br>                        taskQueue.<span class="hljs-built_in">pop</span>();<br>                    &#125;<br>                    <span class="hljs-comment">// æ‰§è¡Œä»»åŠ¡</span><br>                    <span class="hljs-built_in">task</span>();<br>                &#125;<br>            &#125;);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// æäº¤ä»»åŠ¡</span><br>    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">F</span>&gt;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">enqueue</span><span class="hljs-params">(F&amp;&amp; f)</span> </span>&#123;<br>        &#123;<br>            <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(queueMutex)</span></span>;<br>            <span class="hljs-keyword">if</span> (stop) &#123;<br>                <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">runtime_error</span>(<span class="hljs-string">&quot;ThreadPool is stopped&quot;</span>);<br>            &#125;<br>            taskQueue.<span class="hljs-built_in">push</span>(std::forward&lt;F&gt;(f)); <span class="hljs-comment">// å®Œç¾è½¬å‘åˆ°é˜Ÿåˆ—ä¸­</span><br>        &#125;<br>        condition.<span class="hljs-built_in">notify_one</span>(); <span class="hljs-comment">// ä¼ å…¥ä¸€ä¸ªä»»åŠ¡, å°±æ¿€æ´»ç­‰å¾…ä¸­çš„ä¸€ä¸ªçº¿ç¨‹</span><br>    &#125;<br><br>    <span class="hljs-comment">// åœæ­¢çº¿ç¨‹æ± </span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">stopPool</span><span class="hljs-params">()</span> </span>&#123;<br>        &#123;<br>            <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(queueMutex)</span></span>;<br>            stop = <span class="hljs-literal">true</span>;<br>        &#125;<br>        condition.<span class="hljs-built_in">notify_all</span>();<br><br>        <span class="hljs-keyword">for</span> (std::thread&amp; worker : workers) &#123;<br>            worker.<span class="hljs-built_in">join</span>();<br>        &#125;<br>    &#125;<br><br>    ~<span class="hljs-built_in">ThreadPool</span>() &#123;<br>        <span class="hljs-keyword">if</span> (!stop) &#123;<br>            <span class="hljs-built_in">stopPool</span>();<br>        &#125;<br>    &#125;<br><br><span class="hljs-keyword">private</span>:<br>    std::vector&lt;std::thread&gt; workers;           <span class="hljs-comment">// å·¥ä½œçº¿ç¨‹</span><br>    std::queue&lt;std::function&lt;<span class="hljs-type">void</span>()&gt;&gt; taskQueue;  <span class="hljs-comment">// ä»»åŠ¡é˜Ÿåˆ—</span><br>    std::mutex queueMutex;                      <span class="hljs-comment">// ä»»åŠ¡é˜Ÿåˆ—äº’æ–¥é”</span><br>    std::condition_variable condition;          <span class="hljs-comment">// æ¡ä»¶å˜é‡</span><br>    std::atomic&lt;<span class="hljs-type">bool</span>&gt; stop&#123;<span class="hljs-literal">false</span>&#125;;              <span class="hljs-comment">// æ˜¯å¦åœæ­¢çº¿ç¨‹æ± </span><br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-function">ThreadPool <span class="hljs-title">pool</span><span class="hljs-params">(<span class="hljs-number">4</span>)</span></span>;  <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªåŒ…å«4ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± </span><br>    <span class="hljs-comment">// æäº¤å‡ ä¸ªä»»åŠ¡ç»™çº¿ç¨‹æ± æ‰§è¡Œ</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i) &#123;<br>        pool.<span class="hljs-built_in">enqueue</span>([i] &#123;<br>            std::cout &lt;&lt; <span class="hljs-string">&quot;Task &quot;</span> &lt;&lt; i &lt;&lt; <span class="hljs-string">&quot; is being executed by thread &quot;</span> <br>                      &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() &lt;&lt; std::endl;<br>        &#125;);<br>    &#125;<br>    <span class="hljs-comment">// åœæ­¢çº¿ç¨‹æ± </span><br>    pool.<span class="hljs-built_in">stopPool</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>å¤šçº¿ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç®—æ³•å¤å¥ å‰ç¼€å’Œ|æ»‘åŠ¨çª—å£|åˆå¹¶åŒºé—´</title>
    <link href="/2025/02/25/%5B%E7%AE%97%E6%B3%95%E5%A4%8D%E5%81%A5%5D%20%E5%89%8D%E7%BC%80%E5%92%8C%20%20%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%20%20%E5%90%88%E5%B9%B6%E5%8C%BA%E9%97%B4/"/>
    <url>/2025/02/25/%5B%E7%AE%97%E6%B3%95%E5%A4%8D%E5%81%A5%5D%20%E5%89%8D%E7%BC%80%E5%92%8C%20%20%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%20%20%E5%90%88%E5%B9%B6%E5%8C%BA%E9%97%B4/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰ç¼€å’Œ"><a href="#å‰ç¼€å’Œ" class="headerlink" title="å‰ç¼€å’Œ"></a>å‰ç¼€å’Œ</h2><blockquote><p><lc560>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªæ•´æ•° <code>k</code> ï¼Œè¯·ä½ ç»Ÿè®¡å¹¶è¿”å› <em>è¯¥æ•°ç»„ä¸­å’Œä¸º <code>k</code> çš„å­æ•°ç»„çš„ä¸ªæ•°</em> ã€‚å­æ•°ç»„æ˜¯æ•°ç»„ä¸­å…ƒç´ çš„è¿ç»­éç©ºåºåˆ—ã€‚O(nlogn)  </p></blockquote><p>è¿™é“é¢˜çš„å…³é”®åœ¨äºå¦‚ä½•ä»¥O(1)çš„å¤æ‚åº¦å‘ç°å’Œä¸ºkçš„å­æ•°ç»„ä¸ªæ•°, é‡ç‚¹åœ¨äºå­æ•°ç»„ä¸€å®šè¿ç»­, è¿ç»­çš„ä¸€æ®µåŒºé—´çš„å’Œå¯ä»¥ç”¨å‰ç¼€ä»¥O(1)æ±‚å¾—, é—®é¢˜åœ¨äºå¦‚ä½•çŸ¥é“è¿™æ ·çš„æ•°çš„ä¸ªæ•°.</p><p>å¯¹äºè¿ç®—åˆ°ç¬¬iå¤„çš„å‰ç¼€per[i], å‰é¢å¯ä»¥å’Œå…¶ç›¸å‡å¾—åˆ°kçš„per, æœ‰æˆ–æ²¡æœ‰, æœ‰å¤šå°‘éƒ½æ˜¯é—®é¢˜, é‚£ä¹ˆå°±å¯ä»¥è¿›è¡Œperå€¼çš„å­˜å‚¨, è¦æŠŠå…¶æ•°é‡ä¹Ÿä¸€å¹¶è®°å½•, é‚£ä¹ˆç”¨mapå°±å¯ä»¥äº†.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">subarraySum</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums, <span class="hljs-type">int</span> k)</span></span>&#123;<br>        <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">pre</span><span class="hljs-params">(nums.size() + <span class="hljs-number">10</span>)</span></span>;<br>        map&lt;<span class="hljs-type">int</span>, <span class="hljs-type">int</span>&gt; mp; <span class="hljs-comment">// &lt;å‰ç¼€å’Œ, å‡ºç°çš„æ¬¡æ•°&gt;</span><br>        mp[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;<br>        <span class="hljs-type">int</span> ans = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; nums.<span class="hljs-built_in">size</span>(); i ++ )<br>        &#123;<br>            pre[i] = nums[i];<br>            <span class="hljs-keyword">if</span>(i != <span class="hljs-number">0</span>) pre[i] += pre[i - <span class="hljs-number">1</span>];<br>            <span class="hljs-keyword">if</span>(mp.<span class="hljs-built_in">count</span>(pre[i] - k)) ans += mp[pre[i] - k];<br>            mp[pre[i]]++;<br>        &#125;<br>        <span class="hljs-keyword">return</span> ans;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="æ»‘åŠ¨çª—å£"><a href="#æ»‘åŠ¨çª—å£" class="headerlink" title="æ»‘åŠ¨çª—å£"></a>æ»‘åŠ¨çª—å£</h2><blockquote><p><lc239>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code>ï¼Œæœ‰ä¸€ä¸ªå¤§å°ä¸º <code>k</code> çš„æ»‘åŠ¨çª—å£ä»æ•°ç»„çš„æœ€å·¦ä¾§ç§»åŠ¨åˆ°æ•°ç»„çš„æœ€å³ä¾§ã€‚ä½ åªå¯ä»¥çœ‹åˆ°åœ¨æ»‘åŠ¨çª—å£å†…çš„ <code>k</code> ä¸ªæ•°å­—ã€‚æ»‘åŠ¨çª—å£æ¯æ¬¡åªå‘å³ç§»åŠ¨ä¸€ä½ã€‚è¿”å› <em>æ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§å€¼</em> ã€‚</p></blockquote><p>æ ‡å‡†ä¾‹é¢˜, æ·±å…¥ç†è§£çš„å…³é”®åœ¨äºè¿™é‡Œçš„æ»‘åŠ¨çª—å£æ˜¯ä¸€ä¸ªå›ºå®šå€¼, å°±è¦æŠŠæ§åˆ¶çª—å£çš„å˜é‡å’Œé˜Ÿåˆ—çš„æ“ä½œåˆ†æ¸…æ¥š.</p><ul><li><p>é˜Ÿåˆ— : æœ¬é¢˜ä¸­è¦ç»´æŠ¤çš„æ˜¯ä¸€ä¸ªå•å‡é˜Ÿåˆ—, å°±æ˜¯ä¸ºäº†ä¿è¯é˜Ÿå¤´ä¸€å®šæ˜¯æœ€å¤§å€¼, ä¸ºäº†å®ç°è¿™ä¸ªç›®çš„, åªè¦æ–°å…ƒç´ æ¯”é˜Ÿå°¾å…ƒç´ å°å°±è¦å¼¹å‡ºé˜Ÿå°¾å…ƒç´ , ç›´åˆ°é‡åˆ°å¤§äºç­‰äºçš„.</p></li><li><p>çª—å£ : çª—å£çš„ç§»åŠ¨åœ¨éå†ä¸­å®ç°, å¯ä»¥æƒ³åˆ°åªè¦<code>i - k &gt;= 0</code>, æ¯æ¬¡å‘åç§»åŠ¨ä¸€æ ¼å°±ä¸€å®šä¼šç¦»å¼€ä¸€ä¸ªåŠ å…¥ä¸€ä¸ª.</p></li><li><p>é—®é¢˜çš„å…³é”®åœ¨äºé˜Ÿåˆ—ä¼šæå‰å¼¹å‡ºéƒ¨åˆ†å…ƒç´ , æ‰€ä»¥é˜Ÿåˆ—çš„å®é™…å¤§å°å’ŒåŸçª—å£æ˜¯åŒ¹é…ä¸ä¸Šçš„, ä¹Ÿå°±æ˜¯è¯´, å³ä½¿<code>i - k &gt;= 0</code>, å¦‚æœé˜Ÿå¤´è¿˜æ²¡æœ‰åˆ°åº”è¯¥å¼¹å‡ºçš„æ—¶é—´, å°±ä¸èƒ½å¼¹å‡º, è€Œåˆ°äº†åº”è¯¥å¼¹å‡ºçš„æ—¶å€™å°±å¿…é¡»å¼¹å‡º.</p></li><li><p>é—®é¢˜å°±è½¬åŒ–æˆäº† : <strong>éšç€çª—å£çš„ç§»åŠ¨, å¦‚ä½•ç¡®å®šé˜Ÿå¤´æ‰€åœ¨çš„å…ƒç´ æ˜¯å¦ç¦»å¼€äº†åŒºåŸŸ?</strong></p><p>å…¶å®åªéœ€è¦å¯¹æ¯”å½“å‰è¦ç¦»å¼€çš„å…ƒç´ æ˜¯å¦å’Œé˜Ÿå¤´å…ƒç´ å€¼ç›¸ç­‰å°±è¡Œäº†, å› ä¸ºå¦‚æœæ˜¯å…¶ä»–å€¼, å°±ä¸€å®šæ˜¯è¿˜æ²¡è½®åˆ°é˜Ÿå¤´, ä¸ç„¶ä¸å¯èƒ½ä¼šå‡ºç°è¿™ä¸ªé˜Ÿå¤´å­˜åœ¨çš„æƒ…å†µ.</p></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    deque&lt;<span class="hljs-type">int</span>&gt; dq;<br>    <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">maxSlidingWindow</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums, <span class="hljs-type">int</span> k)</span> </span>&#123;<br>        <span class="hljs-comment">// å°†kèŒƒå›´çš„å†…å®¹å…ˆå…¥é˜Ÿ, æ±‚æœ€å¤§å€¼</span><br>        vector&lt;<span class="hljs-type">int</span>&gt; ret;<br>        <span class="hljs-type">int</span> n = nums.<span class="hljs-built_in">size</span>();<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i ++ )<br>        &#123;<br>            <span class="hljs-comment">// æŠŠå°çš„éƒ½å»æ‰, å› ä¸ºä¸ä¼šå½±å“æœ€å¤§å€¼, å½“å‰æœ€å¤§å€¼å°±ä¸€å®šåœ¨é˜Ÿå¤´</span><br>            <span class="hljs-keyword">while</span>(dq.<span class="hljs-built_in">size</span>() &amp;&amp; dq.<span class="hljs-built_in">back</span>() &lt; nums[i]) dq.<span class="hljs-built_in">pop_back</span>();<br>            dq.<span class="hljs-built_in">push_back</span>(nums[i]);<br>            <span class="hljs-keyword">if</span>(i - k  &gt;= <span class="hljs-number">0</span> &amp;&amp; dq.<span class="hljs-built_in">front</span>() == nums[i - k]) dq.<span class="hljs-built_in">pop_front</span>();<br>            <span class="hljs-keyword">if</span>(i - k + <span class="hljs-number">1</span> &gt;= <span class="hljs-number">0</span>) ret.<span class="hljs-built_in">push_back</span>(dq.<span class="hljs-built_in">front</span>());<br>        &#125;<br>        <span class="hljs-keyword">return</span> ret;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="åˆå¹¶åŒºé—´"><a href="#åˆå¹¶åŒºé—´" class="headerlink" title="åˆå¹¶åŒºé—´"></a>åˆå¹¶åŒºé—´</h2><blockquote><p><lc56>ä»¥æ•°ç»„ <code>intervals</code> è¡¨ç¤ºè‹¥å¹²ä¸ªåŒºé—´çš„é›†åˆï¼Œå…¶ä¸­å•ä¸ªåŒºé—´ä¸º <code>intervals[i] = [starti, endi]</code> ã€‚è¯·ä½ åˆå¹¶æ‰€æœ‰é‡å çš„åŒºé—´ï¼Œå¹¶è¿”å› <em>ä¸€ä¸ªä¸é‡å çš„åŒºé—´æ•°ç»„ï¼Œè¯¥æ•°ç»„éœ€æ°å¥½è¦†ç›–è¾“å…¥ä¸­çš„æ‰€æœ‰åŒºé—´</em> ã€‚</p></blockquote><p>ä¾‹é¢˜, æ ¸å¿ƒåœ¨äºåŒºé—´éœ€è¦æ’åº, æˆ‘ä»¬éœ€è¦åœ¨å·¦ç«¯ç‚¹ä»å°åˆ°è¾¾æ’åˆ—çš„å‰æä¸‹å»åˆ†ææ‰èƒ½æœ‰æ•ˆ.</p><p>å‰©ä¸‹çš„å…¶å®å°±æ˜¯æ§åˆ¶ä½å½“å‰åŒºé—´çš„å·¦å³ç«¯ç‚¹[nl, nr], å¯¹æ–°åŠ å…¥çš„åŒºé—´[l, r]è¿›è¡Œåˆ†æ : </p><ul><li>åŠ å…¥l &gt; nr, é‚£ä¹ˆåŒºé—´æ ¹æœ¬ä¸ç›¸äº¤, è¿™æ˜¯ä¸€ä¸ªæ–°çš„åŒºé—´, äºæ˜¯å°†å¤§æƒè½¬ç§».</li><li>l &lt;&#x3D; nr, é‚£ä¹ˆåŒºé—´ç›¸äº¤, æ¥ç€å°±æ˜¯çœ‹å³ç«¯ç‚¹è¿˜éœ€ä¸éœ€è¦æ›´æ–° : <ul><li>r &gt; nr,  æ–°çš„å³è¾¹ç•Œæ›´å¤§, å³è¾¹ç•Œä¸»æƒè½¬ç§».</li><li>r &lt;&#x3D; nr, è¯´æ˜è¿™ä¸ªæ–°åŒºé—´å®Œå…¨è¢«åŒ…å«åœ¨åŸåŒºé—´ä¸­, ä¸åšè°ƒæ•´.</li></ul></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt; <span class="hljs-built_in">merge</span>(vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt;&amp; intervals) &#123;<br>        vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt; ret;<br>        vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt;&amp; a = intervals;<br>        <span class="hljs-built_in">sort</span>(a.<span class="hljs-built_in">begin</span>(), a.<span class="hljs-built_in">end</span>());<br>        <span class="hljs-type">int</span> nl = <span class="hljs-number">-1</span>, nr = <span class="hljs-number">-1</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; a.<span class="hljs-built_in">size</span>(); i ++ )<br>        &#123;<br>            <span class="hljs-type">int</span> l = a[i][<span class="hljs-number">0</span>], r = a[i][<span class="hljs-number">1</span>];<br>            <span class="hljs-keyword">if</span>(l &gt; nr)<br>            &#123;<br>                <span class="hljs-keyword">if</span>(nr != <span class="hljs-number">-1</span>)<br>                &#123;<br>                    vector&lt;<span class="hljs-type">int</span>&gt; v = &#123;nl, nr&#125;;<br>                    ret.<span class="hljs-built_in">push_back</span>(v);<br>                &#125;<br>                nl = l, nr = r;<br>            &#125; <br>            <span class="hljs-keyword">else</span> <br>            &#123;<br>                <span class="hljs-keyword">if</span>(nr &lt; r) nr = r;<br>            &#125;<br>        &#125;<br>        vector&lt;<span class="hljs-type">int</span>&gt; v = &#123;nl, nr&#125;;<br>        <span class="hljs-type">bool</span> flag = <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> e : ret)<br>        &#123;<br>            <span class="hljs-keyword">if</span>(e[<span class="hljs-number">0</span>] == nl) <br>            &#123;<br>                flag = <span class="hljs-literal">true</span>;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(!flag) ret.<span class="hljs-built_in">push_back</span>(v);<br>        <span class="hljs-keyword">return</span> ret;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>ç®—æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ è¯»ä¹¦ç¬”è®°(8)</title>
    <link href="/2025/02/23/%5BLinux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B%5D%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0(8)/"/>
    <url>/2025/02/23/%5BLinux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B%5D%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0(8)/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ç¬¬14ç«  å¤šçº¿ç¨‹ç¼–ç¨‹</p></blockquote><h2 id="çº¿ç¨‹ä¸è¿›ç¨‹"><a href="#çº¿ç¨‹ä¸è¿›ç¨‹" class="headerlink" title="çº¿ç¨‹ä¸è¿›ç¨‹"></a>çº¿ç¨‹ä¸è¿›ç¨‹</h2><p>çº¿ç¨‹æ˜¯è½»é‡çº§çš„è¿›ç¨‹, æƒ³è¦ç†è§£çº¿ç¨‹çš„å…³é”®, é¦–å…ˆè¦ç†è§£çº¿ç¨‹å’Œè¿›ç¨‹ä¹‹é—´çš„åŒºåˆ«.</p><p>ä¸€ä¸ªè¿›ç¨‹åœ¨åˆ›å»ºä¹‹åˆå…¶å®å°±å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªä¸»çº¿ç¨‹, å…¶åˆ›å»ºå‡ºçš„çº¿ç¨‹å…¶å®å’Œå…¶æœ¬è´¨æ— å¾ˆå¤§å·®åˆ«, å…¶å®å°±å¤šäº†ä¸€ä¸ªçº¿ç¨‹å…±äº«èµ„æºç½¢äº†, æˆ‘ä»¬è¦æ˜æ™°çš„æ˜¯ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºçš„ä¸åŒçº¿ç¨‹ä¹‹é—´, ä»€ä¹ˆæ˜¯å…±äº«çš„, ä»€ä¹ˆæ˜¯ç‹¬ç«‹çš„.</p><p>çº¿ç¨‹é—´å…±äº«çš„ : </p><ul><li>è¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„ä»£ç æ®µ, æ•°æ®æ®µ, å †</li><li>æ–‡ä»¶æè¿°ç¬¦</li><li>ä¿¡å·å¤„ç†</li><li>ç¯å¢ƒå˜é‡</li><li>è¿›ç¨‹id</li></ul><p>çº¿ç¨‹é—´ç‹¬ç«‹çš„ : </p><ul><li>çº¿ç¨‹id</li><li>è¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„æ ˆ</li><li>å¯„å­˜å™¨çŠ¶æ€</li><li>ä¿¡å·æ©ç (ä¼šç»§æ‰¿ä½†ç‹¬ç«‹)</li><li>çº¿ç¨‹å±€éƒ¨å­˜å‚¨(TLS)</li><li>errno</li></ul><p>åªæœ‰ç†è§£äº†è¿™äº›, æˆ‘ä»¬æ‰å¯ä»¥åˆ†æå‡ºçº¿ç¨‹ç›¸æ¯”äºè¿›ç¨‹, æˆ‘ä»¬è¿˜éœ€è¦å…³å¿ƒä»€ä¹ˆ, ä¾‹å¦‚ : </p><ul><li>æ•°æ®æ®µ + æ–‡ä»¶æè¿°ç¬¦å…±äº« -&gt; éœ€è¦é”æ¥é™åˆ¶å…±äº«å†…å­˜çš„è®¿é—®</li><li>ä¿¡å·å¤„ç†å…±äº« + ä¿¡å·æ©ç ç‹¬ç«‹ -&gt; å¯ä»¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å•ç‹¬ç®¡ç†ä¿¡å·.</li></ul><hr><h2 id="çº¿ç¨‹åˆ›å»ºåŠä½¿ç”¨"><a href="#çº¿ç¨‹åˆ›å»ºåŠä½¿ç”¨" class="headerlink" title="çº¿ç¨‹åˆ›å»ºåŠä½¿ç”¨"></a>çº¿ç¨‹åˆ›å»ºåŠä½¿ç”¨</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œpthread.hï¼</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">int</span> <span class="hljs-type">pthread_t</span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">pthread_create</span><span class="hljs-params">(<span class="hljs-type">pthread_t</span>*thread,<span class="hljs-type">const</span> <span class="hljs-type">pthread_attr_t</span>*attr,<span class="hljs-type">void</span>*(*start_routine)(<span class="hljs-type">void</span>*),<span class="hljs-type">void</span>*arg)</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pthread_exit</span><span class="hljs-params">(<span class="hljs-type">void</span>*retval)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">pthread_join</span><span class="hljs-params">(<span class="hljs-type">pthread_t</span> thread,<span class="hljs-type">void</span>**retval)</span></span>;<br></code></pre></td></tr></table></figure><hr><h2 id="çº¿ç¨‹åŒæ­¥-çº¿ç¨‹é—´é€šä¿¡"><a href="#çº¿ç¨‹åŒæ­¥-çº¿ç¨‹é—´é€šä¿¡" class="headerlink" title="çº¿ç¨‹åŒæ­¥(çº¿ç¨‹é—´é€šä¿¡)"></a>çº¿ç¨‹åŒæ­¥(çº¿ç¨‹é—´é€šä¿¡)</h2><p>å’Œçº¿ç¨‹åŒæ­¥ç›¸å…³çš„è¦ç‚¹ä¹Ÿæœ‰ä¸‰ç§ : </p><h3 id="POSIXä¿¡å·é‡"><a href="#POSIXä¿¡å·é‡" class="headerlink" title="POSIXä¿¡å·é‡"></a>POSIXä¿¡å·é‡</h3><p>è¿›ç¨‹é—´é€šä¿¡ä¸­å·²ç»å°†äº†System Vä¿¡å·é‡l, POSIXä¿¡å·é‡çš„ç†å¿µå’Œä½¿ç”¨æ–¹æ³•ä¹Ÿç›¸ä¼¼, è¿˜æ˜¯å¯ä»¥ç†è§£ä¸ºä¸€ç§å¯è®¡æ•°çš„é«˜çº§äº’æ–¥é”.</p><p>POSIXä¿¡å·é‡çš„ä½¿ç”¨ä¼šæ›´åŠ æ–¹ä¾¿ä¸€äº› : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsemaphore.hï¼</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sem_init</span><span class="hljs-params">(<span class="hljs-type">sem_t</span>*sem,<span class="hljs-type">int</span> pshared,<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> value)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sem_destroy</span><span class="hljs-params">(<span class="hljs-type">sem_t</span>*sem)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sem_wait</span><span class="hljs-params">(<span class="hljs-type">sem_t</span>*sem)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sem_trywait</span><span class="hljs-params">(<span class="hljs-type">sem_t</span>*sem)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sem_post</span><span class="hljs-params">(<span class="hljs-type">sem_t</span>*sem)</span></span>;<br></code></pre></td></tr></table></figure><ul><li>sem : å°±æ˜¯æ ‡å®šå”¯ä¸€çš„ä¿¡å·é‡çš„ä¸€ä¸ªæ ‡å‡†, ç›´æ¥åˆ›å»ºå³å¯<code>sem_t sem;</code>;</li><li>pshared : ç”¨äºæŒ‡å®šä¿¡å·é‡ç±»å‹, å¦‚æœä¸º0ä»£è¡¨æ˜¯è¿›ç¨‹å±€éƒ¨çš„ä¿¡å·é‡, ä¸ä¸º0å¯ä»¥å®ç°è¿›ç¨‹é—´å…±äº«, ä¸è¿‡è¿™ä¸ªä¿¡å·é‡ä¸€èˆ¬ç”¨äºçº¿ç¨‹é—´é€šä¿¡, æ‰€ä»¥ç”¨0å³å¯.</li><li>value : è®¾ç½®ä¿¡å·é‡çš„å€¼, å’ŒSystem Vä¸­semctlçš„ä½œç”¨ä¸€è‡´.</li></ul><h3 id="äº’æ–¥é”"><a href="#äº’æ–¥é”" class="headerlink" title="äº’æ–¥é”"></a>äº’æ–¥é”</h3><p>è¿™ä¸ªå°±æ˜¯å¸¸ç”¨çš„æ™®é€šé”, åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œpthread.hï¼</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">pthread_mutex_init</span><span class="hljs-params">(<span class="hljs-type">pthread_mutex_t</span>*mutex,<span class="hljs-type">const</span> <span class="hljs-type">pthread_mutexattr_t</span>*mutexattr)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">pthread_mutex_destroy</span><span class="hljs-params">(<span class="hljs-type">pthread_mutex_t</span>*mutex)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">pthread_mutex_lock</span><span class="hljs-params">(<span class="hljs-type">pthread_mutex_t</span>*mutex)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">pthread_mutex_trylock</span><span class="hljs-params">(<span class="hljs-type">pthread_mutex_t</span>*mutex)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">pthread_mutex_unlock</span><span class="hljs-params">(<span class="hljs-type">pthread_mutex_t</span>*mutex)</span></span>;<br></code></pre></td></tr></table></figure><p>å¯ä»¥ç”¨å®çš„æ–¹å¼æ›¿ä»£init : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">pthread_mutex_t</span> mutex = PTHREAD_MUTEX_INITIALIZER; <br></code></pre></td></tr></table></figure><p>initçš„ç¬¬äºŒä¸ªå‚æ•°ç”¨äºè®¾ç½®äº’æ–¥é”å±æ€§, ä¸€èˆ¬æ˜¯NULL.</p><h3 id="æ¡ä»¶å˜é‡"><a href="#æ¡ä»¶å˜é‡" class="headerlink" title="æ¡ä»¶å˜é‡"></a>æ¡ä»¶å˜é‡</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œpthread.hï¼</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">pthread_cond_init</span><span class="hljs-params">(<span class="hljs-type">pthread_cond_t</span>*cond,<span class="hljs-type">const</span> <span class="hljs-type">pthread_condattr_t</span>*cond_attr)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">pthread_cond_destroy</span><span class="hljs-params">(<span class="hljs-type">pthread_cond_t</span>*cond)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">pthread_cond_broadcast</span><span class="hljs-params">(<span class="hljs-type">pthread_cond_t</span>*cond)</span></span>;    <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">pthread_cond_signal</span><span class="hljs-params">(<span class="hljs-type">pthread_cond_t</span>*cond)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">pthread_cond_wait</span><span class="hljs-params">(<span class="hljs-type">pthread_cond_t</span>*cond,<span class="hljs-type">pthread_mutex_t</span>*mutex)</span></span>;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªåç§°èµ·çš„æ¯”è¾ƒæ™¦æ¶©, ä½†æ˜¯ç¡®å®æ˜¯å’Œâ€æ¡ä»¶â€æœ‰å…³, è¿™ä¸ªä¸œè¥¿æ˜¯å’Œäº’æ–¥é”ç»‘å®šä½¿ç”¨çš„, ä½ å¯ä»¥ç†è§£ä¸ºäº’æ–¥é”åªè´Ÿè´£ç¡®ä¿å½“å‰åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æŒæœ‰é”, ä¹Ÿå°±æ˜¯åªç”¨ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®å…±äº«èµ„æº. è€Œæ¡ä»¶å˜é‡æ˜¯åœ¨<strong>ç¡®ä¿è¿™ä¸ªå…±äº«èµ„æºå±äºå¯ç”¨çŠ¶æ€</strong>, <strong>å¯ç”¨çŠ¶æ€çš„åˆ¤æ–­æ˜¯é æ¡ä»¶å®ç°çš„</strong>, æ›´å…·ä½“çš„è¯´å°±æ˜¯é€šè¿‡ifåˆ¤æ–­æ˜¯å¦è§¦å‘<code>pthread_cond_wait</code>å‡½æ•°.</p><p>ä»¥ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ä¸ºä¾‹, ç”Ÿäº§è€…å°†äº§ç‰©å­˜å…¥å…±äº«å†…å­˜ä¸­, æ¶ˆè´¹è€…ä»å…±äº«å†…å­˜ä¸­å–å‡ºäº§ç‰©, é‚£ä¹ˆäº’æ–¥é”å¯ä»¥ä¿è¯åŒæ—¶åªèƒ½ç”±ä¸€ä¸ªç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…è®¿é—®å…±äº«å†…å­˜, </p><ul><li>ä½†æ˜¯å¦‚æœå…±äº«å†…å­˜æ»¡äº†, ç”Ÿäº§è€…å†å»ç”Ÿäº§å°±æ˜¯æµªè´¹, </li><li>å¦‚æœå†…å­˜ä¸ºç©º, æ¶ˆè´¹è€…å»å–ä¹Ÿæ˜¯å¾’åŠ³.</li></ul><p>è¿™æ—¶æ¡ä»¶å˜é‡å°±å¯ä»¥å‘æŒ¥ä½œç”¨ : </p><ul><li>å½“å…±äº«å†…å­˜æ»¡äº†, å¯ä»¥å°†ç”Ÿäº§è€…æŒ‚èµ·, ç›´åˆ°å…±äº«å†…å­˜æœ‰äº§ç‰©è¢«å–èµ°ä¸ºæ­¢,</li><li>å½“å…±äº«å†…å­˜ä¸ºç©º, å¯ä»¥å°†æ¶ˆè´¹è€…æŒ‚èµ·, ç›´åˆ°å…±äº«å†…å­˜ä¸ä¸ºç©ºä¸ºæ­¢.</li></ul><h4 id="å‡½æ•°ä½¿ç”¨"><a href="#å‡½æ•°ä½¿ç”¨" class="headerlink" title="å‡½æ•°ä½¿ç”¨"></a>å‡½æ•°ä½¿ç”¨</h4><p>å‡½æ•°ä½¿ç”¨å’Œäº’æ–¥é”ç›¸ä¼¼, initçš„ç¬¬äºŒä¸ªå‚æ•°è¿˜æ˜¯è®¾ç½®ä¸ºNULLå°±è¡Œ, å¹¶ä¸”ä¹Ÿå¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç æ›¿ä»£ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">pthread_cond_t</span> cond = PTHREAD_COND_INITIALIZER;<br></code></pre></td></tr></table></figure><ul><li>æˆ‘ä»¬é€šè¿‡æ¡ä»¶åˆ¤æ–­è§¦å‘pthread_cond_wait, è¿™ä¸ªå‡½æ•°ä¼šå°†çº¿ç¨‹æŒ‚èµ·, å¹¶ä¸”é‡Šæ”¾å½“å‰æŒæœ‰çš„é”.</li><li>åœ¨æˆ‘ä»¬è®¤ä¸ºå¯ä»¥æ»¡è¶³æ¡ä»¶çš„åœ°æ–¹è§¦å‘pthread_cond_signal, è¿™ä¸ªå‡½æ•°ä¼šé€‰æ‹©ä¸€ä¸ªæŒ‚èµ·çš„çº¿ç¨‹å¹¶å”¤é†’ä»–, è¢«å”¤é†’çš„çº¿ç¨‹ä¼šé‡æ–°æŒæœ‰äº’æ–¥é”å¹¶ä¸”ç»§ç»­æ‰§è¡Œpthread_cond_waitåé¢çš„ä»£ç .</li></ul><h4 id="CSæ¨¡å‹ä»£ç æ¡ˆä¾‹"><a href="#CSæ¨¡å‹ä»£ç æ¡ˆä¾‹" class="headerlink" title="CSæ¨¡å‹ä»£ç æ¡ˆä¾‹"></a>CSæ¨¡å‹ä»£ç æ¡ˆä¾‹</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">pthread_mutex_t</span> mutex = PTHREAD_MUTEX_INITIALIZER;<br><span class="hljs-type">pthread_cond_t</span> cond_var = PTHREAD_COND_INITIALIZER;<br><span class="hljs-type">int</span> shared_data = <span class="hljs-number">0</span>;<br><br><span class="hljs-comment">// ç”Ÿäº§è€…çº¿ç¨‹å‡½æ•°</span><br><span class="hljs-function"><span class="hljs-type">void</span>* <span class="hljs-title">producer</span><span class="hljs-params">(<span class="hljs-type">void</span>* arg)</span> </span>&#123;<br>    <span class="hljs-built_in">pthread_mutex_lock</span>(&amp;mutex);  <span class="hljs-comment">// è·å–äº’æ–¥é”</span><br>    <span class="hljs-keyword">while</span> (shared_data != <span class="hljs-number">0</span>) &#123;   <span class="hljs-comment">// æ¡ä»¶åˆ¤æ–­</span><br>        <span class="hljs-built_in">pthread_cond_wait</span>(&amp;cond_var, &amp;mutex);  <span class="hljs-comment">// ç­‰å¾…æ¡ä»¶å˜é‡</span><br>    &#125;<br>    <br>    shared_data = <span class="hljs-number">1</span>;  <span class="hljs-comment">// ç”Ÿäº§æ•°æ®</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ç”Ÿäº§è€…ç”Ÿäº§æ•°æ®: %d\n&quot;</span>, shared_data);<br>    <br>    <span class="hljs-built_in">pthread_cond_signal</span>(&amp;cond_var);  <span class="hljs-comment">// å”¤é†’æ¶ˆè´¹è€…, è¿™æ—¶æ¡ä»¶ä¸€å®šæ»¡è¶³</span><br>    <span class="hljs-built_in">pthread_mutex_unlock</span>(&amp;mutex);  <span class="hljs-comment">// é‡Šæ”¾äº’æ–¥é”</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br><br><span class="hljs-comment">// æ¶ˆè´¹è€…çº¿ç¨‹å‡½æ•°</span><br><span class="hljs-function"><span class="hljs-type">void</span>* <span class="hljs-title">consumer</span><span class="hljs-params">(<span class="hljs-type">void</span>* arg)</span> </span>&#123;<br>    <span class="hljs-built_in">pthread_mutex_lock</span>(&amp;mutex);  <span class="hljs-comment">// è·å–äº’æ–¥é”</span><br>    <span class="hljs-keyword">while</span> (shared_data == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">pthread_cond_wait</span>(&amp;cond_var, &amp;mutex);  <span class="hljs-comment">// ç­‰å¾…æ¡ä»¶å˜é‡</span><br>    &#125;<br>    <br>    shared_data = <span class="hljs-number">0</span>;  <span class="hljs-comment">// æ¶ˆè´¹æ•°æ®</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;æ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®: %d\n&quot;</span>, shared_data);<br>    <br>    <span class="hljs-built_in">pthread_cond_signal</span>(&amp;cond_var);  <span class="hljs-comment">// å”¤é†’ç”Ÿäº§è€…, è¿™æ—¶æ¡ä»¶ä¸€å®šæ»¡è¶³</span><br>    <span class="hljs-built_in">pthread_mutex_unlock</span>(&amp;mutex);  <span class="hljs-comment">// é‡Šæ”¾äº’æ–¥é”</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">pthread_t</span> producer_thread, consumer_thread;<br><br>    <span class="hljs-built_in">pthread_create</span>(&amp;producer_thread, <span class="hljs-literal">NULL</span>, producer, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-built_in">pthread_create</span>(&amp;consumer_thread, <span class="hljs-literal">NULL</span>, consumer, <span class="hljs-literal">NULL</span>);<br><br>    <span class="hljs-built_in">pthread_join</span>(producer_thread, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-built_in">pthread_join</span>(consumer_thread, <span class="hljs-literal">NULL</span>);<br><br>    <span class="hljs-built_in">pthread_mutex_destroy</span>(&amp;mutex);<br>    <span class="hljs-built_in">pthread_cond_destroy</span>(&amp;cond_var);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="çº¿ç¨‹åŒæ­¥æœºåˆ¶åŒ…è£…ç±»"><a href="#çº¿ç¨‹åŒæ­¥æœºåˆ¶åŒ…è£…ç±»" class="headerlink" title="çº¿ç¨‹åŒæ­¥æœºåˆ¶åŒ…è£…ç±»"></a>çº¿ç¨‹åŒæ­¥æœºåˆ¶åŒ…è£…ç±»</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> LOCKER_H</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> LOCKER_H</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œexceptionï¼</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œpthread.hï¼</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsemaphore.hï¼</span><br><br><span class="hljs-comment">/*å°è£…ä¿¡å·é‡çš„ç±»*/</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">sem</span><br>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">/*åˆ›å»ºå¹¶åˆå§‹åŒ–ä¿¡å·é‡*/</span><br>    <span class="hljs-built_in">sem</span>()<br>    &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">sem_init</span>(ï¼†m_sem,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)!=<span class="hljs-number">0</span>)<br>        &#123;<br>            <span class="hljs-comment">/*æ„é€ å‡½æ•°æ²¡æœ‰è¿”å›å€¼ï¼Œå¯ä»¥é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ¥æŠ¥å‘Šé”™è¯¯*/</span><br>            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">exception</span>();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/*é”€æ¯ä¿¡å·é‡*/</span><br>    ï½<span class="hljs-built_in">sem</span>()<br>    &#123;<br>        <span class="hljs-built_in">sem_destroy</span>(ï¼†m_sem);<br>    &#125;<br><br>    <span class="hljs-comment">/*ç­‰å¾…ä¿¡å·é‡*/</span><br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">wait</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sem_wait</span>(ï¼†m_sem)==<span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/*å¢åŠ ä¿¡å·é‡*/</span><br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">post</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sem_post</span>(ï¼†m_sem)==<span class="hljs-number">0</span>;<br>    &#125;<br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">sem_t</span> m_sem;<br>&#125;;<br><br><span class="hljs-comment">/*å°è£…äº’æ–¥é”çš„ç±»*/</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">locker</span><br>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">/*åˆ›å»ºå¹¶åˆå§‹åŒ–äº’æ–¥é”*/</span><br>    <span class="hljs-built_in">locker</span>()<br>    &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">pthread_mutex_init</span>(ï¼†m_mutex,<span class="hljs-literal">NULL</span>)!=<span class="hljs-number">0</span>)<br>        &#123;<br>            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">exception</span>();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/*é”€æ¯äº’æ–¥é”*/</span><br>    ï½<span class="hljs-built_in">locker</span>()<br>    &#123;<br>        <span class="hljs-built_in">pthread_mutex_destroy</span>(ï¼†m_mutex);<br>    &#125;<br><br>    <span class="hljs-comment">/*è·å–äº’æ–¥é”*/</span><br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">lock</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">pthread_mutex_lock</span>(ï¼†m_mutex)==<span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/*é‡Šæ”¾äº’æ–¥é”*/</span><br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">unlock</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">pthread_mutex_unlock</span>(ï¼†m_mutex)==<span class="hljs-number">0</span>;<br>    &#125;<br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">pthread_mutex_t</span> m_mutex;<br>&#125;;<br><br><span class="hljs-comment">/*å°è£…æ¡ä»¶å˜é‡çš„ç±»*/</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">cond</span><br>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">/*åˆ›å»ºå¹¶åˆå§‹åŒ–æ¡ä»¶å˜é‡*/</span><br>    <span class="hljs-built_in">cond</span>()<br>    &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">pthread_mutex_init</span>(ï¼†m_mutex,<span class="hljs-literal">NULL</span>)!=<span class="hljs-number">0</span>)<br>        &#123;<br>            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">exception</span>();<br>        &#125;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">pthread_cond_init</span>(ï¼†m_cond,<span class="hljs-literal">NULL</span>)!=<span class="hljs-number">0</span>)<br>        &#123;<br>            <span class="hljs-comment">/*æ„é€ å‡½æ•°ä¸­ä¸€æ—¦å‡ºç°é—®é¢˜ï¼Œå°±åº”è¯¥ç«‹å³é‡Šæ”¾å·²ç»æˆåŠŸåˆ†é…äº†çš„èµ„æº*/</span><br>            <span class="hljs-built_in">pthread_mutex_destroy</span>(ï¼†m_mutex);<br>            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">exception</span>();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/*é”€æ¯æ¡ä»¶å˜é‡*/</span><br>    ï½<span class="hljs-built_in">cond</span>()<br>    &#123;<br>        <span class="hljs-built_in">pthread_mutex_destroy</span>(ï¼†m_mutex);<br>        <span class="hljs-built_in">pthread_cond_destroy</span>(ï¼†m_cond);<br>    &#125;<br><br>    <span class="hljs-comment">/*ç­‰å¾…æ¡ä»¶å˜é‡*/</span><br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">wait</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-type">int</span> ret=<span class="hljs-number">0</span>;<br>        <span class="hljs-built_in">pthread_mutex_lock</span>(ï¼†m_mutex);<br>        ret=<span class="hljs-built_in">pthread_cond_wait</span>(ï¼†m_cond,ï¼†m_mutex);<br>        <span class="hljs-built_in">pthread_mutex_unlock</span>(ï¼†m_mutex);<br>        <span class="hljs-keyword">return</span> ret==<span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/*å”¤é†’ç­‰å¾…æ¡ä»¶å˜é‡çš„çº¿ç¨‹*/</span><br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">signal</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">pthread_cond_signal</span>(ï¼†m_cond)==<span class="hljs-number">0</span>;<br>    &#125;<br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">pthread_mutex_t</span> m_mutex;<br>    <span class="hljs-type">pthread_cond_t</span> m_cond;<br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure><h2 id="ä¸å¯é‡å…¥å‡½æ•°"><a href="#ä¸å¯é‡å…¥å‡½æ•°" class="headerlink" title="ä¸å¯é‡å…¥å‡½æ•°"></a>ä¸å¯é‡å…¥å‡½æ•°</h2><p>ä¸å¯é‡å…¥å‡½æ•°ä¸èƒ½åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨, å› ä¸ºå…¶ä¸€èˆ¬ä¼šä½¿ç”¨åˆ°é™æ€å˜é‡, æ¯”å¦‚inet_ntoaç­‰.</p><h2 id="çº¿ç¨‹å’Œä¿¡å·"><a href="#çº¿ç¨‹å’Œä¿¡å·" class="headerlink" title="çº¿ç¨‹å’Œä¿¡å·"></a>çº¿ç¨‹å’Œä¿¡å·</h2><p>æˆ‘ä»¬åœ¨ä¸Šæ–‡å·²ç»çŸ¥é“çº¿ç¨‹ä¹‹é—´ä¿¡å·å¤„ç†å…±äº«å¹¶ä¸”ä¿¡å·æ©ç ä¼šç»§æ‰¿ä½†ç‹¬ç«‹, é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®¾ç½®ä¸€ä¸ªå•ç‹¬çš„ä¿¡å·å¤„ç†çº¿ç¨‹.</p><p>ç›¸å…³å‡½æ•°å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œpthread.hï¼</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsignal.hï¼</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">pthread_sigmask</span><span class="hljs-params">(<span class="hljs-type">int</span> how,<span class="hljs-type">const</span> <span class="hljs-type">sigset_t</span>*newmask,<span class="hljs-type">sigset_t</span>*oldmask)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sigwait</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">sigset_t</span>*set,<span class="hljs-type">int</span>*sig)</span></span>;<br></code></pre></td></tr></table></figure><p>æ„å»ºæµç¨‹å¦‚ä¸‹ : </p><ul><li>åœ¨ä¸»çº¿ç¨‹æ„å»ºå‡ºå…¶ä»–å­çº¿ç¨‹ä¹‹å‰å°±è°ƒç”¨pthread_sigmaskæ¥è®¾ç½®å¥½ä¿¡å·æ©ç ï¼Œæ‰€æœ‰æ–°åˆ›å»ºçš„å­çº¿ç¨‹éƒ½å°†è‡ªåŠ¨ç»§æ‰¿è¿™ä¸ªä¿¡å·æ©ç .</li><li>åœ¨ä¿¡å·å¤„ç†çº¿ç¨‹ä¸­è°ƒç”¨sigwaitæ¥ç­‰å¾…ä¿¡å·å¹¶å¤„ç†ä¹‹.</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œpthread.hï¼</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œstdio.hï¼</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œstdlib.hï¼</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œunistd.hï¼</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsignal.hï¼</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œerrno.hï¼</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> handle_error_en(en,msg) do&#123;errno=en;perror(msg);exit(EXIT_FAILURE);&#125;while(0)</span><br><br><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span>* <span class="hljs-title">sig_thread</span><span class="hljs-params">(<span class="hljs-type">void</span>* arg)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">sigset_t</span>* set = (<span class="hljs-type">sigset_t</span>*)arg;<br>    <span class="hljs-type">int</span> s, sig;<br>    <span class="hljs-keyword">for</span>(;;)<br>    &#123;<br>        <span class="hljs-comment">/*ç¬¬äºŒä¸ªæ­¥éª¤ï¼Œè°ƒç”¨sigwaitç­‰å¾…ä¿¡å·*/</span><br>        s = <span class="hljs-built_in">sigwait</span>(set, &amp;sig);<br>        <span class="hljs-keyword">if</span>(s != <span class="hljs-number">0</span>)<br>            <span class="hljs-built_in">handle_error_en</span>(s, <span class="hljs-string">&quot;sigwait&quot;</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Signal handling thread got signal%d\n&quot;</span>, sig);<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>* argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">pthread_t</span> thread;<br>    <span class="hljs-type">sigset_t</span> set;<br>    <span class="hljs-type">int</span> s;<br>    <span class="hljs-comment">/*ç¬¬ä¸€ä¸ªæ­¥éª¤ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­è®¾ç½®ä¿¡å·æ©ç */</span><br>    <span class="hljs-built_in">sigemptyset</span>(&amp;set);<br>    <span class="hljs-built_in">sigaddset</span>(&amp;set, SIGQUIT);<br>    <span class="hljs-built_in">sigaddset</span>(&amp;set, SIGUSR1);<br>    s = <span class="hljs-built_in">pthread_sigmask</span>(SIG_BLOCK, &amp;set, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-keyword">if</span>(s != <span class="hljs-number">0</span>)<br>        <span class="hljs-built_in">handle_error_en</span>(s, <span class="hljs-string">&quot;pthread_sigmask&quot;</span>);<br>    s = <span class="hljs-built_in">pthread_create</span>(&amp;thread, <span class="hljs-literal">NULL</span>, &amp;sig_thread, (<span class="hljs-type">void</span>*)&amp;set);<br>    <span class="hljs-keyword">if</span>(s != <span class="hljs-number">0</span>)<br>        <span class="hljs-built_in">handle_error_en</span>(s, <span class="hljs-string">&quot;pthread_create&quot;</span>);<br>    <span class="hljs-built_in">pause</span>();<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="çº¿ç¨‹å±€éƒ¨å­˜å‚¨-TLS"><a href="#çº¿ç¨‹å±€éƒ¨å­˜å‚¨-TLS" class="headerlink" title="çº¿ç¨‹å±€éƒ¨å­˜å‚¨(TLS)"></a>çº¿ç¨‹å±€éƒ¨å­˜å‚¨(TLS)</h2><p>çº¿ç¨‹å±€éƒ¨å­˜å‚¨ï¼ˆTLSï¼‰æ˜¯ä¸€ç§å…è®¸çº¿ç¨‹æ‹¥æœ‰ç‹¬ç«‹æ•°æ®çš„æŠ€æœ¯ã€‚è¿™æ„å‘³ç€æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥è®¿é—®åŒåå˜é‡çš„ä¸åŒå®ä¾‹ï¼Œè€Œè¿™äº›å˜é‡åœ¨ä¸åŒçº¿ç¨‹ä¸­ä¸ä¼šäº’ç›¸å¹²æ‰°ã€‚TLS åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­æä¾›äº†ä¸€ç§ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…ç§æœ‰å­˜å‚¨ç©ºé—´çš„æœºåˆ¶ã€‚</p><p>ç®€å•æ¥è¯´å¯ä»¥ç†è§£ä¸º : </p><ul><li><strong>TLSä¸­çš„æ•°æ®åƒçº¿ç¨‹çš„ç§æœ‰å…¨å±€å˜é‡, é¿å…åœ¨å„ç§å‡½æ•°é—´é¢‘ç¹ä¼ å…¥å¸¸ç”¨çš„æ•°æ®é™ä½æ•ˆç‡</strong>.</li></ul><p>åœ¨ POSIX ç³»ç»Ÿä¸­ï¼Œå¦‚æœä½ ä½¿ç”¨ <code>pthread_key_create()</code> æ¥åˆ›å»ºçº¿ç¨‹å±€éƒ¨å­˜å‚¨ï¼ˆTLSï¼‰é”®å¹¶ä¸”å…³è”æŸäº›æ•°æ®ï¼Œé‚£ä¹ˆä½ è¿˜éœ€è¦æä¾›ä¸€ä¸ªé”€æ¯å‡½æ•°ï¼Œè¿™ä¸ªé”€æ¯å‡½æ•°ä¼šåœ¨çº¿ç¨‹é€€å‡ºæ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œç”¨æ¥é‡Šæ”¾çº¿ç¨‹å±€éƒ¨å­˜å‚¨çš„æ•°æ®ã€‚</p><p>é”€æ¯è¿‡ç¨‹ï¼š</p><ul><li>åœ¨ <code>pthread_key_create()</code> æ—¶ï¼Œä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªé”€æ¯å‡½æ•°ï¼ˆdestructorï¼‰ï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨çº¿ç¨‹é€€å‡ºæ—¶è¢«è°ƒç”¨ã€‚</li><li><code>pthread_key_delete()</code> ç”¨äºæ˜¾å¼åœ°åˆ é™¤ä¸€ä¸ª TLS é”®ï¼Œé”€æ¯ç›¸å…³çš„èµ„æºã€‚</li></ul><hr><h2 id="æµ…è°ˆçº¿ç¨‹è®¾è®¡çš„åˆè¡·"><a href="#æµ…è°ˆçº¿ç¨‹è®¾è®¡çš„åˆè¡·" class="headerlink" title="æµ…è°ˆçº¿ç¨‹è®¾è®¡çš„åˆè¡·"></a>æµ…è°ˆçº¿ç¨‹è®¾è®¡çš„åˆè¡·</h2><p>çº¿ç¨‹è®¾è®¡çš„åˆè¡·å°±æ˜¯åœ¨äºå’Œå¤šæ ¸CPUæ­é…å®ç°åŒæ—¶å¹¶è¡Œå¤„ç†å¤šä¸ªä»»åŠ¡, æˆ‘ä»¬å¯ä»¥ç®€å•ç†è§£çº¿ç¨‹çš„åˆç†æ•°é‡åº”å½“å’ŒCUPæ ¸æ•°ç›¸å½“, æ•°é‡å¤ªå°‘æ˜¾ç¤ºä¸å‡ºçº¿ç¨‹çš„ä¼˜åŠ¿, æ•°é‡å¤ªå¤šå…¶é¢å¤–å¼€é”€å…¶å®ä¼šéå¸¸å¤šå¹¶ä¸”è¿˜åƒåŠ›ä¸è®¨å¥½.</p>]]></content>
    
    
    
    <tags>
      
      <tag>å¤šçº¿ç¨‹</tag>
      
      <tag>Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è¢«è®¨åŒçš„å‹‡æ°” è¯»ä¹¦æ‘˜å½•(2)</title>
    <link href="/2025/02/22/%E8%A2%AB%E8%AE%A8%E5%8E%8C%E7%9A%84%E5%8B%87%E6%B0%94%20%E8%AF%BB%E4%B9%A6%E6%91%98%E5%BD%95(2)/"/>
    <url>/2025/02/22/%E8%A2%AB%E8%AE%A8%E5%8E%8C%E7%9A%84%E5%8B%87%E6%B0%94%20%E8%AF%BB%E4%B9%A6%E6%91%98%E5%BD%95(2)/</url>
    
    <content type="html"><![CDATA[<ul><li>å½“äººèƒ½å¤Ÿæ„Ÿè§‰åˆ°â€ä¸è¿™ä¸ªäººåœ¨ä¸€åˆ‡å¯ä»¥æ— æ‹˜æ— æŸâ€çš„æ—¶å€™, æ‰èƒ½ä½“ä¼šåˆ°çˆ±.</li><li>äººç©¶ç«Ÿä¸ºä»€ä¹ˆè¦å¯»æ±‚åˆ«äººçš„è®¤å¯å‘¢? å…¶å®, å¾ˆå¤šæƒ…å†µä¸‹éƒ½æ˜¯å› ä¸ºèµç½šæ•™è‚²çš„å½±å“.</li><li>å¦‚æœä¸€å‘³åœ°å¯»æ±‚åˆ«äººçš„è®¤å¯, åœ¨æ„åˆ«äººçš„è¯„ä»·, é‚£æœ€ç»ˆå°±ä¼šæ´»åœ¨åˆ«äººçš„äººç”Ÿä¸­.</li><li>æˆ‘ä»¬å¿…é¡»ä»â€è¿™æ˜¯è°çš„è¯¾é¢˜â€è¿™ä¸€è§‚ç‚¹å‡ºå‘, æŠŠè‡ªå·±çš„è¯¾é¢˜å’Œä»–äººçš„è¯¾é¢˜åˆ†ç¦»å¼€æ¥.</li><li>åŸºæœ¬ä¸Š, ä¸€åˆ‡äººé™…å…³ç³»çŸ›ç›¾éƒ½èµ·æºäºå¯¹åˆ«äººçš„è¯¾é¢˜å¦„åŠ å¹²æ¶‰æˆ–è‡ªå·±çš„è¯¾é¢˜è¢«åˆ«äººå¦„åŠ å¹²æ¶‰.</li><li>å¯ä»¥æŠŠé©¬å¸¦åˆ°æ°´è¾¹, ä½†ä¸èƒ½å¼ºè¿«å…¶å–æ°´, èƒ½å¤Ÿæ”¹å˜è‡ªå·±çš„åªæœ‰è‡ªå·±.</li><li>æ­£å› ä¸ºæ˜¯å…³ç³»ç´§å¯†çš„å®¶äºº, æ‰æ›´æœ‰å¿…è¦æœ‰æ„è¯†åœ°å»åˆ†ç¦»è¯¾é¢˜.</li><li>å¦‚æœä¸åˆ†ç•Œé™æŠŠè‡ªå·±çš„å¸Œæœ›å¼ºåŠ ç»™ä»–äºº, é‚£å°±å˜æˆç²—æš´çš„â€å¹²æ¶‰â€äº†.</li><li>åˆ«äººå¦‚ä½•è¯„ä»·ä½ çš„é€‰æ‹©, é‚£æ˜¯åˆ«äººçš„è¯¾é¢˜, ä½ æ ¹æœ¬æ— æ³•å·¦å³.</li><li>ä¸å¹²æ¶‰åˆ«äººçš„è¯¾é¢˜, ä¹Ÿä¸è®©åˆ«äººå¹²æ¶‰è‡ªå·±çš„è¯¾é¢˜.</li><li>è¦æƒ³æ„ç­‘è‰¯å¥½çš„äººé™…å…³ç³»ä¹Ÿéœ€è¦ä¿æŒä¸€å®šçš„è·ç¦», å¦‚æœè·ç¦»å¤ªè¿‘, è´´åœ¨ä¸€èµ·, é‚£å°±æ— æ³•ä¸å¯¹æ–¹æ­£é¢å¯¹è¯.</li><li>åˆ†ç¦»è¯¾é¢˜å¹¶ä¸æ˜¯ä»¥è‡ªæˆ‘ä¸ºä¸­å¿ƒ, ç›¸å, å¹²æ¶‰åˆ«äººçš„è¯¾é¢˜æ‰æ˜¯ä»¥è‡ªæˆ‘ä¸ºä¸­å¿ƒçš„æƒ³æ³•.</li><li>é€‰æ‹©äº†ä¸è‡ªç”±ç”Ÿæ´»æ–¹å¼çš„å¤§äººçœ‹ç€è‡ªç”±æ´»åœ¨å½“ä¸‹çš„å¹´è½»äººå°±ä¼šæ‰¹åˆ¤å…¶äº«ä¹ä¸»ä¹‰, å½“ç„¶, è¿™å…¶å®æ˜¯ä¸ºäº†è®©è‡ªå·±æ¥å—ä¸è‡ªç”±ç”Ÿæ´»è€Œæé€ å‡ºçš„ä¸€ç§äººç”Ÿè°è¨€.</li><li>æŠŠæ”¹å˜è‡ªå·±å½“æˆæ“çºµä»–äººçš„æ‰‹æ®µæ˜¯ä¸€ç§æå…¶é”™è¯¯çš„æƒ³æ³•.</li><li>äººé™…å…³ç³»ä¹‹å¡æ€»æ˜¯æŒæ¡åœ¨è‡ªå·±æ‰‹ä¸­, å¦‚æœæ‰§ç€äºè®¤å¯æ¬²æ±‚, é‚£ä¾¿æ˜¯æŠŠäººé™…å…³ç³»ä¹‹å¡æŠ›ç»™äº†åˆ«äºº.</li><li>æˆ‘ä»¬åº”è¯¥æ€è€ƒçš„ä¸æ˜¯ä»–äººä¸ºæˆ‘åšäº†ä»€ä¹ˆ, è€Œæ˜¯æˆ‘èƒ½ä¸ºä»–äººåšä»€ä¹ˆ, å¹¶ç§¯æåœ°åŠ ä»¥å®è·µ.</li><li>å¯¹äººè€Œè¨€, æœ€å¤§çš„ä¸å¹¸å°±æ˜¯ä¸å–œæ¬¢è‡ªå·±.</li><li>æ˜¯å¦çœŸæ­£åšå‡ºäº†è´¡çŒ®, ä»åŸç†ä¸Šæ ¹æœ¬æ— ä»äº†è§£, åªè¦èƒ½å¤Ÿäº§ç”Ÿâ€æˆ‘å¯¹ä»–äººæœ‰ç”¨â€çš„ä¸»è§‚æ„Ÿå—å°±è¡Œ.</li><li>æ‰€æœ‰çš„é—®é¢˜è¡Œä¸º, éƒ½æ˜¯ä¸€ç§â€å»‰ä»·çš„ä¼˜è¶Šæ€§è¿½æ±‚â€.</li><li>æ™®é€šä¸ç­‰äºæ— èƒ½, æˆ‘ä»¬æ ¹æœ¬æ²¡å¿…è¦ç‰¹æ„ç‚«è€€è‡ªå·±çš„ä¼˜è¶Šæ€§.</li><li>å¦‚æœæ„Ÿè§‰èƒ½å¤Ÿçœ‹å¾—åˆ°è¿‡å»ä¹Ÿèƒ½é¢„æµ‹æœªæ¥, é‚£å°±è¯æ˜ä½ æ²¡æœ‰è®¤çœŸçš„æ´»åœ¨æ­¤æ—¶æ­¤åˆ», è€Œæ˜¯ç”Ÿæ´»åœ¨æ¨¡ç³Šè€Œå¾®å¼±çš„ç¯å…‰ä¸­.</li><li>èšç„¦æ­¤æ—¶æ­¤åˆ»æ˜¯è®¤çœŸè€Œè°¨æ…åœ°åšå¥½ç°åœ¨èƒ½åšçš„äº‹æƒ….</li><li>äººç”Ÿæœ€å¤§çš„è°è¨€, å°±æ˜¯ä¸æ´»åœ¨æ­¤æ—¶æ­¤åˆ».</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>é˜…è¯»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linuxé«˜æ€§èƒ½æœåŠ¡ç¼–ç¨‹ è¯»ä¹¦ç¬”è®°(7)</title>
    <link href="/2025/02/22/%5BLinux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B%5D%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0(7)/"/>
    <url>/2025/02/22/%5BLinux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B%5D%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0(7)/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ç¬¬13ç«  å¤šè¿›ç¨‹ç¼–ç¨‹</p></blockquote><p>æœ¬ç« ä¸»è¦æ˜¯è®¨è®ºåˆ›å»ºè¿›ç¨‹, è¿›ç¨‹æ›¿æ¢, è¿›ç¨‹ç­‰å¾…, è¿›ç¨‹é—´é€šä¿¡, æœ€åä¸€ä¸ªå å¤§å¤´.</p><h3 id="åˆ›å»ºè¿›ç¨‹"><a href="#åˆ›å»ºè¿›ç¨‹" class="headerlink" title="åˆ›å»ºè¿›ç¨‹"></a>åˆ›å»ºè¿›ç¨‹</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsys/types.hï¼</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œunistd.hï¼</span><br><span class="hljs-function"><span class="hljs-type">pid_t</span> <span class="hljs-title">fork</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></span>; <br></code></pre></td></tr></table></figure><p>è¿™ä¸ªåªéœ€è¦è®°ä½è¿”å›å€¼çš„åˆ¤æ–­ : </p><ul><li><p><code>&lt; 0</code> : forkå¤±è´¥.</p></li><li><p><code>== 0 </code>: å±äºå­è¿›ç¨‹.</p></li><li><p><code>&gt; 0</code> : å±äºçˆ¶è¿›ç¨‹.</p></li></ul><p>å­è¿›ç¨‹ç»§æ‰¿çˆ¶è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦è¡¨, ä½†æ˜¯çˆ¶è¿›ç¨‹è®¾ç½®çš„ä¿¡å·å›è°ƒéƒ½å›å–æ¶ˆ.</p><hr><h3 id="è¿›ç¨‹æ›¿æ¢"><a href="#è¿›ç¨‹æ›¿æ¢" class="headerlink" title="è¿›ç¨‹æ›¿æ¢"></a>è¿›ç¨‹æ›¿æ¢</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œunistd.hï¼</span><br><span class="hljs-keyword">extern</span> <span class="hljs-type">char</span>**environ;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">execl</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>*path,<span class="hljs-type">const</span> <span class="hljs-type">char</span>*arg,...)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">execlp</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>*file,<span class="hljs-type">const</span> <span class="hljs-type">char</span>*arg,...)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">execle</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>*path,<span class="hljs-type">const</span> <span class="hljs-type">char</span>*arg,...,<span class="hljs-type">char</span>*<span class="hljs-type">const</span> envp[])</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">execv</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>*path,<span class="hljs-type">char</span>*<span class="hljs-type">const</span> argv[])</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">execvp</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>*file,<span class="hljs-type">char</span>*<span class="hljs-type">const</span> argv[])</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">execve</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>*path,<span class="hljs-type">char</span>*<span class="hljs-type">const</span> argv[],<span class="hljs-type">char</span>*<span class="hljs-type">const</span> envp[])</span></span>;<br></code></pre></td></tr></table></figure><hr><h3 id="è¿›ç¨‹ç­‰å¾…"><a href="#è¿›ç¨‹ç­‰å¾…" class="headerlink" title="è¿›ç¨‹ç­‰å¾…"></a>è¿›ç¨‹ç­‰å¾…</h3><ul><li>å­è¿›ç¨‹é€€å‡ºä¹‹å, çˆ¶è¿›ç¨‹è¯»å–å…¶é€€å‡ºçŠ¶æ€ä¹‹å‰, å­è¿›ç¨‹éƒ½å¤„äºåƒµå°¸æ€, è¿™ä¼šå æ®å†…æ ¸èµ„æº, éœ€è¦è°ƒç”¨waité‡Šæ”¾å­è¿›ç¨‹.</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsys/types.hï¼</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsys/wait.hï¼</span><br><span class="hljs-function"><span class="hljs-type">pid_t</span> <span class="hljs-title">wait</span><span class="hljs-params">(<span class="hljs-type">int</span>*stat_loc)</span></span>;  <span class="hljs-comment">// ç­‰å¾…ä»»ä¸€è¿›ç¨‹</span><br><span class="hljs-function"><span class="hljs-type">pid_t</span> <span class="hljs-title">waitpid</span><span class="hljs-params">(<span class="hljs-type">pid_t</span> pid,<span class="hljs-type">int</span>*stat_loc,<span class="hljs-type">int</span> options)</span></span>;  <span class="hljs-comment">// ç­‰å¾…æŒ‡å®šè¿›ç¨‹</span><br></code></pre></td></tr></table></figure><p>é»˜è®¤éƒ½æ˜¯é˜»å¡çš„, ä½†æ˜¯waitpidå¦‚æœoptionsè®¾ç½®äº†WHOHANG, å°±ä¼šå˜æˆéé˜»å¡.</p><p>å½“ä¸€ä¸ªè¿›ç¨‹ç»“æŸæ—¶, ä¼šå‘çˆ¶è¿›ç¨‹å‘é€SIGCHLDä¿¡å·, æˆ‘ä»¬å¯ä»¥æ•è·è¿™ä¸ªä¿¡å·, åœ¨ä¿¡å·å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨éé˜»å¡waitpid.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">handle_child</span><span class="hljs-params">(<span class="hljs-type">int</span> sig)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-type">pid_t</span> pid;<br><span class="hljs-type">int</span> stat;<br><span class="hljs-keyword">while</span>((pid=<span class="hljs-built_in">waitpid</span>(<span class="hljs-number">-1</span>,ï¼†stat,WNOHANG))ï¼<span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-comment">/*å¯¹ç»“æŸçš„å­è¿›ç¨‹è¿›è¡Œå–„åå¤„ç†*/</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="è¿›ç¨‹é—´é€šä¿¡"><a href="#è¿›ç¨‹é—´é€šä¿¡" class="headerlink" title="è¿›ç¨‹é—´é€šä¿¡"></a>è¿›ç¨‹é—´é€šä¿¡</h3><p>ä¸€ç§æœ€ç»å…¸çš„è¿›ç¨‹é—´é€šä¿¡å°±æ˜¯ç®¡é“, è¿™é‡Œä¸å†è¯¦è¿°.</p><p>æ¥ä¸‹æ¥è¯¦è¿°ä¸‰ç§æ— å…³è”è¿›ç¨‹é—´çš„é€šä¿¡æ–¹å¼, è¿™é‡Œéœ€è¦æ³¨æ„è™½ç„¶æ˜¯æ— å…³è¿›ç¨‹, ä½†éƒ½æ˜¯åŒä¸€ä¸»æœºä¸‹çš„è¿›ç¨‹, æ˜¯ä¾é ä¸»æœºå•ç‹¬åœ¨å†…æ ¸ä¸­å¼€è¾Ÿå‡ºä¸€äº›å†…å®¹ç‰©å®ç°çš„.</p><h3 id="ä¿¡å·é‡"><a href="#ä¿¡å·é‡" class="headerlink" title="ä¿¡å·é‡"></a>ä¿¡å·é‡</h3><p>æˆ‘ä»¬é¦–å…ˆè¦ç†è§£ä¿¡å·é‡æ˜¯å¹²ä»€ä¹ˆçš„ : </p><p>å®ƒä¸»è¦ç”¨æ¥<strong>æ§åˆ¶å¯¹å…±äº«èµ„æºçš„è®¿é—®</strong>,  ä¸å…¶è¯´å®ƒæ˜¯è¿›ç¨‹é—´çš„ä¸€ç§é€šä¿¡æ–¹å¼, ä¸å¦‚è¯´å®ƒ<strong>å¯ä»¥ç®¡æ§è¿›ç¨‹é—´å¯¹å…±äº«å†…å­˜çš„è®¿é—®</strong>, å…¶æœ‰ä¸€ä¸ªä¿¡å·é‡èµ„æº, è¿›ç¨‹å¯ä»¥è°ƒç”¨å‡½æ•°å°†ä¿¡å·é‡è¿›è¡ŒåŠ å‡æ“ä½œ, å½“ä¿¡å·é‡å½’0æ—¶, ä¼šé™åˆ¶ä¹‹åéœ€è¦è®¿é—®å…±äº«å†…å­˜çš„è¿›ç¨‹(æŒ‚èµ·), å¯ä»¥ç†è§£ä¸ºè¿™æ˜¯<strong>ä¸€ä¸ªæœ‰è®¡æ•°åŠŸèƒ½çš„ä¸“é—¨é’ˆå¯¹å…±äº«èµ„æºçš„é«˜çº§é”</strong>.</p><p>ä¿¡å·é‡çš„æ ¸å¿ƒç†å¿µæ˜¯å¯¹ä¿¡å·é‡è¿›è¡Œå¤„ç†, <strong>åœ¨è®¾è®¡å…±äº«èµ„æºçš„ä»£ç å‰å, åˆ†åˆ«è®¾ç½®Pæ“ä½œå’ŒVæ“ä½œ</strong>,  Pä»£è¡¨passeren(è¿›å…¥), ä¼šå‡å°‘ä¿¡å·é‡; Vä»£è¡¨vrijgeven(é€€å‡º), ä¼šå¢åŠ ä¿¡å·é‡. PVæ“ä½œéƒ½æœ‰å¯¹åº”çš„å‡½æ•°å¯ä»¥è§¦å‘. ä½ å¯ä»¥ç±»æ¯”ä¸ºPæ“ä½œå°±æ˜¯åŠ é”, Væ“ä½œå°±è§£é”.</p><p>å…³äºä¿¡å·é‡çš„ç³»ç»Ÿå‡½æ•°æœ‰ä¸¤å¥— : </p><ul><li>System V ä¿¡å·é‡ : æ—©æœŸä¿¡å·é‡, è®¾ç½®å¤æ‚, ä½†æ˜¯è€ç‰Œç³»ç»Ÿéƒ½åœ¨ä½¿ç”¨, åªé€‚åˆå¤šçº¿ç¨‹ç¯å¢ƒ.</li><li>POSIX ä¿¡å·é‡ : æ¯”è¾ƒç®€å•æ˜“ç”¨, é€‚åˆå¤šçº¿ç¨‹ç¯å¢ƒ.</li></ul><p>æˆ‘ä»¬å…ˆæ¥å­¦ä¹ System Vä¿¡å·é‡ : </p><h4 id="semget"><a href="#semget" class="headerlink" title="semget"></a>semget</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsys/sem.hï¼</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">semget</span><span class="hljs-params">(<span class="hljs-type">key_t</span> key,<span class="hljs-type">int</span> num_sems,<span class="hljs-type">int</span> sem_flags)</span></span>;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°ç”¨æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ä¿¡å·é‡é›†. </p><ul><li><p>keyç”¨æ¥æ ‡è¯†ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ä¿¡å·é‡é›†, å°±æ˜¯ä¸€ä¸ªå”¯ä¸€å…³é”®å­—, ä¸€èˆ¬ç”¨ftokç”Ÿæˆ.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">key_t</span> <span class="hljs-title">ftok</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *pathname, <span class="hljs-type">int</span> proj_id)</span></span>;<br></code></pre></td></tr></table></figure></li><li><p>num_semsæ˜¯è¦è®¾ç½®çš„ä¿¡å·é‡çš„æ•°ç›®, ä¸€èˆ¬å°±ä¸€ä¸ª. </p></li><li><p>æœ€åä¸€ä¸ªä¸€èˆ¬0666, è®¾ç½®è®¿é—®æƒé™.</p></li></ul><h4 id="semctl"><a href="#semctl" class="headerlink" title="semctl"></a>semctl</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsys/sem.hï¼</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">semctl</span><span class="hljs-params">(<span class="hljs-type">int</span> sem_id,<span class="hljs-type">int</span> sem_num,<span class="hljs-type">int</span> command,...)</span></span>;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥å¯¹å»ºç«‹çš„ä¿¡å·é‡é›†è¿›è¡Œè®¾ç½®çš„å‡½æ•°, </p><ul><li>sem_id : semgetçš„è¿”å›å€¼</li><li>sem_num : ä¿¡å·é‡é›†ä¸­çš„ç´¢å¼•, è®¾ç½®ä¸º0ä»£è¡¨é€‰æ‹©ä¿¡å·é›†ä¸­çš„ç¬¬ä¸€ä¸ª.</li><li>command : ç”¨æ¥è®¾ç½®è¿›è¡Œä»€ä¹ˆæ“ä½œ, SETVALä»£è¡¨è®¾ç½®ä¿¡å·é›†, åé¢åŠ è¦è®¾ç½®çš„å€¼.</li></ul><p>ç”±äºåˆšå»ºç«‹é»˜è®¤çš„ä¿¡å·é‡ä¸º0, æ— æ³•ä½¿ç”¨, å¿…é¡»é€šè¿‡è¿™ä¸ªå‡½æ•°è®¾ç½®ä¿¡å·é‡ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_CONCURRENT 1   <span class="hljs-comment">// åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªè¿›ç¨‹è®¿é—®å…±äº«å†…å­˜</span></span><br><span class="hljs-built_in">semctl</span>(sem_id, <span class="hljs-number">0</span>, SETVAL, MAX_CONCURRENT);<br></code></pre></td></tr></table></figure><p>å‡å¦‚æˆ‘ä»¬è¦å…±äº«çš„ä¸æ˜¯å†…å­˜è€Œæ˜¯çº¿ç¨‹æ± , é‚£ä¹ˆè¿™é‡Œå°±å¤§æœ‰å¯ä¸ºäº†, å¯ä»¥æ ¹æ®å½“å‰çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„æ•°é‡è®¾ç½®ä¿¡å·é‡, å¯ä»¥å¯¹è®¿é—®çº¿ç¨‹æ•°è¿›è¡Œé™åˆ¶.</p><h4 id="semop"><a href="#semop" class="headerlink" title="semop"></a>semop</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">semop</span><span class="hljs-params">(<span class="hljs-type">int</span> sem_id,<span class="hljs-keyword">struct</span> sembuf*sem_ops,<span class="hljs-type">size_t</span> num_sem_ops)</span></span>;<br></code></pre></td></tr></table></figure><p>è¿™å‡½æ•°ç”¨æ¥è¿›è¡Œå®é™…çš„pvæ“ä½œ, sembufçš„ç»“æ„éœ€è¦ç»†è‡´äº†è§£ä¸€ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">sembuf</span>&#123;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> <span class="hljs-type">int</span> sem_num;  <span class="hljs-comment">// ä¿¡å·é‡çš„ç´¢å¼•</span><br>    <span class="hljs-type">short</span> <span class="hljs-type">int</span> sem_op; <span class="hljs-comment">// æ“ä½œçš„æ•°é‡</span><br><span class="hljs-type">short</span> <span class="hljs-type">int</span> sem_flg;     <span class="hljs-comment">// é¢å¤–çš„å±æ€§</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°è¿˜æ˜¯å¦‚æœä¸º0é»˜è®¤é€‰ç¬¬ä¸€ä¸ª.</li><li>sem_op : pæ“ä½œå°±æ˜¯-1, væ“ä½œå°±æ˜¯1.</li><li>sem_flg : ä¸€èˆ¬æ¨èåŠ ä¸ŠSEM_UNDO, è¿™ä¸ªå‚æ•°çš„ä½œç”¨æ˜¯è®¾ç½®å›æ»šæ“ä½œ, ä¹Ÿå°±æ˜¯è¯´pæ“ä½œå®Œ, å¦‚æœåœ¨è§¦å‘væ“ä½œå‰è¿›ç¨‹å´©æºƒäº†, ä¹Ÿä¼šå°†pæ“ä½œæ”¹å˜çš„å€¼æ¢å¤å›å».</li></ul><p>ä¸€èˆ¬è¿™æ ·é…ç½® : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// å®šä¹‰ä¿¡å·é‡æ“ä½œç»“æ„</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">sembuf</span> p = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>, SEM_UNDO&#125;;  <span class="hljs-comment">// wait æ“ä½œ</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">sembuf</span> v = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, SEM_UNDO&#125;;   <span class="hljs-comment">// post æ“ä½œ</span><br></code></pre></td></tr></table></figure><h4 id="ç¤ºä¾‹ï¼šSystem-V-ä¿¡å·é‡æ§åˆ¶å¹¶å‘æ•°é‡"><a href="#ç¤ºä¾‹ï¼šSystem-V-ä¿¡å·é‡æ§åˆ¶å¹¶å‘æ•°é‡" class="headerlink" title="ç¤ºä¾‹ï¼šSystem V ä¿¡å·é‡æ§åˆ¶å¹¶å‘æ•°é‡"></a>ç¤ºä¾‹ï¼šSystem V ä¿¡å·é‡æ§åˆ¶å¹¶å‘æ•°é‡</h4><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªèµ„æºæ± ï¼Œæœ€å¤šå…è®¸ 3 ä¸ªè¿›ç¨‹å¹¶å‘è®¿é—®ï¼Œæˆ‘ä»¬ä¼šå°†ä¿¡å·é‡çš„åˆå§‹å€¼è®¾ç½®ä¸º 3ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ipc.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/sem.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_CONCURRENT 3</span><br><br><span class="hljs-comment">// å®šä¹‰ä¿¡å·é‡æ“ä½œç»“æ„</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">sembuf</span> p = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>, SEM_UNDO&#125;;  <span class="hljs-comment">// wait æ“ä½œ</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">sembuf</span> v = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, SEM_UNDO&#125;;   <span class="hljs-comment">// post æ“ä½œ</span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">key_t</span> key = <span class="hljs-built_in">ftok</span>(<span class="hljs-string">&quot;semfile&quot;</span>, <span class="hljs-number">65</span>);   <span class="hljs-comment">// åˆ›å»º IPC é”®</span><br>    <span class="hljs-type">int</span> sem_id = <span class="hljs-built_in">semget</span>(key, <span class="hljs-number">1</span>, IPC_CREAT | <span class="hljs-number">0666</span>);  <span class="hljs-comment">// è·å–ä¿¡å·é‡</span><br><br>    <span class="hljs-comment">// è®¾ç½®åˆå§‹ä¿¡å·é‡å€¼ä¸º 3ï¼Œè¡¨ç¤ºå…è®¸ 3 ä¸ªè¿›ç¨‹å¹¶å‘è®¿é—®</span><br>    <span class="hljs-built_in">semctl</span>(sem_id, <span class="hljs-number">0</span>, SETVAL, MAX_CONCURRENT);<br><br>    <span class="hljs-comment">// æ¨¡æ‹Ÿè¿›ç¨‹è®¿é—®èµ„æº</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">semop</span>(sem_id, &amp;p, <span class="hljs-number">1</span>) == <span class="hljs-number">-1</span>) &#123;  <span class="hljs-comment">// å°è¯•è·å–ä¿¡å·é‡</span><br>        <span class="hljs-built_in">perror</span>(<span class="hljs-string">&quot;semop p&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// è®¿é—®å…±äº«èµ„æº</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Process %d is accessing shared resource.\n&quot;</span>, <span class="hljs-built_in">getpid</span>());<br>    <span class="hljs-built_in">sleep</span>(<span class="hljs-number">2</span>);  <span class="hljs-comment">// æ¨¡æ‹Ÿå·¥ä½œ</span><br><br>    <span class="hljs-comment">// é‡Šæ”¾ä¿¡å·é‡</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">semop</span>(sem_id, &amp;v, <span class="hljs-number">1</span>) == <span class="hljs-number">-1</span>) &#123;  <br>        <span class="hljs-built_in">perror</span>(<span class="hljs-string">&quot;semop v&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Process %d finished accessing shared resource.\n&quot;</span>, <span class="hljs-built_in">getpid</span>());<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="å…±äº«å†…å­˜"><a href="#å…±äº«å†…å­˜" class="headerlink" title="å…±äº«å†…å­˜"></a>å…±äº«å†…å­˜</h3><p>å…±äº«å†…å­˜ä¹Ÿæ˜¯SystemVå’ŒPOSIXå„æœ‰ä¸€å¥—å‡½æ•°, è¿™é‡Œä½¿ç”¨POSIXçš„. </p><p>ç®€å•æ¥è¯´å°±æ˜¯å‘å†…æ ¸ç”³è¯·ä¸€å—å…±äº«å†…å­˜, ç„¶åé€šè¿‡æ˜ å°„å‡½æ•°(mmap)å°†è¿™å—å†…å­˜æ˜ å°„åˆ°è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸Š, ä½¿å¾—è¿›ç¨‹æ“ä½œè¿™å—å†…å­˜å¯ä»¥åƒå¹³å¸¸ä¸€æ ·.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsys/mman.hï¼</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsys/stat.hï¼</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œfcntl.hï¼</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">shm_open</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>*name, <span class="hljs-type">int</span> oflag, <span class="hljs-type">mode_t</span> mode)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">shm_unlink</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* name)</span></span>;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ˜¯ç”¨äºç”³è¯·åˆ›å»ºå…±äº«å†…å­˜çš„å‡½æ•° : </p><ul><li>name : åå­—è‡ªå·±èµ·, æœ€å¥½æ˜¯â€&#x2F;nameâ€è¿™ç§æ ¼å¼.</li><li>oflag : ç”¨äºæŒ‡å®šåˆ›å»ºæ–¹å¼, O_RDONLY &#x2F; O_RDWR &#x2F; O_CREAT </li><li>mode : ä¸€èˆ¬æ˜¯0666</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">ftruncate</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">off_t</span> length)</span></span>;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°é€šå¸¸è¦æ­é…shm_openä½¿ç”¨, å®ƒç”¨äºè®¾å®šæ–‡ä»¶å¤§å°ä¸ºlength.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsys/mman.hï¼</span><br><span class="hljs-function"><span class="hljs-type">void</span>*<span class="hljs-title">mmap</span><span class="hljs-params">(<span class="hljs-type">void</span>*start,<span class="hljs-type">size_t</span> length,<span class="hljs-type">int</span> prot,<span class="hljs-type">int</span> flags,<span class="hljs-type">int</span> fd,<span class="hljs-type">off_t</span> offset)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">munmap</span><span class="hljs-params">(<span class="hljs-type">void</span>*start,<span class="hljs-type">size_t</span> length)</span></span>;<br></code></pre></td></tr></table></figure><ul><li>start : å…è®¸ç”¨æˆ·ä½¿ç”¨æŸä¸ªç‰¹å®šçš„åœ°å€ä½œä¸ºè¿™æ®µå†…å­˜çš„èµ·å§‹åœ°å€, è®¾ç½®ä¸ºNULLè‡ªåŠ¨é€‰æ‹©åœ°å€.</li><li>length : å†…å­˜æ®µçš„é•¿åº¦.</li><li>port : è®¾ç½®å†…å­˜æ®µçš„è®¿é—®æƒé™.</li><li>flags : æ§åˆ¶å†…å­˜æ®µå†…å®¹è¢«ä¿®æ”¹åç¨‹åºçš„è¡Œä¸º.</li><li>fd : è¢«æ˜ å°„æ–‡ä»¶å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦, è¿™ä¸ªé€šè¿‡shm_openç”Ÿæˆ.</li><li>offset : è®¾ç½®ä»æ–‡ä»¶çš„ä½•å¤„å¼€å§‹æ˜ å°„.</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Linuxé«˜æ€§èƒ½æœåŠ¡ç¼–ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ è¯»ä¹¦ç¬”è®°(6)</title>
    <link href="/2025/02/19/%5BLinux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B%5D%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0(6)/"/>
    <url>/2025/02/19/%5BLinux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B%5D%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0(6)/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ç¬¬10ç«  ä¿¡å·</p><p>ç¬¬11ç«  å®šæ—¶å™¨</p><p>ç¬¬12ç«  libevent</p></blockquote><p>ç½‘ç»œæœåŠ¡å™¨ä¸€èˆ¬æœ‰ä¸‰ç§äº‹ä»¶éœ€è¦å¤„ç† : IOäº‹ä»¶, ä¿¡å·äº‹ä»¶, å®šæ—¶å™¨äº‹ä»¶.</p><p>è¿™ä¸‰ç§äº‹ä»¶éƒ½å¯ä»¥é€šè¿‡epollå‡½æ•°æ¥è¿›è¡Œç»Ÿä¸€å¤„ç†.</p><h2 id="ä¿¡å·"><a href="#ä¿¡å·" class="headerlink" title="ä¿¡å·"></a>ä¿¡å·</h2><h4 id="ä¿¡å·æœ‰ä»€ä¹ˆä½œç”¨"><a href="#ä¿¡å·æœ‰ä»€ä¹ˆä½œç”¨" class="headerlink" title="ä¿¡å·æœ‰ä»€ä¹ˆä½œç”¨?"></a>ä¿¡å·æœ‰ä»€ä¹ˆä½œç”¨?</h4><p>å…¶å®ä¸»è¦æ˜¯ä¸ºäº†å¤„ç†ä¸€äº›ç‰¹æ®Šäº‹ä»¶, æ¯”å¦‚ä¸­æ–­ç³»ç»Ÿè°ƒç”¨, è§¦å‘å®šæ—¶å™¨ä¿¡å·, ç®¡é“è¯»å†™å¤±è´¥å‘å‡ºçš„ä¿¡å·. æ¯”å¦‚è¯´ä¸­æ–­è¿›ç¨‹, åœ¨æœåŠ¡å™¨ä¸Šç›´æ¥ä¸­æ–­ä¸€èˆ¬ä¸æ˜¯ä¸€ä¸ªåˆç†çš„åšæ³•, ä¸€èˆ¬ä¼šæ•è·ä¸­æ–­ä¿¡å·, åœ¨åšå‡ºä¸­æ–­çš„å‡†å¤‡å(å¦‚å…³é—­è¿æ¥, é‡Šæ”¾å†…å­˜, è®°å½•æ—¥å¿—)åœ¨è¿›è¡Œä¸­æ–­è¿›ç¨‹.</p><h4 id="æœ€é‡è¦çš„ä¸¤ä¸ªä¿¡å·æ•è·å‡½æ•°"><a href="#æœ€é‡è¦çš„ä¸¤ä¸ªä¿¡å·æ•è·å‡½æ•°" class="headerlink" title="æœ€é‡è¦çš„ä¸¤ä¸ªä¿¡å·æ•è·å‡½æ•°"></a>æœ€é‡è¦çš„ä¸¤ä¸ªä¿¡å·æ•è·å‡½æ•°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsignal.hï¼</span><br><span class="hljs-function"><span class="hljs-type">_sighandler_t</span> <span class="hljs-title">signal</span><span class="hljs-params">(<span class="hljs-type">int</span>ã€€sig, _sighandler_t_handler)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sigaction</span><span class="hljs-params">(<span class="hljs-type">int</span> sig, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> sigaction*act, <span class="hljs-keyword">struct</span> sigaction*oact)</span></span>;<br></code></pre></td></tr></table></figure><h4 id="ä¿¡å·æ¥æº"><a href="#ä¿¡å·æ¥æº" class="headerlink" title="ä¿¡å·æ¥æº"></a>ä¿¡å·æ¥æº</h4><p>â‘å¯¹äºå‰å°è¿›ç¨‹ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è¾“å…¥ç‰¹æ®Šçš„ç»ˆç«¯å­—ç¬¦æ¥ç»™å®ƒå‘é€ä¿¡å·ã€‚æ¯”å¦‚è¾“å…¥Ctrl+Cé€šå¸¸ä¼šç»™è¿›ç¨‹å‘é€ä¸€ä¸ªä¸­æ–­ä¿¡å·ã€‚</p><p>â‘ç³»ç»Ÿå¼‚å¸¸ã€‚æ¯”å¦‚æµ®ç‚¹å¼‚å¸¸å’Œéæ³•å†…å­˜æ®µè®¿é—®ã€‚</p><p>â‘ç³»ç»ŸçŠ¶æ€å˜åŒ–ã€‚æ¯”å¦‚alarmå®šæ—¶å™¨åˆ°æœŸå°†å¼•èµ·SIGALRMä¿¡å·ã€‚</p><p>â‘è¿è¡Œkillå‘½ä»¤æˆ–è°ƒç”¨killå‡½æ•°ã€‚</p><p>æœåŠ¡å™¨ç¨‹åºå¿…é¡»å¤„ç†ï¼ˆæˆ–è‡³å°‘å¿½ç•¥ï¼‰ä¸€äº›å¸¸è§çš„ä¿¡å·ï¼Œä»¥å…å¼‚å¸¸ç»ˆæ­¢ã€‚</p><h4 id="ç»Ÿä¸€äº‹ä»¶æº"><a href="#ç»Ÿä¸€äº‹ä»¶æº" class="headerlink" title="ç»Ÿä¸€äº‹ä»¶æº"></a>ç»Ÿä¸€äº‹ä»¶æº</h4><p>å¬èµ·æ¥æ¯”è¾ƒé«˜ç«¯, ä½†å…¶å®å°±æ˜¯æŠŠä¿¡å·äº‹ä»¶æ³¨å†Œåˆ°epollä¸Š, è®©epollå¯ä»¥é€šè¿‡ifåœ¨å¤„ç†IOäº‹ä»¶çš„åŒæ—¶å¯ä»¥ä¸€å¹¶å¤„ç†ä¿¡å·äº‹ä»¶.</p><p>æœ€åŸºç¡€çš„åšæ³•å°±æ˜¯ : </p><ul><li>ç”¨signalæˆ–sigactionæŠŠéœ€è¦æ•è·çš„ä¿¡å·è·å–</li><li>è®¾ç½®ä¸€ä¸ªç®¡é“, åœ¨ä¿¡å·å›è°ƒå‡½æ•°ä¸­å°†ä¿¡å·è½¬å‘ç»™ç®¡é“å†™ç«¯.</li><li>å°†ç®¡é“çš„è¯»ç«¯çš„è¯»äº‹ä»¶æ³¨å†Œè¿›å†…æ ¸äº‹ä»¶è¡¨ä¸­.</li><li>åœ¨epoll_waitæ‰€åœ¨çš„å¾ªç¯ä¸­å¯¹ç®¡é“çš„è¯»ç«¯é¢å¤–è¿›è¡Œç›‘è§†.</li></ul><p>ä½ å¯ä»¥ç†è§£ä¸ºå¯¹äºIOäº‹ä»¶, epollé€šè¿‡å°†sockfdæ³¨å†Œè¿›äº‹ä»¶è¡¨è¿›è¡Œç›‘è§†; å¯¹äºä¿¡å·äº‹ä»¶, epollé€šè¿‡å°†ç®¡é“è¯»ç«¯æ³¨å†Œè¿›å†…æ ¸äº‹ä»¶è¡¨è¿›è¡Œç›‘è§†.</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç»Ÿä¸€äº‹ä»¶æºçš„ä»£ç  :</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;netinet/in.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arpa/inet.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;assert.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;errno.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/epoll.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_EVENT_NUMBER 1024</span><br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> pipefd[<span class="hljs-number">2</span>];<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">setnonblocking</span><span class="hljs-params">(<span class="hljs-type">int</span> fd)</span> </span>&#123;<br>    <span class="hljs-type">int</span> old_option = <span class="hljs-built_in">fcntl</span>(fd, F_GETFL);<br>    <span class="hljs-type">int</span> new_option = old_option | O_NONBLOCK;<br>    <span class="hljs-built_in">fcntl</span>(fd, F_SETFL, new_option);<br>    <span class="hljs-keyword">return</span> old_option;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addfd</span><span class="hljs-params">(<span class="hljs-type">int</span> epollfd, <span class="hljs-type">int</span> fd)</span> </span>&#123;<br>    epoll_event event;<br>    event.data.fd = fd;<br>    event.events = EPOLLIN | EPOLLET;<br>    <span class="hljs-built_in">epoll_ctl</span>(epollfd, EPOLL_CTL_ADD, fd, &amp;event);<br>    <span class="hljs-built_in">setnonblocking</span>(fd);<br>&#125;<br><br><span class="hljs-comment">/* ä¿¡å·å¤„ç†å‡½æ•° */</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sig_handler</span><span class="hljs-params">(<span class="hljs-type">int</span> sig)</span> </span>&#123;<br>    <span class="hljs-type">int</span> save_errno = errno;<br>    <span class="hljs-type">int</span> msg = sig;<br>    <span class="hljs-built_in">send</span>(pipefd[<span class="hljs-number">1</span>], (<span class="hljs-type">char</span>*)&amp;msg, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);  <span class="hljs-comment">/* å°†ä¿¡å·å€¼å†™å…¥ç®¡é“ï¼Œä»¥é€šçŸ¥ä¸»å¾ªç¯ */</span><br>    errno = save_errno;<br>&#125;<br><br><span class="hljs-comment">/* è®¾ç½®ä¿¡å·çš„å¤„ç†å‡½æ•° */</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addsig</span><span class="hljs-params">(<span class="hljs-type">int</span> sig)</span> </span>&#123;<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sigaction</span> sa;<br>    <span class="hljs-built_in">memset</span>(&amp;sa, <span class="hljs-string">&#x27;\0&#x27;</span>, <span class="hljs-built_in">sizeof</span>(sa));<br>    sa.sa_handler = sig_handler;<br>    sa.sa_flags |= SA_RESTART;<br>    <span class="hljs-built_in">sigfillset</span>(&amp;sa.sa_mask);<br>    <span class="hljs-built_in">assert</span>(<span class="hljs-built_in">sigaction</span>(sig, &amp;sa, <span class="hljs-literal">NULL</span>) != <span class="hljs-number">-1</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>* argv[])</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (argc &lt;= <span class="hljs-number">2</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;usage: %s ip_address port_number\n&quot;</span>, <span class="hljs-built_in">basename</span>(argv[<span class="hljs-number">0</span>]));<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* ip = argv[<span class="hljs-number">1</span>];<br>    <span class="hljs-type">int</span> port = <span class="hljs-built_in">atoi</span>(argv[<span class="hljs-number">2</span>]);<br>    <span class="hljs-type">int</span> ret = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in</span> address;<br>    <span class="hljs-built_in">bzero</span>(&amp;address, <span class="hljs-built_in">sizeof</span>(address));<br>    address.sin_family = AF_INET;<br>    <span class="hljs-built_in">inet_pton</span>(AF_INET, ip, &amp;address.sin_addr);<br>    address.sin_port = <span class="hljs-built_in">htons</span>(port);<br><br>    <span class="hljs-type">int</span> listenfd = <span class="hljs-built_in">socket</span>(PF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">assert</span>(listenfd &gt;= <span class="hljs-number">0</span>);<br>    ret = <span class="hljs-built_in">bind</span>(listenfd, (<span class="hljs-keyword">struct</span> sockaddr*)&amp;address, <span class="hljs-built_in">sizeof</span>(address));<br>    <span class="hljs-keyword">if</span> (ret == <span class="hljs-number">-1</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;errno is %d\n&quot;</span>, errno);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br><br>    ret = <span class="hljs-built_in">listen</span>(listenfd, <span class="hljs-number">5</span>);<br>    <span class="hljs-built_in">assert</span>(ret != <span class="hljs-number">-1</span>);<br><br>    epoll_event events[MAX_EVENT_NUMBER];<br>    <span class="hljs-type">int</span> epollfd = <span class="hljs-built_in">epoll_create</span>(<span class="hljs-number">5</span>);<br>    <span class="hljs-built_in">assert</span>(epollfd != <span class="hljs-number">-1</span>);<br><br>    <span class="hljs-built_in">addfd</span>(epollfd, listenfd);<br><br>    <span class="hljs-comment">/* ä½¿ç”¨ socketpair åˆ›å»ºç®¡é“ï¼Œæ³¨å†Œ pipefd[0] ä¸Šçš„å¯è¯»äº‹ä»¶ */</span><br>    ret = <span class="hljs-built_in">socketpair</span>(PF_UNIX, SOCK_STREAM, <span class="hljs-number">0</span>, pipefd);<br>    <span class="hljs-built_in">assert</span>(ret != <span class="hljs-number">-1</span>);<br>    <span class="hljs-built_in">setnonblocking</span>(pipefd[<span class="hljs-number">1</span>]);<br>    <span class="hljs-built_in">addfd</span>(epollfd, pipefd[<span class="hljs-number">0</span>]);  <br><br>    <span class="hljs-comment">/* è®¾ç½®ä¸€äº›ä¿¡å·çš„å¤„ç†å‡½æ•° */</span><br>    <span class="hljs-built_in">addsig</span>(SIGHUP);<br>    <span class="hljs-built_in">addsig</span>(SIGCHLD);<br>    <span class="hljs-built_in">addsig</span>(SIGTERM);<br>    <span class="hljs-built_in">addsig</span>(SIGINT);<br><br>    <span class="hljs-type">bool</span> stop_server = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">while</span> (!stop_server) &#123;<br>        <span class="hljs-type">int</span> number = <span class="hljs-built_in">epoll_wait</span>(epollfd, events, MAX_EVENT_NUMBER, <span class="hljs-number">-1</span>);<br>        <span class="hljs-keyword">if</span> ((number &lt; <span class="hljs-number">0</span>) &amp;&amp; (errno != EINTR)) &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;epoll failure\n&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; number; i++) &#123;<br>            <span class="hljs-type">int</span> sockfd = events[i].data.fd;<br><br>            <span class="hljs-comment">/* å¦‚æœå°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦æ˜¯ listenfdï¼Œåˆ™å¤„ç†æ–°çš„è¿æ¥ */</span><br>            <span class="hljs-keyword">if</span> (sockfd == listenfd) &#123;<br>                <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in</span> client_address;<br>                <span class="hljs-type">socklen_t</span> client_addrlength = <span class="hljs-built_in">sizeof</span>(client_address);<br>                <span class="hljs-type">int</span> connfd = <span class="hljs-built_in">accept</span>(listenfd, (<span class="hljs-keyword">struct</span> sockaddr*)&amp;client_address, &amp;client_addrlength);<br>                <span class="hljs-built_in">addfd</span>(epollfd, connfd);<br>            &#125;<br>            <span class="hljs-comment">/* å¦‚æœå°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦æ˜¯ pipefd[0]ï¼Œåˆ™å¤„ç†ä¿¡å· */</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((sockfd == pipefd[<span class="hljs-number">0</span>]) &amp;&amp; (events[i].events &amp; EPOLLIN)) &#123;<br>                <span class="hljs-type">int</span> sig;<br>                <span class="hljs-type">char</span> signals[<span class="hljs-number">1024</span>];<br>                ret = <span class="hljs-built_in">recv</span>(pipefd[<span class="hljs-number">0</span>], signals, <span class="hljs-built_in">sizeof</span>(signals), <span class="hljs-number">0</span>);<br>                <span class="hljs-keyword">if</span> (ret == <span class="hljs-number">-1</span>) <span class="hljs-keyword">continue</span>;<br>                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ret == <span class="hljs-number">0</span>) <span class="hljs-keyword">continue</span>;<br>                <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; ret; ++i) &#123;<br>                        <span class="hljs-keyword">switch</span> (signals[i]) &#123;<br>                            <span class="hljs-keyword">case</span> SIGCHLD:<br>                            <span class="hljs-keyword">case</span> SIGHUP:<br>                                <span class="hljs-keyword">continue</span>;<br>                            <span class="hljs-keyword">case</span> SIGTERM:<br>                            <span class="hljs-keyword">case</span> SIGINT:<br>                                stop_server = <span class="hljs-literal">true</span>;<br>                        &#125;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;close fds\n&quot;</span>);<br>    <span class="hljs-built_in">close</span>(listenfd);<br>    <span class="hljs-built_in">close</span>(pipefd[<span class="hljs-number">1</span>]);<br>    <span class="hljs-built_in">close</span>(pipefd[<span class="hljs-number">0</span>]);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä¸­æ¯”è¾ƒé‡ç‚¹çš„æ˜¯ : </p><ul><li><code>ret = socketpair(PF_UNIX, SOCK_STREAM, 0, pipefd);</code> é€šè¿‡socketpairæ¿€æ´»pipefdå¯¹åº”çš„ç®¡é“</li><li><code>addfd(epollfd, pipefd[0]);</code>  å°†ç®¡é“è¯»ç«¯æ³¨å†Œè¿›å†…æ ¸äº‹ä»¶è¡¨</li><li><code>addsig</code>å‡½æ•°å°†éœ€è¦æ•è·çš„ä¿¡å·è¿›è¡Œæ•è·</li><li><code>else if ((sockfd == pipefd[0]) &amp;&amp; (events[i].events &amp; EPOLLIN))</code> åœ¨å¾ªç¯ä¸­é¢å¤–å¯¹ä¿¡å·äº‹ä»¶åšå¤„ç†.</li></ul><hr><h2 id="å®šæ—¶å™¨"><a href="#å®šæ—¶å™¨" class="headerlink" title="å®šæ—¶å™¨"></a>å®šæ—¶å™¨</h2><p>å…¶å®å°±æ˜¯æœåŠ¡å™¨æœ‰å¯èƒ½éœ€è¦æœ‰å®šæ—¶è§¦å‘çš„æœºåˆ¶å­˜åœ¨, æ‰€ä»¥éœ€è¦ç”¨åˆ°Linuxä¸­çš„å®šæ—¶æœºåˆ¶.</p><p>Linuxæä¾›äº†ä¸‰ç§å®šæ—¶æ–¹æ³•ï¼Œå®ƒä»¬æ˜¯ï¼š</p><p>â‘socketé€‰é¡¹SO_RCVTIMEOå’ŒSO_SNDTIMEOã€‚</p><p>â‘SIGALRMä¿¡å·ã€‚</p><p>â‘I&#x2F;Oå¤ç”¨ç³»ç»Ÿè°ƒç”¨çš„è¶…æ—¶å‚æ•°ã€‚</p><p>è¿™é‡Œæ¯”è¾ƒé‡è¦çš„å°±æ˜¯ä¿¡å·è§¦å‘, SIGALRMæ˜¯é€šè¿‡è°ƒç”¨alarmå‡½æ•°ä¼ å…¥è§¦å‘æ—¶é—´æ¥ä¼ å‡ºçš„, å¾ˆå¤šå®šæ—¶å™¨éƒ½åŸºäºè¿™ä¸ªå®ç°.</p><p>å®šæ—¶å™¨å°±æ˜¯ä¸€ä¸ªç»“æ„ä½“, é‡Œé¢ä¸€èˆ¬åŒ…å«äº†è¶…æ—¶æ—¶é—´å’Œå›è°ƒå‡½æ•°, æˆ‘ä»¬åœ¨å›è°ƒå‡½æ•°ä¸­å¤„ç†å®šæ—¶ä»»åŠ¡.</p><p>æœ€é‡è¦çš„å¦‚ä½•å®ç°å®šæ—¶è§¦å‘, ä¸€èˆ¬æ˜¯é€šè¿‡å¾ªç¯è°ƒç”¨alarmå®ç°æ¯éš”ä¸€æ®µæ—¶é—´å‘ç³»ç»Ÿå‘é€ä¸€ä¸ªSIGALRMä¿¡å·, é€šè¿‡ç»Ÿä¸€äº‹ä»¶æºå¯¹SIGALRMä¿¡å·åšå¯¹åº”å¤„ç†, ä¸€èˆ¬ä¼šè°ƒç”¨ä¸€ä¸ªå¿ƒæå‡½æ•°(tick), å¯¹æ‰€æœ‰æ—¶é—´å·²ç»è¶…æ—¶çš„å®šæ—¶å™¨è°ƒç”¨å…¶å›è°ƒå‡½æ•°æ‰§è¡Œå®šæ—¶ä»»åŠ¡.</p><p>è¿™é‡Œè¿˜è¦æ€è€ƒçš„ä¸€ä¸ªé—®é¢˜æ˜¯, å®šæ—¶ä»»åŠ¡æœ‰å¯èƒ½ä¼šå¾ˆå¤š, æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®¹å™¨æ¥è£…è½½è¿™äº›å®šæ—¶å™¨, è€ƒè™‘åˆ°ä¸€å®šæ˜¯ç¦»è¶…æ—¶æ—¶é—´è¶Šè¿‘çš„ä¼šè¶Šå…ˆè¢«å¤„ç†, é‚£ä¹ˆè¿™ä¸ªç”¨æ¥å­˜å‚¨çš„å®¹å™¨å°±æœ‰ä¸€ä¸ªéœ€è¦æ’åºçš„éœ€æ±‚, è¶…æ—¶æ—¶é—´è¶Šå°å°±è¶Šé å‰.</p><p>è¿™é‡Œæœ‰ä¸‰ç§å®¹å™¨å¯ä¾›é€‰æ‹© : é“¾è¡¨, æ—¶é—´è½®, æ—¶é—´å †.</p><ul><li><p>é“¾è¡¨ : ä»é“¾è¡¨çš„æ€§è´¨åˆ¤æ–­, å¦‚æœè¦ä¿æŒé“¾è¡¨æœ‰åº, æ’å…¥æ•ˆç‡O(N), åˆ é™¤å’Œæ‰§è¡Œçš„æ•ˆç‡éƒ½æ˜¯O(1).</p><p>å…¶å®è¿™ä¸ªæ•ˆç‡å·²ç»ä¸é”™äº†, è™½ç„¶åœ¨ç†è®ºä¸Šä¸ä¸€å®šæ¯”åä¸¤ç§å¼º, ä½†æ˜¯è€ƒè™‘åˆ°å®šæ—¶å™¨äº‹ä»¶åœ¨ä¸€èˆ¬æƒ…å†µä¸‹éœ€æ±‚é‡å¾ˆå°, ç”±äºé“¾è¡¨æ²¡æœ‰å¤šä½™æ“ä½œåè€Œæ•ˆç‡ä¼šé«˜, å› æ­¤libeventä¹Ÿæ˜¯ä¾æ®æƒ…å†µåœ¨é“¾è¡¨å’Œæ—¶é—´å †ç›´æ¥è¿›è¡Œé€‰æ‹©çš„.</p></li><li><p>æ—¶é—´è½® : ä½ å¯ä»¥ç†è§£ä¸ºè¿™æ˜¯ä¸€ä¸ªç¯çŠ¶çš„å“ˆå¸Œè¡¨, æ¯æ”¶åˆ°ä¸€æ¬¡å®šæ—¶ä¿¡å·å°±è§¦å‘ç¯ä¸Šçš„ä¸€å—, è½®è½¬è§¦å‘.</p></li><li><p>æ—¶é—´å † : è¿™å°±æ˜¯ä¸€ä¸ªå°æ ¹å †, ä½ ç”šè‡³å¯ä»¥ç›´æ¥ç”¨C++çš„priority_queueæ¥å®ç°è¿™ä¸ªæ—¶é—´å †, å…¶æ’å…¥æ•ˆç‡O(lgn), åˆ é™¤å’Œæ‰§è¡Œéƒ½æ˜¯O(1), åœ¨ç†è®ºä¸Šç¡®å®ä¼˜äºé“¾è¡¨.</p></li></ul><hr><h2 id="Libevent-â€”-é«˜æ€§èƒ½I-Oæ¡†æ¶åº“"><a href="#Libevent-â€”-é«˜æ€§èƒ½I-Oæ¡†æ¶åº“" class="headerlink" title="Libevent â€” é«˜æ€§èƒ½I&#x2F;Oæ¡†æ¶åº“"></a>Libevent â€” é«˜æ€§èƒ½I&#x2F;Oæ¡†æ¶åº“</h2><p>å…¶å®å°±æ˜¯ä¸€ä¸ªå¯¹æˆ‘ä»¬ä¹‹å‰å­¦çš„I&#x2F;Oå¤ç”¨å‡½æ•°å’Œä¿¡å·å’Œå®šæ—¶å™¨è¿›è¡Œåˆ†è£…çš„ä¸€ä¸ªåº“.</p><p>å®ƒå®ç°äº† : ç»Ÿä¸€äº‹ä»¶æº &#x2F; å¯ç§»æ¤æ€§ &#x2F; å¯¹å¹¶å‘ç¼–ç¨‹çš„æ”¯æŒ.</p><p>ä½¿ç”¨æ–¹æ³•å’Œepollæœ‰ç±»ä¼¼çš„åœ°æ–¹, ä½†æ˜¯ç®€åŒ–äº†å¤§é‡çš„æ­¥éª¤, å¹¶ä¸”å¯ä»¥ç”¨éå¸¸æ¥è¿‘çš„ä½¿ç”¨æ–¹æ³•è®¾ç½®IOäº‹ä»¶&#x2F;ä¿¡å·äº‹ä»¶&#x2F;å®šæ—¶å™¨äº‹ä»¶çš„å›è°ƒå‡½æ•°.</p><ul><li><p>event_base_new(); </p><p>ç”¨äºåˆ›å»ºä¸€ä¸ªevent_baseå¯¹è±¡, ä½ å¯ä»¥ç†è§£ä¸ºè¿™å°±æ˜¯ä¸€ä¸ªReactorå®ä¾‹(åŸºäºIOå¤ç”¨çš„äº‹ä»¶å¤„ç†å™¨).</p></li><li><p>event_new(â€¦) </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">event</span>* <span class="hljs-built_in">event_new</span>(<span class="hljs-keyword">struct</span> event_base *base,<span class="hljs-comment">// å¯¹åº”çš„Reactorå®ä¾‹</span><br>                        <span class="hljs-type">evutil_socket_t</span> fd,<span class="hljs-comment">// å¯¹åº”äº‹ä»¶çš„æ–‡ä»¶æè¿°ç¬¦</span><br>                        <span class="hljs-type">int</span> events,<span class="hljs-comment">// è¦æ³¨å†Œçš„äº‹ä»¶</span><br>                        event_callback_fn callback,<span class="hljs-comment">// äº‹ä»¶å›è°ƒå‡½æ•°</span><br>                        <span class="hljs-type">void</span> *arg);<span class="hljs-comment">// äº‹ä»¶å›è°ƒå‡½æ•°éœ€è¦çš„å‚æ•°</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°ç”¨äºæ³¨å†Œäº‹ä»¶,  ä¸‰ç§äº‹ä»¶éƒ½å¯ä»¥åœ¨è¿™ä¸ªå‡½æ•°ä¸­å¤„ç† : </p><ul><li><p>fd : æ–‡ä»¶æè¿°ç¬¦, IOäº‹ä»¶å°±æ˜¯å¯¹åº”socket, ä¿¡å·äº‹ä»¶æ˜¯å¯¹åº”ä¿¡å·æšä¸¾, å®šæ—¶å™¨äº‹ä»¶è®¾ç½®ä¸º-1.</p></li><li><p>events : ä¸»è¦ç”¨äºæè¿°äº‹ä»¶</p><p><code>EV_READ</code>ï¼šè¡¨ç¤ºå…³æ³¨æ–‡ä»¶æè¿°ç¬¦ä¸Šçš„è¯»äº‹ä»¶ã€‚</p><p><code>EV_WRITE</code>ï¼šè¡¨ç¤ºå…³æ³¨æ–‡ä»¶æè¿°ç¬¦ä¸Šçš„å†™äº‹ä»¶ã€‚</p><p><code>EV_SIGNAL</code>ï¼šè¡¨ç¤ºå…³æ³¨ç‰¹å®šä¿¡å·äº‹ä»¶ã€‚</p><p><code>EV_TIMEOUT</code>ï¼šè¡¨ç¤ºå…³æ³¨è¶…æ—¶äº‹ä»¶ï¼ˆå®šæ—¶å™¨ï¼‰ã€‚</p><p><code>EV_PERSIST</code>ï¼šè¡¨ç¤ºè¯¥äº‹ä»¶åœ¨è§¦å‘åä¸ä¼šè‡ªåŠ¨ç§»é™¤ï¼Œå¿…é¡»æ‰‹åŠ¨ç§»é™¤äº‹ä»¶ã€‚</p><p><code>EV_ET</code>ï¼šè¡¨ç¤ºä½¿ç”¨è¾¹ç¼˜è§¦å‘æ¨¡å¼ï¼ˆEdge Triggeredï¼‰ã€‚</p></li><li><p>callback :  éœ€è¦æ”¾å…¥ä¸€ä¸ªevent_callback_fnç±»å‹çš„å›è°ƒå‡½æ•°.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">void</span>(*å›è°ƒå‡½æ•°å)(<span class="hljs-type">evutil_socket_t</span>,<span class="hljs-type">short</span>,<span class="hljs-type">void</span>*arg);  <span class="hljs-comment">// æ‰€æœ‰å›è°ƒå‡½æ•°å½¢å¼å¿…é¡»æ˜¯è¿™æ ·</span><br></code></pre></td></tr></table></figure></li><li><p>arg : ç”¨äºå­˜æ”¾callbackéœ€è¦çš„å‚æ•°, ä½ å¯ä»¥å’Œçº¿ç¨‹åˆ›å»ºç›¸ç±»æ¯”.</p></li></ul></li><li><p>event_add(â€¦)</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">event_add</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> event *ev, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> timeval *tv)</span></span>;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°ç”¨äºæ¿€æ´»baseä¸­çš„è¿™ä¸ªäº‹ä»¶, event_newè´Ÿè´£æ³¨å†Œäº‹ä»¶, è¿™ä¸ªè´Ÿè´£æ¿€æ´»äº‹ä»¶.</p><ul><li>ev : ç”¨event_newæ„å»ºå‡ºæ¥çš„äº‹ä»¶å¤„ç†å™¨.</li><li>tv : ä¸€ä¸ªæ—¶é—´å‚æ•°, IOå’Œä¿¡å·å¡«NULLå°±è¡Œ, å®šæ—¶å™¨äº‹ä»¶éœ€è¦åœ¨è¿™é‡Œå¡«å…¥æ‰€ç¡®å®šçš„å»¶æ—¶.</li></ul></li><li><p>event_base_dispatch(base); </p><p>è¿™ä¸ªå‡½æ•°å°±æ˜¯è§¦å‘äº‹ä»¶å¤„ç†å™¨å¼€å§‹å¾ªç¯ç›‘è§†çš„å‚æ•°, è¿›ç¨‹å°†é˜»å¡åœ¨è¿™é‡Œ.</p></li><li><p>event_free(struct event *ev);</p></li></ul><p>  é‡Šæ”¾äº‹ä»¶ç»“æ„ä½“.</p><ul><li><p>event_base_free(struct event_base *base);</p><p>é‡Šæ”¾äº‹ä»¶å¤„ç†å™¨ç»“æ„ä½“.</p></li></ul><p>è¿˜è¦æ³¨æ„çš„æ˜¯è¿™é‡Œçš„äº‹ä»¶è¢«event_newå‡ºæ¥å¹¶æ²¡æœ‰è¢«æ¿€æ´», åªæœ‰åœ¨event_addåæ‰ç®—è¢«æ¿€æ´», åªæœ‰æ¿€æ´»çš„äº‹ä»¶æ‰ä¼šåœ¨event_base_dispatchä¸­è¢«å¤„ç†, å¦å¤–å¦‚æœæ²¡æœ‰ç»™äº‹ä»¶è®¾ç½®<code>EV_PERSIST</code>å±æ€§, äº‹ä»¶åœ¨è§¦å‘ä¸€æ¬¡åå°±ä¼šè‡ªåŠ¨è¢«åˆ é™¤, å¿…é¡»é‡æ–°add, ä½†æ˜¯å¦‚æœæœ‰è¿™ä¸ªå±æ€§, é‚£ä¹ˆåœ¨è§¦å‘åä¼šä¾æ—§å¤„äºæ¿€æ´»çŠ¶æ€, é™¤éæ‰‹åŠ¨event_del.</p>]]></content>
    
    
    
    <tags>
      
      <tag>Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ è¯»ä¹¦ç¬”è®°(5)</title>
    <link href="/2025/02/16/%5BLinux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B%5D%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0(5)/"/>
    <url>/2025/02/16/%5BLinux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B%5D%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0(5)/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ç¬¬ä¹ç«  I&#x2F;Oå¤ç”¨(1)</p></blockquote><p>æœ¬èŠ‚ä¸»è¦æè¿°ä¸‰ä¸ªIOå¤ç”¨å‡½æ•°, select &#x2F; poll &#x2F; epoll.</p><p>è¿™é‡Œå¯¹select &#x2F; pollåªåšç®€è¦æè¿°, å¯¹epollåšè¯¦å°½æè¿°.</p><p>æ‰€è°“I&#x2F;Oå¤ç”¨, å°±æ˜¯ä½¿ç¨‹åºå¯é€šè¿‡ä¸€äº›å‡½æ•°<strong>åŒæ—¶ç›‘å¬å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦</strong>(å¦‚socket), å¯ä»¥å³ä½¿å¹¶å‘å¯¹è¿™äº›æ–‡ä»¶æè¿°ç¬¦ä¸Šçš„äº‹ä»¶è¿›è¡Œå¤„ç†.</p><p>è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯I&#x2F;Oå¤ç”¨å‡½æ•°æœ¬èº«æ˜¯<strong>é˜»å¡</strong>çš„, å®ƒå±äºåŒæ­¥IOçš„èŒƒç•´, å…¶è¢«å¹¿æ³›ä½¿ç”¨æ˜¯å› ä¸ºå…¶åŒæ—¶ç›‘å¬çš„ç‰¹æ€§å¯ä»¥å¤§å¹…æå‡å¤„ç†æ•ˆç‡.</p><h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsys/select.hï¼</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">select</span><span class="hljs-params">(<span class="hljs-type">int</span> nfds,fd_set*readfds, fd_set*writefds, fd_set*exceptfds, <span class="hljs-keyword">struct</span> timeval*timeout)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><p>nfds : æŒ‡å®šè¢«ç›‘å¬çš„æ–‡ä»¶æ€»æ•°.</p></li><li><p>fd_set : ä¸€ä¸ªæ•´å‹æ•°ç»„, å…¶å®å°±æ˜¯ç”¨æ¥å­˜å‚¨æ–‡ä»¶æè¿°ç¬¦çš„</p><ul><li>readfds &#x2F; writefds &#x2F; exceptfds åˆ†åˆ«å¯¹åº”å¯è¯»å¯å†™å¼‚å¸¸äº‹ä»¶å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦é›†åˆ.</li></ul></li><li><p>timeout : ç”¨æ¥å‘Šè¯‰ç¨‹åºselecté˜»å¡ç­‰å¾…äº†å¤šä¹…, æ˜¯è¾“å‡ºå‹å‚æ•°.</p></li></ul><hr><h3 id="æ–‡ä»¶æè¿°ç¬¦å°±ç»ªæ¡ä»¶"><a href="#æ–‡ä»¶æè¿°ç¬¦å°±ç»ªæ¡ä»¶" class="headerlink" title="æ–‡ä»¶æè¿°ç¬¦å°±ç»ªæ¡ä»¶"></a>æ–‡ä»¶æè¿°ç¬¦å°±ç»ªæ¡ä»¶</h3><p>æˆ‘ä»¬éœ€è¦è®¤è¯†å“ªäº›æƒ…å†µä¸‹æ–‡ä»¶æè¿°ç¬¦å¯ä»¥è¢«è®¤ä¸ºæ˜¯å¯è¯»ã€å¯å†™æˆ–è€…å‡ºç°å¼‚å¸¸.</p><p>ä¸‹åˆ—æƒ…å†µä¸‹socketå¯è¯»ï¼š</p><p>â‘socketå†…æ ¸æ¥æ”¶ç¼“å­˜åŒºä¸­çš„å­—èŠ‚æ•°å¤§äºæˆ–ç­‰äºå…¶ä½æ°´ä½æ ‡è®°SO_RCVLOWATã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥æ— é˜»å¡åœ°è¯»è¯¥socketï¼Œå¹¶ä¸”è¯»æ“ä½œè¿”å›çš„å­—èŠ‚æ•°å¤§äº0ã€‚</p><p>â‘socketé€šä¿¡çš„å¯¹æ–¹å…³é—­è¿æ¥ã€‚æ­¤æ—¶å¯¹è¯¥socketçš„è¯»æ“ä½œå°†è¿”å›0ã€‚</p><p>â‘ç›‘å¬socketä¸Šæœ‰æ–°çš„è¿æ¥è¯·æ±‚ã€‚</p><p>â‘socketä¸Šæœ‰æœªå¤„ç†çš„é”™è¯¯ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨getsockoptæ¥è¯»å–å’Œæ¸…é™¤è¯¥é”™è¯¯ã€‚</p><p>ä¸‹åˆ—æƒ…å†µä¸‹socketå¯å†™ï¼š</p><p>â‘socketå†…æ ¸å‘é€ç¼“å­˜åŒºä¸­çš„å¯ç”¨å­—èŠ‚æ•°å¤§äºæˆ–ç­‰äºå…¶ä½æ°´ä½æ ‡è®°SO_SNDLOWATã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥æ— é˜»å¡åœ°å†™è¯¥socketï¼Œå¹¶ä¸”å†™æ“ä½œè¿”å›çš„å­—èŠ‚æ•°å¤§äº0ã€‚</p><p>â‘socketçš„å†™æ“ä½œè¢«å…³é—­ã€‚å¯¹å†™æ“ä½œè¢«å…³é—­çš„socketæ‰§è¡Œå†™æ“ä½œå°†è§¦å‘ä¸€ä¸ªSIGPIPEä¿¡å·ã€‚</p><p>â‘socketä½¿ç”¨éé˜»å¡connectè¿æ¥æˆåŠŸæˆ–è€…å¤±è´¥ï¼ˆè¶…æ—¶ï¼‰ä¹‹åã€‚</p><p>â‘socketä¸Šæœ‰æœªå¤„ç†çš„é”™è¯¯ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨getsockoptæ¥è¯»å–å’Œæ¸…é™¤è¯¥é”™è¯¯ã€‚</p><hr><h3 id="poll"><a href="#poll" class="headerlink" title="poll"></a>poll</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œpoll.hï¼</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">poll</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> pollfd*fds, <span class="hljs-type">nfds_t</span> nfds,<span class="hljs-type">int</span> timeout)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><p>nfdså…¶å®å°±æ˜¯ä¸€ä¸ªæ•´æ•°, ç”¨æ¥è®°å½•fdsçš„å¤§å°.</p></li><li><p>timeoutè®°å½•äº†pollçš„é˜»å¡è¶…æ—¶å€¼, è®¾ç½®ä¸º-1åˆ™å§‹ç»ˆå¤„äºé˜»å¡, 0åˆ™ç«‹å³è¿”å›.</p></li><li><p>fdséœ€è¦ç»†è®², å®ƒæ˜¯ä¸€ä¸ªpollfdç±»å‹çš„æ•°ç»„, pollfdçš„ç»“æ„å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">pollfd</span><br>&#123;<br><span class="hljs-type">int</span> fd;<span class="hljs-comment">/*æ–‡ä»¶æè¿°ç¬¦*/</span><br><span class="hljs-type">short</span> events;<span class="hljs-comment">/*æ³¨å†Œçš„äº‹ä»¶*/</span><br><span class="hljs-type">short</span> revents;<span class="hljs-comment">/*å®é™…å‘ç”Ÿçš„äº‹ä»¶ï¼Œç”±å†…æ ¸å¡«å……*/</span><br>&#125;;<br></code></pre></td></tr></table></figure><ul><li>fd : å°±æ˜¯è¦ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦.</li><li>events : è¿™é‡Œç”±ç”¨æˆ·å¡«å…¥å…³å¿ƒçš„äº‹ä»¶.</li><li>revents : è¿™é‡Œä¼šè¿”å›å®é™…å‘ç”Ÿçš„äº‹ä»¶, ç”±å†…æ ¸å¡«å……. è¿™é‡Œè¿”å›çš„äº‹ä»¶åªä¼šå’Œç”¨æˆ·å…³å¿ƒçš„äº‹ä»¶æœ‰å…³. &lt;è¾“å‡ºå‹å‚æ•°&gt;</li></ul><p>åœ¨pollä¸­äº‹ä»¶ç”¨enumåˆ—ä¸¾äº†å‡ºæ¥ : </p><ul><li>POLLIN : æ•°æ®å¯è¯».</li><li>POLLOUT : æ•°æ®å¯å†™.</li><li>POLKLERR : é”™è¯¯.</li><li>POLLHUP : æ–‡ä»¶æè¿°ç¬¦è¢«æŒ‚èµ·.</li><li>POLLNVAL : æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰è¢«æ‰“å¼€.</li><li>â€¦â€¦</li></ul></li></ul><p>â€‹å’Œselectç›¸æ¯”, å¯ä»¥ç†è§£ä¸ºselectåªå…³å¿ƒè¯»å†™å¼‚å¸¸è¿™ä¸‰ä¸ªäº‹ä»¶, è€Œpollå¯é€šè¿‡åœ¨fdsæ•°ç»„ä¸­è®¾ç½®å®ç°å¯¹äº‹ä»¶çš„å…³å¿ƒå’Œç›‘è§†.</p><h4 id="pollä½¿ç”¨æ–¹å¼"><a href="#pollä½¿ç”¨æ–¹å¼" class="headerlink" title="pollä½¿ç”¨æ–¹å¼"></a>pollä½¿ç”¨æ–¹å¼</h4><p>æˆ‘ä»¬é¦–å…ˆè¦æ˜ç¡®çš„å°±æ˜¯è¿™I&#x2F;Oå¤ç”¨å‡½æ•°ç›‘è§†çš„æ˜¯äº‹ä»¶, ä¸æ˜¯fd, <strong>æ˜¯fdä¸Šå‘ç”Ÿçš„äº‹ä»¶</strong>, è¿™ä¸ªäº‹ä»¶ä¸€èˆ¬æ˜¯å°±ç»ªè¯»å’Œå°±ç»ªå†™äº‹ä»¶.</p><p>æˆ‘ä»¬ä½¿ç”¨pollé¦–å…ˆè¦è®¾ç½®fdsæ•°ç»„ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// åˆå§‹åŒ– pollfd æ•°ç»„</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">pollfd</span> fds[MAX_CLIENTS + <span class="hljs-number">1</span>]; <span class="hljs-comment">// +1 ç”¨äºæœåŠ¡å™¨ socket</span><br><span class="hljs-type">int</span> nfds = <span class="hljs-number">1</span>; <span class="hljs-comment">// å½“å‰ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡</span><br><br><span class="hljs-comment">// å°†æœåŠ¡å™¨ socket æ·»åŠ åˆ° pollfd æ•°ç»„ä¸­</span><br>fds[<span class="hljs-number">0</span>].fd = server_fd;<br>fds[<span class="hljs-number">0</span>].events = POLLIN; <span class="hljs-comment">// ç›‘è§†å¯è¯»äº‹ä»¶</span><br><br><span class="hljs-comment">// åˆå§‹åŒ–å®¢æˆ·ç«¯æ–‡ä»¶æè¿°ç¬¦</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= MAX_CLIENTS; i++) &#123;<br>    fds[i].fd = <span class="hljs-number">-1</span>; <span class="hljs-comment">// -1 è¡¨ç¤ºæœªä½¿ç”¨</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åå°†å…¶ä¼ å…¥pollå‡½æ•°, ç¨‹åºè¿è¡Œåˆ°è¿™é‡Œå°±ä¼šé˜»å¡ç›‘å¬è®¾ç½®fdä¸Šçš„äº‹ä»¶äº† : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> ret = <span class="hljs-built_in">poll</span>(fds, nfds, <span class="hljs-number">-1</span>); <span class="hljs-comment">// -1 è¡¨ç¤ºæ— é™ç­‰å¾…</span><br></code></pre></td></tr></table></figure><p>ç›‘å¬çš„äº‹ä»¶å‘ç”Ÿåå°±ä¼šè¿”å›, ç„¶åæˆ‘ä»¬å°±éœ€è¦éå†fds, æŸ¥çœ‹é‡Œé¢çš„revents, å¦‚æœä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç”Ÿä¸º0.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// æ£€æŸ¥æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; nfds; i++) &#123;<br>    <span class="hljs-keyword">if</span> (fds[i].revents == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">continue</span>; <span class="hljs-comment">// æ²¡æœ‰äº‹ä»¶å‘ç”Ÿ</span><br>    &#125;<br>    <span class="hljs-comment">// ä¸ä¸º0è¯´æ˜äº‹ä»¶å‘ç”Ÿ, ä¸‹é¢å¯ä»¥å¼€å§‹å¤„ç†äº‹ä»¶é€»è¾‘</span><br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="epollç³»åˆ—å‡½æ•°"><a href="#epollç³»åˆ—å‡½æ•°" class="headerlink" title="epollç³»åˆ—å‡½æ•°"></a>epollç³»åˆ—å‡½æ•°</h3><p>æ²¡é”™, epollä¸æ˜¯ä¸€ä¸ªå‡½æ•°, è€Œæ˜¯ä¸€ç³»åˆ—å‡½æ•°, åŒ…æ‹¬epoll_create &#x2F; epoll_ctl &#x2F; epoll_waitå‡½æ•°ç­‰.</p><p>ä½ å¯ä»¥ç†è§£ä¸ºå…¶æ˜¯pollå‡½æ•°çš„å‡çº§ç‰ˆ, å®ƒæŠŠç±»ä¼¼è®¾ç½®fdsçš„è¡Œä¸ºåˆ©ç”¨å‡½æ•°åœ¨å†…æ ¸ä¸­å®ç°, å¹¶ä¸”è¿˜å¢åŠ äº†å¾ˆå¤šæå‡æ•ˆç‡çš„åŠŸèƒ½, å¯ä»¥è¯´æ˜¯å‰ä¸¤ä¸ªå‡½æ•°çš„ä¸Šä½æ›¿ä»£, å”¯ä¸€ä¸è¶³çš„å°±æ˜¯è¿™ä¸ªå‡½æ•°æ˜¯Linuxä¸“å±, å­˜åœ¨è·¨å¹³å°çš„é—®é¢˜.</p><h4 id="å†…æ ¸äº‹ä»¶è¡¨"><a href="#å†…æ ¸äº‹ä»¶è¡¨" class="headerlink" title="å†…æ ¸äº‹ä»¶è¡¨"></a>å†…æ ¸äº‹ä»¶è¡¨</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsys/epoll.hï¼</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">epoll_create</span><span class="hljs-params">(<span class="hljs-type">int</span> size)</span></span>;<br></code></pre></td></tr></table></figure><ul><li>sizeç”¨äºæç¤ºäº‹ä»¶è¡¨å…·ä½“æœ‰å¤šå¤§, æ— éœ€å‡†ç¡®, è¿™åªæ˜¯ä¸€ä¸ªæç¤º.</li></ul><p>é‡è¦çš„æ˜¯è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼, è°ƒç”¨è¯¥å‡½æ•°ä¼šåœ¨å†…æ ¸åˆ›å»ºä¸€ä¸ªäº‹ä»¶è¡¨, å°±ç±»ä¼¼äºpolléœ€è¦è‡ªå·±åˆ›å»ºçš„fds, å‡½æ•°è¿”å›å€¼æ˜¯<strong>è¿™ä¸ªäº‹ä»¶è¡¨çš„æ–‡ä»¶æè¿°ç¬¦</strong>, ä¸€èˆ¬è¢«å«åšepid, è¿™ä¸ªè¿”å›å€¼ä¼šè¢«ç”¨ä½œä¸‹ä¸€ä¸ªå‡½æ•°<strong>epoll_ctlçš„ç¬¬ä¸€ä¸ªå‚æ•°</strong>.</p><h4 id="epoll-ctl"><a href="#epoll-ctl" class="headerlink" title="epoll_ctl"></a>epoll_ctl</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsys/epoll.hï¼</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">epoll_ctl</span><span class="hljs-params">(<span class="hljs-type">int</span> epfd, <span class="hljs-type">int</span> op, <span class="hljs-type">int</span> fd, <span class="hljs-keyword">struct</span> epoll_event*event)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><p>epfd : ç”¨äºæŒ‡å®šå¯¹å“ªä¸ªå†…æ ¸äº‹ä»¶è¡¨è¿›è¡Œæ“ä½œ, ç”±epoll_createç”Ÿæˆ.</p></li><li><p>op : æŒ‡å®šæ“ä½œç±»å‹, ä¸‰ç§, EPOLL_CTL_ADD(æ³¨å†Œäº‹ä»¶) &#x2F; EPOLL_CTL_MOD(ä¿®æ”¹äº‹ä»¶) &#x2F; EPOLL_CTL_DEL(åˆ é™¤äº‹ä»¶).</p></li><li><p>fd : æŒ‡å®šfd;</p></li><li><p>event : ç”¨äºå­˜æ”¾äº‹ä»¶ç±»å‹å’Œäº‹ä»¶å‘ç”Ÿåå¯èƒ½éœ€è¦çš„æ•°æ®.</p><p>epoll_eventçš„ç»“æ„å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">epoll_event</span><br>&#123;<br><span class="hljs-type">__uint32_t</span> events;<span class="hljs-comment">/*epolläº‹ä»¶*/</span><br><span class="hljs-type">epoll_data_t</span> data;<span class="hljs-comment">/*ç”¨æˆ·æ•°æ®*/</span><br>&#125;;<br></code></pre></td></tr></table></figure><ul><li>events : å’Œpollä¸­ä½¿ç”¨æ–¹æ³•ä¸€è‡´, äº‹ä»¶ç±»å‹è¿˜æ˜¯é‚£äº›, åªä¸è¿‡å‰é¢è¦åŠ ä¸€ä¸ªâ€Eâ€, å¦å¤–è¿˜åŠ å…¥äº†ä¸¤ä¸ªç‰¹æ®Šäº‹ä»¶EPOLLETå’ŒEPOLLONESHOTã€‚å®ƒä»¬å¯¹äºepollçš„é«˜æ•ˆè¿ä½œéå¸¸å…³é”®ï¼Œæˆ‘ä»¬å°†åœ¨åé¢è®¨è®ºå®ƒä»¬.</li><li>data : è¿™æ˜¯ä¸€ä¸ªè”åˆä½“, è¿™é‡Œå…¶å®å°±æ˜¯ptrå’ŒfdäºŒé€‰ä¸€, æˆ‘ä»¬åœ¨pollçš„pollfdç»“æ„ä½“ä¸­ç”±ä¸€ä¸ªfd, è¿™é‡Œçš„fdä¸ä¹‹æ•ˆç”¨ç›¸åŒ, éƒ½æ˜¯ä¸ºäº†åœ¨äº‹ä»¶å‘ç”Ÿæ—¶å¯ä»¥åŠæ—¶ä½¿ç”¨åˆ°äº‹ä»¶å‘ç”Ÿå¯¹åº”socketçš„fd. è¿™é‡Œptrå…¶å®å°±æ˜¯ç»™å‡ºä¸€ä¸ªé€‰æ‹©å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªç»“æ„ä½“, å¯ä»¥ä¸åªå­˜å…¥fd, è¿˜å¯ä»¥å­˜å…¥å…¶ä»–éœ€è¦çš„ä¿¡æ¯(ä¾‹å¦‚æå‰åˆ†é…çš„ç¼“å†²åŒºçš„æŒ‡é’ˆ, ç¼“å†²åŒºå¤§å°).</li></ul><p>epoll_data_tç»“æ„å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">union</span> <span class="hljs-title class_">epoll_data</span><br>&#123;<br><span class="hljs-type">void</span>*ptr;<br><span class="hljs-type">int</span> fd;<br><span class="hljs-type">uint32_t</span> u32;<br><span class="hljs-type">uint64_t</span> u64;<br>&#125;<span class="hljs-type">epoll_data_t</span>;<br></code></pre></td></tr></table></figure></li></ul><p>epoll_ctlæˆåŠŸè¿”å›0, å¤±è´¥è¿”å›-1å¹¶è®¾ç½®errno.</p><h4 id="epoll-wait"><a href="#epoll-wait" class="headerlink" title="epoll_wait"></a>epoll_wait</h4><p>è¿™ä¸ªå‡½æ•°æ‰æ˜¯epollçœŸæ­£çš„æ‰§è¡Œå‡½æ•°, å‰é¢ä¸¤ä¸ªå‡½æ•°éƒ½æ˜¯å†è¿›è¡Œå‰ç½®æ¡ä»¶çš„è®¾ç½®, è°ƒç”¨epoll_waitæ‰ä¼šå¼€å§‹é˜»å¡è¿›è¡Œå®é™…çš„ç›‘è§†.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsys/epoll.hï¼</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">epoll_wait</span><span class="hljs-params">(<span class="hljs-type">int</span> epfd,<span class="hljs-keyword">struct</span> epoll_event*events,<span class="hljs-type">int</span> maxevents,<span class="hljs-type">int</span> timeout)</span></span>;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹å®ƒçš„å‚æ•°å…¶å®å’Œpollå‡½æ•°éå¸¸ç›¸ä¼¼.</p><ul><li>epfd : é€‰æ‹©è¿›è¡Œç›‘è§†çš„å†…æ ¸äº‹ä»¶è¡¨.</li><li>events : è¿™ä¸ªå‚æ•°å’Œepoll_ctlä¸­eventç±»å‹ä¸€è‡´, ä½†æ˜¯<strong>ç”¨æ³•ä¸ä¸€æ ·</strong>, åœ¨epoll_ctlä¸­çš„eventæ˜¯åªæ˜¯å•ç‹¬ä¸€ä¸ª, ç›®çš„æ˜¯ä¸ºäº†æ³¨å†Œä¸€ä¸ªfdå¯¹åº”çš„äº‹ä»¶. åœ¨è¿™é‡Œeventsæ˜¯ä¸€ä¸ªæ•°ç»„, è¿™æ˜¯ä¸€ä¸ª<strong>è¾“å‡ºå‹å‚æ•°</strong>, ç”¨äº<strong>å­˜å‚¨æ‰€æœ‰è§¦å‘äº†çš„äº‹ä»¶</strong>.</li><li>maxevents : æœ€å¤šç›‘å¬å¤šå°‘ä¸ªäº‹ä»¶.</li><li>timeout : åŒpoll.</li></ul><p>ä¸€æ—¦å†…æ ¸äº‹ä»¶è¡¨ä¸­çš„äº‹ä»¶å·²å°±ç»ª, epoll_waitå°†ä¼šé€€å‡ºé˜»å¡, è¿”å›å°±ç»ªçš„äº‹ä»¶ä¸ªæ•°, æˆ‘ä»¬ä¾¿å¯ä»¥å»å¾ªç¯éå†events, å¯¹å…¶ä¸­çš„fdè¿›è¡Œå¯¹åº”çš„è¯»å†™æ“ä½œ.</p><hr><h3 id="pollå’Œepollçš„å¯¹æ¯”"><a href="#pollå’Œepollçš„å¯¹æ¯”" class="headerlink" title="pollå’Œepollçš„å¯¹æ¯”"></a>pollå’Œepollçš„å¯¹æ¯”</h3><p>æˆ‘ä»¬å¯ä»¥æ„Ÿè§‰åˆ°epollå…¶å®æ˜¯è®²pollä¸­è®¸å¤šè®¾ç½®çš„ç»†èŠ‚åˆ†é…åˆ°å‡½æ•°ä¸­, å¹¶ä¸”å°†è¿™äº›æ“ä½œåœ¨å†…æ ¸ä¸­æ‰§è¡Œ, ä½¿ä¹‹æ›´åŠ é«˜æ•ˆ.</p><p>å¦å¤–pollä¸­çš„fdså‚æ•°å…¶å®å…¼é¡¾äº†è¾“å…¥ä¸è¾“å‡º, è¿™å°±å¯¼è‡´åœ¨è¾“å‡ºæ—¶éœ€è¦å¾ªç¯åˆ¤æ–­ä¹‹å‰è®¾ç½®çš„æ‰€æœ‰äº‹ä»¶, å…¶æ—¶é—´å¤æ‚åº¦ä¸ºO(N). ä½†epollä¸­è¾“å…¥ç”±epoll_ctlä¸­çš„eventå®Œæˆ, è¾“å‡ºç”±epoll_waitä¸­çš„eventså®Œæˆ, eventsä¸­åªåŒ…å«å·²å°±ç»ªçš„äº‹ä»¶, è€Œä¸éœ€è¦å†åƒpollä¸€æ ·å¾ªç¯åˆ¤æ–­, å…¶æ—¶é—´å¤æ‚åº¦ä¸ºO(1), æˆ‘ä»¬å¯ä»¥ä»ä¸‹é¢çš„ä»£ç ä¸­ç›´è§‚çœ‹å‡º : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/*å¦‚ä½•ç´¢å¼•pollè¿”å›çš„å°±ç»ªæ–‡ä»¶æè¿°ç¬¦*/</span><br><span class="hljs-type">int</span> ret = <span class="hljs-built_in">poll</span>(fds,MAX_EVENT_NUMBER,<span class="hljs-number">-1</span>);<br><span class="hljs-comment">/*å¿…é¡»éå†æ‰€æœ‰å·²æ³¨å†Œæ–‡ä»¶æè¿°ç¬¦å¹¶æ‰¾åˆ°å…¶ä¸­çš„å°±ç»ªè€…ï¼ˆå½“ç„¶ï¼Œå¯ä»¥åˆ©ç”¨retæ¥ç¨åšä¼˜åŒ–ï¼‰*/</span><br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; MAX_EVENT_NUMBER; ++i)<br>&#123;<br><span class="hljs-keyword">if</span>(fds[i].revents &amp; POLLIN)<span class="hljs-comment">/*åˆ¤æ–­ç¬¬iä¸ªæ–‡ä»¶æè¿°ç¬¦æ˜¯å¦å°±ç»ª*/</span><br>&#123;<br><span class="hljs-type">int</span> sockfd=fds[i].fd;<br><span class="hljs-comment">/*å¤„ç†sockfd*/</span><br>&#125;<br>&#125;<br><br><span class="hljs-comment">/*å¦‚ä½•ç´¢å¼•epollè¿”å›çš„å°±ç»ªæ–‡ä»¶æè¿°ç¬¦*/</span><br><span class="hljs-type">int</span> ret = <span class="hljs-built_in">epoll_wait</span>(epollfd,events,MAX_EVENT_NUMBER,<span class="hljs-number">-1</span>);<br><span class="hljs-comment">/*ä»…éå†å°±ç»ªçš„retä¸ªæ–‡ä»¶æè¿°ç¬¦*/</span><br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; ret; i++)<br>&#123;<br><span class="hljs-type">int</span> sockfd=events[i].data.fd;<br><span class="hljs-comment">/*sockfdè‚¯å®šå°±ç»ªï¼Œç›´æ¥å¤„ç†*/</span><br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="LT-å’Œ-ET-æ¨¡å¼"><a href="#LT-å’Œ-ET-æ¨¡å¼" class="headerlink" title="LT å’Œ ET æ¨¡å¼"></a>LT å’Œ ET æ¨¡å¼</h3><p>æ ¹æ®åå­—æ¥åˆ†ææ²¡ä»€ä¹ˆæ„ä¹‰, è¿™é‡Œå¤§å¯ä»¥ç†è§£ä¸ºæ™®é€šæ¨¡å¼å’Œé«˜æ•ˆæ¨¡å¼, selectå’Œpolléƒ½é™å®šæ™®é€šæ¨¡å¼, epollå¯ä»¥é€‰æ‹©æ™®é€šæ¨¡å¼å’Œé«˜æ•ˆæ¨¡å¼, é«˜æ•ˆ(ET)æ¨¡å¼ä¼˜åŠ¿åœ¨äº<strong>å‡å°‘epoll_waitè§¦å‘äº‹ä»¶çš„æ¬¡æ•°ä»è€Œæé«˜æ•´ä½“æ•ˆç‡</strong>, åŠ£åŠ¿åœ¨äºç¼–ç¨‹éš¾åº¦æé«˜å¹¶ä¸”å…¼å®¹æ€§ä¸‹é™(å…¶å®ä¸å¤ªæœ‰).</p><p>è®¤è¯†LTå’ŒETçš„å·®åˆ«ä¹‹å‰, æˆ‘ä»¬éœ€è¦è®¤è¯†åˆ°, æ•°æ®ä¼šè¢«å†…æ ¸æ¥æ”¶ç¼“å†²åŒºæ¥æ”¶, ç”¨æˆ·è¦å°†å…¶é€šè¿‡recvç­‰æ“ä½œè¯»åˆ°ç”¨æˆ·è‡ªå·±å®šä¹‰çš„ç¼“å†²åŒºä¸­è¿›è¡Œå¤„ç†, è€Œç”¨æˆ·ç¼“å†²åŒºå’Œå†…æ ¸æ¥æ”¶ç¼“å†²åŒºæ˜¯æœ‰æœ¬è´¨å¤§å°åŒºåˆ«çš„, ç”¨æˆ·è‡ªå·±å®šä¹‰çš„ç¼“å†²åŒºä¸èƒ½å¤ªå¤§, å› ä¸ºå¤ªå¤§ä¼šå ç”¨è¿‡å¤šå†…å­˜å¯¼è‡´æ•ˆç‡ä¸‹é™, è€Œå†…æ ¸æ¥æ”¶ç¼“å†²åŒºæ¯”è¾ƒå¤§, ä¹Ÿå°±æ˜¯è¯´æ¥æ”¶åˆ°çš„æ•°æ®é‡æœ‰å¯èƒ½å¾ˆå¤š, ä¸€æ¬¡è¯»å–(recv)å¯èƒ½æ ¹æœ¬æ— æ³•è¯»å®Œ, LTå’ŒETæ¨¡å¼ä¾¿æ˜¯åœ¨å¤„è¿™ç§æƒ…å†µçš„æ–¹å¼ä¸Šæœ‰æ‰€å·®å¼‚.</p><p>LTå’ŒETçš„å·®åˆ«åœ¨äº : </p><ul><li>LTæ¨¡å¼ä¸‹, æ¯æ¬¡åªè¯»æ»¡ç”¨æˆ·ç¼“å†²åŒºå¤§å°çš„æ•°æ®å°±é€€å‡º, é€šè¿‡epoll_waitå¤šæ¬¡è§¦å‘äº‹ä»¶æ¥è¯»å®Œ.</li><li>ETæ¨¡å¼ä¸‹, ä¸€ä¸ªäº‹ä»¶åªèƒ½è¢«epoll_waitè§¦å‘ä¸€æ¬¡, ä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡è¦å¾ªç¯è¯»å–æ•°æ®åˆ°ç”¨æˆ·ç¼“å†²åŒº, ç›´åˆ°å†…æ ¸æ¥æ”¶ç¼“å†²åŒºè¯»å®Œ.</li></ul><p>åœ¨å®æ“ä¸­,  ETæ¨¡å¼æ˜¯å¯¹å•ä¸ªfdå¯¹åº”çš„ç›‘å¬äº‹ä»¶è®¾ç½®çš„, è§¦å‘ETæ¨¡å¼éœ€è¦æˆ‘ä»¬å¯¹epoll_waitçš„ç¬¬å››ä¸ªå‚æ•°<code>struct epoll_event*event</code>,  å…¶ä¸­<code>epoll_event</code>ä¸­çš„eventsè¿›è¡Œè®¾ç½®, å’Œæ·»åŠ ç›‘è§†è¯»äº‹ä»¶ä¸€æ ·æ·»åŠ <code>EPOLLET</code>è¿™ä¸ªå‚æ•°, ç›¸å½“äºæŠŠå½“å‰fdç›‘å¬çš„äº‹ä»¶é™„åŠ ä¸€ä¸ªETå±æ€§. </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addfd</span><span class="hljs-params">(<span class="hljs-type">int</span> epollfd, <span class="hljs-type">int</span> fd, <span class="hljs-type">bool</span> enable_et)</span></span><br><span class="hljs-function"></span>&#123;<br>    epoll_event event;<br>    event.data.fd = fd;<br>    event.events = EPOLLIN;<span class="hljs-comment">// ç›‘è§†è¯»å°±ç»ªäº‹ä»¶</span><br>    <span class="hljs-keyword">if</span> (enable_et)<br>    &#123;<br>        event.events |= EPOLLET;<span class="hljs-comment">// å¼€å§‹ETæ¨¡å¼</span><br>    &#125;<br>    <span class="hljs-built_in">epoll_ctl</span>(epollfd, EPOLL_CTL_ADD, fd, &amp;event);  <span class="hljs-comment">// å°†è¿™ä¸ªäº‹ä»¶åŠ è¿›å†…æ ¸äº‹ä»¶è¡¨ä¸­</span><br>    <span class="hljs-built_in">setnonblocking</span>(fd);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°ä¾¿æ˜¯å‘å†…æ ¸äº‹ä»¶è¡¨æ³¨å†Œä¸€ä¸ªç›‘å¬fdè¯»äº‹ä»¶å¹¶ä¸”ä¾æ®enable_etæ¥å†³å®šæ˜¯å¦ä½¿ç”¨ETæ¨¡å¼çš„å‡½æ•°, åœ¨æˆ‘ä»¬ä¸‹é¢çš„ä¾‹å­ä¸­è¦ç”¨åˆ°.</p><p>æ¥ä¸‹æ¥å°†å±•ç¤ºä¹¦ä¸­çš„ä¸€ä»½ä»£ç , ç”¨äºå±•ç¤ºLTå’ŒETæ¨¡å¼çš„åŒºåˆ«, æœ¬è´¨æ˜¯ä¸€ä¸ªTCPæœåŠ¡å™¨ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;netinet/in.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arpa/inet.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;assert.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;errno.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/epoll.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_EVENT_NUMBER 1024</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> BUFFER_SIZE 10</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">setnonblocking</span><span class="hljs-params">(<span class="hljs-type">int</span> fd)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> old_option = <span class="hljs-built_in">fcntl</span>(fd, F_GETFL);<br>    <span class="hljs-type">int</span> new_option = old_option | O_NONBLOCK;<br>    <span class="hljs-built_in">fcntl</span>(fd, F_SETFL, new_option);<br>    <span class="hljs-keyword">return</span> old_option;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addfd</span><span class="hljs-params">(<span class="hljs-type">int</span> epollfd, <span class="hljs-type">int</span> fd, <span class="hljs-type">bool</span> enable_et)</span></span><br><span class="hljs-function"></span>&#123;<br>    epoll_event event;<br>    event.data.fd = fd;<br>    event.events = EPOLLIN;<br>    <span class="hljs-keyword">if</span> (enable_et)<br>    &#123;<br>        event.events |= EPOLLET;<br>    &#125;<br>    <span class="hljs-built_in">epoll_ctl</span>(epollfd, EPOLL_CTL_ADD, fd, &amp;event);<br>    <span class="hljs-built_in">setnonblocking</span>(fd);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">lt</span><span class="hljs-params">(epoll_event *events, <span class="hljs-type">int</span> number, <span class="hljs-type">int</span> epollfd, <span class="hljs-type">int</span> listenfd)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">char</span> buf[BUFFER_SIZE];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; number; i++)<br>    &#123;<br>        <span class="hljs-type">int</span> sockfd = events[i].data.fd;<br>        <span class="hljs-keyword">if</span> (sockfd == listenfd)<br>        &#123;<br>            <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in</span> client_address;<br>            <span class="hljs-type">socklen_t</span> client_addrlength = <span class="hljs-built_in">sizeof</span>(client_address);<br>            <span class="hljs-type">int</span> connfd = <span class="hljs-built_in">accept</span>(listenfd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;client_address, &amp;client_addrlength);<br>            <span class="hljs-built_in">addfd</span>(epollfd, connfd, <span class="hljs-literal">false</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (events[i].events &amp; EPOLLIN)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;event trigger once\n&quot;</span>);<br>            <span class="hljs-built_in">memset</span>(buf, <span class="hljs-string">&#x27;\0&#x27;</span>, BUFFER_SIZE);<br>            <span class="hljs-type">int</span> ret = <span class="hljs-built_in">recv</span>(sockfd, buf, BUFFER_SIZE - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>            <span class="hljs-keyword">if</span> (ret &lt;= <span class="hljs-number">0</span>)<br>            &#123;<br>                <span class="hljs-built_in">close</span>(sockfd);<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;get %d bytes of content: %s\n&quot;</span>, ret, buf);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;something else happened\n&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">et</span><span class="hljs-params">(epoll_event *events, <span class="hljs-type">int</span> number, <span class="hljs-type">int</span> epollfd, <span class="hljs-type">int</span> listenfd)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">char</span> buf[BUFFER_SIZE];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; number; i++)<br>    &#123;<br>        <span class="hljs-type">int</span> sockfd = events[i].data.fd;<br>        <span class="hljs-keyword">if</span> (sockfd == listenfd)<br>        &#123;<br>            <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in</span> client_address;<br>            <span class="hljs-type">socklen_t</span> client_addrlength = <span class="hljs-built_in">sizeof</span>(client_address);<br>            <span class="hljs-type">int</span> connfd = <span class="hljs-built_in">accept</span>(listenfd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;client_address, &amp;client_addrlength);<br>            <span class="hljs-built_in">addfd</span>(epollfd, connfd, <span class="hljs-literal">true</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (events[i].events &amp; EPOLLIN)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;event trigger once\n&quot;</span>);<br>            <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>            &#123;<br>                <span class="hljs-built_in">memset</span>(buf, <span class="hljs-string">&#x27;\0&#x27;</span>, BUFFER_SIZE);<br>                <span class="hljs-type">int</span> ret = <span class="hljs-built_in">recv</span>(sockfd, buf, BUFFER_SIZE - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>                <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>)<br>                &#123;<br>                    <span class="hljs-keyword">if</span> ((errno == EAGAIN) || (errno == EWOULDBLOCK))<br>                    &#123;<br>                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;read later\n&quot;</span>);<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                    <span class="hljs-built_in">close</span>(sockfd);<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ret == <span class="hljs-number">0</span>)<br>                &#123;<br>                    <span class="hljs-built_in">close</span>(sockfd);<br>                &#125;<br>                <span class="hljs-keyword">else</span><br>                &#123;<br>                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;get %d bytes of content: %s\n&quot;</span>, ret, buf);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;something else happened\n&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (argc &lt;= <span class="hljs-number">2</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;usage: %s ip_address port_number\n&quot;</span>, <span class="hljs-built_in">basename</span>(argv[<span class="hljs-number">0</span>]));<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *ip = argv[<span class="hljs-number">1</span>];<br>    <span class="hljs-type">int</span> port = <span class="hljs-built_in">atoi</span>(argv[<span class="hljs-number">2</span>]);<br>    <span class="hljs-type">int</span> ret = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in</span> address;<br>    <span class="hljs-built_in">bzero</span>(&amp;address, <span class="hljs-built_in">sizeof</span>(address));<br>    address.sin_family = AF_INET;<br>    <span class="hljs-built_in">inet_pton</span>(AF_INET, ip, &amp;address.sin_addr);<br>    address.sin_port = <span class="hljs-built_in">htons</span>(port);<br>    <span class="hljs-type">int</span> listenfd = <span class="hljs-built_in">socket</span>(PF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">assert</span>(listenfd &gt;= <span class="hljs-number">0</span>);<br>    ret = <span class="hljs-built_in">bind</span>(listenfd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;address, <span class="hljs-built_in">sizeof</span>(address));<br>    <span class="hljs-built_in">assert</span>(ret != <span class="hljs-number">-1</span>);<br>    ret = <span class="hljs-built_in">listen</span>(listenfd, <span class="hljs-number">5</span>);<br>    <span class="hljs-built_in">assert</span>(ret != <span class="hljs-number">-1</span>);<br>    epoll_event events[MAX_EVENT_NUMBER];<br>    <span class="hljs-type">int</span> epollfd = <span class="hljs-built_in">epoll_create</span>(<span class="hljs-number">5</span>);<br>    <span class="hljs-built_in">assert</span>(epollfd != <span class="hljs-number">-1</span>);<br>    <span class="hljs-built_in">addfd</span>(epollfd, listenfd, <span class="hljs-literal">true</span>);<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-type">int</span> ret = <span class="hljs-built_in">epoll_wait</span>(epollfd, events, MAX_EVENT_NUMBER, <span class="hljs-number">-1</span>);<br>        <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;epoll failure\n&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <br>        <span class="hljs-built_in">lt</span>(events, ret, epollfd, listenfd);       <span class="hljs-comment">// LTæ¨¡å¼å¯¹åº”çš„å¤„ç†æ–¹å¼</span><br>        <span class="hljs-comment">// et(events, ret, epollfd, listenfd);  // ETæ¨¡å¼å¯¹åº”çš„å¤„ç†æ–¹å¼</span><br>    &#125;<br>    <span class="hljs-built_in">close</span>(listenfd);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå»ºè®®å¥½å¥½åˆ†æä»¥ä¸‹ä»£ç å†çœ‹ä¸‹é¢æ¯ä¸ªå‡½æ•°çš„ä½œç”¨.</p><ul><li><p>int setnonblocking(int fd)</p><p>è¿™ä¸ªå‡½æ•°ç”¨é€”æ˜¯å°†socketè¯»å†™æ“ä½œè®¾ç½®ä¸ºéé˜»å¡, LTè®¾ä¸è®¾ç½®éƒ½è¡Œ, å› ä¸ºåªè¯»ä¸€æ¬¡å¹¶ä¸”è°ƒç”¨æ—¶å·²ç»å¤„äºè¯»å°±ç»ªæƒ…å†µ. è€ŒETå¿…é¡»è¦è®¾ç½®, å› ä¸ºæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ETæ¨¡å¼ä¸‹è¦ä¸€ç›´å¾ªç¯è¯»å–ç›´åˆ°errnoä¸º<code>EAGAIN</code>æˆ–<code>EWOULDBLOCK</code>æ‰ä¼šåœæ­¢, å¦‚æœä¸æ˜¯éé˜»å¡è¯»ä¸åˆ°æ•°æ®å°±å¡ä½äº†.</p></li><li><p>void addfd(int epollfd, int fd, bool enable_et)</p><p>è¿™ä¸ªå‡½æ•°å°±æ˜¯æŠŠæ³¨å†Œä¸€ä¸ªå’Œfdç›¸å…³çš„äº‹ä»¶åˆ°å†…æ ¸äº‹ä»¶è¡¨ä¸Š, å¯ä»¥é€‰æ‹©æ˜¯å¦å¼€å¯ETæ¨¡å¼.</p></li><li><p>mainå‡½æ•°</p><p>å¾ˆç®€æ˜“åœ°å®ç°äº†å®ç°äº†ä¸€ä¸ªTCPè¿æ¥çš„æ¥æ”¶, éœ€è¦æ³¨æ„çš„æ˜¯åœ¨å®ç°listenæ“ä½œå, æˆ‘ä»¬åˆ©ç”¨addfdæŠŠlistenfdæ³¨å†Œåˆ°äº†å†…æ ¸äº‹ä»¶è¡¨ä¸­, ç„¶åè¿›å…¥åˆ°epoll_waitçš„æ— é™å¾ªç¯ä¸­, epoll_waitä¼šå¯¹listenfdä¸Šçš„è¯»å°±ç»ªäº‹ä»¶åšå‡ºååº”å¹¶è§¦å‘ä¸‹é¢çš„lt&#x2F;etå‡½æ•°.</p></li><li><p>lt &#x2F; et å‡½æ•°</p><p>è¿™ä¸ªå‡½æ•°ä¼šæ¥æ”¶epoll_waitè¾“å‡ºçš„å°±ç»ªäº‹ä»¶æ•°ç»„, å¹¶éå†è¿›è¡Œäº‹ä»¶å¤„ç†.</p><p>é€šè¿‡åˆ†ææ¯ä¸ªäº‹ä»¶å¯¹åº”çš„fd, åˆ¤æ–­æ˜¯listenfdä¸­çš„å»ºç«‹è¿æ¥è¯·æ±‚äº‹ä»¶(sockfd &#x3D;&#x3D; listenfd), è¿˜æ˜¯æ™®é€šsocketçš„è¯»å°±ç»ªäº‹ä»¶(events[i].events &amp; EPOLLIN).</p><p>å¦‚æœæ˜¯å»ºç«‹è¿æ¥çš„è¯·æ±‚, å…ˆé€šè¿‡acceptå¾—åˆ°æ™®é€šçš„socketfd, ç„¶ååˆ©ç”¨addfdå°†å…¶åŠ å…¥å†…æ ¸äº‹ä»¶è¡¨ä¸­, æ ¹æ®è°ƒç”¨çš„æ˜¯ltè¿˜æ˜¯eté€‰æ‹©æ˜¯å¦å¯ç”¨ETæ¨¡å¼, åœ¨è¿™ä¹‹åepoll_waitä¹Ÿä¼šå¯¹è¿™äº›æ™®é€šsocketfdçš„è¯»å°±ç»ªäº‹ä»¶åšå‡ºååº”.</p><p>å¦‚æœæ˜¯æ™®é€šè¯», åˆ™è°ƒç”¨recvè¿›è¡Œæ•°æ®è¯»å–ä¸å¤„ç†, è¿™é‡ŒLTæ¨¡å¼åªè¯»å–ä¸€æ¬¡å°±é€€å‡º, ETæ¨¡å¼è¦æŒç»­å¾ªç¯è¯»å–ç›´åˆ°å†…æ ¸ç¼“å†²åŒºè¢«è¯»å®Œ.</p></li></ul><p>è¿™é‡Œç”¨æˆ·ç¼“å†²åŒºè®¾ç½®ä¸º10, è¿™é‡Œè®¾ç½®çš„åå°, ä½†æ˜¯ä¾¿äºæµ‹è¯•, é€šè¿‡æµ‹è¯•æˆ‘ä»¬å¯ä»¥å‘ç°ç¡®å®ETæ¨¡å¼ä¸‹äº‹ä»¶çš„è§¦å‘æ¬¡æ•°è¦å°‘å¾ˆå¤š : </p><p><img src="/../img/image/1.png"></p><hr><h3 id="EPOLLONESHOTäº‹ä»¶"><a href="#EPOLLONESHOTäº‹ä»¶" class="headerlink" title="EPOLLONESHOTäº‹ä»¶"></a>EPOLLONESHOTäº‹ä»¶</h3><p>è¿™ä¹Ÿæ˜¯ç±»ä¼¼ETä¸€æ ·å¯ä»¥è®¾ç½®çš„ä¸€ä¸ªäº‹ä»¶å±æ€§, åŸå› æ˜¯å› ä¸ºä¸€ä¸ªsocketæ³¨å†Œçš„äº‹ä»¶å¯èƒ½è¢«è§¦å‘å¤šæ¬¡, å¦‚æœåœ¨<strong>å¤šçº¿ç¨‹ç¯å¢ƒ</strong>ä¸‹, å°±ä¼šå‡ºç°<strong>ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªsocket</strong>çš„å±€é¢, è¿™æ˜¯ä¸‡ä¸‡ä¸å¯çš„, ä¸€ä¸ªsocketçš„è¯»äº‹ä»¶å°±åº”å½“è¢«ä¸€ä¸ªçº¿ç¨‹åŒ…æ½, ä¸ç„¶æ•°æ®çš„è¿è´¯æ€§å°±ç¼ºå¤±äº†, è¿›è€Œå¤„ç†åŸºæœ¬å¿…å®šå¤±è´¥. </p><p>è¿™ä¸€ç‚¹å¯ä»¥ä½¿ç”¨epollçš„EPOLLONESHOTäº‹ä»¶é¿å….</p><p>å¯¹äºæ³¨å†Œäº†EPOLLONESHOTäº‹ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ“ä½œç³»ç»Ÿæœ€å¤šè§¦å‘å…¶ä¸Šæ³¨å†Œçš„ä¸€ä¸ªå¯è¯»ã€å¯å†™æˆ–è€…å¼‚å¸¸äº‹ä»¶ï¼Œä¸”åªè§¦å‘ä¸€æ¬¡ï¼Œé™¤éæˆ‘ä»¬ä½¿ç”¨epoll_ctlå‡½æ•°é‡ç½®è¯¥æ–‡ä»¶æè¿°ç¬¦ä¸Šæ³¨å†Œçš„EPOLLONESHOTäº‹ä»¶ã€‚è¿™æ ·ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹åœ¨å¤„ç†æŸä¸ªsocketæ—¶ï¼Œå…¶ä»–çº¿ç¨‹æ˜¯ä¸å¯èƒ½æœ‰æœºä¼šæ“ä½œè¯¥socketçš„ã€‚ä½†åè¿‡æ¥æ€è€ƒï¼Œæ³¨å†Œäº†EPOLLONESHOTäº‹ä»¶çš„socketä¸€æ—¦è¢«æŸä¸ªçº¿ç¨‹å¤„ç†å®Œæ¯•ï¼Œè¯¥çº¿ç¨‹å°±åº”è¯¥ç«‹å³é‡ç½®è¿™ä¸ªsocketä¸Šçš„EPOLLONESHOTäº‹ä»¶ï¼Œä»¥ç¡®ä¿è¿™ä¸ªsocketä¸‹ä¸€æ¬¡å¯è¯»æ—¶ï¼Œå…¶EPOLLINäº‹ä»¶èƒ½è¢«è§¦å‘ï¼Œè¿›è€Œè®©å…¶ä»–å·¥ä½œçº¿ç¨‹æœ‰æœºä¼šç»§ç»­å¤„ç†è¿™ä¸ªsocketã€‚</p><p>ä¹¦ä¸­çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;netinet/in.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arpa/inet.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;assert.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;errno.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/epoll.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_EVENT_NUMBER 1024</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> BUFFER_SIZE 1024</span><br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">fds</span> &#123;<br>    <span class="hljs-type">int</span> epollfd;<br>    <span class="hljs-type">int</span> sockfd;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">setnonblocking</span><span class="hljs-params">(<span class="hljs-type">int</span> fd)</span> </span>&#123;<br>    <span class="hljs-type">int</span> old_option = <span class="hljs-built_in">fcntl</span>(fd, F_GETFL);<br>    <span class="hljs-type">int</span> new_option = old_option | O_NONBLOCK;<br>    <span class="hljs-built_in">fcntl</span>(fd, F_SETFL, new_option);<br>    <span class="hljs-keyword">return</span> old_option;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addfd</span><span class="hljs-params">(<span class="hljs-type">int</span> epollfd, <span class="hljs-type">int</span> fd, <span class="hljs-type">bool</span> oneshot)</span> </span>&#123;<br>    epoll_event event;<br>    event.data.fd = fd;<br>    event.events = EPOLLIN | EPOLLET;<br>    <span class="hljs-keyword">if</span> (oneshot) &#123;<br>        event.events |= EPOLLONESHOT;<br>    &#125;<br>    <span class="hljs-built_in">epoll_ctl</span>(epollfd, EPOLL_CTL_ADD, fd, &amp;event);<br>    <span class="hljs-built_in">setnonblocking</span>(fd);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">reset_oneshot</span><span class="hljs-params">(<span class="hljs-type">int</span> epollfd, <span class="hljs-type">int</span> fd)</span> </span>&#123;<br>    epoll_event event;<br>    event.data.fd = fd;<br>    event.events = EPOLLIN | EPOLLET | EPOLLONESHOT;<br>    <span class="hljs-built_in">epoll_ctl</span>(epollfd, EPOLL_CTL_MOD, fd, &amp;event);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span>* <span class="hljs-title">worker</span><span class="hljs-params">(<span class="hljs-type">void</span>* arg)</span> </span>&#123;<br>    <span class="hljs-type">int</span> sockfd = ((fds*)arg)-&gt;sockfd;<br>    <span class="hljs-type">int</span> epollfd = ((fds*)arg)-&gt;epollfd;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;start new thread to receive data on fd:%d\n&quot;</span>, sockfd);<br>    <span class="hljs-type">char</span> buf[BUFFER_SIZE];<br>    <span class="hljs-built_in">memset</span>(buf, <span class="hljs-string">&#x27;\0&#x27;</span>, BUFFER_SIZE);<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-type">int</span> ret = <span class="hljs-built_in">recv</span>(sockfd, buf, BUFFER_SIZE - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">if</span> (ret == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-built_in">close</span>(sockfd);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;foreiner closed the connection\n&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">if</span> (errno == EAGAIN) &#123;<br>                <span class="hljs-built_in">reset_oneshot</span>(epollfd, sockfd);<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;read later\n&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;get content:%s\n&quot;</span>, buf);<br>            <span class="hljs-built_in">sleep</span>(<span class="hljs-number">5</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;end thread receiving data on fd:%d\n&quot;</span>, sockfd);<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>* argv[])</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (argc &lt;= <span class="hljs-number">2</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;usage:%s ip_address port_number\n&quot;</span>, <span class="hljs-built_in">basename</span>(argv[<span class="hljs-number">0</span>]));<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* ip = argv[<span class="hljs-number">1</span>];<br>    <span class="hljs-type">int</span> port = <span class="hljs-built_in">atoi</span>(argv[<span class="hljs-number">2</span>]);<br>    <span class="hljs-type">int</span> ret = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in</span> address;<br>    <span class="hljs-built_in">bzero</span>(&amp;address, <span class="hljs-built_in">sizeof</span>(address));<br>    address.sin_family = AF_INET;<br>    <span class="hljs-built_in">inet_pton</span>(AF_INET, ip, &amp;address.sin_addr);<br>    address.sin_port = <span class="hljs-built_in">htons</span>(port);<br>    <span class="hljs-type">int</span> listenfd = <span class="hljs-built_in">socket</span>(PF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">assert</span>(listenfd &gt;= <span class="hljs-number">0</span>);<br>    ret = <span class="hljs-built_in">bind</span>(listenfd, (<span class="hljs-keyword">struct</span> sockaddr*)&amp;address, <span class="hljs-built_in">sizeof</span>(address));<br>    <span class="hljs-built_in">assert</span>(ret != <span class="hljs-number">-1</span>);<br>    ret = <span class="hljs-built_in">listen</span>(listenfd, <span class="hljs-number">5</span>);<br>    <span class="hljs-built_in">assert</span>(ret != <span class="hljs-number">-1</span>);<br>    epoll_event events[MAX_EVENT_NUMBER];<br>    <span class="hljs-type">int</span> epollfd = <span class="hljs-built_in">epoll_create</span>(<span class="hljs-number">5</span>);<br>    <span class="hljs-built_in">assert</span>(epollfd != <span class="hljs-number">-1</span>);<br>    <span class="hljs-built_in">addfd</span>(epollfd, listenfd, <span class="hljs-literal">false</span>);<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-type">int</span> ret = <span class="hljs-built_in">epoll_wait</span>(epollfd, events, MAX_EVENT_NUMBER, <span class="hljs-number">-1</span>);<br>        <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;epoll failure\n&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; ret; i++) &#123;<br>            <span class="hljs-type">int</span> sockfd = events[i].data.fd;<br>            <span class="hljs-keyword">if</span> (sockfd == listenfd) &#123;<br>                <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in</span> client_address;<br>                <span class="hljs-type">socklen_t</span> client_addrlength = <span class="hljs-built_in">sizeof</span>(client_address);<br>                <span class="hljs-type">int</span> connfd = <span class="hljs-built_in">accept</span>(listenfd, (<span class="hljs-keyword">struct</span> sockaddr*)&amp;client_address, &amp;client_addrlength);<br>                <span class="hljs-built_in">addfd</span>(epollfd, connfd, <span class="hljs-literal">true</span>);<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (events[i].events &amp; EPOLLIN) &#123;<br>                <span class="hljs-type">pthread_t</span> thread;<br>                fds fds_for_new_worker;<br>                fds_for_new_worker.epollfd = epollfd;<br>                fds_for_new_worker.sockfd = sockfd;<br>                <span class="hljs-built_in">pthread_create</span>(&amp;thread, <span class="hljs-literal">NULL</span>, worker, (<span class="hljs-type">void</span>*)&amp;fds_for_new_worker);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;something else happened\n&quot;</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">close</span>(listenfd);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶å®å†…å®¹å’Œä¸Šä¸€ä¸ªä¾‹å­å¤§å·®ä¸å·®, å¤šçš„å°±æ˜¯æ™®é€šè¯»æ”¹ä¸ºä½¿ç”¨å¤šçº¿ç¨‹, å¹¶ä¸”è¯»å®Œè¦è°ƒç”¨reset_oneshoté‡æ–°è®¾ç½®EPOLLONESHOTè¿™ä¸€äº‹ä»¶å±æ€§, è¿™æ ·å¯ä»¥ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹è¯»å–ä¸€ä¸ªsocket.</p>]]></content>
    
    
    
    <tags>
      
      <tag>Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ è¯»ä¹¦ç¬”è®°(4)</title>
    <link href="/2025/02/15/%5BLinux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B%5D%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0(4)/"/>
    <url>/2025/02/15/%5BLinux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B%5D%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0(4)/</url>
    
    <content type="html"><![CDATA[<blockquote><p><strong>ç¬¬å…«ç«  é«˜æ€§èƒ½æœåŠ¡å™¨ç¨‹åºæ¡†æ¶</strong></p></blockquote><p>æœ¬ç« æ„åœ¨æŠ›å‡ºä¸€äº›æ ¸å¿ƒçš„æ¦‚å¿µ, å®æ“åŸºæœ¬æ²¡æœ‰, ä½†æ˜¯è¿™äº›æ¦‚å¿µçš„ç†è§£æˆ‘è®¤ä¸ºç›¸å¯¹é‡è¦, æˆ‘ä¼šä»¥å£è¯­åŒ–çš„å½¢å¼ç®€è¦æè¿°.</p><h2 id="æœåŠ¡å™¨æ¨¡å‹"><a href="#æœåŠ¡å™¨æ¨¡å‹" class="headerlink" title="æœåŠ¡å™¨æ¨¡å‹"></a>æœåŠ¡å™¨æ¨¡å‹</h2><ul><li>C&#x2F;Sæ¨¡å‹ : å®¢æˆ·ç«¯&#x2F;æœåŠ¡ç«¯, æœ€åŸºç¡€çš„æœåŠ¡å™¨æ¨¡å‹, èµ„æºé›†ä¸­åœ¨æœåŠ¡ç«¯, ä¸»è¦æ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯ç”³è¯·èµ„æº.</li><li>p2pæ¨¡å‹ : æ¯ä¸ªä¸»æœºéƒ½å¯ä»¥æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯, æ¯ä¸ªä¸»æœºä¸Šéƒ½ä¼šå­˜æœ‰ä¸€å®šçš„èµ„æº, æ¯ä¸ªä¸»æœºåˆ©ç”¨æ´ªæ³›å‘æ¯ä¸ªç‚¹ç”³è¯·èµ„æº.</li></ul><hr><h2 id="æœåŠ¡å™¨ç¼–ç¨‹æ¡†æ¶"><a href="#æœåŠ¡å™¨ç¼–ç¨‹æ¡†æ¶" class="headerlink" title="æœåŠ¡å™¨ç¼–ç¨‹æ¡†æ¶"></a>æœåŠ¡å™¨ç¼–ç¨‹æ¡†æ¶</h2><p><img src="/../img/image/2.png"></p><ul><li>I&#x2F;Oå¤„ç†å•å…ƒ : ç”¨äºå¤„ç†å®¢æˆ·è¿æ¥, å®ç°è´Ÿè½½å‡è¡¡, å¯ä»¥ç”¨ä¸»çº¿ç¨‹å®ç°, ä¹Ÿå¯ä»¥ç›´æ¥ç”¨Nginx.</li><li>é€»è¾‘å•å…ƒ : ä¸€èˆ¬æ˜¯ä¸€ä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹, ä¸€èˆ¬ç”¨äºå¤„ç†æ ¸å¿ƒé€»è¾‘, ä¹Ÿå¯è¿›è¡Œæ•°æ®çš„æ”¶å‘(ä¾äº‹ä»¶å¤„ç†æ¨¡å¼è€Œå®š).</li><li>ç½‘ç»œå­˜å‚¨å•å…ƒ : å°±æ˜¯æ•°æ®åº“, æ¯”å¦‚mysql.</li><li>è¯·æ±‚é˜Ÿåˆ— : å°±æ˜¯ä»¥ä¸Šä¸‰è€…ä¹‹é—´é€šä¿¡æ–¹å¼çš„æŠ½è±¡, ä¸€èˆ¬ç”¨æ± å®ç°, é‡Œé¢å­˜æ”¾å·²ç»å»ºç«‹å¥½çš„TCPè¿æ¥.</li></ul><hr><h2 id="I-Oæ¨¡å‹"><a href="#I-Oæ¨¡å‹" class="headerlink" title="I&#x2F;Oæ¨¡å‹"></a>I&#x2F;Oæ¨¡å‹</h2><p>å…¶å®å°±åœ¨ç¡®å®šæ•°æ®åœ¨æ”¶å‘æ—¶æ˜¯é˜»å¡è¿˜æ˜¯éé˜»å¡, æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥.</p><ul><li><p>é˜»å¡å’Œéé˜»å¡å±äº<strong>æ•°æ®å‡†å¤‡</strong>é˜¶æ®µ, æ˜¯ç³»ç»ŸIOæ“ä½œçš„<strong>å°±ç»ªçŠ¶æ€</strong>.</p></li><li><p>åŒæ­¥å’Œå¼‚æ­¥å±äº<strong>æ•°æ®è¯»å†™</strong>é˜¶æ®µ, æ˜¯<strong>åº”ç”¨ç¨‹åºå’Œå†…æ ¸çš„äº¤äº’æ–¹å¼</strong>.</p></li><li><p>é˜»å¡ : åœ¨IOæ“ä½œå°±ç»ªæ—¶, è¿›ç¨‹å°†è¢«é˜»å¡, ç­‰å¾…IOæ•°æ®æ”¶å‘.</p></li><li><p>éé˜»å¡ : åœ¨IOæ“ä½œå°±ç»ªæ—¶, ä¼šç«‹å³åšå‡ºåˆ¤æ–­, ç»™å‡ºè¿”å›å€¼, é€€å‡ºå‡½æ•°, é€šè¿‡è¿”å›å€¼åˆ¤æ–­æ”¶å‘æ˜¯å¦æ­£å¸¸.</p></li><li><p>åŒæ­¥I&#x2F;O : è¯»å†™æ“ä½œåœ¨IOäº‹ä»¶å‘ç”Ÿä¹‹å, ç”±åº”ç”¨ç¨‹åºæœ¬èº«å®Œæˆ.</p><p>é˜»å¡IO &#x2F; IOå¤ç”¨ &#x2F; SIGIOä¿¡å· éƒ½å±äºåŒæ­¥IO</p></li><li><p>å¼‚æ­¥I&#x2F;O : è¯»å†™æ“ä½œç”±å†…æ ¸å®Œæˆ, åº”ç”¨ç¨‹åºåªæ˜¯æå‰è®¾ç½®ç¼“å†²åŒºä½ç½®å’ŒIOæ“ä½œå®Œæˆåçš„é€šçŸ¥å‡½æ•°.</p></li></ul><hr><h2 id="ä¸¤ç§é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æ¨¡å¼"><a href="#ä¸¤ç§é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æ¨¡å¼" class="headerlink" title="ä¸¤ç§é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æ¨¡å¼"></a>ä¸¤ç§é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æ¨¡å¼</h2><p>æœåŠ¡å™¨ç¨‹åºé€šå¸¸éœ€è¦å¤„ç†ä¸‰ç±»äº‹ä»¶ï¼šI&#x2F;Oäº‹ä»¶ã€ä¿¡å·åŠå®šæ—¶äº‹ä»¶ã€‚</p><h3 id="Reactoræ¨¡å¼"><a href="#Reactoræ¨¡å¼" class="headerlink" title="Reactoræ¨¡å¼"></a>Reactoræ¨¡å¼</h3><p>è¿™æ˜¯ä¸€ç§åŒæ­¥IOæ¨¡å¼, å…¶ä¸­çº¿ç¨‹åˆ†ä¸ºä¸»çº¿ç¨‹å’Œå·¥ä½œçº¿ç¨‹, ä¸»çº¿ç¨‹è´Ÿè´£ç›‘è§†socketæ˜¯å¦æœ‰ä¿¡æ¯å‘é€è¿‡æ¥, å·¥ä½œçº¿ç¨‹è´Ÿè´£è¯»å†™ä»¥åŠæ ¸å¿ƒé€»è¾‘.</p><p>ç®€ç•¥æ­¥éª¤å¦‚ä¸‹ : </p><ul><li>ä¸»çº¿ç¨‹é€šè¿‡epollæ³¨å†Œsocketçš„è¯»å°±ç»ªäº‹ä»¶. </li><li>ä¸»çº¿ç¨‹è°ƒç”¨epoll_waitç­‰å¾…æ³¨å†Œçš„socketå‘æ¥æ¶ˆæ¯.</li><li>æŸä¸ªsocketå¯è¯»æ—¶, å°†å…¶åˆ†å‘ç»™å·¥ä½œçº¿ç¨‹.</li><li>å·¥ä½œçº¿ç¨‹è¿›è¡Œè¯»å–å¹¶å¤„ç†æ ¸å¿ƒé€»è¾‘, å¦‚æœéœ€è¦å›å¤, å°±ç”¨ekpollæ³¨å†Œå†™å°±ç»ªäº‹ä»¶.</li><li>ä¸»çº¿ç¨‹ä¹Ÿä¼šè°ƒç”¨epoll_waitç­‰å¾…å†™äº‹ä»¶.</li><li>å½“socketå¯å†™æ—¶, ä¸»çº¿ç¨‹å†å°†å…¶åˆ†å‘ç»™ä¸€ä¸ªå·¥ä½œè¿›ç¨‹è¿›è¡Œå†™æ“ä½œ.</li></ul><p><img src="/../img/3.png"></p><h3 id="Proactoræ¨¡å¼"><a href="#Proactoræ¨¡å¼" class="headerlink" title="Proactoræ¨¡å¼"></a>Proactoræ¨¡å¼</h3><p>ä¸€ç§å¼‚æ­¥IOæ¨¡å¼, åŸºç¡€æ€æƒ³ä¸Reactoræ¨¡å¼ä¸€ç›´, ä½†æ˜¯åˆ©ç”¨å¼‚æ­¥IOçš„æœºåˆ¶å‡å»äº†å·¥ä½œçº¿ç¨‹çš„è¯»å†™å·¥ä½œ, è¯»å†™å·¥ä½œç”±å†…æ ¸å®ç°, åªéœ€è¦è®¾ç½®é€šçŸ¥å‡½æ•°å”¤é†’å·¥ä½œçº¿ç¨‹.</p><p><img src="/../img/image/4.png"></p><hr><h2 id="æœ‰é™çŠ¶æ€æœº"><a href="#æœ‰é™çŠ¶æ€æœº" class="headerlink" title="æœ‰é™çŠ¶æ€æœº"></a>æœ‰é™çŠ¶æ€æœº</h2><p>è¿™ä¸ªåå­—çœŸçš„å¾ˆé«˜ç«¯, ä½†å®é™…æœ‰æ›´ç®€å•çš„ç†è§£.</p><p>è¿™æ˜¯ä¸€ä¸ªé€»è¾‘å•å…ƒå†…éƒ¨çš„é«˜æ•ˆç¼–ç¨‹æ‰‹æ³•, å¯ä»¥ç®€å•ç†è§£ä¸ºæŠŠä¸€ä¸ªäº‹åŠ¡åˆ†è§£æˆå¤šä¸ªæ‰§è¡Œçš„é˜¶æ®µ, ç”¨enumæŠŠè¿™äº›çŠ¶æ€åˆ—ä¸¾å‡ºæ¥, å†ç”¨switché€šè¿‡åˆ¤æ–­å½“å‰äº‹åŠ¡çŠ¶æ€æ¥åˆ†åˆ«è°ƒç”¨å¯¹åº”çš„å¤„ç†å‡½æ•°. </p><p>æ¯”å¦‚æˆ‘ä»¬è¦å¯¹HTTPè¯·æ±‚è¿›è¡Œè¯»å–å’Œåˆ†æ, httpæŠ¥æ–‡æœ‰è¯·æ±‚è¡Œ&#x2F;è¯·æ±‚æŠ¥å¤´&#x2F;è¯·æ±‚æ­£æ–‡ä¸‰ä¸ªéƒ¨åˆ†, ç”±äºTCPä¼ è¾“ä¸€æ¬¡ä¼ è¾“å¯èƒ½ä¸å®Œæ•´, æˆ‘ä»¬å¯èƒ½è¯»ä¸å®Œå…¨, æˆ‘ä»¬å¯ä»¥æŠŠçŠ¶æ€åˆ†ä¸ºè¯·æ±‚è¡Œè¯»å–, æŠ¥å¤´è¯»å–, æ­£æ–‡è¯»å–, åœ¨ä¸åŒçš„çŠ¶æ€æ‰§è¡Œä¸åŒçš„è¯»å†™æ“ä½œå’Œå¤„ç†æ“ä½œ. å¹¶ä¸”æˆ‘ä»¬ä¹Ÿåº”å½“è®¾ç½®åˆç†çš„çŠ¶æ€è½¬ç§», æ¯”å¦‚å½“å‰çŠ¶æ€ä¸ºè¯·æ±‚è¡Œè¯»å–, åœ¨ç›¸å…³æ“ä½œå¤„ç†å®Œå, é‚£ä¹ˆçŠ¶æ€å°±åº”å½“è¢«è½¬åŒ–ä¸ºæŠ¥å¤´è¯»å–.</p><p>ä¸‹é¢æ˜¯å®Œæ•´çš„ä»£ç , ç¡®å®éå¸¸å†—é•¿, ä¸Šé¢è¿™ä¸€æ®µç®—æ˜¯æˆ‘æœ€ç²¾ç®€çš„æ¦‚æ‹¬äº†, å…¶å®ç»è¿‡æ±‚è¯å…¶å®ä¹Ÿæ²¡æœ‰å¤šå¤§å¿…è¦å»è¯¦ç»†è®°ä½, å› ä¸ºç°åœ¨æœ‰å¾ˆå¤šçš„httpåº“å¯ä»¥è§£å†³è¿™æ–¹é¢çš„é—®é¢˜, æˆ‘ä»¬ä¸»è¦æ˜¯é‡åœ¨ç†è§£è¿™ä¸ªæ¦‚å¿µ.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;netinet/in.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arpa/inet.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;assert.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;errno.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> BUFFER_SIZE 4096 <span class="hljs-comment">/* è¯»ç¼“å†²åŒºå¤§å° */</span></span><br><br><span class="hljs-comment">/* ä¸»çŠ¶æ€æœºçš„ä¸¤ç§å¯èƒ½çŠ¶æ€ï¼Œåˆ†åˆ«è¡¨ç¤ºï¼šå½“å‰æ­£åœ¨åˆ†æè¯·æ±‚è¡Œï¼Œå½“å‰æ­£åœ¨åˆ†æå¤´éƒ¨å­—æ®µ */</span><br><span class="hljs-keyword">enum</span> <span class="hljs-title class_">CHECK_STATE</span> &#123;<br>    CHECK_STATE_REQUESTLINE = <span class="hljs-number">0</span>,<br>    CHECK_STATE_HEADER<br>&#125;;<br><br><span class="hljs-comment">/* ä»çŠ¶æ€æœºçš„ä¸‰ç§å¯èƒ½çŠ¶æ€ï¼Œå³è¡Œçš„è¯»å–çŠ¶æ€ï¼Œåˆ†åˆ«è¡¨ç¤ºï¼šè¯»å–åˆ°ä¸€ä¸ªå®Œæ•´çš„è¡Œã€è¡Œå‡ºé”™å’Œè¡Œæ•°æ®å°šä¸”ä¸å®Œæ•´ */</span><br><span class="hljs-keyword">enum</span> <span class="hljs-title class_">LINE_STATUS</span> &#123;<br>    LINE_OK = <span class="hljs-number">0</span>,<br>    LINE_BAD,<br>    LINE_OPEN<br>&#125;;<br><br><span class="hljs-comment">/* æœåŠ¡å™¨å¤„ç†HTTPè¯·æ±‚çš„ç»“æœï¼šNO_REQUESTè¡¨ç¤ºè¯·æ±‚ä¸å®Œæ•´ï¼Œéœ€è¦ç»§ç»­è¯»å–å®¢æˆ·æ•°æ®ï¼›GET_REQUESTè¡¨ç¤ºè·å¾—äº†ä¸€ä¸ªå®Œæ•´çš„å®¢æˆ·è¯·æ±‚ï¼›BAD_REQUESTè¡¨ç¤ºå®¢æˆ·è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯ï¼›FORBIDDEN_REQUESTè¡¨ç¤ºå®¢æˆ·å¯¹èµ„æºæ²¡æœ‰è¶³å¤Ÿçš„è®¿é—®æƒé™ï¼›INTERNAL_ERRORè¡¨ç¤ºæœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼›CLOSED_CONNECTIONè¡¨ç¤ºå®¢æˆ·ç«¯å·²ç»å…³é—­è¿æ¥äº† */</span><br><span class="hljs-keyword">enum</span> <span class="hljs-title class_">HTTP_CODE</span> &#123;<br>    NO_REQUEST,<br>    GET_REQUEST,<br>    BAD_REQUEST,<br>    FORBIDDEN_REQUEST,<br>    INTERNAL_ERROR,<br>    CLOSED_CONNECTION<br>&#125;;<br><br><span class="hljs-comment">/* ä¸ºäº†ç®€åŒ–é—®é¢˜ï¼Œæˆ‘ä»¬æ²¡æœ‰ç»™å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªå®Œæ•´çš„HTTPåº”ç­”æŠ¥æ–‡ï¼Œè€Œåªæ˜¯æ ¹æ®æœåŠ¡å™¨çš„å¤„ç†ç»“æœå‘é€å¦‚ä¸‹æˆåŠŸæˆ–å¤±è´¥ä¿¡æ¯ */</span><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *szret[] = &#123;<span class="hljs-string">&quot;I get a correct result\n&quot;</span>, <span class="hljs-string">&quot;Something wrong\n&quot;</span>&#125;;<br><br><span class="hljs-comment">/* ä»çŠ¶æ€æœºï¼Œç”¨äºè§£æå‡ºä¸€è¡Œå†…å®¹ */</span><br><span class="hljs-function">LINE_STATUS <span class="hljs-title">parse_line</span><span class="hljs-params">(<span class="hljs-type">char</span> *buffer, <span class="hljs-type">int</span> &amp;checked_index, <span class="hljs-type">int</span> &amp;read_index)</span> </span>&#123;<br>    <span class="hljs-type">char</span> temp;<br>    <span class="hljs-comment">/* checked_indexæŒ‡å‘bufferï¼ˆåº”ç”¨ç¨‹åºçš„è¯»ç¼“å†²åŒºï¼‰ä¸­å½“å‰æ­£åœ¨åˆ†æçš„å­—èŠ‚ï¼Œread_indexæŒ‡å‘bufferä¸­å®¢æˆ·æ•°æ®çš„å°¾éƒ¨çš„ä¸‹ä¸€å­—èŠ‚ã€‚bufferä¸­ç¬¬0ï½checked_indexå­—èŠ‚éƒ½å·²åˆ†æå®Œæ¯•ï¼Œç¬¬checked_indexï½(read_index-1)å­—èŠ‚ç”±ä¸‹é¢çš„å¾ªç¯æŒ¨ä¸ªåˆ†æ */</span><br>    <span class="hljs-keyword">for</span> (; checked_index &lt; read_index; ++checked_index) &#123;<br>        <span class="hljs-comment">/* è·å¾—å½“å‰è¦åˆ†æçš„å­—èŠ‚ */</span><br>        temp = buffer[checked_index];<br>        <span class="hljs-comment">/* å¦‚æœå½“å‰çš„å­—èŠ‚æ˜¯â€œ\râ€ï¼Œå³å›è½¦ç¬¦ï¼Œåˆ™è¯´æ˜å¯èƒ½è¯»å–åˆ°ä¸€ä¸ªå®Œæ•´çš„è¡Œ */</span><br>        <span class="hljs-keyword">if</span> (temp == <span class="hljs-string">&#x27;\r&#x27;</span>) &#123;<br>            <span class="hljs-comment">/* å¦‚æœâ€œ\râ€å­—ç¬¦ç¢°å·§æ˜¯ç›®å‰bufferä¸­çš„æœ€åä¸€ä¸ªå·²ç»è¢«è¯»å…¥çš„å®¢æˆ·æ•°æ®ï¼Œé‚£ä¹ˆè¿™æ¬¡åˆ†ææ²¡æœ‰è¯»å–åˆ°ä¸€ä¸ªå®Œæ•´çš„è¡Œï¼Œè¿”å›LINE_OPENä»¥è¡¨ç¤ºè¿˜éœ€è¦ç»§ç»­è¯»å–å®¢æˆ·æ•°æ®æ‰èƒ½è¿›ä¸€æ­¥åˆ†æ */</span><br>            <span class="hljs-keyword">if</span> ((checked_index + <span class="hljs-number">1</span>) == read_index) &#123;<br>                <span class="hljs-keyword">return</span> LINE_OPEN;<br>            &#125;<br>            <span class="hljs-comment">/* å¦‚æœä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯â€œ\nâ€ï¼Œåˆ™è¯´æ˜æˆ‘ä»¬æˆåŠŸè¯»å–åˆ°ä¸€ä¸ªå®Œæ•´çš„è¡Œ */</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (buffer[checked_index + <span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;\n&#x27;</span>) &#123;<br>                buffer[checked_index++] = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>                buffer[checked_index++] = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>                <span class="hljs-keyword">return</span> LINE_OK;<br>            &#125;<br>            <span class="hljs-comment">/* å¦åˆ™çš„è¯ï¼Œè¯´æ˜å®¢æˆ·å‘é€çš„HTTPè¯·æ±‚å­˜åœ¨è¯­æ³•é—®é¢˜ */</span><br>            <span class="hljs-keyword">return</span> LINE_BAD;<br>        &#125;<br>        <span class="hljs-comment">/* å¦‚æœå½“å‰çš„å­—èŠ‚æ˜¯â€œ\nâ€ï¼Œå³æ¢è¡Œç¬¦ï¼Œåˆ™ä¹Ÿè¯´æ˜å¯èƒ½è¯»å–åˆ°ä¸€ä¸ªå®Œæ•´çš„è¡Œ */</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (temp == <span class="hljs-string">&#x27;\n&#x27;</span>) &#123;<br>            <span class="hljs-keyword">if</span> ((checked_index &gt; <span class="hljs-number">1</span>) &amp;&amp; buffer[checked_index - <span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;\r&#x27;</span>) &#123;<br>                buffer[checked_index - <span class="hljs-number">1</span>] = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>                buffer[checked_index++] = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>                <span class="hljs-keyword">return</span> LINE_OK;<br>            &#125;<br>            <span class="hljs-keyword">return</span> LINE_BAD;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/* å¦‚æœæ‰€æœ‰å†…å®¹éƒ½åˆ†æå®Œæ¯•ä¹Ÿæ²¡é‡åˆ°â€œ\râ€å­—ç¬¦ï¼Œåˆ™è¿”å›LINE_OPENï¼Œè¡¨ç¤ºè¿˜éœ€è¦ç»§ç»­è¯»å–å®¢æˆ·æ•°æ®æ‰èƒ½è¿›ä¸€æ­¥åˆ†æ */</span><br>    <span class="hljs-keyword">return</span> LINE_OPEN;<br>&#125;<br><br><span class="hljs-comment">/* åˆ†æè¯·æ±‚è¡Œ */</span><br><span class="hljs-function">HTTP_CODE <span class="hljs-title">parse_requestline</span><span class="hljs-params">(<span class="hljs-type">char</span> *temp, CHECK_STATE &amp;checkstate)</span> </span>&#123;<br>    <span class="hljs-type">char</span> *url = <span class="hljs-built_in">strpbrk</span>(temp, <span class="hljs-string">&quot;\t&quot;</span>);<br>    <span class="hljs-comment">/* å¦‚æœè¯·æ±‚è¡Œä¸­æ²¡æœ‰ç©ºç™½å­—ç¬¦æˆ–â€œ\tâ€å­—ç¬¦ï¼Œåˆ™HTTPè¯·æ±‚å¿…æœ‰é—®é¢˜ */</span><br>    <span class="hljs-keyword">if</span> (!url) &#123;<br>        <span class="hljs-keyword">return</span> BAD_REQUEST;<br>    &#125;<br>    *url++ = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>    <span class="hljs-type">char</span> *method = temp;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcasecmp</span>(method, <span class="hljs-string">&quot;GET&quot;</span>) == <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">/* ä»…æ”¯æŒGETæ–¹æ³• */</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The request method is GET\n&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> BAD_REQUEST;<br>    &#125;<br><br>    url += <span class="hljs-built_in">strspn</span>(url, <span class="hljs-string">&quot;\t&quot;</span>);<br>    <span class="hljs-type">char</span> *version = <span class="hljs-built_in">strpbrk</span>(url, <span class="hljs-string">&quot;\t&quot;</span>);<br>    <span class="hljs-keyword">if</span> (!version) &#123;<br>        <span class="hljs-keyword">return</span> BAD_REQUEST;<br>    &#125;<br>    *version++ = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>    version += <span class="hljs-built_in">strspn</span>(version, <span class="hljs-string">&quot;\t&quot;</span>);<br><br>    <span class="hljs-comment">/* ä»…æ”¯æŒHTTP/1.1 */</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcasecmp</span>(version, <span class="hljs-string">&quot;HTTP/1.1&quot;</span>) != <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">return</span> BAD_REQUEST;<br>    &#125;<br><br>    <span class="hljs-comment">/* æ£€æŸ¥URLæ˜¯å¦åˆæ³• */</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strncasecmp</span>(url, <span class="hljs-string">&quot;http://&quot;</span>, <span class="hljs-number">7</span>) == <span class="hljs-number">0</span>) &#123;<br>        url += <span class="hljs-number">7</span>;<br>        url = <span class="hljs-built_in">strchr</span>(url, <span class="hljs-string">&#x27;/&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!url || url[<span class="hljs-number">0</span>] != <span class="hljs-string">&#x27;/&#x27;</span>) &#123;<br>        <span class="hljs-keyword">return</span> BAD_REQUEST;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The request URL is:%s\n&quot;</span>, url);<br><br>    <span class="hljs-comment">/* HTTPè¯·æ±‚è¡Œå¤„ç†å®Œæ¯•ï¼ŒçŠ¶æ€è½¬ç§»åˆ°å¤´éƒ¨å­—æ®µçš„åˆ†æ */</span><br>    checkstate = CHECK_STATE_HEADER;<br>    <span class="hljs-keyword">return</span> NO_REQUEST;<br>&#125;<br><br><span class="hljs-comment">/* åˆ†æå¤´éƒ¨å­—æ®µ */</span><br><span class="hljs-function">HTTP_CODE <span class="hljs-title">parse_headers</span><span class="hljs-params">(<span class="hljs-type">char</span> *temp)</span> </span>&#123;<br>    <span class="hljs-comment">/* é‡åˆ°ä¸€ä¸ªç©ºè¡Œï¼Œè¯´æ˜æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªæ­£ç¡®çš„HTTPè¯·æ±‚ */</span><br>    <span class="hljs-keyword">if</span> (temp[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;\0&#x27;</span>) &#123;<br>        <span class="hljs-keyword">return</span> GET_REQUEST;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strncasecmp</span>(temp, <span class="hljs-string">&quot;Host:&quot;</span>, <span class="hljs-number">5</span>) == <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">/* å¤„ç†â€œHOSTâ€å¤´éƒ¨å­—æ®µ */</span><br>        temp += <span class="hljs-number">5</span>;<br>        temp += <span class="hljs-built_in">strspn</span>(temp, <span class="hljs-string">&quot;\t&quot;</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;the request host is:%s\n&quot;</span>, temp);<br>    &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">/* å…¶ä»–å¤´éƒ¨å­—æ®µéƒ½ä¸å¤„ç† */</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;I can not handle this header\n&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> NO_REQUEST;<br>&#125;<br><br><span class="hljs-comment">/* åˆ†æHTTPè¯·æ±‚çš„å…¥å£å‡½æ•° */</span><br><span class="hljs-function">HTTP_CODE <span class="hljs-title">parse_content</span><span class="hljs-params">(<span class="hljs-type">char</span> *buffer, <span class="hljs-type">int</span> &amp;checked_index, CHECK_STATE &amp;checkstate, <span class="hljs-type">int</span> &amp;read_index, <span class="hljs-type">int</span> &amp;start_line)</span> </span>&#123;<br>    LINE_STATUS linestatus = LINE_OK; <span class="hljs-comment">/* è®°å½•å½“å‰è¡Œçš„è¯»å–çŠ¶æ€ */</span><br>    HTTP_CODE retcode = NO_REQUEST; <span class="hljs-comment">/* è®°å½•HTTPè¯·æ±‚çš„å¤„ç†ç»“æœ */</span><br><br>    <span class="hljs-comment">/* ä¸»çŠ¶æ€æœºï¼Œç”¨äºä»bufferä¸­å–å‡ºæ‰€æœ‰å®Œæ•´çš„è¡Œ */</span><br>    <span class="hljs-keyword">while</span> ((linestatus = <span class="hljs-built_in">parse_line</span>(buffer, checked_index, read_index)) == LINE_OK) &#123;<br>        <span class="hljs-type">char</span> *temp = buffer + start_line; <span class="hljs-comment">/* start_lineæ˜¯è¡Œåœ¨bufferä¸­çš„èµ·å§‹ä½ç½® */</span><br>        start_line = checked_index; <span class="hljs-comment">/* è®°å½•ä¸‹ä¸€è¡Œçš„èµ·å§‹ä½ç½® */</span><br><br>        <span class="hljs-comment">/* checkstateè®°å½•ä¸»çŠ¶æ€æœºå½“å‰çš„çŠ¶æ€ */</span><br>        <span class="hljs-keyword">switch</span> (checkstate) &#123;<br>            <span class="hljs-keyword">case</span> CHECK_STATE_REQUESTLINE: &#123; <span class="hljs-comment">/* ç¬¬ä¸€ä¸ªçŠ¶æ€ï¼Œåˆ†æè¯·æ±‚è¡Œ */</span><br>                retcode = <span class="hljs-built_in">parse_requestline</span>(temp, checkstate);<br>                <span class="hljs-keyword">if</span> (retcode == BAD_REQUEST) &#123;<br>                    <span class="hljs-keyword">return</span> BAD_REQUEST;<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>            <span class="hljs-keyword">case</span> CHECK_STATE_HEADER: &#123; <span class="hljs-comment">/* ç¬¬äºŒä¸ªçŠ¶æ€ï¼Œåˆ†æå¤´éƒ¨å­—æ®µ */</span><br>                retcode = <span class="hljs-built_in">parse_headers</span>(temp);<br>                <span class="hljs-keyword">if</span> (retcode == BAD_REQUEST) &#123;<br>                    <span class="hljs-keyword">return</span> BAD_REQUEST;<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (retcode == GET_REQUEST) &#123;<br>                    <span class="hljs-keyword">return</span> GET_REQUEST;<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>            <span class="hljs-keyword">default</span>: &#123;<br>                <span class="hljs-keyword">return</span> INTERNAL_ERROR;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/* è‹¥æ²¡æœ‰è¯»å–åˆ°ä¸€ä¸ªå®Œæ•´çš„è¡Œï¼Œåˆ™è¡¨ç¤ºè¿˜éœ€è¦ç»§ç»­è¯»å–å®¢æˆ·æ•°æ®æ‰èƒ½è¿›ä¸€æ­¥åˆ†æ */</span><br>    <span class="hljs-keyword">if</span> (linestatus == LINE_OPEN) &#123;<br>        <span class="hljs-keyword">return</span> NO_REQUEST;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> BAD_REQUEST;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (argc &lt;= <span class="hljs-number">2</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;usage:%s ip_address port_number\n&quot;</span>, <span class="hljs-built_in">basename</span>(argv[<span class="hljs-number">0</span>]));<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *ip = argv[<span class="hljs-number">1</span>];<br>    <span class="hljs-type">int</span> port = <span class="hljs-built_in">atoi</span>(argv[<span class="hljs-number">2</span>]);<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in</span> address;<br>    <span class="hljs-built_in">bzero</span>(&amp;address, <span class="hljs-built_in">sizeof</span>(address));<br>    address.sin_family = AF_INET;<br>    <span class="hljs-built_in">inet_pton</span>(AF_INET, ip, &amp;address.sin_addr);<br>    address.sin_port = <span class="hljs-built_in">htons</span>(port);<br><br>    <span class="hljs-type">int</span> listenfd = <span class="hljs-built_in">socket</span>(PF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">assert</span>(listenfd &gt;= <span class="hljs-number">0</span>);<br><br>    <span class="hljs-type">int</span> ret = <span class="hljs-built_in">bind</span>(listenfd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;address, <span class="hljs-built_in">sizeof</span>(address));<br>    <span class="hljs-built_in">assert</span>(ret != <span class="hljs-number">-1</span>);<br><br>    ret = <span class="hljs-built_in">listen</span>(listenfd, <span class="hljs-number">5</span>);<br>    <span class="hljs-built_in">assert</span>(ret != <span class="hljs-number">-1</span>);<br><br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in</span> client_address;<br>    <span class="hljs-type">socklen_t</span> client_addrlength = <span class="hljs-built_in">sizeof</span>(client_address);<br>    <span class="hljs-type">int</span> fd = <span class="hljs-built_in">accept</span>(listenfd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;client_address, &amp;client_addrlength);<br>    <span class="hljs-keyword">if</span> (fd &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;errno is:%d\n&quot;</span>, errno);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-type">char</span> buffer[BUFFER_SIZE]; <span class="hljs-comment">/* è¯»ç¼“å†²åŒº */</span><br>        <span class="hljs-built_in">memset</span>(buffer, <span class="hljs-string">&#x27;\0&#x27;</span>, BUFFER_SIZE);<br>        <span class="hljs-type">int</span> data_read = <span class="hljs-number">0</span>;<br>        <span class="hljs-type">int</span> read_index = <span class="hljs-number">0</span>; <span class="hljs-comment">/* å½“å‰å·²ç»è¯»å–äº†å¤šå°‘å­—èŠ‚çš„å®¢æˆ·æ•°æ® */</span><br>        <span class="hljs-type">int</span> checked_index = <span class="hljs-number">0</span>; <span class="hljs-comment">/* å½“å‰å·²ç»åˆ†æå®Œäº†å¤šå°‘å­—èŠ‚çš„å®¢æˆ·æ•°æ® */</span><br>        <span class="hljs-type">int</span> start_line = <span class="hljs-number">0</span>; <span class="hljs-comment">/* è¡Œåœ¨bufferä¸­çš„èµ·å§‹ä½ç½® */</span><br><br>        <span class="hljs-comment">/* è®¾ç½®ä¸»çŠ¶æ€æœºçš„åˆå§‹çŠ¶æ€ */</span><br>        CHECK_STATE checkstate = CHECK_STATE_REQUESTLINE;<br><br>        <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123; <span class="hljs-comment">/* å¾ªç¯è¯»å–å®¢æˆ·æ•°æ®å¹¶åˆ†æä¹‹ */</span><br>            data_read = <span class="hljs-built_in">recv</span>(fd, buffer + read_index, BUFFER_SIZE - read_index, <span class="hljs-number">0</span>);<br>            <span class="hljs-keyword">if</span> (data_read == <span class="hljs-number">-1</span>) &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;reading failed\n&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (data_read == <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;remote client has closed the connection\n&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br><br>            read_index += data_read;<br><br>            <span class="hljs-comment">/* åˆ†æç›®å‰å·²ç»è·å¾—çš„æ‰€æœ‰å®¢æˆ·æ•°æ® */</span><br>            HTTP_CODE result = <span class="hljs-built_in">parse_content</span>(buffer, checked_index, checkstate, read_index, start_line);<br>            <span class="hljs-keyword">if</span> (result == NO_REQUEST) &#123; <span class="hljs-comment">/* å°šæœªå¾—åˆ°ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚ */</span><br>                <span class="hljs-keyword">continue</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (result == GET_REQUEST) &#123; <span class="hljs-comment">/* å¾—åˆ°ä¸€ä¸ªå®Œæ•´çš„ã€æ­£ç¡®çš„HTTPè¯·æ±‚ */</span><br>                <span class="hljs-built_in">send</span>(fd, szret[<span class="hljs-number">0</span>], <span class="hljs-built_in">strlen</span>(szret[<span class="hljs-number">0</span>]), <span class="hljs-number">0</span>);<br>                <span class="hljs-keyword">break</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">/* å…¶ä»–æƒ…å†µè¡¨ç¤ºå‘ç”Ÿé”™è¯¯ */</span><br>                <span class="hljs-built_in">send</span>(fd, szret[<span class="hljs-number">1</span>], <span class="hljs-built_in">strlen</span>(szret[<span class="hljs-number">1</span>]), <span class="hljs-number">0</span>);<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-built_in">close</span>(fd);<br>    &#125;<br>    <span class="hljs-built_in">close</span>(listenfd);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¹¦ä¸­è¯´è¿™é‡Œæœ‰ä¸¤ä¸ªçŠ¶æ€æœº, åˆ†ä¸ºä¸»çŠ¶æ€æœºå’Œä»çŠ¶æ€æœº, ä»çŠ¶æ€æœºç”¨äºè§£æå‡ºä¸€è¡Œçš„å†…å®¹, ä¸»çŠ¶æ€æœºç”¨äºæ ¹æ®å½“å‰çŠ¶æ€é€‰æ‹©ä¸åŒçš„å¤„ç†å‡½æ•°.</p><hr><h2 id="æé«˜æœåŠ¡å™¨æ€§èƒ½çš„å…¶ä»–å»ºè®®"><a href="#æé«˜æœåŠ¡å™¨æ€§èƒ½çš„å…¶ä»–å»ºè®®" class="headerlink" title="æé«˜æœåŠ¡å™¨æ€§èƒ½çš„å…¶ä»–å»ºè®®"></a>æé«˜æœåŠ¡å™¨æ€§èƒ½çš„å…¶ä»–å»ºè®®</h2><h3 id="æ± "><a href="#æ± " class="headerlink" title="æ± "></a>æ± </h3><p>ä»¥ç©ºé—´æ¢æ—¶é—´, å³â€œæµªè´¹â€æœåŠ¡å™¨çš„ç¡¬ä»¶èµ„æº, ä»¥æ¢å–å…¶è¿è¡Œæ•ˆç‡, è¿™å°±æ˜¯æ± ï¼ˆpoolï¼‰çš„æ¦‚å¿µã€‚</p><p>æ± æ˜¯ä¸€ç»„èµ„æºçš„é›†åˆï¼Œè¿™ç»„èµ„æºåœ¨æœåŠ¡å™¨å¯åŠ¨ä¹‹åˆå°±è¢«å®Œå…¨åˆ›å»ºå¥½å¹¶åˆå§‹åŒ–ï¼Œè¿™ç§°ä¸ºé™æ€èµ„æºåˆ†é…ã€‚å½“æœåŠ¡å™¨è¿›å…¥æ­£å¼è¿è¡Œé˜¶æ®µï¼Œå³å¼€å§‹å¤„ç†å®¢æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œå¦‚æœå®ƒéœ€è¦ç›¸å…³çš„èµ„æºï¼Œå°±å¯ä»¥ç›´æ¥ä»æ± ä¸­è·å–ï¼Œæ— é¡»åŠ¨æ€åˆ†é…ã€‚å¾ˆæ˜¾ç„¶ï¼Œç›´æ¥ä»æ± ä¸­å–å¾—æ‰€éœ€èµ„æºæ¯”åŠ¨æ€åˆ†é…èµ„æºçš„é€Ÿåº¦è¦å¿«å¾—å¤šï¼Œå› ä¸ºåˆ†é…ç³»ç»Ÿèµ„æºçš„ç³»ç»Ÿè°ƒç”¨éƒ½æ˜¯å¾ˆè€—æ—¶çš„ã€‚å½“æœåŠ¡å™¨å¤„ç†å®Œä¸€ä¸ªå®¢æˆ·è¿æ¥åï¼Œå¯ä»¥æŠŠç›¸å…³çš„èµ„æºæ”¾å›æ± ä¸­ï¼Œæ— é¡»æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ¥é‡Šæ”¾èµ„æºã€‚ä»æœ€ç»ˆçš„æ•ˆæœæ¥çœ‹ï¼Œæ± ç›¸å½“äºæœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿèµ„æºçš„åº”ç”¨å±‚è®¾æ–½ï¼Œå®ƒé¿å…äº†æœåŠ¡å™¨å¯¹å†…æ ¸çš„é¢‘ç¹è®¿é—®ã€‚</p><p>æ ¹æ®ä¸åŒçš„èµ„æºç±»å‹ï¼Œæ± å¯åˆ†ä¸ºå¤šç§ï¼Œå¸¸è§çš„æœ‰å†…å­˜æ± ã€è¿›ç¨‹æ± ã€çº¿ç¨‹æ± å’Œè¿æ¥æ± ã€‚</p><ul><li><p>å†…å­˜æ± é€šå¸¸ç”¨äºsocketçš„æ¥æ”¶ç¼“å­˜å’Œå‘é€ç¼“å­˜ã€‚å¯¹äºæŸäº›é•¿åº¦æœ‰é™çš„å®¢æˆ·è¯·æ±‚ï¼Œæ¯”å¦‚HTTPè¯·æ±‚ï¼Œé¢„å…ˆåˆ†é…ä¸€ä¸ªå¤§å°è¶³å¤Ÿï¼ˆæ¯”å¦‚5000å­—èŠ‚ï¼‰çš„æ¥æ”¶ç¼“å­˜åŒºæ˜¯å¾ˆåˆç†çš„ã€‚å½“å®¢æˆ·è¯·æ±‚çš„é•¿åº¦è¶…è¿‡æ¥æ”¶ç¼“å†²åŒºçš„å¤§å°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸¢å¼ƒè¯·æ±‚æˆ–è€…åŠ¨æ€æ‰©å¤§æ¥æ”¶ç¼“å†²åŒºã€‚</p></li><li><p>è¿›ç¨‹æ± å’Œçº¿ç¨‹æ± éƒ½æ˜¯å¹¶å‘ç¼–ç¨‹å¸¸ç”¨çš„â€œä¼ä¿©â€ã€‚å½“æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå·¥ä½œè¿›ç¨‹æˆ–å·¥ä½œçº¿ç¨‹æ¥å¤„ç†æ–°åˆ°æ¥çš„å®¢æˆ·è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä»è¿›ç¨‹æ± æˆ–çº¿ç¨‹æ± ä¸­å–å¾—ä¸€ä¸ªæ‰§è¡Œå®ä½“ï¼Œè€Œæ— é¡»åŠ¨æ€åœ°è°ƒç”¨forkæˆ–pthread_createç­‰å‡½æ•°æ¥åˆ›å»ºè¿›ç¨‹å’Œçº¿ç¨‹ã€‚</p></li><li><p>è¿æ¥æ± é€šå¸¸ç”¨äºæœåŠ¡å™¨æˆ–æœåŠ¡å™¨æœºç¾¤çš„å†…éƒ¨æ°¸ä¹…è¿æ¥ã€‚æ¯ä¸ªé€»è¾‘å•å…ƒå¯èƒ½éƒ½éœ€è¦é¢‘ç¹åœ°è®¿é—®æœ¬åœ°çš„æŸä¸ªæ•°æ®åº“ã€‚ç®€å•çš„åšæ³•æ˜¯ï¼šé€»è¾‘å•å…ƒæ¯æ¬¡éœ€è¦è®¿é—®æ•°æ®åº“çš„æ—¶å€™ï¼Œå°±å‘æ•°æ®åº“ç¨‹åºå‘èµ·è¿æ¥ï¼Œè€Œè®¿é—®å®Œæ¯•åé‡Šæ”¾è¿æ¥ã€‚å¾ˆæ˜¾ç„¶ï¼Œè¿™ç§åšæ³•çš„æ•ˆç‡å¤ªä½ã€‚ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨è¿æ¥æ± ã€‚è¿æ¥æ± æ˜¯æœåŠ¡å™¨é¢„å…ˆå’Œæ•°æ®åº“ç¨‹åºå»ºç«‹çš„ä¸€ç»„è¿æ¥çš„é›†åˆã€‚å½“æŸä¸ªé€»è¾‘å•å…ƒéœ€è¦è®¿é—®æ•°æ®åº“æ—¶ï¼Œå®ƒå¯ä»¥ç›´æ¥ä»è¿æ¥æ± ä¸­å–å¾—ä¸€ä¸ªè¿æ¥çš„å®ä½“å¹¶ä½¿ç”¨ä¹‹ã€‚å¾…å®Œæˆæ•°æ®åº“çš„è®¿é—®ä¹‹åï¼Œé€»è¾‘å•å…ƒå†å°†è¯¥è¿æ¥è¿”è¿˜ç»™è¿æ¥æ± ã€‚</p></li></ul><h3 id="æ•°æ®å¤åˆ¶"><a href="#æ•°æ®å¤åˆ¶" class="headerlink" title="æ•°æ®å¤åˆ¶"></a>æ•°æ®å¤åˆ¶</h3><p>åº”å½“é¿å…ä¸å¿…è¦çš„æ•°æ®å¤åˆ¶, è¿™å°±åœ¨è¦æ±‚æˆ‘ä»¬å–„ç”¨å†…æ ¸å¤„ç†å‡½æ•°, ä¾‹å¦‚sendfile, splice, teeç­‰, è¿™äº›å‡½æ•°éƒ½æ˜¯åœ¨å†…æ ¸ç©ºé—´ä¸­ç›´æ¥è¿›è¡Œ, é¿å…äº†å‘ç”¨æˆ·ç©ºé—´çš„æ‹·è´. å½“ç„¶å…±äº«å†…å­˜ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„æ‰‹æ®µ.</p><h3 id="ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œé”"><a href="#ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œé”" class="headerlink" title="ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œé”"></a>ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œé”</h3><p>æˆ‘ä»¬çŸ¥é“è¿›ç¨‹åˆ‡æ¢å’Œçº¿ç¨‹åˆ‡æ¢ä¹Ÿæ˜¯ä¼šå¯¼è‡´ç³»ç»Ÿå¼€é”€çš„, ä½¿å·¥ä½œçº¿ç¨‹çš„æ•°é‡ä¿æŒåœ¨ä¸€ä¸ªåˆç†çš„èŒƒå›´å†…ä¹Ÿæ˜¯ä¸€ä¸ªå¿…è¦çš„è¡Œä¸º. </p><p>å¦å¤–è¿˜æœ‰é”, é”ä¼šå¸¦æ¥å¤§é‡çš„ç³»ç»Ÿå¼€é”€, æ‰€ä»¥è¦å–„ç”¨è¯»å†™é”ç­‰é”æœºåˆ¶.</p>]]></content>
    
    
    
    <tags>
      
      <tag>Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è¢«è®¨åŒçš„å‹‡æ°” è¯»ä¹¦æ‘˜å½•(1)</title>
    <link href="/2025/02/15/%E8%A2%AB%E8%AE%A8%E5%8E%8C%E7%9A%84%E5%8B%87%E6%B0%94%20%E8%AF%BB%E4%B9%A6%E6%91%98%E5%BD%95(1)/"/>
    <url>/2025/02/15/%E8%A2%AB%E8%AE%A8%E5%8E%8C%E7%9A%84%E5%8B%87%E6%B0%94%20%E8%AF%BB%E4%B9%A6%E6%91%98%E5%BD%95(1)/</url>
    
    <content type="html"><![CDATA[<ul><li>å¦‚æœä¸€å‘³åœ°å…³æ³¨è¿‡å»çš„åŸå› , ä¼å›¾ä»…ä»…é åŸå› å»è§£é‡Šäº‹åŠ¡, é‚£å°±ä¼šé™·å…¥å†³å®šè®º.</li><li>äº‹å®ä¸Šæˆ‘ä»¬ä¼šä»ç»å†ä¸­å‘ç°ç¬¦åˆè‡ªå·±ç›®çš„çš„å› ç´ . å†³å®šæˆ‘ä»¬è‡ªèº«çš„ä¸æ˜¯è¿‡å»çš„ç»å†, è€Œæ˜¯æˆ‘ä»¬è‡ªå·±èµ‹äºˆç»å†çš„æ„ä¹‰.</li><li>ä½†å…³é”®æ˜¯ç»å†æœ¬èº«ä¸ä¼šå†³å®šä»€ä¹ˆ. æˆ‘ä»¬ç»™è¿‡å»çš„ç»å†â€èµ‹äºˆäº†ä»€ä¹ˆæ ·çš„æ„ä¹‰â€, è¿™ç›´æ¥å†³å®šäº†æˆ‘ä»¬çš„ç”Ÿæ´». äººç”Ÿä¸æ˜¯åˆ«äººèµ‹äºˆçš„, è€Œæ˜¯ç”±è‡ªå·±é€‰æ‹©çš„, æ˜¯è‡ªå·±é€‰æ‹©è‡ªå·±å¦‚ä½•ç”Ÿæ´».</li><li>å¦‚æœä¸èƒ½æ„Ÿåˆ°å¹¸ç¦çš„è¯, å°±ä¸å¯ä»¥ä¸€ç›´è¿™æ ·, ä¸å¯ä»¥æ­¢æ­¥ä¸å‰, å¿…é¡»ä¸æ–­å‘å‰è¿ˆè¿›.</li><li>ä¹‹æ‰€ä»¥æ— æ³•æ”¹å˜, æ˜¯å› ä¸ºè‡ªå·±ä¸‹äº†â€ä¸æ”¹å˜çš„å†³å¿ƒâ€. å³ä½¿æœ‰äº›äººæœ‰å„ç§ä¸æ»¡, ä½†å´æ‹¿ä¸å‡ºæ”¹å˜ç”Ÿæ´»æ–¹å¼çš„å‹‡æ°”, åè€Œæ‹’ç»å»æ”¹å˜, ç‰ºç‰²å½“ä¸‹æœ¬å¯ä»¥äº«å—çš„ä¹è¶£, ç»´æŒç—›è‹¦çš„ç°çŠ¶.</li><li>åº”è¯¥å»åšâ€“è¿™ä¸€ç®€å•çš„è¯¾é¢˜æ‘†åœ¨çœ¼å‰, ä½†å´ä¸æ–­æ‰¯å‡ºå„ç§ä¸èƒ½åšçš„ç†ç”±, ä½ éš¾é“ä¸è®¤ä¸ºè¿™æ˜¯ä¸€ç§å¾ˆç—›è‹¦çš„ç”Ÿæ´»æ–¹å¼å—?</li><li>å€ŸåŠ©æƒåŠ¿æ¥æŠ¬é«˜è‡ªå·±çš„äººç»ˆç©¶æ˜¯æ´»åœ¨ä»–äººçš„ä»·å€¼è§‚å’Œäººç”Ÿä¸­, è¿™æ˜¯å¿…é¡»é‡ç‚¹å¼ºè°ƒçš„åœ°æ–¹.</li><li>å¼±åŠ¿å…·æœ‰ç‰¹æƒ, æœ‰äº›äººä»¥è‡ªå·±çš„ä¸å¹¸ä½œä¸ºæ­¦å™¨æ¥æ”¯é…å¯¹æ–¹, å…¶å®å°±æ˜¯åœ¨å€ŸåŠ©ä¸å¹¸æ¥æ˜¾ç¤ºè‡ªå·±çš„ç‰¹åˆ«, æƒ³è¦ç”¨ä¸å¹¸è¿™ä¸€ç‚¹æ¥å‹ä½åˆ«äºº. è¿™ç§äººæ˜¯å¯æ‚²ä¸”ä»¤äººæ— è¯­çš„, å› ä¸ºä»–åœ¨â€ä½¿ç”¨â€ä¸å¹¸çš„åŒæ—¶, å°±ä¼šæ°¸è¿œéœ€è¦ä¸å¹¸, è¿›è€Œæ°¸è¿œæ— æ³•æŠ›å¼€ä¸å¹¸.</li><li>å¥å…¨çš„è‡ªå‘æ„Ÿä¸æ˜¯æ¥è‡ªä¸åˆ«äººçš„æ¯”è¾ƒ, è€Œæ˜¯æ¥è‡ªä¸â€ç†æƒ³çš„è‡ªå·±â€.</li><li>æˆ‘ä»¬åº”å½“ç§¯æçœ‹å¾…è‡ªå·±ä¸åˆ«äººçš„å·®å¼‚, ä½†æ˜¯, æˆ‘ä»¬è™½ç„¶ä¸åŒä½†æ˜¯å¹³ç­‰.</li><li>sé‚£å°±æ˜¯æ— è®ºè®¤ä¸ºè‡ªå·±å¤šä¹ˆæ­£ç¡®, ä¹Ÿä¸è¦ä»¥æ­¤ä¸ºç†ç”±å»è´£éš¾å¯¹æ–¹.</li><li>â€œæˆ‘æ˜¯æ­£ç¡®çš„â€è¿™ç§åšä¿¡æ„å‘³ç€åšæŒâ€å¯¹æ–¹æ˜¯é”™è¯¯çš„â€, æœ€ç»ˆä¼šæ¼”å˜ä¸ºæƒåŠ›ä¹‹äº‰.</li><li>è¿½æ±‚ä¼˜è¶Šæ€§ä¸æ˜¯é€šè¿‡ä¸ä»–äººçš„ç«äº‰æ¥å®Œæˆçš„.</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>é˜…è¯»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ è¯»ä¹¦ç¬”è®°(3)</title>
    <link href="/2025/02/13/%5BLinux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B%5D%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0(3)/"/>
    <url>/2025/02/13/%5BLinux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B%5D%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0(3)/</url>
    
    <content type="html"><![CDATA[<blockquote><p><strong>ç¬¬ä¸ƒç«  LinuxæœåŠ¡å™¨ç¨‹åºè§„èŒƒ</strong></p></blockquote><h2 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h2><h3 id="rsyslog"><a href="#rsyslog" class="headerlink" title="rsyslog"></a>rsyslog</h3><p>ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æ—¥å¿—ç®¡ç†å·¥å…·ï¼Œå®ƒæ˜¯ç°ä»£ Linux å’Œ Unix ç³»ç»Ÿä¸­é»˜è®¤çš„æ—¥å¿—å®ˆæŠ¤è¿›ç¨‹ä¹‹ä¸€.</p><p>å®ƒè´Ÿè´£æ”¶é›†ã€å­˜å‚¨å’Œè½¬å‘æ¥è‡ªæ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„æ—¥å¿—æ¶ˆæ¯.</p><h3 id="syslog"><a href="#syslog" class="headerlink" title="syslog"></a>syslog</h3><p>ä¸€ä¸ªç”¨äºå‘rsyslogç³»ç»Ÿå‘é€æ—¥å¿—è¿›è¡Œå­˜å‚¨çš„å‡½æ•°.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsyslog.hï¼</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">syslog</span><span class="hljs-params">(<span class="hljs-type">int</span> priority, <span class="hljs-type">const</span> <span class="hljs-type">char</span>*message,...)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><p>priorityç”¨æ¥æè¿°è¿™ä¸ªæ—¥å¿—æ¶ˆæ¯çš„ç±»åˆ«çº§åˆ«ç­‰ä¿¡æ¯.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// æ¶ˆæ¯ç±»åˆ«</span><br>LOG_USERï¼ˆå€¼ <span class="hljs-number">1</span>ï¼‰: ç”¨æˆ·åº”ç”¨ç¨‹åºæ¶ˆæ¯<br>LOG_DAEMONï¼ˆå€¼ <span class="hljs-number">3</span>ï¼‰: å®ˆæŠ¤è¿›ç¨‹æ¶ˆæ¯<br>LOG_SYSLOGï¼ˆå€¼ <span class="hljs-number">4</span>ï¼‰: ç³»ç»Ÿæ—¥å¿—ç›¸å…³æ¶ˆæ¯<br>LOG_LOCAL0 åˆ° LOG_LOCAL7ï¼ˆå€¼ <span class="hljs-number">16</span> åˆ° <span class="hljs-number">23</span>ï¼‰: ç”¨æˆ·å®šä¹‰çš„æœ¬åœ°ç±»åˆ«<br><span class="hljs-comment">// æ¶ˆæ¯çº§åˆ«</span><br>LOG_EMERGï¼ˆ<span class="hljs-number">0</span>ï¼‰ï¼šç´§æ€¥æƒ…å†µï¼Œç³»ç»Ÿæ— æ³•ä½¿ç”¨<br>LOG_ALERTï¼ˆ<span class="hljs-number">1</span>ï¼‰ï¼šéœ€è¦ç«‹å³é‡‡å–è¡ŒåŠ¨<br>LOG_CRITï¼ˆ<span class="hljs-number">2</span>ï¼‰ï¼šä¸´ç•Œæƒ…å†µ<br>LOG_ERRï¼ˆ<span class="hljs-number">3</span>ï¼‰ï¼šé”™è¯¯<br>LOG_WARNINGï¼ˆ<span class="hljs-number">4</span>ï¼‰ï¼šè­¦å‘Š<br>LOG_NOTICEï¼ˆ<span class="hljs-number">5</span>ï¼‰ï¼šæ™®é€šä½†éœ€è¦æ³¨æ„çš„æ¶ˆæ¯<br>LOG_INFOï¼ˆ<span class="hljs-number">6</span>ï¼‰ï¼šä¸€èˆ¬ä¿¡æ¯<br>LOG_DEBUGï¼ˆ<span class="hljs-number">7</span>ï¼‰ï¼šè°ƒè¯•ä¿¡æ¯<br></code></pre></td></tr></table></figure><p>è¿™äº›ä¿¡æ¯ç”¨â€|â€è¿ç®—ç¬¦è¿æ¥.</p><p>ç±»åˆ«å¯ä»¥ä¸å¡«, é»˜è®¤ä¸ºLOG_USER, ä¹Ÿå¯ä»¥åœ¨openlogä¸­è®¾ç½®.</p></li><li><p>åé¢ç”¨æ¥å¡«å†™è¦ä¿å­˜çš„æ—¥å¿—ä¿¡æ¯, æ˜¯ä¸€ä¸ªæ¨¡æ¿å’Œå¯å˜å‚æ•°, å¯ä»¥è¿™æ ·ä½¿ç”¨ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">syslog</span>(LOG_INFO, <span class="hljs-string">&quot;This is a simple log message.&quot;</span>);<br><span class="hljs-type">const</span> <span class="hljs-type">char</span> *username = <span class="hljs-string">&quot;Alice&quot;</span>;<br><span class="hljs-built_in">syslog</span>(LOG_INFO, <span class="hljs-string">&quot;User %s has logged in.&quot;</span>, username);<br></code></pre></td></tr></table></figure></li></ul><h3 id="openlog-closelog"><a href="#openlog-closelog" class="headerlink" title="openlog &#x2F; closelog"></a>openlog &#x2F; closelog</h3><p>å…¶å®å°±æ˜¯ä½¿ç”¨syslogè¦ç”¨åˆ°çš„æ„é€ å’Œææ„å‡½æ•°. </p><p>openlogä¸å†™ä½¿ç”¨syslogä¼šéšå¼è°ƒç”¨è¯¥å‡½æ•°, closelogå¿…é¡»æ˜¾å¼è°ƒç”¨.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsyslog.hï¼</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">openlog</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>*ident,<span class="hljs-type">int</span> logopt,<span class="hljs-type">int</span> facility)</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">closelog</span><span class="hljs-params">()</span></span>;<br></code></pre></td></tr></table></figure><p>identå‚æ•°æŒ‡å®šçš„å­—ç¬¦ä¸²å°†è¢«æ·»åŠ åˆ°æ—¥å¿—æ¶ˆæ¯çš„æ—¥æœŸå’Œæ—¶é—´ä¹‹åï¼Œå®ƒé€šå¸¸è¢«è®¾ç½®ä¸ºç¨‹åºçš„åå­—ã€‚logoptå‚æ•°å¯¹åç»­syslogè°ƒç”¨çš„è¡Œä¸ºè¿›è¡Œé…ç½®ï¼Œå®ƒå¯å–ä¸‹åˆ—å€¼çš„æŒ‰ä½æˆ–ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">define</span> LOG_PID 0x01<span class="hljs-comment">/*åœ¨æ—¥å¿—æ¶ˆæ¯ä¸­åŒ…å«ç¨‹åºPID*/</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> LOG_CONS 0x02<span class="hljs-comment">/*å¦‚æœæ¶ˆæ¯ä¸èƒ½è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ï¼Œåˆ™æ‰“å°è‡³ç»ˆç«¯*/</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> LOG_ODELAY 0x04<span class="hljs-comment">/*å»¶è¿Ÿæ‰“å¼€æ—¥å¿—åŠŸèƒ½ç›´åˆ°ç¬¬ä¸€æ¬¡è°ƒç”¨syslog*/</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> LOG_NDELAY 0x08<span class="hljs-comment">/*ä¸å»¶è¿Ÿæ‰“å¼€æ—¥å¿—åŠŸèƒ½*/</span></span><br></code></pre></td></tr></table></figure><p>facilityå‚æ•°å¯ç”¨æ¥ä¿®æ”¹syslogå‡½æ•°ä¸­çš„é»˜è®¤è®¾æ–½å€¼, å¯ä»¥æå‰è®¾ç½®æ—¥å¿—ç±»åˆ« : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">openlog</span>(<span class="hljs-string">&quot;MyApp&quot;</span>, LOG_PID | LOG_CONS, LOG_USER);<br><span class="hljs-built_in">syslog</span>(LOG_INFO, <span class="hljs-string">&quot;This is an info message.&quot;</span>);<br><span class="hljs-built_in">closelog</span>();<br></code></pre></td></tr></table></figure><hr><h2 id="ç”¨æˆ·ä¿¡æ¯"><a href="#ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="ç”¨æˆ·ä¿¡æ¯"></a>ç”¨æˆ·ä¿¡æ¯</h2><h3 id="uid-euid"><a href="#uid-euid" class="headerlink" title="uid &#x2F; euid"></a>uid &#x2F; euid</h3><ul><li><p><strong><code>uid</code></strong> æ˜¯è¿›ç¨‹çš„çœŸå®ç”¨æˆ· IDï¼Œæ ‡è¯†å¯åŠ¨è¿›ç¨‹çš„ç”¨æˆ·ã€‚</p></li><li><p><strong><code>euid</code></strong> æ˜¯è¿›ç¨‹çš„æœ‰æ•ˆç”¨æˆ· IDï¼Œå†³å®šè¿›ç¨‹çš„æƒé™çº§åˆ«ã€‚</p><p>euidå­˜åœ¨çš„ç›®çš„æ˜¯æ–¹ä¾¿èµ„æºè®¿é—®ï¼šå®ƒä½¿å¾—è¿è¡Œç¨‹åºçš„ç”¨æˆ·æ‹¥æœ‰è¯¥ç¨‹åºçš„æœ‰æ•ˆç”¨æˆ·çš„æƒé™ã€‚</p></li><li><p><strong><code>getuid</code></strong> å’Œ <strong><code>geteuid</code></strong> ç”¨äºè·å– <code>uid</code> å’Œ <code>euid</code>ï¼Œå¸¸ç”¨äºæƒé™æ£€æŸ¥ã€æƒé™åˆ‡æ¢å’Œè°ƒè¯•ã€‚</p></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œunistd.hï¼</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œstdio.hï¼</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-type">uid_t</span> uid=<span class="hljs-built_in">getuid</span>();<br><span class="hljs-type">uid_t</span> euid=<span class="hljs-built_in">geteuid</span>();<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;userid is%d,effective userid is:%d\n&quot;</span>,uid,euid);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½œç”¨ : æ ¹æ®å½“å‰ç”¨æˆ·çš„æƒé™æ‰§è¡Œä¸åŒçš„æ“ä½œ &#x2F; ç”¨äºè°ƒè¯•å’Œæ—¥å¿—è®°å½•.</p><h3 id="åˆ‡æ¢ç”¨æˆ·"><a href="#åˆ‡æ¢ç”¨æˆ·" class="headerlink" title="åˆ‡æ¢ç”¨æˆ·"></a>åˆ‡æ¢ç”¨æˆ·</h3><p>å°†ä»¥rootèº«ä»½å¯åŠ¨çš„è¿›ç¨‹åˆ‡æ¢ä¸ºä»¥ä¸€ä¸ªæ™®é€šç”¨æˆ·èº«ä»½è¿è¡Œ:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">bool</span> <span class="hljs-title">switch_to_user</span><span class="hljs-params">(<span class="hljs-type">uid_t</span> user_id,<span class="hljs-type">gid_t</span> gp_id)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-comment">/*å…ˆç¡®ä¿ç›®æ ‡ç”¨æˆ·ä¸æ˜¯root*/</span><br><span class="hljs-keyword">if</span>((user_id==<span class="hljs-number">0</span>)ï¼†ï¼†(gp_id==<span class="hljs-number">0</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <br><span class="hljs-comment">/*ç¡®ä¿å½“å‰ç”¨æˆ·æ˜¯åˆæ³•ç”¨æˆ·ï¼šrootæˆ–è€…ç›®æ ‡ç”¨æˆ·*/</span><br><span class="hljs-type">gid_t</span> gid=<span class="hljs-built_in">getgid</span>();<br><span class="hljs-type">uid_t</span> uid=<span class="hljs-built_in">getuid</span>();<br><span class="hljs-keyword">if</span>(((gid!=<span class="hljs-number">0</span>)||(uid!=<span class="hljs-number">0</span>))ï¼†ï¼†((gid!=gp_id)||(uid!=user_id))) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <br><span class="hljs-comment">/*å¦‚æœä¸æ˜¯rootï¼Œåˆ™å·²ç»æ˜¯ç›®æ ‡ç”¨æˆ·*/</span><br><span class="hljs-keyword">if</span>(uid!=<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    <br><span class="hljs-comment">/*åˆ‡æ¢åˆ°ç›®æ ‡ç”¨æˆ·*/</span><br><span class="hljs-keyword">if</span>((<span class="hljs-built_in">setgid</span>(gp_id)ï¼œ<span class="hljs-number">0</span>)||(<span class="hljs-built_in">setuid</span>(user_id)ï¼œ<span class="hljs-number">0</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="è¿›ç¨‹é—´å…³ç³»"><a href="#è¿›ç¨‹é—´å…³ç³»" class="headerlink" title="è¿›ç¨‹é—´å…³ç³»"></a>è¿›ç¨‹é—´å…³ç³»</h2><h3 id="è¿›ç¨‹ç»„"><a href="#è¿›ç¨‹ç»„" class="headerlink" title="è¿›ç¨‹ç»„"></a>è¿›ç¨‹ç»„</h3><p>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„pid, ä¹Ÿä¼šæœ‰è‡ªå·±çš„pgid, pgidæ˜¯è‡ªå·±æ‰€åœ¨çš„è¿›ç¨‹ç»„id.</p><p>æ¯ä¸ªè¿›ç¨‹ç»„éƒ½æœ‰ä¸€ä¸ªé¦–é¢†è¿›ç¨‹, é¦–é¢†è¿›ç¨‹çš„pidå°†ä¼šè¢«ç”¨ä½œè¿›ç¨‹ç»„çš„id, ä½œç”¨ä»…é™äºæ­¤.</p><p>ä¸€ä¸ªè¿›ç¨‹ç»„ä¸­çš„è¿›ç¨‹æœ‰å…±åŒä½œç”¨, å¦‚æœä¸€ä¸ªæ¥æ”¶äº†SIGINTä¿¡å·, å…¶ä»–å‡ ä¸ªä¹Ÿä¼šä¸€å¹¶é€€å‡º.</p><p>çˆ¶å­è¿›ç¨‹å°±é»˜è®¤å±äºåŒä¸€ä¸ªè¿›ç¨‹ç»„, ä½†ä¹Ÿå¯ä»¥é€šè¿‡setsidæ¥æ”¹å˜.</p><h3 id="ä¼šè¯"><a href="#ä¼šè¯" class="headerlink" title="ä¼šè¯"></a>ä¼šè¯</h3><p>ä¸€äº›æœ‰å…³è”çš„è¿›ç¨‹ç»„å°†å½¢æˆä¸€ä¸ªä¼šè¯ï¼ˆsessionï¼‰.</p><p>é€šè¿‡ä¼šè¯ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥æ›´é«˜æ•ˆåœ°ç®¡ç†è¿›ç¨‹ç»„å’Œç»ˆç«¯äº¤äº’ï¼Œå¹¶ä¸ºç”¨æˆ·æä¾›å¼ºå¤§çš„ä½œä¸šæ§åˆ¶åŠŸèƒ½ã€‚</p><h4 id="ä¼šè¯çš„ä½œç”¨"><a href="#ä¼šè¯çš„ä½œç”¨" class="headerlink" title="ä¼šè¯çš„ä½œç”¨"></a><strong>ä¼šè¯çš„ä½œç”¨</strong></h4><p>ï¼ˆ1ï¼‰<strong>ç»ˆç«¯ç®¡ç†</strong></p><ul><li>ä¼šè¯ä¸ç»ˆç«¯å…³è”ï¼Œå†³å®šäº†å“ªäº›è¿›ç¨‹ç»„å¯ä»¥è®¿é—®ç»ˆç«¯ã€‚</li><li>æ¯ä¸ªä¼šè¯æœ‰ä¸€ä¸ªå‰å°è¿›ç¨‹ç»„ï¼ˆForeground Process Groupï¼‰ï¼Œåªæœ‰å‰å°è¿›ç¨‹ç»„ä¸­çš„è¿›ç¨‹å¯ä»¥ä»ç»ˆç«¯è¯»å–è¾“å…¥ã€å‘ç»ˆç«¯è¾“å‡ºï¼Œå¹¶æ¥æ”¶ç»ˆç«¯çš„æ§åˆ¶ä¿¡å·ï¼ˆå¦‚ <code>Ctrl+C</code> å‘é€çš„ <code>SIGINT</code>ï¼‰ã€‚</li></ul><p>ï¼ˆ2ï¼‰<strong>ä½œä¸šæ§åˆ¶</strong></p><ul><li>ä¼šè¯æ”¯æŒä½œä¸šæ§åˆ¶ï¼ˆJob Controlï¼‰ï¼Œå…è®¸ç”¨æˆ·åœ¨å‰å°å’Œåå°ä¹‹é—´åˆ‡æ¢ä»»åŠ¡ã€‚</li><li>ä¾‹å¦‚ï¼ŒShell å¯ä»¥å°†ä¸€ä¸ªä½œä¸šï¼ˆå¦‚ç®¡é“å‘½ä»¤ï¼‰æ”¾åˆ°å‰å°æˆ–åå°è¿è¡Œã€‚</li></ul><p>ï¼ˆ3ï¼‰<strong>ä¿¡å·ç®¡ç†</strong></p><ul><li>ä¼šè¯å¯ä»¥ç»Ÿä¸€ç®¡ç†ä¿¡å·ã€‚</li><li>ä¾‹å¦‚ï¼Œå½“ç»ˆç«¯æ–­å¼€è¿æ¥æ—¶ï¼Œä¼šè¯é¦–è¿›ç¨‹ä¼šæ”¶åˆ° <code>SIGHUP</code> ä¿¡å·ï¼Œé€šå¸¸ä¼šå¯¼è‡´ä¼šè¯ä¸­çš„æ‰€æœ‰è¿›ç¨‹ç»ˆæ­¢ã€‚</li></ul><p>ï¼ˆ4ï¼‰<strong>èµ„æºç®¡ç†</strong></p><ul><li>ä¼šè¯å¯ä»¥ç»Ÿä¸€ç®¡ç†èµ„æºã€‚</li><li>ä¾‹å¦‚ï¼Œå½“ä¼šè¯é¦–è¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå‘ä¼šè¯ä¸­çš„æ‰€æœ‰è¿›ç¨‹å‘é€ <code>SIGHUP</code> ä¿¡å·ï¼Œç»ˆæ­¢æ•´ä¸ªä¼šè¯ã€‚</li></ul><h3 id="æ”¹å˜å·¥ä½œç›®å½•å’Œæ ¹ç›®å½•"><a href="#æ”¹å˜å·¥ä½œç›®å½•å’Œæ ¹ç›®å½•" class="headerlink" title="æ”¹å˜å·¥ä½œç›®å½•å’Œæ ¹ç›®å½•"></a>æ”¹å˜å·¥ä½œç›®å½•å’Œæ ¹ç›®å½•</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œunistd.hï¼</span><br><span class="hljs-function"><span class="hljs-type">char</span>*<span class="hljs-title">getcwd</span><span class="hljs-params">(<span class="hljs-type">char</span>*buf,<span class="hljs-type">size_t</span> size)</span></span>;  <span class="hljs-comment">// è·å–å½“å‰çš„å·¥ä½œç›®å½•</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">chdir</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>*path)</span></span>;<span class="hljs-comment">// æ”¹å˜å½“å‰å·¥ä½œç›®å½•</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">chroot</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>*path)</span></span>;<span class="hljs-comment">// æ”¹å˜æ ¹ç›®å½•</span><br></code></pre></td></tr></table></figure><h3 id="æœåŠ¡å™¨ç¨‹åºåå°åŒ–-å®ˆæŠ¤è¿›ç¨‹"><a href="#æœåŠ¡å™¨ç¨‹åºåå°åŒ–-å®ˆæŠ¤è¿›ç¨‹" class="headerlink" title="æœåŠ¡å™¨ç¨‹åºåå°åŒ–(å®ˆæŠ¤è¿›ç¨‹)"></a>æœåŠ¡å™¨ç¨‹åºåå°åŒ–(å®ˆæŠ¤è¿›ç¨‹)</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">daemonize</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">/*åˆ›å»ºå­è¿›ç¨‹ï¼Œå…³é—­çˆ¶è¿›ç¨‹ï¼Œè¿™æ ·å¯ä»¥ä½¿ç¨‹åºåœ¨åå°è¿è¡Œ*/</span><br>    <span class="hljs-type">pid_t</span> pid = fork();<br>    <span class="hljs-keyword">if</span> (pidï¼œ<span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pidï¼<span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-comment">/*è®¾ç½®æ–‡ä»¶æƒé™æ©ç ã€‚å½“è¿›ç¨‹åˆ›å»ºæ–°æ–‡ä»¶ï¼ˆä½¿ç”¨open(const char*pathname,int flags,mode_t mode)ç³»ç»Ÿè°ƒç”¨ï¼‰æ—¶ï¼Œæ–‡ä»¶çš„æƒé™å°†æ˜¯modeï¼†0777*/</span><br>    <span class="hljs-built_in">umask</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-comment">/*åˆ›å»ºæ–°çš„ä¼šè¯ï¼Œè®¾ç½®æœ¬è¿›ç¨‹ä¸ºè¿›ç¨‹ç»„çš„é¦–é¢†*/</span><br>    <span class="hljs-type">pid_t</span> sid = <span class="hljs-built_in">setsid</span>();<br>    <span class="hljs-keyword">if</span> (sidï¼œ<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br>    <span class="hljs-comment">/*åˆ‡æ¢å·¥ä½œç›®å½•*/</span><br>    <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">chdir</span>(<span class="hljs-string">&quot;/&quot;</span>))ï¼œ<span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/*å…³é—­æ ‡å‡†è¾“å…¥è®¾å¤‡ã€æ ‡å‡†è¾“å‡ºè®¾å¤‡å’Œæ ‡å‡†é”™è¯¯è¾“å‡ºè®¾å¤‡*/</span><br>    <span class="hljs-built_in">close</span>(STDIN_FILENO);<br>    <span class="hljs-built_in">close</span>(STDOUT_FILENO);<br>    <span class="hljs-built_in">close</span>(STDERR_FILENO);<br>    <span class="hljs-comment">/*å…³é—­å…¶ä»–å·²ç»æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»£ç çœç•¥*/</span><br>    <br>    <span class="hljs-comment">/*å°†æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯è¾“å‡ºéƒ½å®šå‘åˆ°/dev/nullæ–‡ä»¶*/</span><br>    <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;/dev/null&quot;</span>, O_RDONLY);<br>    <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;/dev/null&quot;</span>, O_RDWR);<br>    <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;/dev/null&quot;</span>, O_RDWR);<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨daemonå‡½æ•°, å°†è¯¥å‡½æ•°æ‰€åœ¨çš„è¿›ç¨‹å˜ä¸ºå®ˆæŠ¤è¿›ç¨‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œunistd.hï¼</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">daemon</span><span class="hljs-params">(<span class="hljs-type">int</span> nochdir,<span class="hljs-type">int</span> noclose)</span></span>;<br></code></pre></td></tr></table></figure><ul><li>nochdirç”¨äºæŒ‡å®šæ˜¯å¦æ”¹å˜å½“å‰ç›®å½•, 0åˆ™è®¾ç½®â€&#x2F;â€œä¸ºæ ¹ç›®å½•.</li><li>nocloseè®¾ç½®ä¸º0æ—¶, ä¸‰ä¸ªæ ‡å‡†éƒ½ä¼šè¢«é»˜è®¤é‡å®šå‘åˆ°&#x2F;dev&#x2F;nullæ–‡ä»¶.</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ è¯»ä¹¦ç¬”è®°(2)</title>
    <link href="/2025/02/13/%5BLinux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B%5D%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0(2)/"/>
    <url>/2025/02/13/%5BLinux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B%5D%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0(2)/</url>
    
    <content type="html"><![CDATA[<blockquote><p><strong>ç¬¬å…­ç«  é«˜çº§IOå‡½æ•°</strong></p></blockquote><h3 id="pipe"><a href="#pipe" class="headerlink" title="pipe"></a>pipe</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">pipe</span><span class="hljs-params">(<span class="hljs-type">int</span> fd[<span class="hljs-number">2</span>])</span></span>;<br></code></pre></td></tr></table></figure><ul><li><p>fd[0]å¯¹åº”è¯»ç«¯, fd[1]å¯¹åº”å†™ç«¯</p></li><li><p>é»˜è®¤é˜»å¡, å¯è®¾ç½®ä¸ºéé˜»å¡</p></li><li><p>åŒç«¯éƒ½å­˜åœ¨å¼•ç”¨è®¡æ•°åŠŸèƒ½, å†™ç«¯å¼•ç”¨è®¡æ•°ä¸º0è¯»ç«¯readè¿”å›0, è¯»ç«¯å¼•ç”¨è®¡æ•°ä¸º0å†™ç«¯writeä¼šå¤±è´¥å¹¶å‘å‡ºSIGPIPEä¿¡å·</p></li><li><p>å¤šç”¨äºçˆ¶å­è¿›ç¨‹é—´é€šä¿¡, ä¸€è¾¹å…³é—­è¯»ç«¯, ä¸€è¾¹å…³é—­å†™ç«¯.</p></li></ul><hr><h3 id="dup-dup2"><a href="#dup-dup2" class="headerlink" title="dup &#x2F; dup2"></a>dup &#x2F; dup2</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">dup</span><span class="hljs-params">(<span class="hljs-type">int</span> fd)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">dup2</span><span class="hljs-params">(<span class="hljs-type">int</span> oldfd, <span class="hljs-type">int</span> newfd)</span></span>;<br></code></pre></td></tr></table></figure><h4 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h4><ul><li>æ–‡ä»¶æè¿°ç¬¦ : ç”¨æ¥æ ‡å®šå·²æ‰“å¼€æ–‡ä»¶çš„æ•´æ•°, è¿›ç¨‹ä¸­é»˜è®¤æ‰“å¼€çš„ä¸‰ä¸ªæ“ä½œç¬¦æ˜¯stdio(0), stiout(1), stderro(2).</li><li>æ–‡ä»¶æè¿°ç¬¦ä»¥è¿›ç¨‹ä¸ºå•ä½, æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€å¥—ç‹¬ç«‹çš„æ–‡ä»¶æè¿°ç¬¦, ä»0å¼€å§‹, è¿›ç¨‹å¼€å§‹å°±ä¼šä½¿ç”¨0,1,2ä¸‰ä¸ªæ–‡ä»¶æè¿°ç¬¦, åˆ†åˆ«ä»£è¡¨è¾“å…¥&#x2F;è¾“å‡º&#x2F;æŠ¥é”™.</li><li>Linuxä¸‹ä¸€åˆ‡çš†æ–‡ä»¶, æˆ‘ä»¬å¾ˆå¤šçš„è¡Œä¸ºéƒ½å¯ä»¥è¢«è§£é‡Šä¸ºæ–‡ä»¶æ“ä½œ, æ¯”å¦‚fork, socket, åªè¦æœ‰æ–‡ä»¶æè¿°ç¬¦, æˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶å…¶è¯»å†™.</li><li>å¯ä»¥åˆ›å»ºæ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œ : open&#x2F;pipe&#x2F;socket&#x2F;accept&#x2F;forkç­‰.</li><li>æ¯æ¬¡åˆ›å»ºæ–‡ä»¶æè¿°ç¬¦æ—¶é€‰æ‹©çš„å€¼éƒ½æ˜¯<strong>ä»0å¼€å§‹å½“å‰è¿›ç¨‹ä¸­æœ€å°çš„æœªä½¿ç”¨å€¼</strong>.</li></ul><p>dup&#x2F;dup2çš„ä½œç”¨ä¸»è¦å°±æ˜¯<strong>é‡å®šå‘æ–‡ä»¶æè¿°ç¬¦çš„è¾“å…¥è¾“å‡º</strong>. </p><p>dupçš„ä¸»è¦æ“ä½œä¸º : å°†ä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦(å’Œåˆ›å»ºé€»è¾‘ä¸€è‡´)é‡å®šå‘åˆ°fd, è¿”å›è¿™ä¸ªæ–°æ–‡ä»¶æè¿°ç¬¦.</p><p>dup2å°±æ˜¯åœ¨dupçš„åŸºç¡€ä¸Š, å¯ä»¥æŒ‡å®šè¿™ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦, å¦‚æœè¿™ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦å·²è¢«å ç”¨, å°±å…ˆå…³é—­è¯¥æè¿°ç¬¦å†é‡å®šå‘.</p><p>å…¶å®åœ¨å®é™…ä½¿ç”¨ä¸­â€æ–°çš„æ–‡ä»¶æè¿°ç¬¦â€ä¸€èˆ¬éƒ½æ˜¯ä¸‰ç§æ ‡å‡†æ–‡ä»¶æè¿°ç¬¦, å³å°†æ ‡å‡†è¾“å…¥è¾“å…¥é‡å®šå‘åˆ°fd.</p><p>dupçš„ä½¿ç”¨æ¯”è¾ƒæ„è¯†æµ, æˆ‘ä»¬å…ˆçœ‹ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;netinet/in.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arpa/inet.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/stat.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> arg, <span class="hljs-type">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *ip = argv[<span class="hljs-number">1</span>];<br>    <span class="hljs-type">int</span> port = <span class="hljs-built_in">atoi</span>(argv[<span class="hljs-number">2</span>]);<br><br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in</span> server;<br>    <span class="hljs-built_in">bzero</span>(&amp;server, <span class="hljs-built_in">sizeof</span>(server));<br>    server.sin_family = AF_INET;<br>    server.sin_port = <span class="hljs-built_in">htons</span>(port);<br>    <span class="hljs-built_in">inet_pton</span>(AF_INET, ip, &amp;server.sin_addr);<br><br>    <span class="hljs-type">int</span> sock = <span class="hljs-built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);<br>    <span class="hljs-type">int</span> ret = <span class="hljs-built_in">bind</span>(sock, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;server, <span class="hljs-built_in">sizeof</span>(server));<br>    ret = <span class="hljs-built_in">listen</span>(sock, <span class="hljs-number">5</span>);<br><br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in</span> client;<br>    <span class="hljs-type">socklen_t</span> client_addrlength = <span class="hljs-built_in">sizeof</span>(client);<br><br>    <span class="hljs-type">int</span> connfd = <span class="hljs-built_in">accept</span>(sock, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;client, &amp;client_addrlength);<br>    <span class="hljs-keyword">if</span> (connfd &lt; <span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error: accept() failed.\n&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-built_in">close</span>(STDOUT_FILENO);<br>        <span class="hljs-built_in">dup</span>(connfd);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hello World\n&quot;</span>);<br>        <span class="hljs-built_in">close</span>(connfd);<br>    &#125;<br><br>    <span class="hljs-built_in">close</span>(sock);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªç®€æ˜“çš„TCPç½‘ç»œä»£ç , dupåœ¨è¿™é‡Œçš„ä½œç”¨æ˜¯æŠŠæ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°ç½‘ç»œå¥—æ¥å­—, è¿‡ç¨‹å¦‚ä¸‹ : </p><ul><li><code>close(STDOUT_FILENO);</code>å…³é—­æ ‡å‡†è¾“å…¥</li><li><code>dup(connfd);</code>é€‰å–ä»0å¼€å§‹å½“å‰è¿›ç¨‹ä¸­æœ€å°çš„æœªä½¿ç”¨å€¼, é‚£å°±æ˜¯åˆšåˆšå…³é—­çš„æ ‡å‡†è¾“å‡º(1), å› æ­¤æ ‡å‡†è¾“å‡ºè¢«é‡å®šå‘åˆ°äº†connfd.</li><li><code>printf(&quot;Hello World\n&quot;);</code>ä¸­çš„è¾“å‡ºå°†è¢«æ”¹ä¸ºè¾“å‡ºåˆ°connfdä¸­, å…¶å®å°±ç±»ä¼¼äºä½¿ç”¨äº†sendå°†â€Hello World\nâ€å‘é€äº†å‡ºå».</li></ul><p>åŠ å…¥æ¢ç”¨dup2, å¯ä»¥æŠŠclose+dupæ›¿æ¢ä¸ºå¦‚ä¸‹ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">dup2</span>(connfd, STDOUT_FILENO);<br></code></pre></td></tr></table></figure><p>dup2çš„ä½¿ç”¨ä¸€èˆ¬æ¯”dupè¦æ–¹ä¾¿ç›´è§‚ä¸å°‘, æ‰€ä»¥æ—¥å¸¸ä¸­åŸºæœ¬éƒ½æ˜¯ä½¿ç”¨dup2.</p><h4 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h4><ul><li>å°†æ ‡å‡†è¾“å…¥è¾“å‡ºä»é‡å®šå‘åˆ°æ‰“å¼€çš„æ–‡ä»¶.</li><li>å°†æ ‡å‡†è¾“å…¥è¾“å‡ºä»é‡å®šå‘åˆ°ç½‘ç»œå¥—æ¥å­—. </li><li>å°†æ ‡å‡†è¾“å…¥è¾“å‡ºä»é‡å®šå‘åˆ°ç®¡é“.</li><li>åˆ©ç”¨å­è¿›ç¨‹ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹æ–‡ä»¶æè¿°ç¬¦çš„ç‰¹æ€§, åœ¨forkå‰ä½¿ç”¨dup2å¯ä»¥ä½¿åç»­çš„å­è¿›ç¨‹é‡å®šå‘åˆ°ç›¸åŒçš„ä½ç½®è€Œæ— éœ€å¤šä½™æ“ä½œ, åœ¨forkåä½¿ç”¨dup2å¯ä»¥ä½¿çˆ¶å­è¿›ç¨‹è¾“å…¥è¾“å‡ºåˆ°ä¸åŒçš„æ–‡ä»¶, è¿™é‡Œçš„å¯æ“ä½œç©ºé—´å¾ˆå¤§. å¦‚æœä¸ä½¿ç”¨dup2å¯èƒ½è¿˜è¦åˆ›å»ºå¤šä½™çš„æ–‡ä»¶å¥æŸ„ç­‰.</li></ul><hr><h3 id="readv-writev"><a href="#readv-writev" class="headerlink" title="readv &#x2F; writev"></a>readv &#x2F; writev</h3><p>åé¢çš„væŒ‡ä»£vector, ä½œç”¨åœ¨äºè¾“å…¥è¾“å‡ºåˆ°å¤šä¸ªç¼“å†²åŒº(è¿™é‡Œçš„ç¼“å†²åŒºå¯ä»¥ç†è§£ä¸ºå†…å­˜).</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsys/uio.hï¼</span><br><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">readv</span><span class="hljs-params">(<span class="hljs-type">int</span> fd,<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> iovec*vector,<span class="hljs-type">int</span> count)</span>ï¼›</span><br><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">writev</span><span class="hljs-params">(<span class="hljs-type">int</span> fd,<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> iovec*vector,<span class="hljs-type">int</span> count)</span></span>;<br></code></pre></td></tr></table></figure><p>ç›¸æ¯”äºæ™®é€šçš„read : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">read</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">void</span> *buf, <span class="hljs-type">size_t</span> count)</span></span>;<br></code></pre></td></tr></table></figure><p>readåªèƒ½è¯»å…¥ä¸€ä¸ªç¼“å†²åŒºçš„å†…å®¹, countä»£è¡¨bufçš„size.</p><p>readvå¯ä»¥è¯»å…¥å¤šä¸ªç¼“å†²åŒºçš„å†…å®¹, å¤šä¸ªç¼“å†²åŒºéƒ½è¢«å­˜åœ¨struct iovecä¸­, countä»£è¡¨ç¼“å†²åŒºçš„ä¸ªæ•°.</p><p>writeå’ŒwritevåŒç†.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">char</span> header_buf[BUFFER_SIZE];<br>...<br><span class="hljs-type">char</span>*file_buf;<br>...<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">iovec</span> iv[<span class="hljs-number">2</span>];<br>iv[<span class="hljs-number">0</span>].iov_base = header_buf;            <span class="hljs-comment">// æŒ‡å‘ç¼“å†²åŒºçš„æŒ‡é’ˆ</span><br>iv[<span class="hljs-number">0</span>].iov_len = <span class="hljs-built_in">strlen</span>(header_buf);<span class="hljs-comment">// ç¼“å†²åŒºçš„size</span><br>iv[<span class="hljs-number">1</span>].iov_base = file_buf;<br>iv[<span class="hljs-number">1</span>].iov_len = file_stat.st_size;<br>ret = <span class="hljs-built_in">writev</span>(connfd,iv,<span class="hljs-number">2</span>);<br></code></pre></td></tr></table></figure><p>åœ¨å‘é€httpå›å¤æ—¶æˆ‘ä»¬å°±å¯ä»¥å°†æŠ¥å¤´éƒ¨åˆ†å’Œæ–‡ä»¶éƒ¨åˆ†å­˜å…¥ivä¸­, å°±å¯ä»¥å®ç°å°†å¤šä¸ªç¼“å†²åŒºä¸­çš„å†…å­˜å‘é€, è€Œä¸å¿…è¦å°†è¿™ä¸¤ä¸ªéƒ¨åˆ†åˆå¹¶å†ç”¨writeå‘é€, æˆ‘ä»¬å¯ä»¥å‘ç°è¿™å¯ä»¥é¿å…ä¸å¿…è¦çš„æ‹·è´å’Œå†…å­˜æ¶ˆè€—.</p><hr><h3 id="å†…å­˜çš„ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´"><a href="#å†…å­˜çš„ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´" class="headerlink" title="å†…å­˜çš„ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´"></a>å†…å­˜çš„ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´</h3><ul><li>ç”¨æˆ·ç©ºé—´ : ç”¨æˆ·ç¨‹åºè¿è¡Œçš„å†…å­˜åŒºåŸŸï¼ŒåŒ…å«åº”ç”¨ç¨‹åºçš„ä»£ç ã€æ•°æ®å’Œå †æ ˆã€‚ç”¨æˆ·ç¨‹åºåœ¨æ­¤ç©ºé—´è¿è¡Œï¼Œ<strong>æ— æ³•ç›´æ¥è®¿é—®ç¡¬ä»¶æˆ–å†…æ ¸èµ„æº</strong>ï¼Œå¿…é¡»é€šè¿‡ç³»ç»Ÿè°ƒç”¨è¯·æ±‚å†…æ ¸ååŠ©.</li><li>å†…æ ¸ç©ºé—´ : æ“ä½œç³»ç»Ÿå†…æ ¸è¿è¡Œçš„å†…å­˜åŒºåŸŸï¼Œè´Ÿè´£ç®¡ç†ç¡¬ä»¶ã€è¿›ç¨‹è°ƒåº¦ã€å†…å­˜åˆ†é…ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚åªæœ‰å†…æ ¸ä»£ç èƒ½ç›´æ¥è®¿é—®æ­¤åŒºåŸŸï¼Œå…·æœ‰<strong>æœ€é«˜æƒé™</strong>ï¼ˆå¦‚æ“ä½œç¡¬ä»¶ã€ä¿®æ”¹é¡µè¡¨).</li><li>ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„è½¬æ¢ : <ul><li>è¿™ä¸¤ç§çŠ¶æ€æ˜¯CPUçš„è¿è¡ŒçŠ¶æ€, ä¸€èˆ¬å¤„äºç”¨æˆ·æ€, å¯ä»¥é€šè¿‡ä¸€äº›æ–¹å¼è¿›å…¥å†…æ ¸æ€.</li><li>å†…æ ¸æ€æ‹¥æœ‰æœ€é«˜æƒé™.</li><li>å†…æ ¸æ€å¯ä»¥è®¿é—®æ‰€æœ‰å†…å­˜ç©ºé—´, åŒ…æ‹¬ç£ç›˜, ç½‘ç»œè®¾å¤‡ç­‰, ç”¨æˆ·æ€åªå¯è®¿é—®å†…å­˜ç©ºé—´. </li><li>è¿›å…¥å†…æ ¸æ€çš„æ–¹å¼ : ç³»ç»Ÿè°ƒç”¨(fork, open, readç­‰), ç¡¬ä»¶ä¸­æ–­, å¼‚å¸¸.</li></ul></li></ul><hr><h3 id="sendfile"><a href="#sendfile" class="headerlink" title="sendfile"></a>sendfile</h3><p>ä¸€ç§ä¸“ç”¨äºæ–‡ä»¶ç½‘ç»œä¼ è¾“çš„send.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsys/sendfile.hï¼</span><br><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">sendfile</span><span class="hljs-params">(<span class="hljs-type">int</span> out_fd, <span class="hljs-type">int</span> in_fd, <span class="hljs-type">off_t</span>*offset, <span class="hljs-type">size_t</span> count)</span></span>;<br></code></pre></td></tr></table></figure><ul><li>out_fd : è¦è¾“å‡ºåˆ°çš„socketfd, è¿™é‡Œå¿…é¡»æ˜¯socketçš„fd.</li><li>in_fd : è¦è¾“å…¥çš„æ–‡ä»¶fd, è¿™é‡Œå¿…é¡»æ˜¯çœŸæ­£æ–‡ä»¶çš„fd.</li><li>offset : è¦ä»in_fdåç§»é‡ä¸ºå¤šå°‘çš„ä½ç½®å¼€å§‹è¯», é»˜è®¤ä¸º0.</li><li>count : è¦è¯»å–çš„å¤§å°.</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">sendfile</span>(sockfd, filefd, <span class="hljs-literal">NULL</span>, stat_buf.st_size);<br></code></pre></td></tr></table></figure><p>è¯¥å‡½æ•°çš„ä¼˜åŠ¿åœ¨äºä¼ è¾“æ–‡ä»¶æ—¶ä¸éœ€è¦å°†å…¶ä»ç£ç›˜æ¬åˆ°ç”¨æˆ·ç©ºé—´å†å‘é€, è€Œæ˜¯ç›´æ¥åœ¨å†…æ ¸ç©ºé—´ä¸­å°±å°†ç£ç›˜ä¸­çš„æ•°æ®å‘é€åˆ°ç½‘ç»œå¥—æ¥å­—ä¸­, å®ç°äº†<strong>é›¶æ‹·è´</strong>.</p><hr><h3 id="mmap-munmap"><a href="#mmap-munmap" class="headerlink" title="mmap &#x2F; munmap"></a>mmap &#x2F; munmap</h3><p>ä¸€ä¸ªç”¨äºç”³è¯·ä¸€æ®µå†…å­˜ç©ºé—´å°†æ–‡ä»¶æ˜ å°„åˆ°è¯¥ç©ºé—´ä¸­çš„å‡½æ•°, è¿™ä¸ªç©ºé—´å¯ä»¥ä½œä¸ºè¿›ç¨‹é—´é€šä¿¡çš„è´¡çŒ®å†…å­˜. munmapç”¨äºé‡Šæ”¾è¯¥ç©ºé—´.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span>ï¼œsys/mman.hï¼</span><br><span class="hljs-function"><span class="hljs-type">void</span>*<span class="hljs-title">mmap</span><span class="hljs-params">(<span class="hljs-type">void</span>*start,<span class="hljs-type">size_t</span> length,<span class="hljs-type">int</span> prot,<span class="hljs-type">int</span> flags,<span class="hljs-type">int</span> fd,<span class="hljs-type">off_t</span> offset)</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">munmap</span><span class="hljs-params">(<span class="hljs-type">void</span>*start,<span class="hljs-type">size_t</span> length)</span></span>;<br></code></pre></td></tr></table></figure><ul><li>start : å…è®¸ç”¨æˆ·ä½¿ç”¨æŸä¸ªç‰¹å®šçš„åœ°å€ä½œä¸ºè¿™æ®µå†…å­˜çš„èµ·å§‹åœ°å€, è®¾ç½®ä¸ºNULLè‡ªåŠ¨é€‰æ‹©åœ°å€.</li><li>length : å†…å­˜æ®µçš„é•¿åº¦.</li><li>port : è®¾ç½®å†…å­˜æ®µçš„è®¿é—®æƒé™.</li><li>flags : æ§åˆ¶å†…å­˜æ®µå†…å®¹è¢«ä¿®æ”¹åç¨‹åºçš„è¡Œä¸º.</li><li>fd : è¢«æ˜ å°„æ–‡ä»¶å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦.</li><li>offset : è®¾ç½®ä»æ–‡ä»¶çš„ä½•å¤„å¼€å§‹æ˜ å°„.</li></ul><hr><h3 id="splice"><a href="#splice" class="headerlink" title="splice"></a>splice</h3><p>ç”¨äºä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¹‹é—´çš„æ•°æ®ç§»åŠ¨, æ‰€è°“ç§»åŠ¨å°±æ˜¯è¯´è¯»å–å®Œå°±æ²¡æœ‰äº†.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">splice</span><span class="hljs-params">(<span class="hljs-type">int</span> fd_in, <span class="hljs-type">off_t</span> *off_in, <span class="hljs-type">int</span> fd_out, <span class="hljs-type">off_t</span> *off_out, <span class="hljs-type">size_t</span> len, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flags)</span></span>;<br></code></pre></td></tr></table></figure><ul><li>fd_in : æ‰§è¡Œè¾“å…¥çš„æ–‡ä»¶æè¿°ç¬¦.</li><li>off_in : å¯¹åº”åç§»é‡çš„æŒ‡é’ˆ, ä¸€èˆ¬è®¾NULL.</li><li>fd_out : æ¥æ”¶è¾“å…¥çš„æ–‡ä»¶æè¿°ç¬¦.</li><li>off_out : åŒä¸Š.</li><li>len : è¾“å…¥æ•°æ®çš„é•¿åº¦.</li><li>flags : æ§åˆ¶æ•°æ®å¦‚ä½•ç§»åŠ¨.</li></ul><p>spliceå¯ä»¥åœ¨å†…æ ¸ç©ºé—´ä¸­å®ç°ä¸åŒæ–‡ä»¶æè¿°ç¬¦ä¹‹é—´çš„ä¿¡æ¯ä¼ è¾“, è€Œå’Œç®¡é“ç»“åˆå¯ä»¥å°†è¿™ç§ä¿¡æ¯ä¼ è¾“æ‰©å±•åˆ°è¿›ç¨‹é—´é€šä¿¡, è€Œä¸åªæ˜¯åœ¨ä¸€ä¸ªè¿›ç¨‹å†…ä¼ è¾“, ç”±æ­¤å¯ä»¥å®ç°<strong>é«˜æ•ˆçš„è¿›ç¨‹é—´é€šä¿¡</strong>.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/uio.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> BUFFER_SIZE 1024</span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">int</span> pipe_fds[<span class="hljs-number">2</span>]; <span class="hljs-comment">// ç®¡é“æ–‡ä»¶æè¿°ç¬¦</span><br>    <span class="hljs-type">pid_t</span> pid;<br>    <span class="hljs-type">char</span> *message = <span class="hljs-string">&quot;Hello from parent process to child process using splice!&quot;</span>;<br>    <span class="hljs-type">ssize_t</span> bytes_spliced;<br><br>    <span class="hljs-comment">// åˆ›å»ºç®¡é“</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">pipe</span>(pipe_fds) == <span class="hljs-number">-1</span>) &#123;<br>        <span class="hljs-built_in">perror</span>(<span class="hljs-string">&quot;pipe failed&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    pid = fork();<br>    <span class="hljs-keyword">if</span> (pid &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">perror</span>(<span class="hljs-string">&quot;fork failed&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (pid &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// çˆ¶è¿›ç¨‹ï¼šå°†æ•°æ®å†™å…¥ç®¡é“</span><br>        <span class="hljs-built_in">close</span>(pipe_fds[<span class="hljs-number">0</span>]); <span class="hljs-comment">// å…³é—­ç®¡é“çš„è¯»ç«¯</span><br><br>        <span class="hljs-comment">// å°†æ•°æ®å†™å…¥ç®¡é“</span><br>        bytes_spliced = <span class="hljs-built_in">splice</span>(STDOUT_FILENO, <span class="hljs-literal">NULL</span>, pipe_fds[<span class="hljs-number">1</span>], <span class="hljs-literal">NULL</span>, BUFFER_SIZE, <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">if</span> (bytes_spliced == <span class="hljs-number">-1</span>) &#123;<br>            <span class="hljs-built_in">perror</span>(<span class="hljs-string">&quot;splice to pipe failed&quot;</span>);<br>            <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>        &#125;<br><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Parent process wrote data to pipe: %zd bytes\n&quot;</span>, bytes_spliced);<br>        <span class="hljs-built_in">close</span>(pipe_fds[<span class="hljs-number">1</span>]); <span class="hljs-comment">// å…³é—­ç®¡é“çš„å†™ç«¯</span><br><br>        <span class="hljs-comment">// ç­‰å¾…å­è¿›ç¨‹ç»“æŸ</span><br>        <span class="hljs-built_in">wait</span>(<span class="hljs-literal">NULL</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// å­è¿›ç¨‹ï¼šä»ç®¡é“ä¸­è¯»å–æ•°æ®</span><br>        <span class="hljs-built_in">close</span>(pipe_fds[<span class="hljs-number">1</span>]); <span class="hljs-comment">// å…³é—­ç®¡é“çš„å†™ç«¯</span><br><br>        <span class="hljs-comment">// é€šè¿‡ç®¡é“è¯»å–æ•°æ®å¹¶å°†å…¶è¾“å‡º</span><br>        <span class="hljs-type">char</span> buf[BUFFER_SIZE];<br>        bytes_spliced = <span class="hljs-built_in">splice</span>(pipe_fds[<span class="hljs-number">0</span>], <span class="hljs-literal">NULL</span>, STDOUT_FILENO, <span class="hljs-literal">NULL</span>, BUFFER_SIZE, <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">if</span> (bytes_spliced == <span class="hljs-number">-1</span>) &#123;<br>            <span class="hljs-built_in">perror</span>(<span class="hljs-string">&quot;splice from pipe failed&quot;</span>);<br>            <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>        &#125;<br><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Child process received data from pipe: %zd bytes\n&quot;</span>, bytes_spliced);<br>        <span class="hljs-built_in">close</span>(pipe_fds[<span class="hljs-number">0</span>]); <span class="hljs-comment">// å…³é—­ç®¡é“çš„è¯»ç«¯</span><br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä¸­çˆ¶è¿›ç¨‹å‘å­è¿›ç¨‹å‘é€æ¶ˆæ¯, å­è¿›ç¨‹å¯ä»¥æ¥æ”¶åˆ°çˆ¶è¿›ç¨‹ä¸­çš„æ¶ˆæ¯, å¹¶ä¸”ç”±äºspliceä¸€åˆ‡éƒ½åœ¨å†…æ ¸ç©ºé—´ä¸­è¿›è¡Œ, éå¸¸é«˜æ•ˆ.</p><hr><h3 id="tee"><a href="#tee" class="headerlink" title="tee"></a>tee</h3><p>ç”¨äºä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¹‹é—´çš„æ•°æ®å¤åˆ¶, å’Œspliceç”¨æ³•ä¸€è‡´, ä½†æ˜¯æ•°æ®è¯»å–åä¼šç•™ä¸‹äº†, ä¸‹æ¬¡è¯»å–è¿˜åœ¨.</p><hr><h3 id="struct-stat"><a href="#struct-stat" class="headerlink" title="struct stat"></a>struct stat</h3><p>ç”¨äºç”¨äºæè¿°æ–‡ä»¶æˆ–æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡çš„ç»“æ„ä½“. ä½¿å¾—è¿›ç¨‹å¯ä»¥é€šè¿‡stat, fstat, lstatè·å¾—æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">stat</span> &#123;<br>    <span class="hljs-type">dev_t</span>     st_dev;         <span class="hljs-comment">/* æ–‡ä»¶æ‰€åœ¨è®¾å¤‡çš„ ID */</span><br>    <span class="hljs-type">ino_t</span>     st_ino;         <span class="hljs-comment">/* Inode å· */</span><br>    <span class="hljs-type">mode_t</span>    st_mode;        <span class="hljs-comment">/* æ–‡ä»¶ç±»å‹å’Œæƒé™ */</span><br>    <span class="hljs-type">nlink_t</span>   st_nlink;       <span class="hljs-comment">/* ç¡¬é“¾æ¥æ•° */</span><br>    <span class="hljs-type">uid_t</span>     st_uid;         <span class="hljs-comment">/* æ‰€æœ‰è€…çš„ç”¨æˆ· ID */</span><br>    <span class="hljs-type">gid_t</span>     st_gid;         <span class="hljs-comment">/* æ‰€æœ‰è€…çš„ç»„ ID */</span><br>    <span class="hljs-type">dev_t</span>     st_rdev;        <span class="hljs-comment">/* è®¾å¤‡ IDï¼ˆå¦‚æœæ˜¯è®¾å¤‡æ–‡ä»¶ï¼‰ */</span><br>    <span class="hljs-type">off_t</span>     st_size;        <span class="hljs-comment">/* æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰ */</span><br>    <span class="hljs-type">blksize_t</span> st_blksize;     <span class="hljs-comment">/* æ–‡ä»¶ç³»ç»Ÿ I/O çš„å—å¤§å° */</span><br>    <span class="hljs-type">blkcnt_t</span>  st_blocks;      <span class="hljs-comment">/* æ–‡ä»¶å ç”¨çš„å—æ•° */</span><br><br>    <span class="hljs-comment">/* æ—¶é—´æˆ³ */</span><br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">timespec</span> st_atim;  <span class="hljs-comment">/* æœ€åè®¿é—®æ—¶é—´ */</span><br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">timespec</span> st_mtim;  <span class="hljs-comment">/* æœ€åä¿®æ”¹æ—¶é—´ */</span><br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">timespec</span> st_ctim;  <span class="hljs-comment">/* æœ€åçŠ¶æ€å˜æ›´æ—¶é—´ */</span><br><br>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> st_atime st_atim.tv_sec  <span class="hljs-comment">/* å‘åå…¼å®¹ï¼šæœ€åè®¿é—®æ—¶é—´ï¼ˆç§’ï¼‰ */</span></span><br>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> st_mtime st_mtim.tv_sec  <span class="hljs-comment">/* å‘åå…¼å®¹ï¼šæœ€åä¿®æ”¹æ—¶é—´ï¼ˆç§’ï¼‰ */</span></span><br>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> st_ctime st_ctim.tv_sec  <span class="hljs-comment">/* å‘åå…¼å®¹ï¼šæœ€åçŠ¶æ€å˜æ›´æ—¶é—´ï¼ˆç§’ï¼‰ */</span></span><br>&#125;;<br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">stat</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *pathname, <span class="hljs-keyword">struct</span> stat *statbuf)</span></span>;   <span class="hljs-comment">// ç”¨è·¯å¾„å¯»æ‰¾æ–‡ä»¶ä¿¡æ¯,  statbuféƒ½æ˜¯è¾“å‡ºå‹å‚æ•°</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">fstat</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-keyword">struct</span> stat *statbuf)</span></span>;<span class="hljs-comment">// ç”¨æ–‡ä»¶fdå¯»æ‰¾æ–‡ä»¶ä¿¡æ¯</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ³• : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">stat</span> stat_buf;<br><span class="hljs-built_in">fstat</span>(filefd, &amp;stat_buf);  <br>...<br><span class="hljs-built_in">sendfile</span>(connfd,filefd,<span class="hljs-literal">NULL</span>,stat_buf.st_size);  <span class="hljs-comment">// è¿™é‡Œsendfileçš„å°±ä¼šç”¨åˆ°éœ€è¦ä¼ è¾“çš„æ–‡ä»¶å¤§å°</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ è¯»ä¹¦ç¬”è®°(1)</title>
    <link href="/2025/02/10/%5BLinux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B%5D%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0(1)/"/>
    <url>/2025/02/10/%5BLinux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B%5D%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0(1)/</url>
    
    <content type="html"><![CDATA[<blockquote><p><strong>ç¬¬äº”ç«   Linuxç½‘ç»œç¼–ç¨‹åŸºç¡€API</strong></p></blockquote><h2 id="å­—èŠ‚åº"><a href="#å­—èŠ‚åº" class="headerlink" title="å­—èŠ‚åº"></a>å­—èŠ‚åº</h2><h3 id="ä»€ä¹ˆæ˜¯å¤§å°ç«¯å­—èŠ‚åº"><a href="#ä»€ä¹ˆæ˜¯å¤§å°ç«¯å­—èŠ‚åº" class="headerlink" title="ä»€ä¹ˆæ˜¯å¤§å°ç«¯å­—èŠ‚åº?"></a>ä»€ä¹ˆæ˜¯å¤§å°ç«¯å­—èŠ‚åº?</h3><p>è¿™é‡Œä»¥32ä½æœºä¸¾ä¾‹, 32ä½æœºCPUä¸€æ¬¡å¯ä»¥è£…è½½4å­—èŠ‚,  é‚£ä¹ˆè¿™4ä¸ªå­—èŠ‚ä¸åŒçš„æ’åºæ–¹å¼å°±å¯¹åº”äº†ä¸åŒçš„å­—èŠ‚åº : </p><ul><li>å¤§ç«¯å­—èŠ‚åº : é¡ºç€æ’, 0x12345678 å°†è¢«æ’åºä¸º 12  34  56  78.</li><li>å°ç«¯å­—èŠ‚åº : é€†ç€æ’, 0x12345678 å°†è¢«æ’åºä¸º 78  56  34  12.</li></ul><h3 id="ä¸ºä»€ä¹ˆè¦åˆ†å¤§å°ç«¯"><a href="#ä¸ºä»€ä¹ˆè¦åˆ†å¤§å°ç«¯" class="headerlink" title="ä¸ºä»€ä¹ˆè¦åˆ†å¤§å°ç«¯?"></a>ä¸ºä»€ä¹ˆè¦åˆ†å¤§å°ç«¯?</h3><p>å…¶å®æ›´å¤šè¿˜æ˜¯å› ä¸º<strong>å†å²åŸå› </strong>,  æ—©æœŸéƒ½æ˜¯æŒ‰ç…§å¤§ç«¯å­—èŠ‚åºæ¥è®¾è®¡çš„, å› ä¸ºé¡ºç€æ’æ›´ç¬¦åˆäººç±»çš„é˜…è¯»ä¹ æƒ¯, æ—©æœŸç½‘ç»œåè®®è®¾è®¡éƒ½æ˜¯æŒ‰å¤§ç«¯è®¾è®¡çš„, å¹¶ä¸”ç½‘ç»œåè®®ä¸€æ—¦å®æ–½å°±ä¸å¥½æ”¹äº†, æ‰€ä»¥ç›´åˆ°ç°åœ¨ç½‘ç»œä¼ è¾“çš„å­—èŠ‚åºéƒ½æ˜¯å¤§ç«¯å­—èŠ‚åº, å› æ­¤å¤§ç«¯å­—èŠ‚åºåˆç§°ä¸ºç½‘ç»œå­—èŠ‚åº.</p><p>åæ¥äººä»¬å‘ç°å°ç«¯å­—èŠ‚åºæ›´ç¬¦åˆCPUçš„è¿ç®—é€»è¾‘, ä½¿ç”¨å°æ®µå­—èŠ‚åºç¼–ç å¯ä»¥è®©CPUè¿è¡Œæ›´åŠ é«˜æ•ˆ, å› æ­¤ä¹‹åçš„ä¸»æœºå¤§éƒ½é‡‡ç”¨å°ç«¯å­—èŠ‚åº, å› æ­¤å°æ®µå­—èŠ‚åºåˆç§°ä¸ºä¸»æœºå­—èŠ‚åº.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">int</span> <span class="hljs-title function_">htonl</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">int</span> hostlong)</span>; <span class="hljs-comment">// host to network long </span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šä¸ºlongç±»å‹ç«¯å£ä»ä¸»æœºå­—èŠ‚åºè½¬ä¸ºç½‘ç»œå­—èŠ‚åºçš„å‡½æ•°.</p><hr><h2 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h2><h3 id="shutdownå…³é—­socket"><a href="#shutdownå…³é—­socket" class="headerlink" title="shutdownå…³é—­socket"></a>shutdownå…³é—­socket</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">shutdown</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-type">int</span> howto)</span></span>;<br></code></pre></td></tr></table></figure><p>shoudownç±»ä¼¼äºè¿›é˜¶ç‰ˆçš„close, closeæ˜¯ç›´æ¥æ–­å¼€è¯»å†™, shoudownå¯ä»¥åˆ†åˆ«å…³é—­è¯»ç«¯å†™ç«¯.</p><p>howtoä¸ºé€‰é¡¹ : </p><ul><li>SHUT_RD : åªå…³é—­å†™ç«¯.</li><li>SHUT_WR : åªå…³é—­è¯»ç«¯.</li><li>SHUT_RDWR : åŒç«¯å…³é—­.</li></ul><p>åº”ç”¨åœºæ™¯ : åŠåŒå·¥å®ç°, å®¢æˆ·ç«¯æ”¶åˆ°EOFå¯ä»¥ç›´æ¥å…³é—­è¯»ç«¯, å†™ç«¯ä¸å…³é—­å¯ä»¥ç»§ç»­å¤„ç†æ²¡æœ‰å¤„ç†å®Œçš„äº‹åŠ¡.</p><p>å…¶å®å°±æ˜¯è¯»ç«¯å’Œå†™ç«¯éƒ½ä¼šå ç”¨èµ„æº, closeåªèƒ½åŒæ—¶é‡Šæ”¾, showdownå¯ä»¥æ ¹æ®å…·ä½“æƒ…å†µé€‰æ‹©åªè¯»ä¸å†™&#x2F;åªå†™ä¸è¯», æå‰é‡Šæ”¾éƒ¨åˆ†èµ„æº.</p><h3 id="socketé€‰é¡¹"><a href="#socketé€‰é¡¹" class="headerlink" title="socketé€‰é¡¹"></a>socketé€‰é¡¹</h3><ul><li><p>SO_REUSEADDR : å¼ºåˆ¶ä½¿ç”¨å¤„äºTIME_WAITçŠ¶æ€çš„è¿æ¥å ç”¨çš„socketåœ°å€.</p><ul><li>TIME_WAITä½œç”¨ : TCPè¿æ¥å‘é€çš„æ•°æ®å¯èƒ½æ»å, å¦‚æœå´©æºƒç«‹å³é‡å¯, å¯èƒ½æ¥æ”¶åˆ°æ—§æ•°æ®åŒ…é€ æˆæ··ä¹±.</li></ul><p>SO_REUSEADDRä½œç”¨ : </p><ol><li>å¯ä»¥é¿å…æœåŠ¡å™¨å´©æºƒåè¿›å…¥TIME_WAITçŠ¶æ€, é…åˆsystemdå¯ä»¥å®ç°å¿«é€Ÿé‡å¯æœåŠ¡.</li><li>æ”¯æŒå¤šä¸ªè¿›ç¨‹åŒæ—¶ç»‘å®šåŒä¸€ä¸ªç«¯å£(ä»…é™UDP), ç”¨äºè§†é¢‘å½±éŸ³ç­‰é«˜å¹¶å‘ç”¨å¤šä¸ªè¿›ç¨‹åŒæ—¶å¤„ç†å‘é€åˆ°åŒä¸€ä¸ªç«¯å£ä¸Šçš„ä¿¡æ¯.</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> reuse = <span class="hljs-number">1</span>;  <span class="hljs-comment">// è¡¨ç¤ºå¯ç”¨è®¾ç½®</span><br>setsockopt(sockfd, SOL_SOCKET, SO_REUSEADDR, &amp;reuse, <span class="hljs-keyword">sizeof</span>(reuse));<br></code></pre></td></tr></table></figure></li><li><p>SO_RCVBUF&#x2F;SO_SNDBUF : ç”¨äºä¿®æ”¹TCPå‘é€å’Œæ¥æ”¶ç¼“å†²åŒºçš„å¤§å°.</p><p>ç¼“å†²åŒºå¤§å°æœ€å°ä¸º256å­—èŠ‚, å¤§å°ä¼šæŒ‰è®¾ç½®çš„å¤§å°çš„ä¸¤å€è®¡ç®—.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> bufsize = <span class="hljs-number">2000</span>; <span class="hljs-comment">// æ ‡å®šæ–°çš„ç¼“å†²åŒºå¤§å°</span><br><span class="hljs-built_in">setsockopt</span>(sockfd, SOL_SOCKET, SO_RCV, &amp;bufsize, <span class="hljs-built_in">sizeof</span>(bufsize))<br></code></pre></td></tr></table></figure></li></ul><hr><h2 id="ç½‘ç»œä¿¡æ¯API"><a href="#ç½‘ç»œä¿¡æ¯API" class="headerlink" title="ç½‘ç»œä¿¡æ¯API"></a>ç½‘ç»œä¿¡æ¯API</h2><p>åœ¨ç°å®ç”Ÿæ´»ä¸­æˆ‘ä»¬ä¹ æƒ¯<strong>ç”¨åŸŸåä»£æ›¿IPåœ°å€, ç”¨æœåŠ¡åä»£æ›¿ç«¯å£å·</strong>, ä½¿ç”¨ç½‘ç»œä¿¡æ¯APIä¾¿å¯ä»¥<strong>å®ç°&lt;åŸŸå+æœåŠ¡å&gt;åˆ°&lt;IP+port&gt;çš„åŒå‘è½¬åŒ–</strong>, ä¾¿äºæˆ‘ä»¬socketç­‰æ“ä½œçš„è¿›è¡Œ. ä¸»è¦æ˜¯ä¸¤å¤§å‡½æ•°<code>getaddrinfo</code>å’Œ<code>getnameinfo</code>, è¿™ä¸¤ä¸ªå‡½æ•°<strong>çº¿ç¨‹å®‰å…¨å¹¶ä¸”æ”¯æŒå„ç§åœ°å€æ—å’Œåè®®ç±»å‹</strong>, å¯ä»¥ä½¿socketè¿›è¡ŒåŠ¨æ€è®¾ç½®ä»¥å®ç°<strong>åŠ¨æ€å®æ—¶å¤„ç†ä¸è·¨å¹³å°æ€§</strong>.</p><h3 id="getaddrinfo"><a href="#getaddrinfo" class="headerlink" title="getaddrinfo"></a>getaddrinfo</h3><p>è¿™ä¸ªå‡½æ•°å¯ä»¥é€šè¿‡ä¸»æœºåè·å¾—IPåœ°å€, é€šè¿‡æœåŠ¡åè·å¾—ç«¯å£å·.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;netdb.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getaddrinfo</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *node,                   <span class="hljs-comment">// ä¸»æœºå / å­—ç¬¦ä¸²å½¢å¼çš„IPåœ°å€</span></span></span><br><span class="hljs-params"><span class="hljs-function">                <span class="hljs-type">const</span> <span class="hljs-type">char</span> *service,<span class="hljs-comment">// æœåŠ¡å</span></span></span><br><span class="hljs-params"><span class="hljs-function">                <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> addrinfo *hints, <span class="hljs-comment">// ä¼ å…¥ä¸€äº›å¿…è¦çš„ä¿¡æ¯</span></span></span><br><span class="hljs-params"><span class="hljs-function">                <span class="hljs-keyword">struct</span> addrinfo **res<span class="hljs-comment">// å­˜å‚¨è¿”å›ç»“æœ, è¾“å‡ºå‹å‚æ•°</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">addrinfo</span> &#123;<br>    <span class="hljs-type">int</span>              ai_flags;        <span class="hljs-comment">// åœ°å€ä¿¡æ¯æ ‡å¿—</span><br>    <span class="hljs-type">int</span>              ai_family;       <span class="hljs-comment">// åœ°å€æ— (AF_INET, AF_INET6 ç­‰)</span><br>    <span class="hljs-type">int</span>              ai_socktype;     <span class="hljs-comment">// å¥—æ¥å­—ç±»å‹ (SOCK_STREAM, SOCK_DGRAM ç­‰)</span><br>    <span class="hljs-type">int</span>              ai_protocol;     <span class="hljs-comment">// åè®®ç±»å‹ (IPPROTO_TCP, IPPROTO_UDP ç­‰), é»˜è®¤ä¸º0å³å¯</span><br>    <span class="hljs-type">size_t</span>           ai_addrlen;      <span class="hljs-comment">// åœ°å€é•¿åº¦</span><br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr</span> *ai_addr;         <span class="hljs-comment">// æŒ‡å‘å¥—æ¥å­—åœ°å€çš„æŒ‡é’ˆ</span><br>    <span class="hljs-type">char</span>            *ai_canonname;    <span class="hljs-comment">// å®Œæ•´ä¸»æœºå</span><br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">addrinfo</span> *ai_next;         <span class="hljs-comment">// ä¸‹ä¸€ä¸ªåœ°å€ä¿¡æ¯é“¾è¡¨</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è·å–çš„ä¿¡æ¯ç›´æ¥å»ºç«‹socket : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">addrinfo</span> hints, *res;<br><span class="hljs-built_in">memset</span>(&amp;hints, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(hints));<br>hints.ai_family = AF_UNSPEC;   <span class="hljs-comment">// æ”¯æŒ IPv4 å’Œ IPv6</span><br>hints.ai_socktype = SOCK_STREAM; <span class="hljs-comment">// TCP</span><br><br><span class="hljs-comment">// è·å–ç›®æ ‡ä¸»æœºçš„åœ°å€ä¿¡æ¯</span><br><span class="hljs-type">int</span> status = <span class="hljs-built_in">getaddrinfo</span>(<span class="hljs-string">&quot;www.example.com&quot;</span>, <span class="hljs-string">&quot;http&quot;</span>, &amp;hints, &amp;res);<br><span class="hljs-keyword">if</span> (status != <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-comment">// é”™è¯¯å¤„ç†</span><br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-comment">// ä½¿ç”¨è¿”å›çš„åœ°å€ä¿¡æ¯åˆ›å»ºå¥—æ¥å­—å¹¶è¿›è¡Œè¿æ¥</span><br><span class="hljs-type">int</span> sockfd = <span class="hljs-built_in">socket</span>(res-&gt;ai_family, res-&gt;ai_socktype, res-&gt;ai_protocol);<br><span class="hljs-keyword">if</span> (sockfd == <span class="hljs-number">-1</span>) &#123;<br>    <span class="hljs-comment">// é”™è¯¯å¤„ç†</span><br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-built_in">freeaddrinfo</span>(res);<br><span class="hljs-built_in">freeaddrinfo</span>(hints);  <span class="hljs-comment">// addrinfoç±»å‹éœ€è¦é‡Šæ”¾å†…å­˜</span><br></code></pre></td></tr></table></figure><h3 id="getnameinfo"><a href="#getnameinfo" class="headerlink" title="getnameinfo"></a>getnameinfo</h3><p>é€šè¿‡socketåœ°å€è¿”å›ä¸»æœºå&#x2F;æœåŠ¡å, å’Œgetaddrinfoæ˜¯ç›¸åçš„ä½œç”¨.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">getnameinfo</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> sockaddr *sa, <span class="hljs-type">socklen_t</span> salen, <span class="hljs-comment">// ç›®æ ‡ç½‘ç»œåœ°å€ç»“æ„ä½“</span></span><br><span class="hljs-params">                <span class="hljs-type">char</span> *host, <span class="hljs-type">size_t</span> hostlen,<span class="hljs-comment">// è¿”å›çš„ä¸»æœºå, è¾“å‡ºå‹å‚æ•°</span></span><br><span class="hljs-params">                <span class="hljs-type">char</span> *serv, <span class="hljs-type">size_t</span> servlen,<span class="hljs-comment">// è¿”å›çš„æœåŠ¡å/ç«¯å£å·, è¾“å‡ºå‹å‚æ•°</span></span><br><span class="hljs-params">                <span class="hljs-type">int</span> flags<span class="hljs-comment">// ç¡®å®šå‡½æ•°è¡Œä¸º</span></span><br><span class="hljs-params">)</span>;<br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in</span> sa;<br>   <span class="hljs-type">char</span> host[NI_MAXHOST], service[NI_MAXSERV];<br>   <br>   <span class="hljs-comment">// æ„é€ ä¸€ä¸ªIPv4åœ°å€ï¼Œå‡è®¾æ˜¯127.0.0.1ï¼Œç«¯å£æ˜¯80</span><br>   sa.sin_family = AF_INET;<br>   sa.sin_port = <span class="hljs-built_in">htons</span>(<span class="hljs-number">80</span>);<br>   <span class="hljs-built_in">inet_pton</span>(AF_INET, <span class="hljs-string">&quot;127.0.0.1&quot;</span>, &amp;(sa.sin_addr));<br><br>   <span class="hljs-comment">// è·å–ä¸»æœºåå’ŒæœåŠ¡å</span><br>   <span class="hljs-type">int</span> result = <span class="hljs-built_in">getnameinfo</span>((<span class="hljs-keyword">struct</span> sockaddr*)&amp;sa, <span class="hljs-built_in">sizeof</span>(sa),<br>                            host, NI_MAXHOST, service, NI_MAXSERV, <span class="hljs-number">0</span>);<br>   <span class="hljs-keyword">if</span> (result == <span class="hljs-number">0</span>) &#123;<br>       <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Host: %s\n&quot;</span>, host);<br>       <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Service: %s\n&quot;</span>, service);<br>   &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>é«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç“¦å°”ç™»æ¹–è¯»ä¹¦æ‘˜å½•(4)</title>
    <link href="/2025/02/02/%E7%93%A6%E5%B0%94%E7%99%BB%E6%B9%96%E8%AF%BB%E4%B9%A6%E6%91%98%E5%BD%95(4)/"/>
    <url>/2025/02/02/%E7%93%A6%E5%B0%94%E7%99%BB%E6%B9%96%E8%AF%BB%E4%B9%A6%E6%91%98%E5%BD%95(4)/</url>
    
    <content type="html"><![CDATA[<ul><li><p>æˆ‘ä»¬å¯¹è§„å¾‹ä¸å’Œè°çš„äº†è§£, å¾€å¾€å±€é™äºé‚£äº›æˆ‘ä»¬å·²ç»æŒæ¡çš„äº‹ä¾‹; ä½†è®¸å¤šè²Œä¼¼å½¼æ­¤å†²çªçš„å› ç´ ä¹Ÿèƒ½å¯¼è‡´å’Œè°çš„ç»“æœ, ä½†è®¸å¤šè§„å¾‹æˆ‘ä»¬å›ºç„¶å°šæœªè®¤è¯†å¯æ˜¯ç¡®å®å­˜åœ¨ä¸”æ›´åŠ ç¥å¥‡ç¾å¦™.</p></li><li><p>å…¶å®å¹¸ç¦çš„äººåº”è¯¥æ°¸è¿œç”Ÿæ´»åœ¨æ­¤åˆ», å¥½å¥½åˆ©ç”¨æ¯ä»¶è½åˆ°æˆ‘ä»¬èº«ä¸Šçš„çäº‹, å°±åƒé’è‰å¦ç„¶æ¥å—æ¯é¢—è½åœ¨å®ƒèº«ä¸Šçš„æœ€ç»†å°çš„éœ²ç é‚£æ ·, åˆ«æŠŠæ—¶é—´ç”¨äºæŒ½å›ä»å‰å¤±å»çš„æœºä¼š, å¹¶ç¾åå…¶æ›°æ‰¿æ‹…è´£ä»».</p></li><li><p>è‹¥æ˜¯èƒ½åœ¨å®é™è€Œæœ‰ç›Šçš„æ¸…æ™¨ä¹‹æ°”ä¸­, å›æƒ³æ¯æ—¥æ‰€åšå–„äº‹, åŸ¹å…»å¯¹ç¾å¾·çš„çƒ­çˆ±å’Œå¯¹é‚ªæ¶çš„æ†æ¨, é‚£ä¹ˆäººå¿ƒé‡ŒåŸå§‹çš„å…½æ€§, å°±ä¼šåƒæ£®æ—é‡Œè¢«ç æ‰çš„æ–°èŠ½é‚£æ ·, ä¸ä¼šèŒå£®æˆé•¿.</p></li><li><p>åœ¨æ¸´æœ›æ¢ç´¢å’Œäº†è§£ä¸‡ç‰©çš„åŒæ—¶, æˆ‘ä»¬è¦ç‰¢è®°ä¸‡ç‰©å‡æ˜¯ç¥ç§˜å’Œæœªç»æ¢ç´¢çš„.</p></li><li><p>æˆ‘ä»¬éœ€è¦çœ‹è§æˆ‘ä»¬çªç ´è‡ªå·±çš„å±€é™, åœ¨æˆ‘ä»¬ä»æœªæ¶‰è¶³çš„åŸé‡è‡ªç”±è‡ªåœ¨çš„ç”Ÿæ´».</p></li><li><p>ç„¶è€Œæˆ‘ä»¬æ€»æ˜¯ä»¥ä¸º, è‹¥æ˜¯å°†æˆ‘ä»¬å†œåœºçš„ç¯±ç¬†æ‹†æ‰, å’ä¸ŠçŸ³å¢™, æˆ‘ä»¬çš„ç”Ÿæ´»ä¾¿è‡ªæ­¤æœ‰äº†è¾¹ç•Œ, æˆ‘ä»¬çš„å‘½è¿ä¹Ÿå·²ç»æ³¨å®š.</p></li><li><p>æ¯ä¸ªäººéƒ½æ˜¯å…¶å¿ƒçµé¢†åœ°çš„ä¸»äºº, ç„¶è€Œæœ‰äº›äººæ˜æ˜æ¯«ä¸å°Šé‡è‡ªå·±, å´è¡¨ç°å¾—å¾ˆçˆ±å›½, æ¡èµ·èŠéº»ä¸¢äº†è¥¿ç“œ. ä»–ä»¬çƒ­çˆ±å¯ä»¥ä¾›ä»–ä»¬é€ åŸçš„åœŸåœ°, å´å¯¹é‚£ä½¿ä»–ä»¬çš„æ³¥èº«å……æ»¡ç”Ÿæ°”çš„çµé­‚æ¯«ä¸å…³å¿ƒ. çˆ±å›½ä¸»ä¹‰æ˜¯ä»–ä»¬è„‘é‡Œçš„è›†è™«.</p></li><li><p>ä½†äººç”Ÿçš„ç›®æ ‡å¹¶éè®©è‡ªå·±æŒæœ‰è¿™ç§æ•Œè§†ç¤¾ä¼šçš„æ€åº¦, è€Œæ˜¯å§‹ç»ˆèƒ½å¤Ÿåšä»–è‡ªå·±, éµä»è‡ªå·±çš„åŸåˆ™, æ— è®ºè¿™ç§éµä»ä¼šè®©ä»–å¯¹ç¤¾ä¼šäº§ç”Ÿä»€ä¹ˆæ ·çš„æ€åº¦, å¦‚æœæœ‰å¹¸é‡åˆ°ä¸€ä¸ªæ­£ä¹‰çš„æ”¿åºœ, ä»–æ˜¯ä¸ä¼šäº§ç”Ÿæ•Œæ„çš„æ€åº¦çš„.</p></li><li><p><strong>æˆ‘ä»¬å¾ˆå®¹æ˜“ä¸çŸ¥ä¸è§‰å°±ä¹ æƒ¯æŸæ¡å›ºå®šçš„è·¯çº¿, ä¸ºæˆ‘ä»¬è‡ªå·±è¸å‡ºä¸€æ¡è·¯æ¥.</strong></p></li><li><p>å¤§åœ°çš„è¡¨é¢æ˜¯æŸ”è½¯çš„, äººç±»çš„è„šèƒ½å¤Ÿè¸©å¾—å®ƒé™·è¿›å», ç²¾ç¥çš„é“è·¯ä¹Ÿæ˜¯å¦‚æ­¤. æ‰€ä»¥ä¸–ä¸Šçš„é“è·¯ä¸€å®šæ˜¯éå¸¸ç ´çƒ‚å’Œå°˜åœŸé£æ‰¬çš„, ä¼ ç»Ÿå’Œä¹ ä¿—çš„è½¦è¾™ä¹Ÿè‚¯å®šæ˜¯å¾ˆæ·±çš„!</p></li><li><p>å¦‚æœäººè‡ªä¿¡åœ°æœç€æ¢¦æƒ³çš„æ–¹å‘å‰è¿›, åŠªåŠ›å»è¿‡ä¸Šä»–äº‹å…ˆè®¾æƒ³çš„ç”Ÿæ´», ä»–å°†ä¼šå–å¾—æ™®é€šäººæƒ³è±¡ä¸åˆ°çš„æˆåŠŸ. ä»–ä¼šæŠŠæŸäº›ä¸œè¥¿ç”©åœ¨èº«å, å°†ä¼šè·¨è¶Šæ— å½¢çš„ç•Œçº¿; ä»–çš„å‘¨å›´å’Œå†…å¿ƒå°†ä¼šå¾—åˆ°æ–°çš„è§£é‡Š, èµ‹äºˆä»–æ›´å¤§çš„è‡ªç”±, ä»–å°†ä¼šè¿‡ä¸Šä¸€ç§æ›´ä¸ºé«˜å°šçš„ç”Ÿæ´».</p></li><li><p>å¦‚æœä½ åœ¨ç©ºä¸­ä¿®å»ºäº†å‡ åº§æ¥¼é˜, ä½ çš„å¿ƒè¡€æœªå¿…ä¼šç™½è´¹, é‚£å°±æ˜¯å®ƒä»¬åº”è¯¥åœ¨çš„åœ°æ–¹, ç°åœ¨è¯·æŠŠåŸºç¡€æ‘†åˆ°å®ƒä»¬ä¸‹é¢å».</p></li><li><p>å¥½åƒåªæœ‰æ„šè ¢æ˜¯æœ€å®‰å…¨çš„, æˆ‘å´ç‹¬æƒ³é€¾è§„è¶ŠçŸ©!</p></li><li><p>**è‡³äºæœªæ¥æˆ–è€…å‰æ™¯, æˆ‘ä»¬åº”è¯¥æŠ±ç€å¼€æ”¾çš„æ€åº¦, é¡ºå…¶è‡ªç„¶, åˆ«æ˜ç¡®çš„é™å®šæˆ‘ä»¬å°†æ¥åº”è¯¥æ˜¯ä»€ä¹ˆæ¨¡æ ·.**è‡³äºè¿‡å»æˆ–è€…ä»å‰, åº”è¯¥å°†å…¶æŠ›åœ¨èº«å.</p></li><li><p>äººä»¬çƒ­çˆ±çš„çº¯æ´å°±åƒç¬¼ç½©å¤§åœ°çš„è¿·é›¾, è€Œä¸åƒè¶…ä¹é‚£è¿·é›¾ä¹‹ä¸Šçš„è“å¤©.</p></li><li><p>å¦‚æœé€‚åˆæˆ‘ä»¬çš„ç¯å¢ƒå°šæœªå‡ºç°, æˆ‘ä»¬åˆèƒ½ç”¨ä»€ä¹ˆæ¥å–ä»£å®ƒå‘¢? æˆ‘ä»¬å¯åˆ«åœ¨è™šé€ çš„ç¯å¢ƒé‡Œç¿»äº†èˆ¹.</p></li><li><p>ä¸å…¶ç”¨èŠ±è¨€å·§è¯­å»ç¾åŒ–äº‹ç‰©, å€’ä¸å¦‚è¯´å‡ºäº‹ç‰©çš„çœŸç›¸. å¯¹å¤§å¤šæ•°äººæ¥è¯´, æˆ‘ä»¬å¹¶æ²¡æœ‰å¤„äºæ­£ç¡®çš„åœ°æ–¹, è€Œæ˜¯å‡ºç°åœ¨é”™è¯¯çš„ä½ç½®. ç”±äºå¤©æ€§çš„ç¼ºç‚¹, æˆ‘ä»¬è™šæ„äº†ä¸€ç§æƒ…å†µ, æŠŠè‡ªå·±æ”¾è¿›é‚£æƒ…å†µé‡Œ, äºæ˜¯åŒæ—¶å­˜åœ¨ç€ä¸¤ç§æƒ…å†µ, æƒ³è¦èµ°å‡ºæ¥å°±åŠ å€åœ°éš¾.</p></li><li><p>å¤§å¤šæ•°äººä»¥ä¸ºä»–ä»¬ä¸è¦é é•‡ä¸Šçš„æ¥æµ, ä½†ä»–ä»¬å¾€å¾€æ˜¯é è™šä¼ªç‹¡è¯ˆçš„æ‰‹æ®µæ¥ç”Ÿæ´», è¿™æ˜¯æ›´åº”è¯¥é­åˆ°é„™è§†çš„.</p></li><li><p>å»æ‰¾æ—§ä¸œè¥¿å§, å›å»æ‰¾å®ƒä»¬, äº‹ç‰©ä¸ä¼šæ”¹å˜, å˜çš„æ˜¯æˆ‘ä»¬.</p></li><li><p>åˆ«å¦‚æ­¤è¿«åˆ‡åœ°è°‹æ±‚å‘å±•, åˆ«è®©è‡ªå·±å—åˆ°è®¸å¤šå¤–ç•Œå› ç´ æ‘†å¸ƒ, é‚£æœ¬æ¥æ˜¯ä¾›ä½ ç©å¼„çš„; é‚£å®Œå…¨æ˜¯åœ¨æµªæ·å…‰é˜´.</p></li><li><p>æˆ‘å–œæ¬¢å»æ‚é‡, å»æ‘¸ç´¢, å»æ¥è¿‘é‚£äº›è®©æˆ‘äº§ç”Ÿæœ€å¼ºçƒˆæœ€æ­£ç¡®å…´è¶£çš„ä¸œè¥¿.</p></li><li><p>æˆ‘åªä¼šè¸ä¸Šæˆ‘æœ‰èƒ½åŠ›å»èµ°çš„é“è·¯, åœ¨é‚£æ¡é“è·¯ä¸Š, æ²¡æœ‰ä»»ä½•åŠ›é‡å¯ä»¥é˜»æ­¢æˆ‘å‰è¡Œ. å°šæœªæ‰“å¥½åœ°åŸºå°±å»ä¿®å»ºæ‹±é—¨è¿™ç§äº‹æƒ…, å¹¶ä¸èƒ½ç»™æˆ‘å¸¦æ¥æ»¡è¶³æ„Ÿ. ç¤¾ä¼šçš„æ²¼æ³½å’Œæµæ²™ä¹Ÿæ˜¯å¦‚æ­¤, å¯æ˜¯å¹´çºªå¾ˆå¤§çš„å­©å­æ‰èƒ½æ˜ç™½è¿™ä¸ªé“ç†.</p></li><li><p>æˆ‘ä»¬ä¸ºä½•è¦é•¿ä¹…åœ°ååœ¨èµ°å»Šé‡Œ, ç©ºè°ˆç€é‚£äº›æ— èŠè€Œé™ˆè…çš„é“å¾·è§‚, è€Œä¸å»ä»äº‹å®é™…è€Œæœ‰ç”¨çš„å·¥ä½œ?</p></li><li><p>å¤§å¤šæ•°äººæ—¢ä¸æ›¾æ·±å…¥å¾—åˆ°ä½ä¸‹å…­è‹±å°ºä¹‹å¤„, ä¹Ÿä¸æ›¾è·³å¾—å¤šé«˜, æˆ‘ä»¬ä¸çŸ¥é“æˆ‘ä»¬èº«åœ¨ä½•å¤„. æ­¤å¤–, æˆ‘ä»¬æœ‰å¤§åŠæ—¶é—´æ˜¯æ˜ç¡ç€çš„, ç„¶è€Œæˆ‘ä»¬å´è‡ªä»¥ä¸ºå¾ˆèªæ˜, åœ¨è¡¨é¢ä¸Šå»ºç«‹èµ·ç§©åº.</p></li><li><p>å½“ä»Šä¸–ä¸Šæ–°å¥‡çš„ä¸œè¥¿å±‚å‡ºä¸ç©·, å¯æ˜¯æˆ‘ä»¬ä¾ç„¶å¿å—ç€éš¾ä»¥ç½®ä¿¡çš„æ„šé’.</p></li><li><p>æˆ‘ä»¬å†…å¿ƒçš„ç”Ÿæ´»å°±åƒæ²³æ°´, ä¹Ÿè®¸å®ƒä»Šå¹´ä¼šæ¶¨å¾—å‰æ‰€æœªæœ‰çš„é«˜, æ¼«ä¸Šå¹²ç‡¥çš„å¡åœ°; ç”šè‡³å¯èƒ½é€ æˆç¾å®³, æ·¹æ­»æˆ‘ä»¬æ‰€æœ‰çš„éºé¼ .</p></li><li><p>æ—©æ™¨åªæ˜¯æ—¶é—´çš„æµé€, è€Œä¸æ˜¯çœŸæ­£çš„ç ´æ™“. å¯¼è‡´æˆ‘ä»¬é—­ä¸ŠåŒçœ¼çš„é˜³å…‰, å¯¹æˆ‘ä»¬æ¥è¯´å°±æ˜¯é»‘æš—, åªæœ‰åœ¨æˆ‘ä»¬é†’ç€æ—¶, å¤©æ‰æ˜¯çœŸæ­£çš„ç ´æ™“. æ—¥å‡ºæœªå¿…æ„å‘³ç€å…‰æ˜, å¤ªé˜³ä¹Ÿæ— éæ˜¯ä¸€é¢—æ™¨æ˜Ÿè€Œå·².</p></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
      <tag>é˜…è¯»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾53-55 æ‚é¡¹è®¨è®º</title>
    <link href="/2025/01/31/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE53-55%20%E6%9D%82%E9%A1%B9%E8%AE%A8%E8%AE%BA/"/>
    <url>/2025/01/31/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE53-55%20%E6%9D%82%E9%A1%B9%E8%AE%A8%E8%AE%BA/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å­¦åˆ°è¿™é‡Œ, Effective C++è‡³æ­¤ä¹Ÿç®—æ˜¯å‘Šä¸€æ®µè½äº†, è¿˜å‰©ä¸‹ä¸€äº›æ‚ä¸ƒæ‚å…«çš„è®¨è®º, æˆ‘ä»¬å°†åœ¨æœ¬æ–‡é€ä¸€åˆ—ä¸¾.</p></blockquote><h2 id="æ¡æ¬¾53-ä¸è¦å¿½è§†ç¼–è¯‘å™¨çš„è­¦å‘Š"><a href="#æ¡æ¬¾53-ä¸è¦å¿½è§†ç¼–è¯‘å™¨çš„è­¦å‘Š" class="headerlink" title="æ¡æ¬¾53 : ä¸è¦å¿½è§†ç¼–è¯‘å™¨çš„è­¦å‘Š"></a>æ¡æ¬¾53 : ä¸è¦å¿½è§†ç¼–è¯‘å™¨çš„è­¦å‘Š</h2><ul><li>æˆ‘ä»¬åº”ä¸¥è‚ƒå¯¹å¾…ç¼–è¯‘å™¨å‘å‡ºçš„è­¦å‘Šä¿¡æ¯, åŠªåŠ›åœ¨ä½ çš„ç¼–è¯‘å™¨æœ€é«˜è­¦å‘Šçº§åˆ«ä¸‹äº‰å–æ— è­¦å‘Šçš„è£èª‰.</li><li>åŒæ—¶ä¹Ÿä¸è¦è¿‡åº¦ä¾èµ–ç¼–è¯‘å™¨çš„æŠ¥è­¦èƒ½åŠ›, æœ‰äº›å¯èƒ½å¯¼è‡´è¿è¡Œå´©æºƒçš„é”™è¯¯ç¼–è¯‘å™¨æ— æ³•å‡†ç¡®æ£€æµ‹.</li></ul><hr><h2 id="æ¡æ¬¾54-è®©è‡ªå·±ç†Ÿæ‚‰åŒ…æ‹¬Tr1åœ¨å†…çš„æ ‡å‡†ç¨‹åºåº“"><a href="#æ¡æ¬¾54-è®©è‡ªå·±ç†Ÿæ‚‰åŒ…æ‹¬Tr1åœ¨å†…çš„æ ‡å‡†ç¨‹åºåº“" class="headerlink" title="æ¡æ¬¾54 : è®©è‡ªå·±ç†Ÿæ‚‰åŒ…æ‹¬Tr1åœ¨å†…çš„æ ‡å‡†ç¨‹åºåº“"></a>æ¡æ¬¾54 : è®©è‡ªå·±ç†Ÿæ‚‰åŒ…æ‹¬Tr1åœ¨å†…çš„æ ‡å‡†ç¨‹åºåº“</h2><p>Tr1å…¶å®æ˜¯æ—©æœŸçš„å®éªŒæ ‡å‡†åº“, å¦‚ä»Šå·²ç»åºŸå¼ƒ, è®¸å¤šåŠŸèƒ½éƒ½å·²ç»æ­£å¼å¹¶å…¥æ ‡å‡†åº“ä¸­, ä¾‹å¦‚ : </p><ul><li>æ™ºèƒ½æŒ‡é’ˆ</li><li>functional</li><li>bind</li><li>unordered_set &#x2F; unordered_map</li><li>type_traits</li></ul><p>è¿™äº›æŠ€æœ¯å…¶å®åœ¨ç°åœ¨éƒ½å·²ç»æˆç†Ÿå¹¶ä¸”è¢«å¹¿æ³›è¿ç”¨, æˆä¸ºäº†æˆ‘ä»¬å¿…é¡»å­¦ä¹ çš„ä¸€éƒ¨åˆ†.</p><hr><h2 id="æ¡æ¬¾55-è®©è‡ªå·±ç†Ÿæ‚‰Boost"><a href="#æ¡æ¬¾55-è®©è‡ªå·±ç†Ÿæ‚‰Boost" class="headerlink" title="æ¡æ¬¾55 : è®©è‡ªå·±ç†Ÿæ‚‰Boost"></a>æ¡æ¬¾55 : è®©è‡ªå·±ç†Ÿæ‚‰Boost</h2><p>Boost æ˜¯ C++ ç¤¾åŒºå¹¿æ³›ä½¿ç”¨çš„<strong>é«˜è´¨é‡å¼€æºåº“é›†åˆ</strong>ï¼Œæ—¨åœ¨æ‰©å±• C++ æ ‡å‡†åº“åŠŸèƒ½ï¼Œå¹¶æ¨åŠ¨æ–°ç‰¹æ€§è¿›å…¥ C++ æ ‡å‡†ã€‚å…¶ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p><ol><li><strong>é«˜è´¨é‡ä»£ç </strong>ï¼šç»è¿‡ä¸¥æ ¼ä»£ç å®¡æŸ¥å’Œè·¨å¹³å°æµ‹è¯•ã€‚</li><li><strong>ä¸æ ‡å‡†å…¼å®¹</strong>ï¼šå¤šä¸ª Boost ç»„ä»¶ï¼ˆå¦‚æ™ºèƒ½æŒ‡é’ˆã€æ­£åˆ™è¡¨è¾¾å¼ï¼‰å·²è¢«çº³å…¥ C++11 åŠåç»­æ ‡å‡†ã€‚</li><li><strong>æ¨¡å—åŒ–è®¾è®¡</strong>ï¼šå¯æŒ‰éœ€å¼•å…¥å•ä¸ªå¤´æ–‡ä»¶æˆ–ç¼–è¯‘åº“ï¼Œå‡å°‘ä¾èµ–ã€‚</li><li><strong>è·¨å¹³å°æ”¯æŒ</strong>ï¼šå…¼å®¹ä¸»æµæ“ä½œç³»ç»Ÿå’Œç¼–è¯‘å™¨ã€‚</li></ol><p>Boost æ˜¯ C++ å¼€å‘è€…çš„é‡è¦å·¥å…·åº“ï¼Œæä¾›ä¸°å¯Œçš„æ‰©å±•åŠŸèƒ½ï¼Œæ¶µç›–ç³»ç»Ÿç¼–ç¨‹ã€ç®—æ³•ã€å¹¶å‘ç­‰é¢†åŸŸã€‚å¯¹äºéœ€è¦é«˜æ€§èƒ½å’Œç°ä»£ç¼–ç¨‹èŒƒå¼çš„é¡¹ç›®ï¼ŒBoost èƒ½æ˜¾è‘—æå‡å¼€å‘æ•ˆç‡å’Œä»£ç å¥å£®æ€§ã€‚</p><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾49-52 å†…å­˜åˆ†é…</title>
    <link href="/2025/01/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE49-52%20%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/"/>
    <url>/2025/01/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE49-52%20%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾49-äº†è§£new-handlerçš„è¡Œä¸º"><a href="#æ¡æ¬¾49-äº†è§£new-handlerçš„è¡Œä¸º" class="headerlink" title="æ¡æ¬¾49 : äº†è§£new-handlerçš„è¡Œä¸º"></a>æ¡æ¬¾49 : äº†è§£new-handlerçš„è¡Œä¸º</h2><h2 id="æ¡æ¬¾50-äº†è§£newå’Œdeleteçš„åˆç†æ›¿æ¢æ—¶æœº"><a href="#æ¡æ¬¾50-äº†è§£newå’Œdeleteçš„åˆç†æ›¿æ¢æ—¶æœº" class="headerlink" title="æ¡æ¬¾50 : äº†è§£newå’Œdeleteçš„åˆç†æ›¿æ¢æ—¶æœº"></a>æ¡æ¬¾50 : äº†è§£newå’Œdeleteçš„åˆç†æ›¿æ¢æ—¶æœº</h2><h2 id="æ¡æ¬¾51-ç¼–å†™newå’Œdeleteæ—¶éœ€å›ºå®ˆå¸¸è§„"><a href="#æ¡æ¬¾51-ç¼–å†™newå’Œdeleteæ—¶éœ€å›ºå®ˆå¸¸è§„" class="headerlink" title="æ¡æ¬¾51 : ç¼–å†™newå’Œdeleteæ—¶éœ€å›ºå®ˆå¸¸è§„"></a>æ¡æ¬¾51 : ç¼–å†™newå’Œdeleteæ—¶éœ€å›ºå®ˆå¸¸è§„</h2><h2 id="æ¡æ¬¾52-ï¼šå†™äº†placement-newä¹Ÿè¦å†™placement-delete"><a href="#æ¡æ¬¾52-ï¼šå†™äº†placement-newä¹Ÿè¦å†™placement-delete" class="headerlink" title="æ¡æ¬¾52 ï¼šå†™äº†placement newä¹Ÿè¦å†™placement delete"></a>æ¡æ¬¾52 ï¼šå†™äº†placement newä¹Ÿè¦å†™placement delete</h2><blockquote><p>æ¡æ¬¾49-52ä¸­è¯¦ç»†è®²è¿°äº†å®šåˆ¶newå’Œdeleteçš„å®ç°, åŠ ä¸Šå‰é¢æ‰€è®²è¿°çš„æ™ºèƒ½æŒ‡é’ˆåŠèµ„æºç®¡ç†ç±», è®©æˆ‘ä»¬å¯¹å†…å­˜ç®¡ç†æœ‰äº†æ¯”è¾ƒæ·±åˆ»çš„è®¤çŸ¥. ä½†æ˜¯è¿™éƒ¨åˆ†æœ‰äº›å†…å®¹ç»æŸ¥è¯å·²ç»ç›¸å¯¹è¿‡æ—¶, æ‰€ä»¥æˆ‘å°†ç»Ÿåˆè¿™å››ä¸ªæ¡æ¬¾, å…ˆå¯¹å†…å­˜åˆ†é…æœ‰ä¸€ä¸ªåˆæ­¥çš„è®¤è¯†, ç„¶åå†ç®€å•è®²è§£ä¸€ä¸‹å®šåˆ¶newå’Œdeleteçš„ç¼–å†™, ä¹‹åå†è®¨è®ºä¸€ä¸‹å„ç§å†…å­˜åˆ†é…çš„æ–¹å¼.</p></blockquote><h3 id="å†…å­˜åˆ†é…çš„æ•´ä½“è®¤çŸ¥"><a href="#å†…å­˜åˆ†é…çš„æ•´ä½“è®¤çŸ¥" class="headerlink" title="å†…å­˜åˆ†é…çš„æ•´ä½“è®¤çŸ¥"></a>å†…å­˜åˆ†é…çš„æ•´ä½“è®¤çŸ¥</h3><p>ç›¸æ¯”äºjavaç­‰ç¼–ç¨‹è¯­è¨€ä»¥åƒåœ¾å›æ”¶åŠŸèƒ½æ´¥æ´¥ä¹é“, ä½†å…¶å®é™…ä¹Ÿä¼šå¸¦æ¥è¿è¡Œæ•ˆç‡ä¸‹é™çš„å¼Šç«¯, C++å› æ­¤å¹¶æ²¡æœ‰çº³å…¥åƒåœ¾å›æ”¶çš„æœºåˆ¶, å°†å†…å­˜åˆ†é…çš„ä»»åŠ¡äº¤ç»™äº†ç¨‹åºå‘˜è‡ªå·±, æ‰€ä»¥å­¦ä¹ å†…å­˜åˆ†é…æ˜¯æˆä¸ºä¸€ä¸ªä¼˜ç§€C++ç¨‹åºå‘˜çš„æ‰€å¿…é¡»çš„. ä¸ºäº†å®ç°æ›´å¥½çš„å†…å­˜åˆ†é…, è¯¸å¦‚æ™ºèƒ½æŒ‡é’ˆ, allocatorç­‰çš„å„ç§èµ„æºç®¡ç†ç±»å¦‚é›¨åæ˜¥ç¬‹èˆ¬äº§ç”Ÿ, å½“ç„¶åœ¨æ­¤ä¹‹å¤–C++æœ¬èº«å°±å¯ä»¥å¯¹newè¿›è¡Œå®šåˆ¶, è¿™ç§åšæ³•è™½ç„¶åŸå§‹, ä½†æ˜¯ä¹Ÿæœ‰ä¸€å®šçš„ç”¨æ­¦ä¹‹åœ°.</p><p>å…ˆè®©æˆ‘ä»¬äº†è§£ä¸€ä¸‹å†…å­˜åˆ†é…çš„æµç¨‹ : </p><ul><li>C : å†…å­˜ç”³è¯·(malloc) -&gt; â€¦(ä½¿ç”¨) -&gt; é‡Šæ”¾å†…å­˜(free)</li><li>C++ : å†…å­˜ç”³è¯· -&gt; æ„é€  -&gt; â€¦(ä½¿ç”¨) -&gt; ææ„ -&gt; é‡Šæ”¾å†…å­˜</li></ul><p>ä¸Šé¢å±•ç¤ºäº†C&#x2F;C++å†…å­˜åˆ†é…çš„æµç¨‹, å…¶å®å†…å­˜ç”³è¯·å’Œé‡Šæ”¾åœ¨åº•å±‚éƒ½æ˜¯è°ƒç”¨mallocå’Œfree, ä½†æ˜¯åœ¨C++ä¸­å¯¹å…¶è¿›è¡Œäº†å°è£…, å› ä¸ºå…¶OOPçš„ç‰¹æ€§, åœ¨newä¸­ä¸ä»…ç”³è¯·äº†å†…å­˜, è¿˜è¿›è¡Œäº†å¯¹åº”çš„æ„é€ , ç®€å•æ¥è¯´å°±æ˜¯å…ˆè°ƒç”¨mallocç”³è¯·äº†ä¸€å—å†…å­˜, ç„¶ååœ¨è¿™ç‰‡å†…å­˜ä¸Šè°ƒç”¨å¯¹åº”å¯¹è±¡çš„æ„é€ å‡½æ•°, deleteä¹Ÿæ˜¯åŒç†ä¸å†èµ˜è¿°.</p><hr><h3 id="å®šåˆ¶newå’Œdelete"><a href="#å®šåˆ¶newå’Œdelete" class="headerlink" title="å®šåˆ¶newå’Œdelete"></a>å®šåˆ¶newå’Œdelete</h3><ul><li><p>ä»€ä¹ˆæ˜¯å®šåˆ¶newå’Œdelete?</p><p>å³å¯¹newå’Œdeleteè¿ç®—ç¬¦è¿›è¡Œé‡è½½, åŒ…æ‹¬newå’Œdeleteçš„ä½¿ç”¨ä»¥åŠè¿ç®—ç¬¦é‡è½½å­¦åˆ°è¿™é‡Œæˆ‘ä»¬åº”å½“éƒ½å·²ç»éå¸¸ç†Ÿæ‚‰.</p></li><li><p>ä¸ºä»€ä¹ˆè¦å®šåˆ¶newå’Œdelete?</p><p>æ ¹æœ¬åŸå› å°±æ˜¯æ ‡å‡†ç‰ˆæœ¬çš„newå’Œdeleteæä¾›çš„æœåŠ¡å¤ªå°‘, åªæœ‰ç”³è¯·å’Œæ„é€ , ææ„å’Œé”€æ¯, å› æ­¤å®šåˆ¶å¯ä»¥å®ç°æ›´å¤šçš„æ“ä½œ.</p><p>ä¹¦ä¸­è¿™é‡Œç”¨äº†ä¸€ä¸ªæ¡æ¬¾æ¥è§£é‡Š, æˆ‘è¿™é‡Œç®€å•æç‚¼ä¸€ä¸‹å®šåˆ¶newå’Œdeleteä¸»è¦å¯ä»¥åšåˆ°çš„æå‡ : </p><ul><li>æå‰æ£€æµ‹è¿ç”¨newæˆ–deleteä¸Šçš„é”™è¯¯.</li><li>å¼ºåŒ–åˆ†é…çš„æ•ˆèƒ½, å¯ä»¥å¼•å…¥å†…å­˜æ± æå‡åˆ†é…å’Œé‡Šæ”¾çš„æ•ˆç‡.</li><li>æ”¶é›†ç»Ÿè®¡æ•°æ®, åŠ å…¥æ—¥å¿—åŠŸèƒ½, è®°å½•å†…å­˜åˆ†é…æƒ…å†µ, ä¾¿äºä¿¡æ¯åˆ†æ.</li></ul></li><li><p>å¦‚ä½•å®ç°å®šåˆ¶newå’Œdelete?</p><p>ä¸»è¦å°±æ˜¯å­¦ä¼šnewå’Œdeleteçš„è¿ç®—ç¬¦é‡è½½, ä½†æ˜¯å…¶ä¸­è¿˜æ˜¯æœ‰ä¸€äº›é—¨é“, æˆ‘ä»¬ä¸å¦¨æ¥å›é¡¾ä¸€ä¸‹newæ˜¯å¦‚ä½•ä½¿ç”¨çš„ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">MyClass* myclass = <span class="hljs-keyword">new</span> <span class="hljs-built_in">MyClass</span>(<span class="hljs-number">42</span>);<br></code></pre></td></tr></table></figure><p>å‡è®¾æœ‰ä¸€ä¸ªMyClassç±», å…¶æ„é€ éœ€è¦ä¼ å…¥ä¸€ä¸ªint, è¿™æ®µä»£ç ä¾¿å¯ä»¥å®ç°ç”³è¯·å†…å­˜ + æ„é€ çš„å…¨è¿‡ç¨‹, ä½†æ˜¯æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç å®ç° : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">void</span>* ptr = ::<span class="hljs-keyword">operator</span> <span class="hljs-built_in">new</span>(<span class="hljs-built_in">sizeof</span>(MyClass));    <span class="hljs-comment">// ::operator new</span><br>MyClass* myclass = <span class="hljs-built_in">new</span>(ptr) <span class="hljs-built_in">MyClass</span>(<span class="hljs-number">42</span>);    <span class="hljs-comment">// placement new</span><br></code></pre></td></tr></table></figure><p>è¿™å’Œä¸Šé¢ä»£ç å®ç°çš„æ•ˆæœæ˜¯ä¸€æ ·çš„, é‡Œé¢çš„ä¸¤ä¸ªè¯­æ³•::operator new(å…¨å±€åˆ†é…å‡½æ•°)å’Œplacement new(å®šä½new), éƒ½æ˜¯C++åŸºç¡€ä¸­åº”è¯¥å­¦åˆ°è¿‡çš„, å…¶å®ä¹Ÿå°±åˆ†åˆ«å¯¹åº”äº†ç”³è¯·å†…å­˜å’Œæ„é€ , äºæ˜¯æˆ‘ä»¬å¯ä»¥å¯¹å†…å­˜åˆ†é…æµç¨‹åšå‡ºå¦‚ä¸‹çš„å¯¹åº” : </p><ul><li>å†…å­˜ç”³è¯·(::operator new) -&gt; æ„é€ (placement new) -&gt; â€¦(ä½¿ç”¨) -&gt; ææ„(placement delete) -&gt; é‡Šæ”¾å†…å­˜(::operator delete)</li></ul><p>é‚£ä¹ˆå®šåˆ¶newå’Œdeleteå°±å˜æˆäº†å®šåˆ¶::operator newå’Œplacement new(åŠå¯¹åº”delteteç‰ˆæœ¬)äº†, å®šåˆ¶æ–¹æ³•ä¹Ÿå¾ˆç®€å• : </p><ul><li><p>é‡è½½operator new, <strong>ä¸åŒçš„å‚æ•°å¯¹åº”ä¸ç”¨çš„åŠŸèƒ½</strong>, åªä¼ å…¥ä¸€ä¸ªsizeå¯¹åº”::operator new, ä¸ä»…ä¼ å…¥sizeè¿˜ä¼ å…¥ptrå¯¹åº”placement new, ä¹Ÿè®¸è¿™æ ·è®¾å®šä½ ä¼šè§‰å¾—å¾ˆæ€ª, ä½†æ˜¯äº‹å®å°±æ˜¯è¿™æ ·, æˆ‘ä»¬é€šè¿‡ä»£ç æ¥è®¤è¯† : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// å®šåˆ¶ ::operator new</span><br><span class="hljs-function"><span class="hljs-type">void</span>* <span class="hljs-keyword">operator</span> <span class="hljs-title">new</span><span class="hljs-params">(std::<span class="hljs-type">size_t</span> size)</span> </span>&#123;<br>    <span class="hljs-comment">// è¿›è¡Œå‚æ•°æ£€æµ‹, æ—¥å¿—è®°å½•, è°ƒç”¨å†…å­˜æ± ç­‰</span><br>    <span class="hljs-comment">// ......</span><br>    <span class="hljs-keyword">return</span> ::<span class="hljs-keyword">operator</span> <span class="hljs-built_in">new</span>(size);  <span class="hljs-comment">// å¯ä»¥ä»ç„¶ä½¿ç”¨æ ‡å‡†çš„ ::operator new, å½“ç„¶ä¹Ÿå¯ä»¥è‡ªå·±malloc</span><br>&#125;<br><br><span class="hljs-comment">// å®šåˆ¶ placement new æ“ä½œç¬¦</span><br><span class="hljs-function"><span class="hljs-type">void</span>* <span class="hljs-keyword">operator</span> <span class="hljs-title">new</span><span class="hljs-params">(std::<span class="hljs-type">size_t</span> size, <span class="hljs-type">void</span>* ptr)</span> <span class="hljs-keyword">noexcept</span> </span>&#123;<br>    <span class="hljs-comment">// è¿›è¡Œæ—¥å¿—è®°å½•ç­‰æ“ä½œ</span><br>    <span class="hljs-keyword">return</span> ptr;  <span class="hljs-comment">// ä¸è¿›è¡Œå†…å­˜åˆ†é…ï¼Œåªæ˜¯è¿”å›å·²åˆ†é…çš„å†…å­˜åœ°å€</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å½“ç„¶è¿™ç§è¿ç®—ç¬¦é‡è½½å¦‚æœæ”¾åœ¨ç±»å¤–å°±æ˜¯ä½œç”¨äºå…¨å±€, æ”¾åœ¨ç±»å†…å°±æ˜¯ç±»ä¸“å±, æˆ‘ä»¬åº”å½“æœ‰æ‰€è®¤çŸ¥.</p></li></ul></li></ul><hr><h3 id="ç”³è¯·å†…å­˜å¤±è´¥çš„å¤„ç†æ–¹å¼"><a href="#ç”³è¯·å†…å­˜å¤±è´¥çš„å¤„ç†æ–¹å¼" class="headerlink" title="ç”³è¯·å†…å­˜å¤±è´¥çš„å¤„ç†æ–¹å¼"></a>ç”³è¯·å†…å­˜å¤±è´¥çš„å¤„ç†æ–¹å¼</h3><p>æˆ‘ä»¬çŸ¥é“mallocæ˜¯å¯èƒ½å‡ºé”™çš„, å†…å­˜ä¸è¶³ç­‰é—®é¢˜éƒ½æœ‰å¯èƒ½å‘é€, mallocå‡ºé”™ä¼šè¿”å›ä¸€ä¸ªnullptr, åœ¨æ ‡å‡†åº“ä¸­newä¼šæŠ›å‡º<code>std::bad_alloc</code>è¿™ä¸ªå¼‚å¸¸, å› æ­¤æˆ‘ä»¬åœ¨è‡ªå·±çš„<code>operator new</code>ä¸­å¦‚æœä½¿ç”¨malloc, å½“å…¶è¿”å›ä¸€ä¸ªnullptræ—¶ä¹Ÿåº”æŠ›å‡ºä¸€ä¸ª<code>bad_alloc</code>.</p><p>å½“ç„¶ä¹¦ä¸­ä¹Ÿæå‡ºåº”è¯¥æœ‰æ›´ä¼˜ç§€çš„å¤„ç†æ–¹å¼, ä¸åº”è¯¥åªæ˜¯æŠ›å‡ºå¼‚å¸¸, åœ¨æ¡æ¬¾49ä¸­ä¾¿æå‡ºæ ‡å‡†åº“å†…ç½®äº†ä¸€ä¸ªé”™è¯¯å¤„ç†å‡½æ•°<code>new_handler</code>, å¯ä»¥é€šè¿‡<code>set_new_handler(handler)</code>è¿™ä¸ªå‡½æ•°æ¥è®¾ç½®, å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ, ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥è‡ªå·±å†™å›è°ƒå‡½æ•°å¹¶å°†å…¶è®¾ç½®ä¸º<code>new_handler</code>, åœ¨å‘ç”Ÿå†…å­˜å¤±è´¥æ—¶å¯ä»¥è‡ªåŠ¨è°ƒç”¨è¯¥å‡½æ•°. æˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­è®°å½•æ—¥å¿—, ä½¿ç”¨å†…å­˜æ± æœºåˆ¶(å¦‚æœç”¨äº†å†…å­˜æ± çš„è¯), å†³å®šæ˜¯å¦æŠ›å‡ºå¼‚å¸¸(å¦‚æœç”³è¯·å¤±è´¥æ— æ‰€è°“çš„è¯å¯ä»¥ä¸æŠ›å‡ºå¼‚å¸¸).</p><p>ä½†æ˜¯çœŸçš„æœ‰å¿…è¦å—?</p><p>å…¶å®new_handleråœ¨å®é™…è¿ç”¨ä¸­å·²ç»å¾ˆå°‘ä½¿ç”¨, æ ¹æœ¬åŸå› è¿˜æ˜¯åœ¨ç°ä»£å†…å­˜å¤§å°å·²ç»ä¸å†æ˜¯é—®é¢˜, ä¹Ÿå°±æ˜¯è¯´å†…å­˜ç”³è¯·å¤±è´¥å‡ ä¹ä¸å¯èƒ½å‡ºç°, åªåœ¨æå°‘åµŒå…¥å¼è®¾å¤‡ä¸­å¯èƒ½æœ‰éœ€è¦äº†. è€Œä¸”å¦‚æœçœŸçš„å‡ºç°äº†ç”³è¯·å†…å­˜å¤±è´¥é‚£åªèƒ½è¯´æ˜é—®é¢˜å¾ˆå¤§, ä¸æ˜¯ç¡¬ä»¶æœ‰é—®é¢˜å°±æ˜¯ä»£ç å“ªé‡Œå‡ºç°äº†ä¸¥é‡çš„å†…å­˜æ³„éœ², è¿™ä¸æ˜¯å†™ä¸€ä¸ªnew_handlerå¯ä»¥è§£å†³çš„äº†, å› æ­¤å…¶å®åœ¨ç°ä»£èƒŒæ™¯ä¸‹è¿˜æ˜¯è€å®æŠ›å‡ºå¼‚å¸¸å°±è¡Œäº†.</p><hr><h3 id="æµ…è°ˆå†…å­˜åˆ†é…"><a href="#æµ…è°ˆå†…å­˜åˆ†é…" class="headerlink" title="æµ…è°ˆå†…å­˜åˆ†é…"></a>æµ…è°ˆå†…å­˜åˆ†é…</h3><p>å…³äºå†…å­˜åˆ†é…æˆ‘è®¤ä¸ºå­¦å¥½æ™ºèƒ½æŒ‡é’ˆçš„ä½¿ç”¨æ˜¯æœ€å…³é”®çš„, å› ä¸ºå…¶å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šä¿è¯æˆ‘ä»¬çš„ä»£ç ä¸ä¼šå†…å­˜æ³„æ¼, åªè¦ä¸å‘ç”Ÿå†…å­˜æ³„æ¼, å†…å­˜å¤§å°ä¸€èˆ¬ä¸ä¼šæ˜¯é—®é¢˜.</p><p>æˆ‘ä»¬å¯¹äºå†…å­˜åˆ†é…çš„å…³æ³¨ç‚¹åº”è¯¥æ”¾åœ¨å¦‚ä½•é¿å…å†…å­˜æ³„æ¼å’Œæå‡æ•ˆç‡ä¸Š, å†…å­˜æ³„æ¼æœ‰æ™ºèƒ½æŒ‡é’ˆé¿å…, æé€Ÿå¯ä»¥é€šè¿‡<strong>å¼•å…¥å†…å­˜æ± </strong>æ¥ç¼“è§£, å†…å­˜æ± è¿™é‡Œä¸å†è¯¦è¿°, ç®€å•æ¥è¯´å°±æ˜¯ç”³è¯·å’Œé‡Šæ”¾å†…å­˜å…¶å®æ˜¯æœ‰ä¸€å®šèŠ±é”€çš„, ä¸æ–­çš„ä¸€å°å—ä¸€å°å—åœ°ç”³è¯·å†…å­˜ç„¶åæ„é€ å…¶å®æ˜¯æ•ˆç‡è¿œä½äºç›´æ¥ç”³è¯·ä¸€å¤§å—å†…å­˜, ç„¶åæ ¹æ®éœ€æ±‚åˆ†é…è¿™å—å†…å­˜çš„, è€Œå†…å­˜æ± å°±æ˜¯åšåˆ°äº†åè€….</p><p>è‡³äºå¦‚ä½•å¼•å…¥, å¯ä»¥é€šè¿‡ä¸Šæ–‡çš„å®šåˆ¶newå’Œdeleteçš„é‡è½½å‡½æ•°ä¸­å¼•å…¥, ä¹Ÿå¯ä»¥é€šè¿‡è‡ªå®šä¹‰çš„allocator(åˆ†é…å™¨)æ¥å¼•å…¥, allocatorä¹Ÿæ˜¯ä¸€ç§ç›¸å¯¹æœ‰ç”¨çš„å†…å­˜åˆ†é…æŠ€æœ¯, å¦‚æœæ„Ÿå…´è¶£å¯ä»¥è‡ªå·±æœç´¢å­¦ä¹ .</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>å†…å­˜åˆ†é…åœ¨ç°ä»£ä¸»è¦è¿˜æ˜¯ä¾èµ–æ™ºèƒ½æŒ‡é’ˆ, å¯ä»¥æœ‰æ•ˆé¿å…å†…å­˜æ³„éœ².</li><li>å¦‚æœæƒ³å¯¹å†…å­˜åˆ†é…åšæ›´ç»†è‡´çš„å¤„ç†, ä¾‹å¦‚æé€Ÿæˆ–è®°å½•æ—¥å¿—ç­‰, å¯ä»¥å°è¯•å®šåˆ¶newå’Œdelete, ä½¿ç”¨allocator, å¼•å…¥å†…å­˜æ± .</li><li>å†…å­˜åˆ†é…å¤±è´¥çš„æƒ…å†µåœ¨å½“ä¸‹éå¸¸å°‘è§, å¯ä»¥å†™ç®€å•çš„å¤±è´¥å¤„ç†æœºåˆ¶, ä½†æ²¡å¿…è¦æŠ•å…¥è¿‡å¤šç²¾åŠ›.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾48 æ¨¡æ¿å…ƒç¼–ç¨‹(TMP)</title>
    <link href="/2025/01/22/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE48%20%E6%A8%A1%E6%9D%BF%E5%85%83%E7%BC%96%E7%A8%8B(TMP)/"/>
    <url>/2025/01/22/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE48%20%E6%A8%A1%E6%9D%BF%E5%85%83%E7%BC%96%E7%A8%8B(TMP)/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾48-è®¤è¯†templateå…ƒç¼–ç¨‹"><a href="#æ¡æ¬¾48-è®¤è¯†templateå…ƒç¼–ç¨‹" class="headerlink" title="æ¡æ¬¾48 : è®¤è¯†templateå…ƒç¼–ç¨‹"></a>æ¡æ¬¾48 : è®¤è¯†templateå…ƒç¼–ç¨‹</h2><blockquote><p>åœ¨æ¡æ¬¾47æˆ‘ä»¬ä¸»è¦äº†è§£äº†èƒå–å™¨è¿™ç§æ¨¡æ¿å…ƒç¼–ç¨‹, ä¹Ÿåˆæ­¥è¿›å…¥äº†æ¨¡æ¿å…ƒç¼–ç¨‹çš„ä¸–ç•Œ. åœ¨æœ¬æ¡æ¬¾ä¸­, æˆ‘ä»¬å°†ç»§ç»­è®¤è¯†æ¨¡æ¿å…ƒç¼–ç¨‹, è®¤è¯†å…¶å¿…è¦æ€§å’Œåº”ç”¨åœºæ™¯, ç›¸æ¯”äºæ¡æ¬¾47è®²çš„è¿˜ç®—æ¯”è¾ƒæ·±å…¥,æœ¬æ¡æ¬¾çœŸçš„å°±åªæ˜¯ç®€ä»‹, å› ä¸ºå…¶ä½“é‡ç¡®å®éå¸¸åºå¤§, ç”šè‡³å¯ä»¥å•ç‹¬ä½œä¸ºä¸€ä¸ªå­¦ç§‘ç ”ç©¶.</p></blockquote><p><code>Template metaprogramming</code>, æ¨¡æ¿å…ƒç¼–ç¨‹, ç®€ç§°TMP, æ˜¯<strong>ç¼–å†™template-based C++ç¨‹åºå¹¶æ‰§è¡Œäºç¼–è¯‘æœŸçš„è¿‡ç¨‹</strong>.</p><hr><h3 id="æ¨¡æ¿å…ƒç¼–ç¨‹çš„æ•ˆç”¨"><a href="#æ¨¡æ¿å…ƒç¼–ç¨‹çš„æ•ˆç”¨" class="headerlink" title="æ¨¡æ¿å…ƒç¼–ç¨‹çš„æ•ˆç”¨"></a>æ¨¡æ¿å…ƒç¼–ç¨‹çš„æ•ˆç”¨</h3><p>æˆ‘ä»¬ç›®å‰å¯ä»¥ç”¨åœ¨æ¡æ¬¾47ä¸­å­¦åˆ°çš„èƒå–å™¨çš„çŸ¥è¯†æ¥ç†è§£æ¨¡æ¿å…ƒçš„æ•ˆç”¨ : </p><ul><li>å®ƒè®©æŸäº›äº‹æƒ…æ›´å®¹æ˜“, è¿™äº›äº‹æƒ…åŸæœ¬æ¯”è¾ƒå›°éš¾ç”šè‡³ä¸å¯èƒ½.(ä¾‹å¦‚é’ˆå¯¹è¿­ä»£å™¨ç±»å‹è¿›è¡Œå¯é çš„æ¡ä»¶ç¼–è¯‘)</li><li>å®ƒå°†å·¥ä½œæœŸä»è¿è¡ŒæœŸç§»è‡³ç¼–è¯‘æœŸ, å¤§å¤§æé«˜äº†è¿è¡Œæ•ˆç‡, æœ‰æ›´å°çš„å¯æ‰§è¡Œæ–‡ä»¶, æ›´çŸ­çš„è¿è¡ŒæœŸ, æ›´å°‘çš„å†…å­˜æ¶ˆè€—.</li></ul><p>å‡è®¾æˆ‘ä»¬ä½¿ç”¨èƒå–å™¨æ—¶ä¸é‡‡ç”¨é‡è½½æˆ–<code>if constexpr</code>è¿™ç§æ¨¡æ¿å…ƒç¼–ç¨‹, è€Œæ˜¯å°±æ˜¯åœ¨è¿è¡ŒæœŸé€šè¿‡åˆ¤æ–­è¿­ä»£å™¨ç±»å‹æ¥æ¡ä»¶åˆ¤æ–­, æˆ‘ä»¬çœ‹çœ‹æœ€åçš„æ•ˆæœæ€æ · : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> IterT, <span class="hljs-keyword">typename</span> DistT&gt;</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">advance</span><span class="hljs-params">(IterT&amp; iter, DistT d)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">typeid</span>(<span class="hljs-keyword">typename</span> std::iterator_traits&lt;IterT&gt;::iterator_category) ==<br>      <span class="hljs-built_in">typeid</span>(std::random_access_iterator_tag)) &#123;<br>     iter += d;                                     <br>  &#125;                                                 <br>  <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">if</span> (d &gt;= <span class="hljs-number">0</span>) &#123; <span class="hljs-keyword">while</span> (d--) ++iter; &#125;             <br>    <span class="hljs-keyword">else</span> &#123; <span class="hljs-keyword">while</span> (d++) --iter; &#125;                    <br>  &#125;                                                 <br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜æ˜¯ç”¨èƒå–å™¨æå–å‡ºç±»å‹, åˆ©ç”¨<code>typeid</code>åœ¨è¿è¡ŒæœŸè¿›è¡Œæ¡ä»¶åˆ¤æ–­, ä½†æ˜¯è¿™ç§æ–¹æ³•ä¸ä»…ä¸é«˜æ•ˆ(å¯¹åº”æ•ˆç”¨2), è€Œä¸”ä¸å¯è¡Œ(å¯¹åº”æ•ˆç”¨1).</p><ul><li><p>ä¸é«˜æ•ˆ : è¿™ä¸ªå¾ˆå®¹æ˜“ç†è§£, åˆ©ç”¨æ¨¡æ¿å…ƒç¼–ç¨‹åœ¨ç¼–è¯‘æœŸå³å¯å®ç°çš„æ•ˆæœ, è¿™æ ·å´è¦åœ¨è¿è¡ŒæœŸèŠ±æ—¶é—´åˆ¤æ–­.</p></li><li><p>ä¸å¯è¡Œ : è¿™æ®µä»£ç åœ¨ä¸€äº›æƒ…å†µä¸‹ç”šè‡³éƒ½æ— æ³•é€šè¿‡ç¼–è¯‘, å¦‚æœæˆ‘ä»¬åƒä¸‹é¢è¿™æ ·ä½¿ç”¨ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp">std::list&lt;<span class="hljs-type">int</span>&gt;::iterator iter;<br><span class="hljs-built_in">advance</span>(iter, <span class="hljs-number">10</span>);<br></code></pre></td></tr></table></figure><p>è¿™æ ·ä½¿ç”¨éå¸¸åˆç†, ä½†æ˜¯ä¼šè¿è¡Œå´©æºƒ, å› ä¸ºlistçš„è¿­ä»£å™¨æ˜¯åŒå‘è¿­ä»£å™¨, è€Œééšæœºè®¿é—®è¿­ä»£å™¨, æ‰€ä»¥<code>iter += d;</code>è¿™æ®µä»£ç æ ¹æœ¬æ— æ³•é€šè¿‡ç¼–è¯‘! ä¹Ÿè®¸ä½ ä¼šè®¤ä¸ºå› ä¸ºæ¡ä»¶åˆ¤æ–­, å¦‚æœæ˜¯listçš„è¿­ä»£å™¨, è¿™å¥ä»£ç æ°¸è¿œä¸ä¼šè§¦å‘, ä½†æ˜¯æˆ‘ä»¬åº”å½“çŸ¥é“ : </p><ul><li><strong>ç¼–è¯‘å™¨å¿…é¡»ç¡®ä¿æ‰€æœ‰æºç éƒ½æœ‰æ•ˆ, çºµä½¿æ˜¯ä¸ä¼šæ‰§è¡Œèµ·æ¥çš„ä»£ç .</strong></li></ul></li></ul><p>è‡³æ­¤æˆ‘ä»¬åº”è¯¥å·²ç»å¯ä»¥ç†è§£åˆ°éƒ¨åˆ†æ¨¡æ¿å…ƒç¼–ç¨‹å¯ä»¥è¾¾åˆ°çš„æ•ˆç”¨äº†.</p><hr><h3 id="æ¨¡æ¿å…ƒç¼–ç¨‹ä¸­çš„â€hello-world-â€"><a href="#æ¨¡æ¿å…ƒç¼–ç¨‹ä¸­çš„â€hello-world-â€" class="headerlink" title="æ¨¡æ¿å…ƒç¼–ç¨‹ä¸­çš„â€hello world!â€"></a>æ¨¡æ¿å…ƒç¼–ç¨‹ä¸­çš„â€hello world!â€</h3><p>æˆ‘ä»¬å¯ä»¥äº†è§£æ¨¡æ¿å…ƒç¼–ç¨‹ä¸­çš„ä¸€ä¸ªå…¥é—¨ç¼–ç¨‹, å®ƒç›¸å½“äºåˆå…¥ç¼–ç¨‹çš„â€hello worldâ€, å³<strong>åœ¨ç¼–è¯‘æœŸè®¡ç®—é˜¶ä¹˜</strong>.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-type">unsigned</span> n&gt;                 <br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Factorial</span> &#123;                   <br>  <span class="hljs-keyword">enum</span> &#123; value = n * Factorial&lt;n<span class="hljs-number">-1</span>&gt;::value &#125;;<br>&#125;;<br><br><span class="hljs-keyword">template</span>&lt;&gt;                          <br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Factorial</span>&lt;<span class="hljs-number">0</span>&gt; &#123;            <span class="hljs-comment">// å…¨ç‰¹åŒ–</span><br>  <span class="hljs-keyword">enum</span> &#123; value = <span class="hljs-number">1</span> &#125;;<br>&#125;;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡ä»£ç åº”è¯¥å¯ä»¥æ¨å¯¼å‡ºä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹, å¹¶ä¸”è¿™ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡æ¨¡æ¿åœ¨ç¼–è¯‘æœŸæ¥å®ç°çš„! äºæ˜¯æˆ‘ä»¬å°±å¯ä»¥è¿™æ ·ä½¿ç”¨ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  std::cout &lt;&lt; Factorial&lt;<span class="hljs-number">5</span>&gt;::value &lt;&lt; std::endl;   <span class="hljs-comment">// ç›´æ¥æ‰“å°å‡º120</span><br>  std::cout &lt;&lt; Factorial&lt;<span class="hljs-number">10</span>&gt;::value;               <span class="hljs-comment">// ç›´æ¥æ‰“å°å‡º3628800</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å’Œæ™®é€šé€’å½’æ±‚é˜¶ä¹˜è¿›è¡Œå¯¹æ¯” : </p><ul><li>æ™®é€šé€’å½’ : è¿è¡ŒæœŸå®ç°, å¯ä»¥é€šè¿‡ç”¨æˆ·è¾“å…¥åŠ¨æ€è®¡ç®—ä»»æ„æ•°çš„é˜¶ä¹˜.</li><li>æ¨¡æ¿å…ƒé€’å½’ : ç¼–è¯‘æœŸå®ç°, åªå¯ä»¥å¾—åˆ°é¢„å…ˆè®¾ç½®çš„æ•°çš„é˜¶ä¹˜.</li></ul><p>ç®€å•æ¥è¯´å°±æ˜¯å‰è€…è€—è´¹è¿è¡ŒæœŸæ—¶é—´ä½†æ˜¯çµæ´», åè€…ä¸è´¹è¿è¡ŒæœŸæ—¶é—´ä½†æ˜¯ä¸å¯å˜.</p><p>å½“ç„¶ä½¿ç”¨enumæ˜¯ä¸€ä¸ªæ¯”è¾ƒåŸå§‹ä¸”å¯è¯»æ€§è¾ƒå·®çš„åšæ³•, åœ¨C++11å·²ç»å¼•å…¥constexpr : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-type">unsigned</span> n&gt;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Factorial</span> &#123;<br>  <span class="hljs-type">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-type">unsigned</span> value = n * Factorial&lt;n - <span class="hljs-number">1</span>&gt;::value;  <span class="hljs-comment">// constexprä»£æ›¿enum</span><br>&#125;;<br><br><span class="hljs-keyword">template</span>&lt;&gt;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Factorial</span>&lt;<span class="hljs-number">0</span>&gt; &#123;<br>  <span class="hljs-type">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-type">unsigned</span> value = <span class="hljs-number">1</span>;<br>&#125;;<br></code></pre></td></tr></table></figure><hr><h3 id="ä¸‰ä¸ªåº”ç”¨åœºæ™¯æ¡ˆä¾‹"><a href="#ä¸‰ä¸ªåº”ç”¨åœºæ™¯æ¡ˆä¾‹" class="headerlink" title="ä¸‰ä¸ªåº”ç”¨åœºæ™¯æ¡ˆä¾‹"></a>ä¸‰ä¸ªåº”ç”¨åœºæ™¯æ¡ˆä¾‹</h3><ul><li><p>ç¡®ä¿åº¦é‡å•ä½æ­£ç¡®.</p><p>åœ¨ç§‘å­¦å·¥ç¨‹ä¸­, æˆ‘ä»¬å¯ä»¥æå‰ç¡®å®šåº¦é‡å•ä½çš„ç»“åˆæ­£ç¡®, å¯ä»¥è¿›è¡Œæ—©æœŸçš„é”™è¯¯ä¾¦æµ‹.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;type_traits&gt;</span></span><br><br><span class="hljs-comment">// å®šä¹‰ä¸åŒçš„å•ä½ç±»å‹</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Time</span> &#123; <span class="hljs-type">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span>* name = <span class="hljs-string">&quot;Time&quot;</span>; &#125;;<span class="hljs-comment">// æ—¶é—´</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Length</span> &#123; <span class="hljs-type">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span>* name = <span class="hljs-string">&quot;Length&quot;</span>; &#125;;<span class="hljs-comment">// é•¿åº¦</span><br><br><span class="hljs-comment">// è®¡ç®—å•ä½çš„ä¹˜æ³•</span><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Unit1, <span class="hljs-keyword">typename</span> Unit2&gt;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">MultiplyUnits</span>;<br><br><span class="hljs-comment">// ä¸¤ä¸ªé•¿åº¦ç›¸ä¹˜å¾—åˆ°é¢ç§¯</span><br><span class="hljs-keyword">template</span> &lt;&gt;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">MultiplyUnits</span>&lt;Length, Length&gt; &#123;   <span class="hljs-comment">// å…¨ç‰¹åŒ–</span><br>    <span class="hljs-keyword">using</span> type = <span class="hljs-keyword">struct</span> Area &#123; <span class="hljs-type">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span>* name = <span class="hljs-string">&quot;Area&quot;</span>; &#125;; <span class="hljs-comment">// å®šä¹‰é¢ç§¯ç±»å‹</span><br>&#125;;<br><br><span class="hljs-comment">// æ—¶é—´ä¸é•¿åº¦ç›¸é™¤ï¼Œå¾—åˆ°é€Ÿåº¦</span><br><span class="hljs-keyword">template</span> &lt;&gt;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">MultiplyUnits</span>&lt;Length, Time&gt; &#123;<br>    <span class="hljs-keyword">using</span> type = <span class="hljs-keyword">struct</span> Velocity &#123; <span class="hljs-type">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span>* name = <span class="hljs-string">&quot;Velocity&quot;</span>; &#125;; <span class="hljs-comment">// å®šä¹‰é€Ÿåº¦ç±»å‹</span><br>&#125;;<br><br><span class="hljs-comment">// æ‰“å°å•ä½åç§°</span><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Unit&gt;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">printType</span><span class="hljs-params">()</span> </span>&#123;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;TypeName: &quot;</span> &lt;&lt; Unit::name &lt;&lt; std::endl;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// è®¡ç®—é•¿åº¦ä¸æ—¶é—´çš„ç»„åˆï¼Œå¾—åˆ°é€Ÿåº¦</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> MultiplyUnits&lt;Length, Time&gt;::type unit1;<br><span class="hljs-built_in">printType</span>&lt;unit1&gt;();  <span class="hljs-comment">// è¾“å‡º: Unit: Velocity</span><br><br><span class="hljs-comment">// è®¡ç®—é•¿åº¦ä¸é•¿åº¦çš„ç»„åˆï¼Œå¾—åˆ°é¢ç§¯</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> MultiplyUnits&lt;Length, Length&gt;::type unit2;<br><span class="hljs-built_in">printType</span>&lt;unit2&gt;();  <span class="hljs-comment">// è¾“å‡º: Unit: Area</span><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ¬ä¾‹ä¸­å°±å¯ä»¥æ ¹æ®å‘<code>MultiplyUnits</code>ä¸­ä¼ å…¥çš„ç±»å‹åœ¨ç¼–è¯‘æœŸè¿›è¡Œåˆ¤æ–­å…¶ç»“æœçš„ç±»å‹.</p></li><li><p>ä¼˜åŒ–çŸ©é˜µè¿ç®—.</p><p>åœ¨æ¡æ¬¾44ä¸­æˆ‘ä»¬ç¼–å†™è¿‡çŸ©é˜µ, å‡å¦‚æˆ‘ä»¬è¿›è¡Œä¸‹é¢çš„è¿ç®— : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> SquareMatrix&lt;<span class="hljs-type">double</span>, <span class="hljs-number">10000</span>&gt; BigMatrix;<br>BigMatrix m1, m2, m3, m4, m5;              <br>BigMatrix result = m1 * m2 * m3 * m4 * m5; <br></code></pre></td></tr></table></figure><p>å¦‚æœè¿™äº›åœ¨è¿è¡ŒæœŸå®Œæˆ, å°†ä¼šäº§ç”Ÿå†…å­˜å·¨å¤§çš„ä¸´æ—¶å¯¹è±¡å’Œä¸ä½çš„æ—¶é—´æˆæœ¬, ä½†å‡å¦‚ç”¨æ¨¡æ¿å…ƒç¼–ç¨‹å°±å¯èƒ½æ¶ˆé™¤ä¸´æ—¶å¯¹è±¡å¹¶åˆå¹¶å¾ªç¯, å¤§å¤§é™ä½æˆæœ¬, å…·ä½“ç»†èŠ‚ä¹¦ä¸­æ²¡æœ‰ç»™å‡º, è¿™é‡Œå°±ä¸å†ç»†è®².</p></li><li><p>å¯ä»¥ç”Ÿæˆå®¢æˆ·å®šåˆ¶ä¹‹è®¾è®¡æ¨¡å¼å®ç°å“.</p><p>è¿™é‡Œçš„å‘½é¢˜å°±æ›´åŠ å¹¿é˜”äº†, ç®€å•ç†è§£å°±æ˜¯è®¸å¤šè®¾è®¡æ¨¡å¼éƒ½å’Œç±»ä¸æ¨¡æ¿æœ‰å…³, å¯ä»¥åˆ©ç”¨æ¨¡æ¿å…ƒç¼–ç¨‹æ ¹æ®éœ€æ±‚å°†ä¸€äº›è®¾è®¡æ¨¡å¼çš„è¡Œä¸ºä»è¿è¡ŒæœŸæ¬åˆ°ç¼–è¯‘æœŸä¸­, ä¸ä»…å®ç°äº†å®šåˆ¶, è¿˜æé«˜äº†è¿è¡Œæ•ˆç‡.</p></li></ul><hr><h3 id="ç°ä»£æ¨¡æ¿å…ƒç¼–ç¨‹"><a href="#ç°ä»£æ¨¡æ¿å…ƒç¼–ç¨‹" class="headerlink" title="ç°ä»£æ¨¡æ¿å…ƒç¼–ç¨‹"></a>ç°ä»£æ¨¡æ¿å…ƒç¼–ç¨‹</h3><p>éšC++11, C++14, C++17çš„å¼•å…¥, æ¨¡æ¿å…ƒç¼–ç¨‹çš„è¯­æ³•æ—¥æ¸ä¸°å¯Œ, è¿™ä¸€é¢†åŸŸè™½ç„¶æœ‰äº›æ™¦æ¶©éš¾æ‡‚, ä½†æ˜¯å…¶ç¡®å®æœ‰å…¶ä»·å€¼æ‰€åœ¨, å¹¶ä¸”è¶Šæ¥è¶Šè¢«é‡è§†. æˆ‘ä»¬è™½ç„¶ä¸ä¸€å®šè¦å®Œå…¨æŒæ¡, ä½†æ˜¯å¯ä»¥é€æ­¥äº†è§£ä¸€ä¸‹æ¨¡æ¿å…ƒç¼–ç¨‹çš„è¯­æ³•, ä¾‹å¦‚constexpr, if constexpr, SFINAEæŠ€æœ¯, æ¨¡æ¿å…ƒå‡½æ•°ç­‰ç­‰.</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>æ¨¡æ¿å…ƒç¼–ç¨‹å¯å°†å·¥ä½œç”±è¿è¡ŒæœŸç§»å¾€ç¼–è¯‘æœŸ, å› è€Œå¾—ä»¥å®ç°æ—©æœŸé”™è¯¯ä¾¦æµ‹å’Œæ›´é«˜çš„æ‰§è¡Œæ•ˆç‡.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
      <tag>æ¨¡æ¿</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾47 èƒå–å™¨</title>
    <link href="/2025/01/16/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE47%20%E8%90%83%E5%8F%96%E5%99%A8/"/>
    <url>/2025/01/16/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE47%20%E8%90%83%E5%8F%96%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾47-è¯·ä½¿ç”¨traits-classesè¡¨ç°ç±»å‹ä¿¡æ¯"><a href="#æ¡æ¬¾47-è¯·ä½¿ç”¨traits-classesè¡¨ç°ç±»å‹ä¿¡æ¯" class="headerlink" title="æ¡æ¬¾47 : è¯·ä½¿ç”¨traits classesè¡¨ç°ç±»å‹ä¿¡æ¯"></a>æ¡æ¬¾47 : è¯·ä½¿ç”¨traits classesè¡¨ç°ç±»å‹ä¿¡æ¯</h2><blockquote><p>traits classes(èƒå–å™¨ç±»), å¦‚ä½ æ‰€è§èƒå–å™¨å…¶å®æ˜¯ä¸€ä¸ªæ¨¡æ¿ç±», åœ¨C++ä¸­èƒå–å™¨æ˜¯ä¸€ä¸ªç¥å¥‡ä¸”æœ‰è¶£çš„å­˜åœ¨, å®ƒè¢«å¹¿æ³›å¼•ç”¨äºæ ‡å‡†åº“STLçš„ç¼–å†™ä¸­, æˆ‘ä»¬å°†åœ¨æœ¬æ¡æ¬¾ä¸­äº†è§£èƒå–å™¨çš„åŠŸèƒ½åŠå®ç°, åˆæ­¥è¸å…¥æ¨¡æ¿å…ƒç¼–ç¨‹çš„ä¸–ç•Œ.</p></blockquote><h3 id="æ¨¡æ¿å…ƒç¼–ç¨‹çš„åˆæ­¥è®¤çŸ¥"><a href="#æ¨¡æ¿å…ƒç¼–ç¨‹çš„åˆæ­¥è®¤çŸ¥" class="headerlink" title="æ¨¡æ¿å…ƒç¼–ç¨‹çš„åˆæ­¥è®¤çŸ¥"></a>æ¨¡æ¿å…ƒç¼–ç¨‹çš„åˆæ­¥è®¤çŸ¥</h3><p>å¾ˆå¤šäººåœ¨ç¬¬ä¸€æ¬¡å¬åˆ°â€æ¨¡æ¿å…ƒç¼–ç¨‹â€æ—¶ä¸€å®šè§‰å¾—éå¸¸é«˜å¤§ä¸Š, ä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥ç®€å•è®¤çŸ¥å…¶ä¸º<strong>é’ˆå¯¹æ¨¡æ¿ç±»å‹åœ¨ç¼–è¯‘æœŸæ‰§è¡Œçš„ä»£ç </strong>, ç›®å‰æˆ‘ä»¬å†™çš„ä»£ç å¤§éƒ½æ˜¯åœ¨è¿è¡ŒæœŸæ‰§è¡Œçš„, ä½†æ˜¯ç”±äºæ¨¡æ¿çš„å¼•å…¥, æˆ‘ä»¬ä¾¿å¯ä»¥é’ˆå¯¹æ¨¡æ¿ç±»å‹(T)è¿›è¡Œå„ç§æ“ä½œ, è­¬å¦‚æ ¹æ®ä¸åŒçš„ç±»å‹é€‰æ‹©ä¸åŒçš„æ‰§è¡Œä»£ç å’Œè®¡ç®—é€»è¾‘, è¿™äº›è¡Œä¸ºéƒ½ä¼šåœ¨ç¼–è¯‘æœŸæ‰§è¡Œ. è€Œæˆ‘ä»¬æœ¬æ¡æ¬¾è¦å­¦ä¹ çš„èƒå–å™¨ä¾¿å±äºæ¨¡æ¿å…ƒç¼–ç¨‹çš„ä¸€éƒ¨åˆ†.</p><hr><h3 id="åœ¨-STLæºç å‰–æ-ä¸­å­¦ä¹ "><a href="#åœ¨-STLæºç å‰–æ-ä¸­å­¦ä¹ " class="headerlink" title="åœ¨ STLæºç å‰–æ ä¸­å­¦ä¹ "></a>åœ¨ <em>STLæºç å‰–æ</em> ä¸­å­¦ä¹ </h3><p>æœ¬æ¡æ¬¾å…¶å®åªæ˜¯å¯¹èƒå–å™¨çš„ç®€ä»‹, è®©ä½ è®¤è¯†èƒå–å™¨è¿™ä¸ªå­˜åœ¨, æƒ³è¦çœŸæ­£æŒæ¡å®ƒ, è¿˜æ˜¯å»ºè®®é˜…è¯»<em>STLæºç å‰–æ</em>, å…¶ä¸­ç¬¬äºŒç« ç”¨äº†æ•´æ•´ä¸€ç« çš„å†…å®¹æ¥è¯¦è¿°èƒå–å™¨ç›¸å…³çš„å†…å®¹, æˆ‘ä¹Ÿæ˜¯å› ä¸ºæå‰é˜…è¯»è¿‡<em>STLæºç å‰–æ</em>, æ‰å¯¹æœ¬æ¡æ¬¾çš„é˜…è¯»æ²¡æœ‰ä»€ä¹ˆéšœç¢çš„.</p><hr><h3 id="èƒå–å™¨"><a href="#èƒå–å™¨" class="headerlink" title="èƒå–å™¨"></a>èƒå–å™¨</h3><p>é¡¾åæ€ä¹‰, èƒå–å™¨æ˜¯ç”¨æ¥èƒå–çš„, å…¶ä½œç”¨æ˜¯<strong>ä»æ¨¡æ¿ç±»å‹ä¸­èƒå–å‡ºç±»å‹ä¿¡æ¯</strong>, å¦å¤–èƒå–å™¨æ˜¯ä¸€ç§<strong>æŠ€æœ¯</strong>, æ˜¯ä¸€ä¸ªå¯ä»¥å®ç°èƒå–åŠŸèƒ½çš„ç±», å¹¶ä¸”åŒæ—¶ä¹Ÿéœ€è¦è¢«èƒå–ç±»çš„å¸®åŠ©æ‰è¡Œ. </p><p>æˆ‘ä»¬å…ˆæ¥ä»‹ç»ä¹¦ä¸­çš„å…¸ä¾‹ - è¿­ä»£å™¨ :</p><p>è¿­ä»£å™¨å¤§å®¶éƒ½ç†ŸçŸ¥, å¹¶ä¸”è¿­ä»£å™¨æœ‰äº”ç§è¿­ä»£å™¨ç±»åˆ« : <strong>åªè¯»è¿­ä»£å™¨, åªå†™è¿­ä»£å™¨, å•å‘è¯»å†™è¿­ä»£å™¨, åŒå‘è¯»å†™è¿­ä»£å™¨, éšæœºè¯»å†™è¿­ä»£å™¨</strong>, è¿™äº”ç§è¿­ä»£å™¨ç±»å‹æœ‰æ˜ç¡®çš„ç»§æ‰¿å…³ç³», ä»£ç å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">input_iterator_tag</span> &#123;&#125;;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">output_iterator_tag</span> &#123;&#125;;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">forward_iterator_tag</span>: <span class="hljs-keyword">public</span> input_iterator_tag &#123;&#125;;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">bidirectional_iterator_tag</span>: <span class="hljs-keyword">public</span> forward_iterator_tag &#123;&#125;;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">random_access_iterator_tag</span>: <span class="hljs-keyword">public</span> bidirectional_iterator_tag &#123;&#125;;<br></code></pre></td></tr></table></figure><p>å¦å¤–STLåº“ä¸­è¿˜æœ‰è®¸å¤šæ¨¡æ¿å‡½æ•°, advanceå‡½æ•°ä¾¿æ˜¯å…¶ä¸­ä¹‹ä¸€, å…¶å£°æ˜å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> IterT, <span class="hljs-keyword">typename</span> DistT&gt;  </span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">advance</span><span class="hljs-params">(IterT&amp; iter, DistT d)</span></span>;<br></code></pre></td></tr></table></figure><p>å…¶æ¥æ”¶ä¸€ä¸ªè¿­ä»£å™¨ç±»å‹å‚æ•°å’Œä¸€ä¸ªè·ç¦»ç±»å‹å‚æ•°, æ„åœ¨å®ç°<code>iter += d</code>è¿™ç§æ“ä½œ, ä¹Ÿå°±æ˜¯è®©iteræŒ‰då‘ç”Ÿå˜åŒ–, è¿™æ˜¯è¿­ä»£å™¨çš„åŸºæœ¬åŠŸèƒ½. ä½†æ˜¯ä¸åŒçš„è¿­ä»£å™¨æ‰€èƒ½å®ç°çš„æ“ä½œæœ‰æ‰€å·®åˆ« : </p><ul><li>åªè¯»åªå†™è¿­ä»£å™¨å’Œå•å‘è¯»å†™è¿­ä»£å™¨åªèƒ½æ­£å‘ä¸”ä¸€æ¬¡ä¸€æ­¥è¯»å†™(++). </li><li>åŒå‘è¯»å†™è¿­ä»£å™¨å¯ä»¥åŒå‘ä¸€æ¬¡ä¸€æ­¥è¯»å†™(++, â€“).</li><li>éšæœºè¯»å†™è¿­ä»£å™¨å¯ä»¥è·³è·ƒè¯»å†™(+&#x3D; x, -&#x3D; x).</li></ul><p>è¿™å°±å¯¼è‡´advanceå¸Œæœ›æ ¹æ®è¿­ä»£å™¨ç±»åˆ«å»å®ç°ä¸åŒçš„æ“ä½œ, å°±åƒä¸‹é¢ä¸€æ · : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> IterT, <span class="hljs-keyword">typename</span> DistT&gt;</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">advance</span><span class="hljs-params">(IterT&amp; iter, DistT d)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span>(åˆ¤æ–­iteræ˜¯å¦æ˜¯éšæœºè¯»å†™è¿­ä»£å™¨) &#123;<br>        iter += d;<br>    &#125; <br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(åˆ¤æ–­iteræ˜¯å¦æ˜¯åŒå‘è¯»å†™è¿­ä»£å™¨) &#123;<br>        <span class="hljs-keyword">if</span> (d &gt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">while</span> (d--) ++iter;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">while</span> (d++) --iter;<br>        &#125;<br>    &#125; <br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(åˆ¤æ–­iteræ˜¯å¦æ˜¯è¿­ä»£å™¨) &#123;<br>        <span class="hljs-keyword">if</span> (d &lt; <span class="hljs-number">0</span>) &#123;  <span class="hljs-comment">// åå‘æ˜¯è¿è§„çš„</span><br>            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">out_of_range</span>(<span class="hljs-string">&quot;Negative distance not supported for input iterators.&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">while</span> (d--) ++iter;<br>    &#125; <br>&#125;<br></code></pre></td></tr></table></figure><p>å½“ç„¶è¿™åªæ˜¯æˆ‘ä»¬çš„å¹»æƒ³, ç›´æ¥åˆ¤æ–­è¿­ä»£å™¨ç±»å‹è¿™ç§æŠ€æœ¯åœ¨C++17æ‰å‡ºç°, æˆ‘ä»¬åœ¨åé¢ä¹Ÿä¼šè®²è§£, ä½†æ˜¯æˆ‘ä»¬å…ˆçœ‹çœ‹å‰äººæ˜¯å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜çš„.</p><p>è§£å†³æ–¹æ³•è‡ªç„¶å°±æ˜¯ç”¨<strong>èƒå–å™¨</strong>äº†, æˆ‘ä»¬å…ˆè¦çŸ¥é“èƒå–å™¨è¦åšåˆ°ä»€ä¹ˆ, åœ¨æœ¬ä¾‹ä¸­å°±æ˜¯<strong>ä»è¿­ä»£å™¨ç±»å‹IterTä¸­å¾—åˆ°è¿­ä»£å™¨çš„ç±»åˆ«</strong>, è¿™é‡Œä¸è¦æ··æ·†äº†, è¿­ä»£å™¨ç±»å‹æ˜¯ä¸“å±äºæŸäº›å¤§ç±»çš„è¿­ä»£å™¨(å¦‚vector, dequeçš„iterator), è¿­ä»£å™¨ç±»åˆ«å°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´çš„äº”ç§ç±»åˆ«, ä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦ä»è¿­ä»£å™¨ç±»å‹ä¸­æå–å‡ºçš„ä¸œè¥¿. </p><p>é‡ç‚¹åœ¨äºå¦‚ä½•æå–å‡ºæ¥, å®é™…è¿‡ç¨‹éå¸¸å¤æ‚, ä½†åˆç¼ºä¸€ä¸å¯, æˆ‘åœ¨è¿™é‡Œç»è¿‡æ€»ç»“å°†å…¶åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† : å‡†å¤‡é˜¶æ®µå’Œä½¿ç”¨é˜¶æ®µ.</p><hr><h3 id="å‡†å¤‡é˜¶æ®µ"><a href="#å‡†å¤‡é˜¶æ®µ" class="headerlink" title="å‡†å¤‡é˜¶æ®µ"></a>å‡†å¤‡é˜¶æ®µ</h3><p>åœ¨è¿™ä¸€é˜¶æ®µ, æˆ‘ä»¬éœ€è¦åšçš„å·¥ä½œæœ‰ : </p><ul><li><p><strong>ä¸ºéœ€è¦æå–å‡ºç›¸å…³ä¿¡æ¯çš„è¿­ä»£å™¨é…ç½®å¯¹åº”çš„æ ‡ç­¾</strong>.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt; ... &gt;                  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">deque</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-keyword">class</span> <span class="hljs-title class_">iterator</span> &#123;<br>  <span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">typedef</span> random_access_iterator_tag iterator_category;  <span class="hljs-comment">// è¿™é‡Œä¾¿é…ç½®äº†éœ€è¦çš„æ ‡ç­¾</span><br>    ...<br>  &#125;:<br>&#125;;<br></code></pre></td></tr></table></figure><p>æœ¬ä¾‹ä¸­æˆ‘ä»¬å¯¹deque(åŒç«¯é˜Ÿåˆ—)çš„è¿­ä»£å™¨è¿›è¡Œæ“ä½œ, ä½¿ç”¨typedefå¯¹å…¶<code>iterator_category(è¿­ä»£å™¨ç±»åˆ«)</code>è¿›è¡Œäº†å£°æ˜, è¿™å…¶å®å°±æ˜¯åœ¨è¯´æ˜dequeçš„è¿­ä»£å™¨æ˜¯å¯ä»¥éšæœºè¯»å†™çš„.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt; ... &gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">list</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-keyword">class</span> <span class="hljs-title class_">iterator</span> &#123;<br>  <span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">typedef</span> bidirectional_iterator_tag iterator_category;<br>    ...<br>  &#125;:<br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>åœ¨listä¸­ä¹Ÿæ˜¯å¦‚æ­¤, listä¸æ”¯æŒéšæœºè¯»å†™, åªèƒ½åŒå‘è¯»å†™, å› æ­¤å®ƒå£°æ˜çš„æ˜¯<code>bidirectional_iterator_tag</code>.</p></li><li><p><strong>å‡†å¤‡ä¸€ä¸ªèƒå–å™¨ç±», ä½¿å…¶å¯ä»¥æå–å‡ºè¿­ä»£å™¨ä¸­çš„å¯¹åº”æ ‡ç­¾.</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> IterT&gt;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">iterator_traits</span> &#123;<br>  <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> IterT::iterator_category iterator_category;<br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>æå–çš„åŸç†å…¶å®å¾ˆç®€å•, è¿™é‡Œéœ€è¦èƒå–å™¨ç±»å’Œè¢«èƒå–ç±»æœ‰ä¸€ä¸ª<strong>å…±è¯†</strong>, <strong>ä»£è¡¨è¿­ä»£å™¨ç±»åˆ«çš„æ ‡ç­¾åä¸º<code>iterator_category</code></strong>, è¿™æ ·åªè¦å‘èƒå–å™¨ç±»ä¸­ä¼ å…¥ä¸€ä¸ªè¿­ä»£å™¨ç±»å‹, å°±å¯ä»¥é€šè¿‡<code>typedef typename IterT::iterator_category iterator_category;</code>è¿™æ®µä»£ç å°†åŸæœ¬è¿­ä»£å™¨ç±»å‹ä¸­çš„<code>iterator_category</code>, èµ‹ç»™è‡ªå·±çš„<code>iterator_category</code>, è¿™æ ·å°±å®ç°äº†è¿­ä»£å™¨ç±»åˆ«çš„æå–.</p><p>å½“ç„¶æˆ‘ä»¬å¯ä»¥å‘ç°è¿™ç§èƒå–å™¨åªå¯¹typedefäº†<code>iterator_category</code>çš„è‡ªå®šä¹‰ç±»å‹ç”Ÿæ•ˆ, ä½†åœ¨å®é™…ä½¿ç”¨ä¸­æ™®é€šæŒ‡é’ˆä¹Ÿæ˜¯ç±»ä¼¼è¿­ä»£å™¨çš„å½¢å¼, ä¾‹å¦‚æ™®é€šæ•°ç»„<code>int* arr</code>, è¿™é‡Œint*å°±å¯ä»¥å½“ä½œæ˜¯ä¸€ç§æŒ‡é’ˆè¿­ä»£å™¨ç±», å®ƒä¹Ÿå¯ä»¥åšåˆ°éšæœºè¯»å†™è®¿é—®. å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡æ¿çš„åç‰¹åŒ–, ä½¿å…¶å…¼å®¹æŒ‡é’ˆè¿­ä»£å™¨ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> IterT&gt;  <br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">iterator_traits</span>&lt;IterT*&gt;   <span class="hljs-comment">// æ¨¡æ¿åç‰¹åŒ–</span><br>&#123;<br>  <span class="hljs-keyword">typedef</span> random_access_iterator_tag iterator_category; <span class="hljs-comment">// ç›´æ¥è®¾ç½®æ™®é€šæŒ‡é’ˆçš„è¿­ä»£å™¨ç±»å‹ä¸ºéšæœºè¯»å†™è¿­ä»£å™¨</span><br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure></li></ul><hr><h3 id="ä½¿ç”¨é˜¶æ®µ"><a href="#ä½¿ç”¨é˜¶æ®µ" class="headerlink" title="ä½¿ç”¨é˜¶æ®µ"></a>ä½¿ç”¨é˜¶æ®µ</h3><p>åœ¨å‡†å¤‡é˜¶æ®µåšå‡ºäº†èƒå–å™¨å, æˆ‘ä»¬å°†è¦é€šè¿‡åœ¨advanceå‡½æ•°ä¸­ä½¿ç”¨èƒå–å™¨æ¥è¾¾åˆ°æˆ‘ä»¬åŸå…ˆå¸Œæœ›çš„æ•ˆæœ, ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ : </p><ul><li>å»ºç«‹ä¸€ä¸ªæ§åˆ¶å‡½æ•°, ä¾æ—§æ˜¯æ¥å—è¿­ä»£å™¨å’Œè·ç¦».</li><li>å»ºç«‹ä¸€ç»„ç‰¹åŒ–å‡½æ•°, é™¤äº†æ¥æ”¶è¿­ä»£å™¨, è·ç¦», è¿˜æœ‰è¿­ä»£å™¨ç±»å‹.</li><li>åœ¨æ§åˆ¶å‡½æ•°ä¸­åˆ©ç”¨èƒå–å™¨èƒå–å‡ºè¿­ä»£å™¨ç±»åˆ«, å°†è¿­ä»£å™¨ç±»åˆ«ä¼ å…¥ç‰¹åŒ–å‡½æ•°.</li><li>ä¾é <strong>é‡è½½è§£æ</strong>æœºåˆ¶, å°†è°ƒç”¨å¯¹åº”è¿­ä»£å™¨ç±»å‹çš„ç‰¹åŒ–å‡½æ•°.</li></ul><p>å…‰çœ‹æ¯”è¾ƒéš¾ä»¥ç†è§£, æˆ‘ä»¬é€šè¿‡ä»£ç æ¥åˆ†æ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">//-------------ç‰¹åŒ–å‡½æ•°-------------//</span><br><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> IterT, <span class="hljs-keyword">typename</span> DistT&gt;              </span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">doAdvance</span><span class="hljs-params">(IterT&amp; iter, DistT d,                  </span></span><br><span class="hljs-params"><span class="hljs-function">               std::random_access_iterator_tag)</span>    <span class="hljs-comment">// é’ˆå¯¹:random_access_iteratorçš„ç‰¹åŒ–ç‰ˆæœ¬</span></span><br><span class="hljs-function"></span>&#123;<br>  iter += d;   <span class="hljs-comment">// ç›´æ¥+=</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> IterT, <span class="hljs-keyword">typename</span> DistT&gt;              </span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">doAdvance</span><span class="hljs-params">(IterT&amp; iter, DistT d,                  </span></span><br><span class="hljs-params"><span class="hljs-function">               std::bidirectional_iterator_tag)</span>    <span class="hljs-comment">// é’ˆå¯¹bidirectional_iteratorçš„ç‰¹åŒ–ç‰ˆæœ¬</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span> (d &gt;= <span class="hljs-number">0</span>) &#123; <span class="hljs-keyword">while</span> (d--) ++iter; &#125;     <br>  <span class="hljs-keyword">else</span> &#123; <span class="hljs-keyword">while</span> (d++) --iter;&#125;       <span class="hljs-comment">// å¯é€æ¬¡++/--</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> IterT, <span class="hljs-keyword">typename</span> DistT&gt;              </span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">doAdvance</span><span class="hljs-params">(IterT&amp; iter, DistT d,                  </span></span><br><span class="hljs-params"><span class="hljs-function">               std::input_iterator_tag)</span>   <span class="hljs-comment">// é’ˆå¯¹input_iteratorçš„ç‰¹åŒ–ç‰ˆæœ¬</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span> (d &lt; <span class="hljs-number">0</span> ) &#123;<br>     <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">out_of_range</span>(<span class="hljs-string">&quot;Negative distance&quot;</span>);    <br>  &#125;<br>  <span class="hljs-keyword">while</span> (d--) ++iter;   <span class="hljs-comment">// åªå¯é€æ¬¡++</span><br>&#125;<br><br><span class="hljs-comment">//-------------æ§åˆ¶å‡½æ•°-------------//</span><br><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> IterT, <span class="hljs-keyword">typename</span> DistT&gt;</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">advance</span><span class="hljs-params">(IterT&amp; iter, DistT d)</span>           <span class="hljs-comment">// æ§åˆ¶å‡½æ•°</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-comment">// è°ƒç”¨ç‰¹åŒ–å‡½æ•°  </span><br>  <span class="hljs-built_in">doAdvance</span>(iter, d,                                              <br>    <span class="hljs-keyword">typename</span> std::iterator_traits&lt;IterT&gt;::<span class="hljs-built_in">iterator_category</span>()); <span class="hljs-comment">// è¿™é‡Œæ˜¯æœ€é‡ç‚¹çš„åœ°æ–¹                       </span><br>&#125;   <br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆèšç„¦äºæ§åˆ¶å‡½æ•°, è°ƒç”¨ç‰¹åŒ–å‡½æ•°åº”è¯¥éƒ½èƒ½ç†è§£, é‡ç‚¹åœ¨äº : </p><ul><li><strong>typename std::iterator_traits<IterT>::iterator_category()</strong></li></ul><p>è¿™æ˜¯<strong>ç‰¹åŒ–å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°</strong>, è¿™æ®µä»£ç å¦‚ä½•ç†è§£?</p><ul><li><p>å…¶ä¸­<code>typename</code>æ˜¯ä¸ºäº†é˜²æ­¢ç¼–è¯‘å™¨æ··æ·†, ç¡®å®šåé¢çš„æ˜¯ä¸€ä¸ªç±»å‹(è§æ¡æ¬¾42).</p></li><li><p><code>typename std::iterator_traits&lt;IterT&gt;::iterator_category</code>æ˜¯ä¸€ä¸ªç±»å‹, <strong>ä»£è¡¨<code>iterator_traits</code>ä»<code>IterT</code>ä¸­å–å‡ºçš„è¿­ä»£å™¨ç±»åˆ«çš„ç±»å‹</strong>.</p></li><li><p>åé¢åŠ ä¸Š**()**, ä»£è¡¨è¿™æ˜¯ä¸€ä¸ªåŒ¿åå˜é‡, è¿™ä¸ªå‚æ•°æœ¬èº«æ²¡æœ‰ä»»ä½•ç”¨å¤„, æ‰€ä»¥ä½¿ç”¨åŒ¿åå˜é‡å®Œå…¨å¯è¡Œ, <strong>å…¶ä½œç”¨åªåœ¨äºä¼ é€’ä¸€ä¸ªç±»å‹, è§¦å‘å†…éƒ¨çš„é‡è½½æœºåˆ¶, é€‰æ‹©åˆ°æ­£ç¡®çš„ç‰¹åŒ–ç‰ˆæœ¬</strong>.</p></li></ul><p>å†å»åˆ†æç‰¹åŒ–å‡½æ•°, ä¸Šé¢ç»™å‡ºäº†ä¸‰ä¸ªç‰ˆæœ¬, <strong>ç¬¬ä¸‰ä¸ªå‚æ•°çš„ç±»å‹åˆ†åˆ«æ˜¯å¯¹åº”çš„è¿­ä»£å™¨ç±»åˆ«</strong>, è¿™é‡Œè¿å‚æ•°éƒ½æ²¡å†™åœ¨è¯­æ³•ä¸Šæ˜¯å¯è¡Œçš„, å› ä¸ºç¡®å®ä¸ä¼šç”¨åˆ°, æ²¡æœ‰å†™çš„å¿…è¦. è¿™é‡Œè¦å¼ºè°ƒçš„ä¸€ç‚¹æ˜¯è™½ç„¶æ²¡æœ‰<code>forward_iterator</code>çš„ç‰ˆæœ¬, ä½†æ˜¯å› ä¸ºå…¶å’Œ<code>input_iterator</code>çš„æ“ä½œå®è´¨ä¸Šæ˜¯ä¸€æ ·çš„, è¿™é‡Œä¼šç›´æ¥é€šè¿‡<strong>ç»§æ‰¿</strong>è°ƒç”¨åˆ°å…¶åŸºç±»<code>input_iterator</code>çš„ä»£ç , å› æ­¤ä¸éœ€è¦å¤šå†™.</p><hr><h3 id="ç°ä»£C-ä¸­èƒå–å™¨çš„ä½¿ç”¨æ–¹å¼"><a href="#ç°ä»£C-ä¸­èƒå–å™¨çš„ä½¿ç”¨æ–¹å¼" class="headerlink" title="ç°ä»£C++ä¸­èƒå–å™¨çš„ä½¿ç”¨æ–¹å¼"></a>ç°ä»£C++ä¸­èƒå–å™¨çš„ä½¿ç”¨æ–¹å¼</h3><p>å…ˆå‰æˆ‘ä»¬ä»‹ç»çš„ä½¿ç”¨æ–¹å¼æ˜¯<strong>åŸºäºé‡è½½æœºåˆ¶</strong>, å®ç°åœ¨ç¼–è¯‘æœŸå³å¯é€šè¿‡ä¸åŒçš„è¿­ä»£å™¨ç±»åˆ«é€‰å–ä¸åŒçš„ç‰¹åŒ–ç‰ˆadvance.</p><p>ä¸€åˆ‡çš„æ ¹æœ¬ç›®çš„å°±æ˜¯ä¸ºäº†<strong>åœ¨ç¼–è¯‘æœŸå®ç°æ¡ä»¶é€‰æ‹©</strong>, ç°åœ¨C++17ä¸­å¼•å…¥äº†<code>if constexpr</code>è¯­æ³•, ä½¿å¾—æˆ‘ä»¬å¯ä»¥ç”¨ç±»ä¼¼ifçš„è¯­å¥å®ç°ç¼–è¯‘å™¨çš„æ¡ä»¶é€‰æ‹©, å°±ä¸éœ€è¦å†ä½¿ç”¨é‡è½½äº† : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">advance</span><span class="hljs-params">(IterT&amp; iter, DistT d)</span> </span>&#123;<br>    <span class="hljs-keyword">using</span> category = <span class="hljs-keyword">typename</span> std::iterator_traits&lt;IterT&gt;::iterator_category; <span class="hljs-comment">// è¿˜æ˜¯è¦å…ˆèƒå–å‡ºè¿­ä»£å™¨ç±»åˆ«</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">if</span> <span class="hljs-title">constexpr</span> <span class="hljs-params">(std::is_same_v&lt;category, std::random_access_iterator_tag&gt;)</span> </span>&#123;<br>        iter += d;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-built_in">constexpr</span> (std::is_same_v&lt;category, std::bidirectional_iterator_tag&gt;) &#123;<br>        <span class="hljs-keyword">if</span> (d &gt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">while</span> (d--) ++iter;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">while</span> (d++) --iter;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-built_in">constexpr</span> (std::is_same_v&lt;category, std::input_iterator_tag&gt;) &#123;<br>        <span class="hljs-keyword">if</span> (d &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">out_of_range</span>(<span class="hljs-string">&quot;Negative distance not supported for input iterators.&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">while</span> (d--) ++iter;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œé€šè¿‡æ ‡å‡†åº“å†…ç½®çš„<code>is_same_v</code>æ¥åˆ¤æ–­ä¸¤ä¸ªç±»åˆ«æ˜¯å¦ç›¸ç­‰, å…¶ä»–å‡å’Œæ™®é€šifè¯­å¥çš„æ“ä½œä¸€è‡´.</p><hr><h3 id="æ›´å¤šç±»å‹ä¿¡æ¯å¯ä¾›æå–"><a href="#æ›´å¤šç±»å‹ä¿¡æ¯å¯ä¾›æå–" class="headerlink" title="æ›´å¤šç±»å‹ä¿¡æ¯å¯ä¾›æå–"></a>æ›´å¤šç±»å‹ä¿¡æ¯å¯ä¾›æå–</h3><p>åœ¨æœ¬æ¡æ¬¾ä¸­åªé’ˆå¯¹<code>iterator_category</code>è¿›è¡Œäº†æå–, ä½†æ˜¯äº‹å®ä¸Šèƒå–å™¨å¯ä»¥æå–å‡ºæ›´å¤šçš„ç±»å‹ä¿¡æ¯, åœ¨<em>STLæºç å‰–æ</em>ä¸­ä¸»è¦æå‡ºäº†äº”ç§ä¿¡æ¯, åˆ†åˆ«æ˜¯ : value_type(è¿­ä»£å™¨æ‰€æŒ‡å¯¹è±¡çš„ç±»å‹), difference_type(ä¸¤ä¸ªè¿­ä»£å™¨ä¹‹é—´çš„è·ç¦»ç±»å‹), reference_type(è¿­ä»£å™¨æ‰€æŒ‡å¯¹è±¡çš„ç±»å‹çš„å¼•ç”¨), pointer_type(è¿­ä»£å™¨æ‰€æŒ‡å¯¹è±¡çš„ç±»å‹çš„æŒ‡é’ˆ), iterator_category(è¿­ä»£å™¨ç±»åˆ«).</p><p>è¿™é‡Œ<code>value_type</code>å°¤ä¸ºå¸¸ç”¨, åƒä¸Šæ–‡ä¸€æ ·æ—¢ç„¶å¯ä»¥é€šè¿‡<code>iterator_category</code>æ¥é€‰å–ä¸åŒç‰ˆæœ¬çš„ä»£ç , é‚£ä¹ˆä¹Ÿå¯ä»¥æ ¹æ®<code>value_type</code>(å¯¹è±¡ç±»å‹)æ¥é€‰å–ä¸åŒç‰ˆæœ¬çš„ä»£ç , æ‰€ä»¥è¯´èƒå–å™¨æä¾›äº†éå¸¸çµæ´»å¤šæ ·çš„ç¼–è¯‘æœŸæ¡ä»¶é€‰å–æ–¹å¼.</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>å¯ä»¥ä½¿ç”¨èƒå–å™¨æŠ€æœ¯æå–å‡ºæ¨¡æ¿ç±»å‹ä¸­çš„ç±»å‹ä¿¡æ¯, åˆ©ç”¨é‡è½½æˆ–C++17ä¸­çš„<code>if constexpr</code>å®ç°ç¼–è¯‘æœŸçš„æ¡ä»¶é€‰æ‹©.</li><li>å®ç°èƒå–éœ€è¦åŒæ–¹çº¦å®šç›¸åŒçš„ç±»å‹ä¿¡æ¯åç§°.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
      <tag>æ¨¡æ¿</tag>
      
      <tag>èƒå–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾46 å‹å…ƒéæˆå‘˜å‡½æ•°</title>
    <link href="/2025/01/14/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE46%20%E5%8F%8B%E5%85%83%E9%9D%9E%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0/"/>
    <url>/2025/01/14/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE46%20%E5%8F%8B%E5%85%83%E9%9D%9E%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾46-éœ€è¦ç±»å‹è½¬æ¢æ—¶è¯·ä¸ºæ¨¡æ¿å®šä¹‰å‹å…ƒéæˆå‘˜å‡½æ•°"><a href="#æ¡æ¬¾46-éœ€è¦ç±»å‹è½¬æ¢æ—¶è¯·ä¸ºæ¨¡æ¿å®šä¹‰å‹å…ƒéæˆå‘˜å‡½æ•°" class="headerlink" title="æ¡æ¬¾46 : éœ€è¦ç±»å‹è½¬æ¢æ—¶è¯·ä¸ºæ¨¡æ¿å®šä¹‰å‹å…ƒéæˆå‘˜å‡½æ•°"></a>æ¡æ¬¾46 : éœ€è¦ç±»å‹è½¬æ¢æ—¶è¯·ä¸ºæ¨¡æ¿å®šä¹‰å‹å…ƒéæˆå‘˜å‡½æ•°</h2><blockquote><p>æœ¬æ¡æ¬¾æ˜¯æ¡æ¬¾24çš„å»¶ç”³è®¨è®º, åœ¨å¼•å…¥æ¨¡æ¿çš„å‰æä¸‹, å¦‚æœæˆ‘ä»¬æƒ³å®ç°æŸäº›éšå¼ç±»å‹è½¬æ¢çš„æ“ä½œ, ä¼šéœ€è¦æ¯”ä»¥å¾€å¤šä¸€äº›é¢å¤–çš„æ“ä½œ, è®©æˆ‘ä»¬é€šè¿‡æœ¬æ¡æ¬¾æ¥ç†è§£.</p></blockquote><h3 id="å‰æå¼•å…¥"><a href="#å‰æå¼•å…¥" class="headerlink" title="å‰æå¼•å…¥"></a>å‰æå¼•å…¥</h3><p>è¿˜è®°å¾—æ¡æ¬¾24ä¸­çš„<code>Rational</code>å—, è¿™æ˜¯ä¸€ä¸ªæœ‰ç†æ•°ç±», å†…éƒ¨åŒ…å«åˆ†å­å’Œåˆ†æ¯, å¯ä»¥ç”±intéšå¼è½¬æ¢è€Œæ¥, å½“æ—¶æ¡æ¬¾24ä¸­è®¨è®ºçš„æ ¸å¿ƒæ˜¯å¦‚ä½•è®©<code>Rational</code>æ”¯æŒæ··åˆè¿ç®—, å°±åƒä¸‹é¢è¿™æ · : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">Rational <span class="hljs-title">oneHalf</span><span class="hljs-params">(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)</span></span>;<br>Rational result;          <br>result = oneHalf * <span class="hljs-number">2</span>;                 <br>result = <span class="hljs-number">2</span> * oneHalf;   <span class="hljs-comment">// æ··åˆç±»å‹çš„ä¹˜æ³•è¿ç®—                          </span><br></code></pre></td></tr></table></figure><p>æ²¡æœ‰äº†è§£çš„å¯ä»¥çœ‹æˆ‘å¾€æœŸçš„åšå®¢, æ€»ä¹‹è®¨è®ºæœ€åçš„ç»“æœå°±æ˜¯<code>operator*é‡è½½</code>ä¸å¯ä»¥æ˜¯æˆå‘˜å‡½æ•°(å› ä¸ºæœ‰thisæŒ‡é’ˆå¹²æ‰°), è¦ä½¿ç”¨éæˆå‘˜å‡½æ•° : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rational</span> &#123;<br>  ... <br>&#125;;<br><br><span class="hljs-type">const</span> Rational <span class="hljs-keyword">operator</span>*(<span class="hljs-type">const</span> Rational&amp; lhs,     <span class="hljs-comment">// non-member</span><br>                         <span class="hljs-type">const</span> Rational&amp; rhs) <br>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Rational</span>(lhs.<span class="hljs-built_in">numerator</span>() * rhs.<span class="hljs-built_in">numerator</span>(),<br>                  lhs.<span class="hljs-built_in">denominator</span>() * rhs.<span class="hljs-built_in">denominator</span>());<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³å†™ä¸€ä¸ªæ³›å‹çš„<code>Rational</code>, æˆ‘ä»¬ä¼šå¾ˆè‡ªç„¶åœ°å†™å‡ºä¸‹é¢çš„ç‰ˆæœ¬ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rational</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-built_in">Rational</span>(<span class="hljs-type">const</span> T&amp; numerator = <span class="hljs-number">0</span>,     <br>           <span class="hljs-type">const</span> T&amp; denominator = <span class="hljs-number">1</span>);  <span class="hljs-comment">// è¿™ä¸ªæ„é€ å‡½æ•°å…è®¸éšå¼ç±»å‹è½¬æ¢</span><br><br>  <span class="hljs-function"><span class="hljs-type">const</span> T <span class="hljs-title">numerator</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;           <br>  <span class="hljs-function"><span class="hljs-type">const</span> T <span class="hljs-title">denominator</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;         <br>&#125;;<br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-type">const</span> Rational&lt;T&gt; <span class="hljs-keyword">operator</span>*(<span class="hljs-type">const</span> Rational&lt;T&gt;&amp; lhs,<br>                            <span class="hljs-type">const</span> Rational&lt;T&gt;&amp; rhs)<br>&#123; ... &#125;<br></code></pre></td></tr></table></figure><p>ä½†å¾ˆå¯æƒœ, å½“æˆ‘ä»¬å†™å‡º<code>result = oneHalf * 2;</code>è¿™æ ·çš„è¯­å¥æ—¶æ ¹æœ¬æ— æ³•é€šè¿‡ç¼–è¯‘, å…¶æœ¬è´¨é—®é¢˜åœ¨äº<strong>templateçš„å®å‚æ¨å¯¼å‡ºäº†é—®é¢˜</strong>, å› ä¸º<strong>templateå®å‚æ¨å¯¼è¿‡ç¨‹ä¸­ä¸å°†éšå¼ç±»å‹è½¬æ¢çº³å…¥è€ƒè™‘</strong>, 2ä¸èƒ½å†åƒæ¡æ¬¾24ä¸­ä¸€æ ·ä»intéšå¼è½¬æ¢ä¸º<code>Rationa</code>, ç¼–è¯‘å™¨åªèƒ½è¯•å›¾ä»intä¸­æå–å‡ºT, ä½†è¿™æ˜¾ç„¶æ˜¯ä¸è¡Œçš„, æ‰€ä»¥åªèƒ½ç¼–è¯‘å¤±è´¥.</p><hr><h3 id="ç±»å†…å®šä¹‰å‹å…ƒå‡½æ•°"><a href="#ç±»å†…å®šä¹‰å‹å…ƒå‡½æ•°" class="headerlink" title="ç±»å†…å®šä¹‰å‹å…ƒå‡½æ•°"></a>ç±»å†…å®šä¹‰å‹å…ƒå‡½æ•°</h3><p>ä¹¦ä¸­æŒ‡å‡ºäº†è§£å†³æ–¹æ³• : </p><ul><li><strong>å°†è¿™ä¸ªéæˆå‘˜å‡½æ•°å£°æ˜ä¸ºå‹å…ƒ.</strong></li></ul><p>æˆ‘ä»¬åœ¨è¿™é‡Œå£°æ˜å‹å…ƒä¸æ˜¯ä¸ºäº†è®¿é—®<code>Rational</code>ä¸­çš„<code>non-public</code>æˆåˆ†, ä»…ä»…åªæ˜¯ä¸ºäº†<strong>åœ¨ç±»å†…éƒ¨å£°æ˜ä¸€ä¸ªéæˆå‘˜å‡½æ•°</strong>, è¿™æ ·åœ¨ç¼–è¯‘æ—¶<strong>è¿™ä¸ªéæˆå‘˜å‡½æ•°å°±ä¼šæå‰çŸ¥é“Tæ˜¯ä»€ä¹ˆç±»å‹</strong>, è€Œä¸éœ€è¦å†é€šè¿‡templateå®å‚æ¨å¯¼å‡º, å‰é¢çš„é—®é¢˜å°±è¿åˆƒè€Œè§£äº†, ä¸‹é¢æ˜¯æ–°ä¸€ç‰ˆä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rational</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">// å£°æ˜å‹å…ƒæ¨¡æ¿å‡½æ•°</span><br>    <span class="hljs-keyword">typename</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">friend</span> <span class="hljs-type">const</span> Rational&lt;T&gt; <span class="hljs-keyword">operator</span>*(<span class="hljs-type">const</span> Rational&lt;T&gt;&amp; lhs, <span class="hljs-type">const</span> Rational&lt;T&gt;&amp; rhs); <br>    ...<br>&#125;;<br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;                                <br><span class="hljs-type">const</span> Rational&lt;T&gt; <span class="hljs-keyword">operator</span>*(<span class="hljs-type">const</span> Rational&lt;T&gt;&amp; lhs, <span class="hljs-type">const</span> Rational&lt;T&gt;&amp; rhs)&#123; <br><span class="hljs-keyword">return</span> <span class="hljs-built_in">Rational</span>&lt;T&gt;(lhs.<span class="hljs-built_in">numerator</span>() * rhs.<span class="hljs-built_in">numerator</span>(),<br>                  lhs.<span class="hljs-built_in">denominator</span>() * rhs.<span class="hljs-built_in">denominator</span>());<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªä»£ç åœ¨éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯å¯ä»¥è¿è¡Œçš„, ä¹Ÿå°±æ˜¯å‚æ•°ç±»å‹éƒ½æ˜¯<code>Rational&lt;T&gt;</code>çš„æƒ…å†µä¸‹, å½¢å¦‚ <code>result = oneHalf * 2;</code>è¿™æ ·çš„è¯­å¥ä¾æ—§æ— æ³•é€šè¿‡ç¼–è¯‘, å› ä¸º<strong>è¿˜æ˜¯æ— æ³•è¿›è¡Œéšå¼è½¬æ¢</strong>! æˆ‘ä»¬çŸ¥é“Rationalçš„éšå¼è½¬æ¢æ˜¯é€šè¿‡å…¶æ„é€ å‡½æ•°å®ç°çš„, ä½†æ˜¯å½“å‰æƒ…å†µæ˜¯<code>operator*é‡è½½</code>è¢«å®šä¹‰åœ¨ç±»å¤–, ç”±äºtemplateçš„å­˜åœ¨, <code>Rational</code>å’Œè¯¥å‡½æ•°æ²¡æœ‰ä»»ä½•è”ç³», è¯¥å‡½æ•°è‡ªç„¶ä¸èƒ½çŸ¥é“<code>Rational</code>çš„æ„é€ å‡½æ•°, å› æ­¤æ— æ³•è¿›è¡Œéšå¼è½¬æ¢.</p><p>è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å• : </p><ul><li><strong>åœ¨ç±»å†…å®šä¹‰å‹å…ƒå‡½æ•°</strong>.</li></ul><p>è¿™ç§åšæ³•çš„æœ¬è´¨æ˜¯<strong>é€šè¿‡å‹å…ƒæŠŠä¸€ä¸ªéæˆå‘˜å‡½æ•°æ¬åˆ°äº†ç±»å†…, åœ¨ç±»å†…æ¥è§¦åˆ°æ„é€ å‡½æ•°ä½¿ä¹‹å¯ä»¥éšå¼ç±»å‹è½¬æ¢</strong>. ä»£ç å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rational</span> &#123;<br><span class="hljs-keyword">public</span>:<br><span class="hljs-keyword">friend</span> <span class="hljs-type">const</span> Rational&lt;T&gt; <span class="hljs-keyword">operator</span>*(<span class="hljs-type">const</span> Rational&lt;T&gt;&amp; lhs, <span class="hljs-type">const</span> Rational&lt;T&gt;&amp; rhs)<br>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Rational</span>&lt;T&gt;(lhs.<span class="hljs-built_in">numerator</span>() * rhs.<span class="hljs-built_in">numerator</span>(),      <br>                  lhs.<span class="hljs-built_in">denominator</span>() * rhs.<span class="hljs-built_in">denominator</span>());  <br>&#125;    <br>    ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™æ ·ä»£ç å°±å¯ä»¥æ­£å¸¸è¿è¡Œäº†, æ··åˆç±»å‹çš„è¿ç®—ä¹Ÿå¯ä»¥åº”å¯¹!</p><p>å¦å¤–, ä¹¦ä¸­æå‡º : </p><ul><li><strong>åœ¨ä¸€ä¸ªclass templateå†…, templateåç§°å¯è¢«ç”¨æ¥ä½œä¸ºâ€templateå’Œå…¶å‚æ•°â€çš„ç®€å†™</strong>.</li></ul><p>ç®€å•æ¥è¯´å°±æ˜¯<code>Rational&lt;T&gt;</code>å¯ä»¥ä¹‹é—´è¢«æ›¿æ¢ä¸º<code>Rational</code>, ä»…é™æ¨¡æ¿ç±»å†… : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rational</span> &#123;<br><span class="hljs-keyword">public</span>:<br><span class="hljs-keyword">friend</span> <span class="hljs-type">const</span> Rational <span class="hljs-keyword">operator</span>*(<span class="hljs-type">const</span> Rational&amp; lhs, <span class="hljs-type">const</span> Rational&amp; rhs)<br>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Rational</span>(lhs.<span class="hljs-built_in">numerator</span>() * rhs.<span class="hljs-built_in">numerator</span>(),      <br>                  lhs.<span class="hljs-built_in">denominator</span>() * rhs.<span class="hljs-built_in">denominator</span>());  <br>&#125;   <br>    ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™ä¾¿æ˜¯æœ€ç®€å•å¯ä»¥è¾¾åˆ°ç›®çš„çš„ç‰ˆæœ¬äº†!</p><hr><h3 id="ä»¤friendå‡½æ•°è°ƒç”¨è¾…åŠ©å‡½æ•°"><a href="#ä»¤friendå‡½æ•°è°ƒç”¨è¾…åŠ©å‡½æ•°" class="headerlink" title="ä»¤friendå‡½æ•°è°ƒç”¨è¾…åŠ©å‡½æ•°"></a>ä»¤friendå‡½æ•°è°ƒç”¨è¾…åŠ©å‡½æ•°</h3><p>åœ¨æ­¤åŸºç¡€ä¸Š, ä½œè€…è¿˜æå‡ºäº†ä¸€ç‚¹ä¼˜åŒ–, å› ä¸ºæˆ‘ä»¬åœ¨æ¡æ¬¾30ä¸­è¯´è¿‡, friendå‡½æ•°ä¹Ÿä¼šè¢«åœ¨åº•å±‚åŒ–ä¸ºinlineå‡½æ•°, è¿™åœ¨å¯¹äºæœ¬ä¾‹ç¡®å®æ˜¯ä¼˜åŒ–, å› ä¸ºè¿™ä¸ªå‡½æ•°åªæœ‰ä¸€è¡Œ, ä½†æ˜¯å‡å¦‚è¿™ä¸ªå‡½æ•°å¾ˆé•¿å°±ä¼šå¸¦æ¥ä»£ç è†¨èƒ€çš„é—®é¢˜, äºæ˜¯æˆ‘ä»¬å¯ä»¥â€<strong>ä»¤friendå‡½æ•°è°ƒç”¨è¾…åŠ©å‡½æ•°</strong>â€œæ¥é¿å…è¿™ä¸€é—®é¢˜.</p><p>åœ¨æœ¬ä¾‹ä¸­ç¡®å®æ²¡ä»€ä¹ˆå¿…è¦, è¿™é‡Œåªæ˜¯ä¸¾ä¸ªä¾‹å­ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-keyword">class</span> <span class="hljs-title class_">Rational</span>;                                                                         <br><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;                                      </span><br><span class="hljs-function"><span class="hljs-type">const</span> Rational&lt;T&gt; <span class="hljs-title">doMultiply</span><span class="hljs-params">(<span class="hljs-type">const</span> Rational&lt;T&gt;&amp; lhs,      <span class="hljs-comment">// è¾…åŠ©å‡½æ•°, ä»£ç å¯ä»¥éå¸¸é•¿</span></span></span><br><span class="hljs-params"><span class="hljs-function">                             <span class="hljs-type">const</span> Rational&lt;T&gt;&amp; rhs)</span>     </span><br><span class="hljs-function"></span>&#123;                                                         <br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Rational</span>&lt;T&gt;(lhs.<span class="hljs-built_in">numerator</span>() * rhs.<span class="hljs-built_in">numerator</span>(),   <br>                     lhs.<span class="hljs-built_in">denominator</span>() * rhs.<span class="hljs-built_in">denominator</span>());<br>&#125;<br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rational</span> &#123;<br><span class="hljs-keyword">public</span>:<br><span class="hljs-keyword">friend</span><br>  <span class="hljs-type">const</span> Rational&lt;T&gt; <span class="hljs-keyword">operator</span>*(<span class="hljs-type">const</span> Rational&lt;T&gt;&amp; lhs,<br>                              <span class="hljs-type">const</span> Rational&lt;T&gt;&amp; rhs)   <br>  &#123; <span class="hljs-keyword">return</span> <span class="hljs-built_in">doMultiply</span>(lhs, rhs); &#125;                      <span class="hljs-comment">// è¿™é‡Œç›´æ¥åœ¨å‹å…ƒå‡½æ•°ä¸­è°ƒç”¨è¾…åŠ©å‡½æ•°</span><br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„ä»£ç éå¸¸å·§å¦™, æˆ‘ä»¬å¯ä»¥çŸ¥é“è¾…åŠ©å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªæ¨¡æ¿å‡½æ•°, åœ¨è¿™ä¸ªå‡½æ•°é‡Œæ˜¯æ— æ³•è¿›è¡Œéšå¼è½¬æ¢çš„, ä½†æ˜¯å®é™…æ•ˆæœä¾ç„¶å¯ä»¥éšå¼è½¬æ¢, å®ƒæ”¯æŒå„ç§æ··åˆè¿ç®—! å› ä¸ºæ‰€æœ‰çš„éšå¼è½¬æ¢éƒ½åœ¨<code>å‹å…ƒoperator*é‡è½½</code>ä¸­è¿›è¡Œ, åœ¨ä¼ ç»™è¾…åŠ©å‡½æ•°æ—¶ç±»å‹å·²ç»è½¬æ¢å®Œæ¯•!</p><hr><h3 id="é€»è¾‘æ¢³ç†"><a href="#é€»è¾‘æ¢³ç†" class="headerlink" title="é€»è¾‘æ¢³ç†"></a>é€»è¾‘æ¢³ç†</h3><p>æˆ‘ä»¬å¯ä»¥å†ç†ä¸€éé€»è¾‘, åœ¨å¼•å…¥æ¨¡æ¿çš„å‰æä¸‹ : </p><ul><li>ä¸ºäº†æ”¯æŒæ··åˆè¿ç®—, è¿ç®—ç¬¦é‡è½½å¿…é¡»æ˜¯éæˆå‘˜æ¨¡æ¿å‡½æ•°(æˆå‘˜æ¨¡æ¿å‡½æ•°æœ‰thiså¹²æ‰°).</li><li>éæˆå‘˜æ¨¡æ¿å‡½æ•°å®å‚æ¨å¯¼è¿‡ç¨‹ä¸­ä¸å°†éšå¼ç±»å‹è½¬æ¢çº³å…¥è€ƒè™‘.</li><li>å› æ­¤è¦å°†å…¶å£°æ˜å®šä¹‰åœ¨ç±»å†…, æœ¬è´¨æ˜¯éæˆå‘˜å‡½æ•°, ä¸ä½¿ç”¨æ¨¡æ¿ä½†è¾¾åˆ°æ¨¡æ¿ç±»ä¼¼çš„æ•ˆæœ.</li><li>å£°æ˜å‹å…ƒå¯ä»¥å®ç°ä¸Šè¿°çš„éœ€æ±‚.</li></ul><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>å½“æˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªæ¨¡æ¿ç±»çš„è¿ç®—å¯ä»¥æ”¯æŒâ€<strong>æ‰€æœ‰å‚æ•°ä¹‹éšå¼ç±»å‹è½¬æ¢</strong>â€œæ—¶, å°†é‚£äº›å‡½æ•°å®šä¹‰ä¸ºâ€<strong>class templateå†…éƒ¨çš„friendå‡½æ•°</strong>â€œ.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
      <tag>æ¨¡æ¿</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾45 è¿ç”¨æˆå‘˜å‡½æ•°æ¨¡æ¿æ¥å—æ‰€æœ‰å…¼å®¹ç±»å‹</title>
    <link href="/2025/01/13/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE45%20%E8%BF%90%E7%94%A8%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0%E6%A8%A1%E6%9D%BF%E6%8E%A5%E5%8F%97%E6%89%80%E6%9C%89%E5%85%BC%E5%AE%B9%E7%B1%BB%E5%9E%8B/"/>
    <url>/2025/01/13/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE45%20%E8%BF%90%E7%94%A8%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0%E6%A8%A1%E6%9D%BF%E6%8E%A5%E5%8F%97%E6%89%80%E6%9C%89%E5%85%BC%E5%AE%B9%E7%B1%BB%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾45-è¿ç”¨æˆå‘˜å‡½æ•°æ¨¡æ¿æ¥å—æ‰€æœ‰å…¼å®¹ç±»å‹"><a href="#æ¡æ¬¾45-è¿ç”¨æˆå‘˜å‡½æ•°æ¨¡æ¿æ¥å—æ‰€æœ‰å…¼å®¹ç±»å‹" class="headerlink" title="æ¡æ¬¾45 : è¿ç”¨æˆå‘˜å‡½æ•°æ¨¡æ¿æ¥å—æ‰€æœ‰å…¼å®¹ç±»å‹"></a>æ¡æ¬¾45 : è¿ç”¨æˆå‘˜å‡½æ•°æ¨¡æ¿æ¥å—æ‰€æœ‰å…¼å®¹ç±»å‹</h2><blockquote><p>æœ¬æ¡æ¬¾ä¸­æˆ‘ä»¬å°†ä¼šä»¥æ™ºèƒ½æŒ‡é’ˆä¸ºä¾‹, ä»‹ç»å¦‚ä½•é€šè¿‡æˆå‘˜å‡½æ•°æ¨¡æ¿ä½¿ä¸€ä¸ªæ¨¡æ¿ç±»å¯ä»¥æ¥å—æ‰€æœ‰å…¼å®¹ç±»å‹.</p></blockquote><p>æˆ‘ä»¬å…ˆæ¥æ„å»ºä¸€ä¸ªç®€å•çš„ç»§æ‰¿ä½“ç³» : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Top</span> &#123; ... &#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Middle</span>: <span class="hljs-keyword">public</span> Top &#123; ... &#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Bottom</span>: <span class="hljs-keyword">public</span> Middle &#123; ... &#125;;<br>Top *pt1 = <span class="hljs-keyword">new</span> Middle;                   <span class="hljs-comment">// Middle*éšå¼è½¬æ¢ä¸ºTop*</span><br>Top *pt2 = <span class="hljs-keyword">new</span> Bottom;                   <span class="hljs-comment">// Bottom*éšå¼è½¬æ¢ä¸ºTop*</span><br><span class="hljs-type">const</span> Top *pct2 = pt1;  <span class="hljs-comment">// Top*éšå¼è½¬æ¢ä¸ºconst Top*</span><br></code></pre></td></tr></table></figure><p>åœ¨æœ¬ä¾‹ä¸­, <code>Top</code>æ˜¯æœ€åˆå§‹çš„åŸºç±», ä¾æ¬¡æ´¾ç”Ÿå‡º<code>Middle</code>å’Œ<code>Bottom</code>, é€šè¿‡éšå¼è½¬æ¢, å„ç§æŒ‡é’ˆç±»å‹æ˜¯å¯ä»¥åˆç†åœ°è¿›è¡Œéšå¼è½¬æ¢çš„. ä½†å½“æˆ‘ä»¬æƒ³ç”¨æ™ºèƒ½æŒ‡é’ˆä»£è¡Œç®¡ç†äº‹åŠ¡æ—¶, å†æƒ³è¿™æ ·çš„è½¬æ¢å°±æ¯”è¾ƒéº»çƒ¦äº†, å½“ç„¶æ ‡å‡†åº“ä¸­çš„æ™ºèƒ½æŒ‡é’ˆå·²ç»è§£å†³äº†è¿™ç§é—®é¢˜, æˆ‘ä»¬ç°åœ¨è¦è®¨è®ºçš„å°±æ˜¯æ ‡å‡†åº“æ˜¯å¦‚ä½•å®ç°æ™ºèƒ½æŒ‡é’ˆä¹‹é—´çš„éšå¼è½¬æ¢çš„, æˆ‘ä»¬æœŸå¾…çš„æ•ˆæœå¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SmartPtr</span> &#123;<br><span class="hljs-keyword">public</span>:                             <br>  <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">SmartPtr</span><span class="hljs-params">(T *realPtr)</span></span>;    <span class="hljs-comment">// é€šè¿‡èµ„æºæŒ‡é’ˆè¿›è¡Œåˆå§‹åŒ–</span><br>  ...<br>&#125;;<br><br>SmartPtr&lt;Top&gt; pt1 = <span class="hljs-built_in">SmartPtr</span>&lt;Middle&gt;(<span class="hljs-keyword">new</span> Middle);   <br>SmartPtr&lt;Top&gt; pt2 = <span class="hljs-built_in">SmartPtr</span>&lt;Bottom&gt;(<span class="hljs-keyword">new</span> Bottom); <br>SmartPtr&lt;<span class="hljs-type">const</span> Top&gt; pct2 = pt1; <br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç æ˜¯æ— æ³•é€šè¿‡ç¼–è¯‘çš„, å› ä¸ºå°±ç®—æ˜¯<code>Top</code>å’Œ<code>Middle</code>æœ‰è”ç³», <code>SmartPtr&lt;Top&gt;</code>å’Œ<code>SmartPtr&lt;Middle&gt;</code>ä¹Ÿæ²¡æœ‰ä»»ä½•è”ç³», å®ƒä»¬æ˜¯æ— æ³•éšå¼è½¬æ¢çš„, ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æˆå‘˜å‡½æ•°æ¨¡æ¿, å…·ä½“è¯´æ˜¯å†™ä¸€ä¸ªæ³›åŒ–copyæ„é€ å‡½æ•°æ¥åˆ›é€ è¿™ç§è”ç³».</p><hr><h3 id="æ³›åŒ–copyæ„é€ å‡½æ•°"><a href="#æ³›åŒ–copyæ„é€ å‡½æ•°" class="headerlink" title="æ³›åŒ–copyæ„é€ å‡½æ•°"></a>æ³›åŒ–copyæ„é€ å‡½æ•°</h3><p>æˆ‘ä»¬å…ˆæ¥å†™ä¸€ä¸ªæˆå‘˜å‡½æ•°æ¨¡æ¿ä¸­çš„<strong>æ³›åŒ–copyæ„é€ å‡½æ•°</strong> : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SmartPtr</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> U&gt;                       <span class="hljs-comment">// æ³›åŒ–copyæ„é€ å‡½æ•°</span><br>  <span class="hljs-built_in">SmartPtr</span>(<span class="hljs-type">const</span> SmartPtr&lt;U&gt;&amp; other);       <br>  ...                 <br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ¨¡æ¿å‡½æ•°æ¥å—ç”¨ä¸€ä¸ª<code>SmartPtr&lt;U&gt;</code>ç±»å‹çš„å‚æ•°å»æ„é€ ä¸€ä¸ª<code>SmartPtr&lt;T&gt;</code>ç±»å‹çš„å¯¹è±¡, ç°åœ¨è¿˜åªæ˜¯å£°æ˜, æˆ‘ä»¬åº”è¯¥è€ƒè™‘å¦‚ä½•å®šä¹‰å†…éƒ¨é€»è¾‘, æ­£å¸¸é€»è¾‘åº”è¯¥æ˜¯å…ˆçœ‹<code>U*</code>æ˜¯å¦å¯ä»¥éšå¼è½¬æ¢ä¸º<code>T*</code>, å¦‚æœå¯ä»¥è½¬æ¢ä¹Ÿå°±å¯ä»¥è¿›è¡Œæ™ºèƒ½æŒ‡é’ˆä¹‹é—´çš„è½¬æ¢, æˆ‘ä»¬æ¥çœ‹ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SmartPtr</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> U&gt;</span><br><span class="hljs-function">  <span class="hljs-title">SmartPtr</span><span class="hljs-params">(<span class="hljs-type">const</span> SmartPtr&lt;U&gt;&amp; other)</span>         </span><br><span class="hljs-function">  : heldPtr(other.get()) &#123;</span>...&#125;            <span class="hljs-comment">// å…³é”®ä»£ç </span><br>    <br>  <span class="hljs-function">T* <span class="hljs-title">get</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> heldPtr; &#125;<br>  ...<br><span class="hljs-keyword">private</span>:                                     <br>  T *heldPtr;                                <br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œç›´æ¥å°†å‚æ•°otherä¸­çš„<code>heldPtr</code>å–å‡º, èµ‹å€¼ç»™å½“å‰å¯¹è±¡çš„<code>heldPtr</code>. å…¶å®åœ¨è¿™é‡Œå°±è¿›è¡Œäº†æ£€æŸ¥ : </p><ul><li><code>other.get()</code>å–å‡ºçš„æŒ‡é’ˆç±»å‹ä¸º<code>U*</code>, å¦‚æœ<code>U*</code>å¯ä»¥éšå¼è½¬æ¢ä¸º<code>T*</code>, é‚£ä¹ˆå¯ä»¥è¿›è¡Œæ™ºèƒ½æŒ‡é’ˆä¹‹é—´çš„è½¬æ¢.</li><li>å¦‚æœä¸å¯ä»¥éšå¼è½¬æ¢, ç¼–è¯‘é”™è¯¯, ä¼šè¢«ç³»ç»Ÿæ‹¦æˆª.</li></ul><p>è‡³æ­¤, é€šè¿‡æ³›åŒ–copyæ„é€ å‡½æ•°è¿™ä¸ªæˆå‘˜å‡½æ•°æ¨¡æ¿, åªè¦<code>U*</code>å¯ä»¥éšå¼è½¬æ¢ä¸º<code>T*</code>, é‚£ä¹ˆ<code>SmartPtr&lt;U&gt;</code>ä¹Ÿå¯ä»¥éšå¼è½¬æ¢ä¸º<code>SmartPtr&lt;T&gt;</code>.</p><hr><h3 id="æˆå‘˜å‡½æ•°æ¨¡æ¿"><a href="#æˆå‘˜å‡½æ•°æ¨¡æ¿" class="headerlink" title="æˆå‘˜å‡½æ•°æ¨¡æ¿"></a>æˆå‘˜å‡½æ•°æ¨¡æ¿</h3><p>æˆå‘˜å‡½æ•°æ¨¡æ¿çš„æ•ˆç”¨ä¸åªå±€é™äºæ„é€ å‡½æ•°, ä¹Ÿå¯ä»¥æ”¯æŒèµ‹å€¼æ“ä½œ, å…¶ä¸æ”¹å˜è¯­è¨€è§„åˆ™, ä½†æ˜¯å¯ä»¥å¸®åŠ©ä½ è®©classåœ¨æ„é€ å’Œèµ‹å€¼æ“ä½œä¸Šå¯ä»¥å…¼å®¹æ›´å¤šç±»å‹, è®©æˆ‘ä»¬åœ¨ä½¿ç”¨æ¨¡æ¿ç±»å‹æ—¶å¯ä»¥åƒä½¿ç”¨éæ¨¡æ¿ç±»å‹æ—¶ä¸€æ ·è‡ªç„¶æµç•…. æˆ‘ä»¬å¯ä»¥äº†è§£ä¸€ä¸‹æ ‡å‡†åº“ä¸­<code>shared_ptr</code>çš„ç®€ç•¥ç‰ˆæœ¬, çœ‹çœ‹å…¶å¯¹æˆå‘˜å‡½æ•°æ¨¡æ¿çš„ä½¿ç”¨ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt; <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">shared_ptr</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-comment">// æ„é€ </span><br>  <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> Y&gt;                                     </span><br><span class="hljs-function">    <span class="hljs-keyword">explicit</span> <span class="hljs-title">shared_ptr</span><span class="hljs-params">(Y * p)</span></span>;                         <span class="hljs-comment">// æ³›åŒ–æ„é€ å‡½æ•°</span><br>  <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> Y&gt;                                     </span><br><span class="hljs-function">    <span class="hljs-title">shared_ptr</span><span class="hljs-params">(shared_ptr&lt;Y&gt; <span class="hljs-type">const</span>&amp; r)</span></span>;                 <span class="hljs-comment">// æ³›åŒ–copyæ„é€ å‡½æ•°</span><br>  <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> Y&gt;                                     </span><br><span class="hljs-function">    <span class="hljs-keyword">explicit</span> <span class="hljs-title">shared_ptr</span><span class="hljs-params">(weak_ptr&lt;Y&gt; <span class="hljs-type">const</span>&amp; r)</span></span>;          <span class="hljs-comment">// é€šè¿‡weak_ptræ„é€ </span><br>  <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> Y&gt;</span><br><span class="hljs-function">    <span class="hljs-keyword">explicit</span> <span class="hljs-title">shared_ptr</span><span class="hljs-params">(unique_ptr&lt;Y&gt;&amp; r)</span></span>;<span class="hljs-comment">// é€šè¿‡unique_ptræ„é€ </span><br>  <span class="hljs-comment">// èµ‹å€¼</span><br>  <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">Y</span>&gt;                                    <br>    shared_ptr&amp; <span class="hljs-keyword">operator</span>=(shared_ptr&lt;Y&gt; <span class="hljs-type">const</span>&amp; r);      <span class="hljs-comment">// æ³›åŒ–èµ‹å€¼é‡è½½</span><br>  <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">Y</span>&gt;                                     <br>    shared_ptr&amp; <span class="hljs-keyword">operator</span>=(unique_ptr&lt;Y&gt;&amp; r);            <span class="hljs-comment">// ç”¨unique_ptrèµ‹å€¼</span><br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>åœ¨æœ¬ä¾‹ä¸­,  æ„é€ å‡½æ•°ä¸­åªæœ‰æ³›åŒ–copyæ„é€ å‡½æ•°æ²¡æœ‰explicit, è¯´æ˜å…¶ä»–æ„é€ å‡½æ•°éƒ½ä¸åº”å½“æ”¯æŒéšå¼ç±»å‹è½¬æ¢, ä¹Ÿå°±æ˜¯è¯´Tå’ŒYçš„ç±»å‹åº”å½“ä¸€è‡´. å¦å¤–æˆå‘˜æ¨¡æ¿å‡½æ•°å¹¶<strong>ä¸æ”¹å˜è¯­è¨€è§„åˆ™</strong>, å°±ç®—æˆ‘ä»¬å†™äº†æ³›åŒ–çš„æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼é‡è½½, ä¾æ—§ä¸å½±å“æ™®é€šçš„æ‹·è´æ„é€ å’Œèµ‹å€¼é‡è½½, å¦‚æœæˆ‘ä»¬æ²¡æœ‰å†™, ç¼–è¯‘å™¨è¿˜æ˜¯ä¼šè‡ªåŠ¨ç”Ÿæˆ, æ‰€ä»¥å¦‚æœæƒ³è¦æ§åˆ¶æ„é€ çš„æ–¹æ–¹é¢é¢, æˆ‘ä»¬åº”å½“<strong>åŒæ—¶å£°æ˜æ™®é€šç‰ˆæœ¬å’Œæ³›åŒ–ç‰ˆæœ¬</strong>.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt; <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">shared_ptr</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-built_in">shared_ptr</span>(shared_ptr <span class="hljs-type">const</span>&amp; r);                 <span class="hljs-comment">// æ™®é€šæ‹·è´æ„é€ </span><br>  <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> Y&gt;                                </span><br><span class="hljs-function">    <span class="hljs-title">shared_ptr</span><span class="hljs-params">(shared_ptr&lt;Y&gt; <span class="hljs-type">const</span>&amp; r)</span></span>;            <span class="hljs-comment">// æ³›åŒ–æ‹·è´æ„é€ </span><br><br>  shared_ptr&amp; <span class="hljs-keyword">operator</span>=(shared_ptr <span class="hljs-type">const</span>&amp; r);      <span class="hljs-comment">// æ™®é€šèµ‹å€¼é‡è½½</span><br>  <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">Y</span>&gt;                               <br>    shared_ptr&amp; <span class="hljs-keyword">operator</span>=(shared_ptr&lt;Y&gt; <span class="hljs-type">const</span>&amp; r); <span class="hljs-comment">// æ³›åŒ–èµ‹å€¼é‡è½½</span><br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>ä½¿ç”¨æˆå‘˜å‡½æ•°æ¨¡æ¿å¯ä»¥ç”Ÿæˆâ€å¯æ¥å—æ‰€æœ‰å…¼å®¹ç±»å‹â€çš„å‡½æ•°.</li><li>å½“æˆ‘ä»¬å£°æ˜æ³›åŒ–æ‹·è´æ„é€ å’Œèµ‹å€¼é‡è½½æ—¶, ä¹Ÿåº”è¯¥å£°æ˜å…¶æ™®é€šç‰ˆæœ¬.</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
      <tag>æ¨¡æ¿</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾44 é˜²æ­¢ä»£ç è†¨èƒ€</title>
    <link href="/2025/01/12/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE44%20%E9%98%B2%E6%AD%A2%E4%BB%A3%E7%A0%81%E8%86%A8%E8%83%80/"/>
    <url>/2025/01/12/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE44%20%E9%98%B2%E6%AD%A2%E4%BB%A3%E7%A0%81%E8%86%A8%E8%83%80/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾44-å°†ä¸å‚æ•°æ— å…³çš„ä»£ç æŠ½ç¦»templates"><a href="#æ¡æ¬¾44-å°†ä¸å‚æ•°æ— å…³çš„ä»£ç æŠ½ç¦»templates" class="headerlink" title="æ¡æ¬¾44 : å°†ä¸å‚æ•°æ— å…³çš„ä»£ç æŠ½ç¦»templates"></a>æ¡æ¬¾44 : å°†ä¸å‚æ•°æ— å…³çš„ä»£ç æŠ½ç¦»templates</h2><blockquote><p>æˆ‘ä»¬çŸ¥é“ä»£ç é‡å¤å’Œè¿‡åº¦çš„inlineéƒ½å¯èƒ½å¯¼è‡´ä»£ç è†¨èƒ€, è€Œåœ¨æ¨¡æ¿ä¸­ä¼šå‘ç”Ÿæ¯”è¾ƒéšæ™¦çš„ä»£ç é‡å¤, æˆ‘ä»¬åº”å½“å°½åŠ›å»é¿å…ä»£ç é‡å¤çš„æƒ…å†µå‘ç”Ÿ, è€Œæœ€æ ¸å¿ƒçš„æ–¹æ³•å°±æ˜¯å°†ä¸å‚æ•°æ— å…³çš„ä»£ç æŠ½ç¦»templates, è®©æˆ‘ä»¬é€šè¿‡æœ¬æ¡æ¬¾è¿›è¡Œäº†è§£.</p></blockquote><p>åœ¨æœ¬æ¡æ¬¾ä¸­æˆ‘ä»¬å°†ä¼šäº†è§£ : </p><ul><li>åœ¨æ¨¡æ¿ä¸­ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”Ÿä»£ç è†¨èƒ€?</li><li>å¦‚ä½•ç¼“è§£è¿™ç§ä»£ç è†¨èƒ€?</li><li>åœ¨ç¼“è§£ä»£ç è†¨èƒ€åå¦‚ä½•çŸ¥é“è¯¥æ“ä½œä»€ä¹ˆæ•°æ®?</li></ul><hr><h3 id="ä»£ç è†¨èƒ€"><a href="#ä»£ç è†¨èƒ€" class="headerlink" title="ä»£ç è†¨èƒ€"></a>ä»£ç è†¨èƒ€</h3><p>ä¸¾ä¸ªä¾‹å­, å‡è®¾ä½ æƒ³ä¸ºå›ºå®šå°ºå¯¸çš„æ­£æ–¹çŸ©å½¢ç¼–å†™ä¸€ä¸ªtemplate, è¯¥çŸ©å½¢æŒ‡å‡ºé€†çŸ©é˜µè¿ç®— : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T,           <span class="hljs-comment">// çŸ©é˜µçš„å…ƒç´ ç±»å‹æ˜¯T</span><br>         std::<span class="hljs-type">size_t</span> n&gt;        <span class="hljs-comment">// çŸ©é˜µçš„å›ºå®šå°ºå¯¸ä¸ºn, è¿™æ˜¯éç±»å‹æ¨¡æ¿å‚æ•°</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SquareMatrix</span> &#123;         <br><span class="hljs-keyword">public</span>:<br>  ...<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">invert</span><span class="hljs-params">()</span></span>;              <span class="hljs-comment">// æ±‚é€†åŠŸèƒ½</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬åœ¨ä½¿ç”¨è¿™ä¸ªç±»å‹æ—¶ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp">SquareMatrix&lt;<span class="hljs-type">double</span>, <span class="hljs-number">5</span>&gt; sm1;      <span class="hljs-comment">// SquareMatrix&lt;double, 5&gt;ç±»å‹</span><br>...<br>sm<span class="hljs-number">1.</span><span class="hljs-built_in">invert</span>();                 <br><br>SquareMatrix&lt;<span class="hljs-type">double</span>, <span class="hljs-number">10</span>&gt; sm2;     <span class="hljs-comment">// SquareMatrix&lt;double, 10&gt;ç±»å‹</span><br>...<br>sm<span class="hljs-number">2.</span><span class="hljs-built_in">invert</span>(); <br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åº”è¯¥å·²ç»æ³¨æ„åˆ°, åªè¦Tå’Œnæœ‰ä¸åŒ, åœ¨å®é™…ä¸Šç¼–è¯‘å™¨å°±ä¼šé‡æ–°ç¼–è¯‘å‡ºä¸€ä»½ä»£ç . åœ¨æœ¬ä¾‹ä¸­, ä»…ä»…åªæ˜¯åœ¨å°ºå¯¸ä¸Šæœ‰å·®åˆ«, ä½†è¿˜æ˜¯åœ¨åº•å±‚ç¼–è¯‘å‡ºäº†ä¸¤ä»½é™¤äº†å°ºå¯¸ä¸ä¸€æ ·ä½†æ˜¯å…¶ä»–éƒ½ç›¸è¿‘çš„ä»£ç , è¿™å°±é€ æˆäº†å®é™…æ„ä¹‰ä¸Šçš„ä»£ç è†¨èƒ€.</p><p>ä½ ä¹Ÿè®¸ä¼šè§‰å¾—è¿™æ ·æ— å¯åšé, è¿™å°±æ˜¯æ¨¡æ¿æœºåˆ¶å¯¼è‡´çš„, ä½†æ˜¯ç»†æƒ³<code>invert()</code>è¿™ä¸ªå‡½æ•°, å¯¹çŸ©é˜µæ±‚é€†çš„è¿‡ç¨‹åŸºæœ¬éƒ½æ˜¯ç›¸åŒçš„, åªæ˜¯çŸ©é˜µçš„å°ºå¯¸æœ‰å·®åˆ«ç½¢äº†, æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸäº›æ‰‹æ³•å°†<code>invert()</code>æŠ½ç¦»å‡ºæ¥, ä½¿å…¶ä¸å¿…é¢‘ç¹ç¼–è¯‘, è¿™ä¾¿æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦ä»‹ç»çš„è§£å†³æ–¹æ³•.</p><hr><h3 id="å°†å®ç°ç±»å’ŒåŠŸèƒ½ç±»åˆ†ç¦»"><a href="#å°†å®ç°ç±»å’ŒåŠŸèƒ½ç±»åˆ†ç¦»" class="headerlink" title="å°†å®ç°ç±»å’ŒåŠŸèƒ½ç±»åˆ†ç¦»"></a>å°†å®ç°ç±»å’ŒåŠŸèƒ½ç±»åˆ†ç¦»</h3><p>æˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ªç±»æ‹†åˆ†, æŠŠåŠŸèƒ½å‡½æ•°æ‹†åˆ†å‡ºæ¥ä½œä¸ºåŸºç±», å®ç°ç±»ä½œä¸ºå­ç±».</p><p>è®©æˆ‘ä»¬ç›´æ¥ç»™å‡ºä¾‹å­, æ ¹æ®ä¾‹å­æ¥ä»‹ç» : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;                   <span class="hljs-comment">// åŸºç±» - åŠŸèƒ½ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SquareMatrixBase</span> &#123;               <br><span class="hljs-keyword">protected</span>:   <span class="hljs-comment">// è¿™é‡Œæ˜¯protected, ä¸å¯¹å¤–å…¬å¼€, åªç»™æ´¾ç”Ÿç±»è°ƒç”¨</span><br>  ...<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">invert</span><span class="hljs-params">(std::<span class="hljs-type">size_t</span> matrixSize)</span></span>; <span class="hljs-comment">// è¿™é‡Œå®é™…æ˜¯ç”¨å‡½æ•°å‚æ•°æ›¿ä»£æ‰äº†SquareMatrixBaseçš„æ¨¡æ¿å‚æ•°</span><br>  ...<br>&#125;;<br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, std::<span class="hljs-type">size_t</span> n&gt;    <span class="hljs-comment">// æ´¾ç”Ÿç±» - å®ç°ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SquareMatrix</span>: <span class="hljs-keyword">private</span> SquareMatrixBase&lt;T&gt; &#123;<br><span class="hljs-keyword">private</span>:<br>  <span class="hljs-keyword">using</span> SquareMatrixBase&lt;T&gt;::invert;   <span class="hljs-comment">// è§æ¡æ¬¾33, é¿å…é®æ©</span><br><span class="hljs-keyword">public</span>:<br>  ...<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">invert</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">this</span>-&gt;<span class="hljs-built_in">invert</span>(n); &#125;   <span class="hljs-comment">// è°ƒç”¨æ¨¡æ¿åŸºç±»çš„æˆå‘˜å‡½æ•°, è§æ¡æ¬¾43</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œ<code>SquareMatrix</code>æ˜¯å®ç°ç±», ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ­£å¸¸ä½¿ç”¨çš„ç±»å‹, å®ƒçš„æƒ…å†µè¿˜æ˜¯å’Œä¸Šé¢ä¸€è‡´, åªè¦Tå’Œnæœ‰ä¸åŒ, è¿˜æ˜¯ä¼šç”Ÿæˆä¸€ä»½é¢å¤–çš„ä»£ç , ä½†æ˜¯ä¸åŒçš„æ˜¯<strong>å®ƒæŠŠå¤§é‡çš„å®é™…ä»£ç ç§»åˆ°äº†åŠŸèƒ½ç±»ä¸­(è¿™é‡Œåªæ˜¾ç¤ºäº†invert, å®é™…å¯ä»¥æœ‰å¾ˆå¤šåŠŸèƒ½å‡½æ•°), ä½¿æœ¬èº«çš„ä»£ç é‡éª¤å‡, å¤§å¤§å‡å°‘äº†é¢å¤–ä»£ç çš„ç”Ÿæˆ</strong>.</p><p>è¿™é‡Œ<code>SquareMatrixBase</code>æ˜¯åŠŸèƒ½ç±», ä»–è´Ÿè´£ç»™æ´¾ç”Ÿç±»æä¾›ç›¸åº”çš„åŠŸèƒ½, æˆ‘ä»¬ä»æ´¾ç”Ÿç±»<strong>privateç»§æ‰¿</strong>è‡ªå®ƒä¾¿å¯çœ‹å‡º. å®ƒåªæœ‰ä¸€ä¸ªTæ¨¡æ¿å‚æ•°, ä¹Ÿå°±æ˜¯è¯´å®ƒ<strong>åªå¯¹â€çŸ©é˜µå…ƒç´ å¯¹è±¡çš„ç±»å‹â€å‚æ•°åŒ–, ä¸å¯¹â€çŸ©é˜µçš„å°ºå¯¸â€å‚æ•°åŒ–</strong>, ä¹Ÿå°±æ˜¯è¯´åªè¦Tç›¸åŒ, å°±ç®—æ´¾ç”Ÿç±»çš„næ˜¯ä»»ä½•æ•°å­—, éƒ½å°†ä½¿ç”¨åŒä¸€ä»½ä»£ç  , ä¸ä¼šå†ç¼–è¯‘å‡ºå¤šä»½ä»£ç , æˆ‘ä»¬ä¹Ÿå¯ä»¥è®¤ä¸º<strong>å®é™…ä¸Šæ˜¯ç”¨å‡½æ•°å‚æ•°æ›¿ä»£æ‰äº†SquareMatrixBaseçš„æ¨¡æ¿å‚æ•°</strong>. </p><hr><h3 id="æ•°æ®æ“ä½œé—®é¢˜"><a href="#æ•°æ®æ“ä½œé—®é¢˜" class="headerlink" title="æ•°æ®æ“ä½œé—®é¢˜"></a>æ•°æ®æ“ä½œé—®é¢˜</h3><p>åœ¨è§£é‡Šè¿™ä¸ªé—®é¢˜ä¹‹å‰, æˆ‘ä»¬åº”è¯¥å†å¼•å…¥ä¸€ä¸ªå‰æ, å°±æ˜¯<strong>SquareMatrixåº”è¯¥æ˜¯æœ‰ä¸€ä¸ªå­˜å‚¨æ•°æ®çš„æˆå‘˜å˜é‡çš„</strong>, è¿™åº”å½“å¾ˆå®¹æ˜“ç†è§£, åœ¨æœ€åˆç‰ˆ<code>SquareMatrix</code>ä¸­å°±å¯ä»¥æ˜¯è¿™æ · : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T,         <br>         std::<span class="hljs-type">size_t</span> n&gt;       <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SquareMatrix</span> &#123;         <br><span class="hljs-keyword">public</span>:<br>  ...<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">invert</span><span class="hljs-params">()</span></span>;            <br>    <br><span class="hljs-keyword">private</span>:<br>  T data[n * n];              <span class="hljs-comment">// å­˜å‚¨çŸ©é˜µæ•°æ®çš„æˆå‘˜å˜é‡</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>åœ¨æœ€åˆç‰ˆä¸­, <code>invert()</code>å¯ä»¥ç›´æ¥å¯¹dataè¿›è¡Œæ“ä½œ, ä½†æ˜¯å½“æˆ‘ä»¬æŠŠå®ç°ç±»å’ŒåŠŸèƒ½ç±»åˆ†ç¦»å, <strong>dataè‚¯å®šè¿˜æ˜¯åœ¨å®ç°ç±»ä¸­</strong>, å› ä¸ºæ§åˆ¶æ•°æ®åº”å½“æ˜¯å®ç°ç±»çš„èŒè´£, å¹¶ä¸”è¿™æ ·å­ä¾¿äºåŠ¨æ€å†…å­˜çš„åˆ†é…; <strong>ä½†æ˜¯invert()åˆ°äº†åŠŸèƒ½ç±», æ— æ³•ç›´æ¥å¯¹dataè¿›è¡Œä¿®æ”¹</strong>, åŠŸèƒ½ç±»å‡½æ•°è¯¥å¦‚ä½•å®é™…ä¿®æ”¹dataä¸­çš„æ•°æ®, è¿™ä¾¿æ˜¯æˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜.</p><p>å…¶å®è§£å†³æ–¹å¼ä¹Ÿå¾ˆç®€å•, <strong>åœ¨SquareMatrixBaseä¸­å­˜å‚¨ä¸€ä¸ªæŒ‡å‘dataçš„æŒ‡é’ˆ</strong>å°±å¥½äº† : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SquareMatrixBase</span> &#123;<br><span class="hljs-keyword">protected</span>:<br>  <span class="hljs-built_in">SquareMatrixBase</span>(T *pMem)     <br>  :<span class="hljs-built_in">pData</span>(pMem) &#123;&#125;                    <span class="hljs-comment">// åœ¨æ„é€ å‡½æ•°ä¸­æ¥å—ä¼ å…¥çš„èµ„æºæŒ‡é’ˆ</span><br><br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setDataPtr</span><span class="hljs-params">(T *ptr)</span> </span>&#123; pData = ptr; &#125;     <span class="hljs-comment">// é‡æ–°è®¾ç½®èµ„æºæŒ‡é’ˆ</span><br>  ...<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">invert</span><span class="hljs-params">(std::<span class="hljs-type">size_t</span> matrixSize)</span></span>;       <span class="hljs-comment">// å†…éƒ¨ç›´æ¥ç”¨pDataè¿™ä¸ªæŒ‡é’ˆå¯¹èµ„æºè¿›è¡Œè°ƒæ•´</span><br><br><span class="hljs-keyword">private</span>:<br>  T *pData;                                    <span class="hljs-comment">// æŒ‡å‘èµ„æº</span><br>&#125;;<br><br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, std::<span class="hljs-type">size_t</span> n&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SquareMatrix</span>: <span class="hljs-keyword">private</span> SquareMatrixBase&lt;T&gt; &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-built_in">SquareMatrix</span>()                             <br>  : <span class="hljs-built_in">SquareMatrixBase</span>&lt;T&gt;(data) &#123;&#125;          <span class="hljs-comment">// å‘åŸºç±»æ„é€ ä¼ å…¥èµ„æºæŒ‡é’ˆ</span><br>  ...<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">invert</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">this</span>-&gt;<span class="hljs-built_in">invert</span>(n); &#125;<br><span class="hljs-keyword">private</span>:<br>  T data[n*n];<br>&#125;;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥è‡ªè¡Œå†³å®šå®ç°ç±»ä¸­æ•°æ®å†…å­˜çš„åˆ†é…æ–¹å¼, åœ¨ä¸Šæ–‡ä¸­<code>T data[n*n];</code>æ˜¯å°†æ•°æ®å­˜å‚¨åœ¨äº†å¯¹è±¡å†…éƒ¨, ä¹Ÿå°±æ˜¯æ ˆä¸Š. æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡åŠ¨æ€åˆ†é…å†…å­˜çš„æ–¹å¼å°†æ•°æ®å­˜å…¥å †ä¸Š(é€šè¿‡newæ¥åˆ†é…å†…å­˜) : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, std::<span class="hljs-type">size_t</span> n&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SquareMatrix</span>: <span class="hljs-keyword">private</span> SquareMatrixBase&lt;T&gt; &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-built_in">SquareMatrix</span>()                          <br>  : <span class="hljs-built_in">SquareMatrixBase</span>&lt;T&gt;(n, <span class="hljs-number">0</span>),            <br>    <span class="hljs-built_in">pData</span>(<span class="hljs-keyword">new</span> T[n*n])                    <span class="hljs-comment">// å‘åŸºç±»æ„é€ ä¼ å…¥newå‡ºæ¥çš„æŒ‡é’ˆ</span><br>  &#123; <span class="hljs-keyword">this</span>-&gt;<span class="hljs-built_in">setDataPtr</span>(pData.<span class="hljs-built_in">get</span>()); &#125;      <br>  ...                                     <br><br><span class="hljs-keyword">private</span>:<br>  std::unique_ptr&lt;T&gt; pData;           <span class="hljs-comment">// ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆç®¡ç†å†…å­˜</span><br>&#125;; <br></code></pre></td></tr></table></figure><hr><h3 id="ç±»å‹å‚æ•°å¯¼è‡´çš„ä»£ç è†¨èƒ€"><a href="#ç±»å‹å‚æ•°å¯¼è‡´çš„ä»£ç è†¨èƒ€" class="headerlink" title="ç±»å‹å‚æ•°å¯¼è‡´çš„ä»£ç è†¨èƒ€"></a>ç±»å‹å‚æ•°å¯¼è‡´çš„ä»£ç è†¨èƒ€</h3><p>æˆ‘ä»¬å¯ä»¥å‘ç°ä¸Šæ–‡éƒ½å¯¹éç±»å‹å‚æ•°(n)å¯¼è‡´çš„ä»£ç è†¨èƒ€æä¾›çš„è§£å†³æ–¹æ¡ˆ, ä½†æ˜¯ç±»å‹å‚æ•°(T)ä¹ŸåŒæ ·ä¼šå¯¼è‡´ä»£ç è†¨èƒ€, ä¸åŒçš„Tä¹Ÿä¼šäº§ç”Ÿä¸åŒçš„ç¼–è¯‘ç‰ˆæœ¬, æœ‰äº›ç±»å‹åœ¨åº•å±‚å…¶å®æ˜¯éå¸¸ç›¸è¿‘ç”šè‡³ç›¸åŒçš„, ä¾‹å¦‚intå’Œlong, å„ç§æŒ‡é’ˆç±»å‹ä¹‹é—´. </p><p>å‡è®¾Tæ˜¯ä¸€ä¸ªæŒ‡é’ˆç±»å‹, æ‰€æœ‰æŒ‡é’ˆç±»å‹éƒ½æœ‰ç€ç›¸åŒçš„äºŒè¿›åˆ¶è¡¨è¿°, å…¶å®ç¼–è¯‘å‡ºæ¥çš„ä»£ç åŸºæœ¬ä¸€è‡´, åªæ˜¯æŒ‡é’ˆç±»å‹ä¸ä¸€æ ·è€Œå·². é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åœ¨æ¨¡æ¿å‡½æ•°ä¸­å°†è¿™äº›æŒ‡é’ˆè½¬æ¢ä¸º<code>void*</code>, ç„¶åè°ƒç”¨æ“ä½œ<code>void*</code>æŒ‡é’ˆç±»å‹çš„å‡½æ•°, ç”±åè€…å®Œæˆå®é™…å‡½æ•°, ä¹Ÿå¯ä»¥è¾¾åˆ°ç±»ä¼¼é˜²æ­¢ä»£ç è†¨èƒ€çš„æ•ˆæœ, æ ‡å‡†åº“ä¸­çš„vector, listç­‰éƒ½ç”¨è¿‡è¿™ç§æ–¹å¼, ä»¥ä¸‹æ˜¯liståœ¨åº•å±‚çš„ç±»ä¼¼å®ç° : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ListBase</span> &#123;<br><span class="hljs-keyword">protected</span>:<br>    ...<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push_back_impl</span><span class="hljs-params">(<span class="hljs-type">void</span>* value)</span> </span>&#123;<br>        <span class="hljs-comment">// ä½¿ç”¨ `void*` å®ç°é€šç”¨é€»è¾‘</span><br>        *(pdata + size) = value;<br>        size++;<br>    &#125;<br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">void</span>* pData;<br>    <span class="hljs-type">int</span> size = <span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">List</span> : <span class="hljs-keyword">private</span> ListBase &#123;<br><span class="hljs-keyword">public</span>:<br>    ...<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push_back</span><span class="hljs-params">(T* value)</span> </span>&#123;<br>        <span class="hljs-comment">// è½¬æ¢ä¸º `void*`ï¼Œè°ƒç”¨åº•å±‚é€šç”¨é€»è¾‘</span><br>        <span class="hljs-built_in">push_back_impl</span>(<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">void</span>*&gt;(value));<br>    &#125;<br>    <br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">void</span>* data[<span class="hljs-number">100</span>]; <span class="hljs-comment">// ç”¨ `void*` å­˜å‚¨æ‰€æœ‰æŒ‡é’ˆç±»å‹</span><br>&#125;;<br><br><span class="hljs-comment">// `list&lt;int*&gt;` å’Œ `list&lt;const int*&gt;` éƒ½è°ƒç”¨ç›¸åŒçš„åº•å±‚ä»£ç </span><br>List&lt;<span class="hljs-type">int</span>*&gt; list1;<br>List&lt;<span class="hljs-type">const</span> <span class="hljs-type">int</span>*&gt; list2;<br></code></pre></td></tr></table></figure><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li><p>ä½¿ç”¨æ¨¡æ¿ä¼šæœ‰éšå«çš„ä»£ç è†¨èƒ€äº§ç”Ÿ, æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†ä¸€äº›åŠŸèƒ½å‡½æ•°æŠ½ç¦»å‡ºæ¥ä½œä¸ºåŸºç±», privateç»§æ‰¿ç»™æ´¾ç”Ÿç±»æ¥é¿å…ä»£ç è†¨èƒ€.</p></li><li><p>å› éç±»å‹æ¨¡æ¿å‚æ•°(n)é€ æˆçš„ä»£ç è†¨èƒ€, å¾€å¾€å¯æ¶ˆé™¤, å¯ä»¥ç”¨<strong>å‡½æ•°å‚æ•°æˆ–classæˆå‘˜å˜é‡</strong>æ›¿æ¢æ‰éç±»å‹æ¨¡æ¿å‚æ•°.</p></li><li><p>å› ç±»å‹æ¨¡æ¿å‚æ•°(T)é€ æˆçš„ä»£ç è†¨èƒ€, å¾€å¾€å¯é™ä½, å¯ä»¥è®©<strong>åº•å±‚äºŒè¿›åˆ¶è¡¨è¿°å®Œå…¨ç›¸åŒçš„ç±»å‹(å¦‚æŒ‡é’ˆ)å…±äº«åŠŸèƒ½å‡½æ•°</strong>.</p></li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
      <tag>æ¨¡æ¿</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾43 æ¨¡æ¿åŸºç±»çš„ç»§æ‰¿</title>
    <link href="/2025/01/07/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE43%20%E6%A8%A1%E6%9D%BF%E5%9F%BA%E7%B1%BB%E7%9A%84%E7%BB%A7%E6%89%BF/"/>
    <url>/2025/01/07/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE43%20%E6%A8%A1%E6%9D%BF%E5%9F%BA%E7%B1%BB%E7%9A%84%E7%BB%A7%E6%89%BF/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾43-å­¦ä¹ å¤„ç†æ¨¡æ¿åŒ–åŸºç±»å†…çš„åç§°"><a href="#æ¡æ¬¾43-å­¦ä¹ å¤„ç†æ¨¡æ¿åŒ–åŸºç±»å†…çš„åç§°" class="headerlink" title="æ¡æ¬¾43 : å­¦ä¹ å¤„ç†æ¨¡æ¿åŒ–åŸºç±»å†…çš„åç§°"></a>æ¡æ¬¾43 : å­¦ä¹ å¤„ç†æ¨¡æ¿åŒ–åŸºç±»å†…çš„åç§°</h2><blockquote><p>åœ¨æœ¬æ¡æ¬¾ä¸­æˆ‘ä»¬å°†æ¢è®¨ç»§æ‰¿ä¸æ¨¡æ¿å…±åŒä½¿ç”¨æ—¶çš„æ³¨æ„äº‹é¡¹, æœ‰äº›æˆ‘ä»¬é€šè¿‡å­¦ä¹ ç»§æ‰¿å¾—æ¥çš„ç›´è§‰åœ¨è¿™é‡Œå¯èƒ½ä¸å†é€‚ç”¨, å½“æˆ‘ä»¬ä»Object Oriented C++ è·¨è¿› Template C++, ç»§æ‰¿å°±ä¸åƒä»¥å‰é‚£æ ·ç•…è¡Œæ— é˜»äº†.</p></blockquote><h3 id="å‘ç°é—®é¢˜"><a href="#å‘ç°é—®é¢˜" class="headerlink" title="å‘ç°é—®é¢˜"></a>å‘ç°é—®é¢˜</h3><p>æˆ‘ä»¬å…ˆå¼•å…¥ä¸€ä¸ªä¾‹å­, å‡è®¾æˆ‘ä»¬è¦å†™ä¸€ä¸ªç¨‹åº, ä»–èƒ½å¤Ÿä¼ é€ä¿¡æ¯åˆ°è‹¥å¹²ä¸åŒå…¬å¸å», å¤§éƒ¨åˆ†å…¬å¸ä¼ è¾“çš„ä¿¡æ¯ä¸éœ€è¦åŠ å¯†, å°‘éƒ¨åˆ†å…¬å¸ä¼ è¾“çš„ä¿¡æ¯éœ€è¦åŠ å¯†. é‚£ä¹ˆåœ¨å®é™…ç¼–å†™ä¸­å°±æ˜¯å†™ä¸€ä¸ª<code>MsgSender</code>æ¨¡æ¿ç±», æ¨¡æ¿å‚æ•°æ˜¯å…¬å¸ç±»å‹, é’ˆå¯¹éœ€è¦åŠ å¯†ä¿¡æ¯çš„å…¬å¸è¿›è¡Œå…¨ç‰¹åŒ–. æˆ‘ä»¬é€šè¿‡ä»£ç æ¥ç†è§£.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// ä¸¤ä¸ªå…¬å¸ç±», ä¼ é€’ä¿¡æ¯éƒ½ä¸éœ€è¦åŠ å¯†</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CompanyA</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  ...<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sendCleartext</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; msg)</span></span>;<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sendEncrypted</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; msg)</span></span>;<br>  ...<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CompanyB</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  ...<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sendCleartext</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; msg)</span></span>;<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sendEncrypted</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; msg)</span></span>;<br>  ...<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MsgInfo</span> &#123; ... &#125;;                  <span class="hljs-comment">// ç”¨æ¥ä¿å­˜ä¿¡æ¯çš„ç±»</span><br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Company&gt; <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MsgSender</span> &#123;<br><span class="hljs-keyword">public</span>:<br><br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sendClear</span><span class="hljs-params">(<span class="hljs-type">const</span> MsgInfo&amp; info)</span>  <span class="hljs-comment">// å‘é€ä¸åŠ å¯†çš„ä¿¡æ¯</span></span><br><span class="hljs-function">  </span>&#123;<br>    std::string msg;<br>    create msg from info;<br><br>    Company c;<br>    c.<span class="hljs-built_in">sendCleartext</span>(msg);<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>å‡è®¾æˆ‘ä»¬æƒ³è¦åœ¨<code>MsgSender</code>çš„å‰æä¸‹å†åŠ å…¥æ—¥å¿—å¿—è®°çš„åŠŸèƒ½, ç»§æ‰¿å®ƒå¯èƒ½æ˜¯ä¸€ä¸ªæœ€é«˜æ•ˆçš„æ–¹å¼ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Company&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggingMsgSender</span>: <span class="hljs-keyword">public</span> MsgSender&lt;Company&gt; &#123;<br><span class="hljs-keyword">public</span>:<br>  ...                                    <br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sendClearMsg</span><span class="hljs-params">(<span class="hljs-type">const</span> MsgInfo&amp; info)</span></span><br><span class="hljs-function">  </span>&#123;<br>    <span class="hljs-comment">// ä¿¡æ¯å‘é€å‰è¿›è¡Œè®°å½•æ—¥å¿—</span><br><br>    <span class="hljs-built_in">sendClear</span>(info);           <span class="hljs-comment">// é”™è¯¯! è¿™é‡Œæ ¹æœ¬æ— æ³•é€šè¿‡ç¼–è¯‘ </span><br>      <br>    <span class="hljs-comment">// ä¿¡æ¯å‘é€åè¿›è¡Œè®°å½•æ—¥å¿—</span><br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™ç§ç»§æ‰¿æ–¹å¼åœ¨<code>Object Oriented C++</code>é¢†åŸŸä¸­æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„, ä½†æ˜¯ä¸€æ—¦åŠ ä¸Šäº†æ¨¡æ¿, åœ¨äº‹å®ä¸Šä½ ä¼šå‘ç°è¿™ä¸ªä»£ç æ ¹æœ¬æ— æ³•é€šè¿‡ç¼–è¯‘, è¿™å°±æ˜¯æˆ‘ä»¬æœ¬æ¡æ¬¾éœ€è¦è§£å†³çš„é—®é¢˜.</p><hr><h3 id="é—®é¢˜æ ¸å¿ƒ"><a href="#é—®é¢˜æ ¸å¿ƒ" class="headerlink" title="é—®é¢˜æ ¸å¿ƒ"></a>é—®é¢˜æ ¸å¿ƒ</h3><p>å¼€é—¨è§å±±åœ°æŒ‡å‡ºé—®é¢˜æ ¸å¿ƒ : <strong>æ¨¡æ¿ç±»å­˜åœ¨ç‰¹åŒ–è¿™ç§æ“ä½œ</strong>, å› æ­¤æ™®é€šæ¨¡æ¿ç±»æœ‰çš„å‡½æ•°, ç‰¹åŒ–ç‰ˆæœ¬å´ä¸ä¸€å®šæœ‰. </p><p>æˆ‘ä»¬å‡è®¾è¿˜æœ‰ä¸€ä¸ªå…¬å¸Z, å®ƒè¦æ±‚è‡ªå·±ä¼ é€çš„ä¿¡æ¯å¿…é¡»åŠ å¯†, æˆ‘ä»¬çœ‹çœ‹ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CompanyZ</span> &#123;                             <span class="hljs-comment">// è¦æ±‚å‘é€åŠ å¯†ä¿¡æ¯</span><br><span class="hljs-keyword">public</span>:                                    <br>  ...<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sendEncrypted</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; msg)</span></span>;<br>  ...<br>&#125;;<br><br><span class="hljs-keyword">template</span>&lt;&gt;                          <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MsgSender</span>&lt;CompanyZ&gt; &#123;                <br><span class="hljs-keyword">public</span>:                                  <br>  ...                                     <br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sendSecret</span><span class="hljs-params">(<span class="hljs-type">const</span> MsgInfo&amp; info)</span></span><br><span class="hljs-function">  </span>&#123; ... &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°, å½“æˆ‘ä»¬å¯¹MsgSenderè¿›è¡Œå…¨ç‰¹åŒ–å, è¿™ä¸ªç‰¹åŒ–ç‰ˆæœ¬ä¸­å¹¶æ²¡æœ‰<code>sendClear</code>! ç„¶è€ŒLoggingMsgSenderä¸­ä½¿ç”¨åˆ°äº†sendClearè¿™ä¸ªå‡½æ•°, é‚£ä¹ˆå½“LoggingMsgSenderç»§æ‰¿åˆ°çš„æ˜¯è¿™ä¸ªç‰¹åŒ–ç‰ˆæœ¬æ—¶, æŠ¥é”™ä¹Ÿå°±åœ¨æ‰€éš¾å…äº†.</p><hr><h3 id="æ·±å…¥æ¢è®¨"><a href="#æ·±å…¥æ¢è®¨" class="headerlink" title="æ·±å…¥æ¢è®¨"></a>æ·±å…¥æ¢è®¨</h3><p>è¿™ç§ç°è±¡å‡ºç°çš„æœ¬è´¨åœ¨äº, åœ¨æ´¾ç”Ÿç±»ä¸­ä½¿ç”¨åˆ°çš„åŸºç±»çš„åŠŸèƒ½, å› ä¸ºç‰¹åŒ–çš„å­˜åœ¨, åœ¨ä¸€äº›ç‰ˆæœ¬æœ‰è¿™ç§åŠŸèƒ½, å¦å¤–ä¸€äº›ç‰ˆæœ¬å°±å¯èƒ½æ²¡æœ‰, æ‰€ä»¥C++å¯ä»¥é€‰æ‹©çš„æ–¹å¼è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ : </p><ul><li>å‡å®šç»§æ‰¿è€Œæ¥çš„åŸºç±»<strong>æ²¡æœ‰</strong>è¿™äº›åŠŸèƒ½, é™¤éç¨‹åºå‘˜æ˜ç¡®æŒ‡å‡ºæœ‰, ä¼šåœ¨ç¼–è¯‘æœŸæŠ¥é”™.</li><li>å‡å®šç»§æ‰¿è€Œæ¥çš„åŸºç±»<strong>æœ‰</strong>è¿™äº›åŠŸèƒ½, ç¨‹åºå‘˜è‡ªè¡Œæ‰¿æ‹…ç»§æ‰¿é”™è¯¯åŸºç±»çš„é£é™©, ä¼šåœ¨è¿è¡ŒæœŸæŠ¥é”™.</li></ul><p>åœ¨äº‹å®ä¸ŠC++é€‰æ‹©äº†å‰è€…, å› ä¸ºè¿™æ ·æ›´åŠ è§„èŒƒ, èµ·ç ä¸ä¼šåœ¨è¿è¡Œä¸­äº§ç”Ÿé”™è¯¯.</p><p>è€Œå…¶å¯¹åº”åšå‡ºçš„è¡Œä¸ºå°±æ˜¯ : <strong>C++ä¸è¿›å…¥templatized base classes(æ¨¡æ¿åŸºç±»)è§‚å¯Ÿ</strong>, ä¹Ÿå°±æ˜¯C++ä¸ä¼šå»æ¨¡æ¿åŸºç±»ä¸­æ‰¾ç”¨åˆ°çš„æˆå‘˜, é™¤éç¨‹åºå‘˜æŒ‡å®š, æˆ‘ä»¬æ¥ä¸‹æ¥å°†ä¼šä»‹ç»æŒ‡å®šæ–¹æ³•.</p><hr><h3 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h3><p>å…¶å®å°±æ˜¯åœ¨ç¨‹åºå‘˜é€šè¿‡è‡ªå·±çš„åˆ†æå, æ˜ç¡®å‘Šè¯‰å®ƒæœ‰å¯¹åº”çš„åŠŸèƒ½, æ€»å…±æœ‰ä¸‰ç§æ–¹å¼ : </p><ul><li><p>åœ¨åŸºç±»å‡½æ•°å‰åŠ ä¸Š<code>this-&gt;</code>.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sendClearMsg</span><span class="hljs-params">(<span class="hljs-type">const</span> MsgInfo&amp; info)</span></span><br><span class="hljs-function">  </span>&#123;<br>    ...<br>    <span class="hljs-keyword">this</span>-&gt;<span class="hljs-built_in">sendClear</span>(info);                <span class="hljs-comment">// ç¼–è¯‘é€šè¿‡</span><br>    ...<br>  &#125;<br></code></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨usingå£°æ˜å¼.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Company&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggingMsgSender</span>: <span class="hljs-keyword">public</span> MsgSender&lt;Company&gt; &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-keyword">using</span> MsgSender&lt;Company&gt;::sendClear;   <span class="hljs-comment">// æå‰å‘Šè¯‰ç¼–è¯‘å™¨åŸºç±»ä¸­å­˜åœ¨sendClear</span><br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sendClearMsg</span><span class="hljs-params">(<span class="hljs-type">const</span> MsgInfo&amp; info)</span></span><br><span class="hljs-function">  </span>&#123;<br>    ...<br>    <span class="hljs-built_in">sendClear</span>(info);    <span class="hljs-comment">// ç¼–è¯‘é€šè¿‡               </span><br>    ...<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure></li><li><p>æ˜ç¡®æŒ‡å‡ºå‡½æ•°ä½äºåŸºç±»å†….</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sendClearMsg</span><span class="hljs-params">(<span class="hljs-type">const</span> MsgInfo&amp; info)</span></span><br><span class="hljs-function"></span>&#123;<br>    ...<br>    MsgSender&lt;Company&gt;::<span class="hljs-built_in">sendClear</span>(info);      <span class="hljs-comment">// ç¼–è¯‘é€šè¿‡</span><br>    ...                                       <br>&#125;   <br></code></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼å¹¶ä¸æ¨è, å› ä¸ºå…¶ä¼šå…³é—­è™šå‡½æ•°çš„ç»‘å®šè¡Œä¸º, å¦‚æœsendClearæ˜¯è™šå‡½æ•°çš„è¯, å°†ä¼šå¼ºåˆ¶ä½¿ç”¨å½“å‰åŸºç±»çš„ç‰ˆæœ¬.</p></li></ul><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>ç»§æ‰¿æ¨¡æ¿åŸºç±»å, æƒ³è¦ä½¿ç”¨ç»§æ‰¿è€Œæ¥çš„æˆå‘˜, å¿…é¡»é€šè¿‡<code>this-&gt;</code>æˆ–<code>usingå£°æ˜å¼</code>æŒ‡å®š.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
      <tag>ç»§æ‰¿</tag>
      
      <tag>æ¨¡æ¿</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾42 typename</title>
    <link href="/2025/01/05/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE42%20typename/"/>
    <url>/2025/01/05/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE42%20typename/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾42-äº†è§£typenameçš„åŒé‡æ„ä¹‰"><a href="#æ¡æ¬¾42-äº†è§£typenameçš„åŒé‡æ„ä¹‰" class="headerlink" title="æ¡æ¬¾42 : äº†è§£typenameçš„åŒé‡æ„ä¹‰"></a>æ¡æ¬¾42 : äº†è§£typenameçš„åŒé‡æ„ä¹‰</h2><blockquote><p>æœ¬æ¡æ¬¾ä¸­æˆ‘ä»¬å°†äº†è§£typenameçš„ä¸¤ç§ä½¿ç”¨åœºæ™¯, å¯¹typenameçš„å†…æ¶µåŠä½¿ç”¨åŠ æ·±è®¤çŸ¥.</p></blockquote><h3 id="templateå£°æ˜å¼"><a href="#templateå£°æ˜å¼" class="headerlink" title="templateå£°æ˜å¼"></a>templateå£°æ˜å¼</h3><p>åœ¨templateçš„å£°æ˜ä¸­, <code>template&lt;class T&gt;</code>å’Œ<code>template&lt;typename T&gt;</code>éƒ½æ˜¯è¢«å…è®¸çš„, è¿™ä¸¤ç§å†™æ³•å¹¶æ²¡æœ‰ä»»ä½•å·®åˆ«, C++å¯¹è¿™ä¸¤ç§å†™æ³•ä¸€è§†åŒä», ä½†æ˜¯åœ¨çœŸæ­£ä½¿ç”¨ä¸­, ä½œè€…è¿˜æ˜¯å»ºè®®åœ¨ä¼ å…¥è‡ªå®šä¹‰ç±»æ—¶ç”¨class, åœ¨ä¼ å…¥ä»»æ„ç±»å‹(åŒ…æ‹¬intç­‰)æ—¶ç”¨typename, è¿™æ ·ä¼šå¢åŠ ä»£ç çš„å¯è¯»æ€§.</p><hr><h3 id="é’ˆå¯¹åµŒå¥—ä»å±ç±»å‹åç§°çš„åº”ç”¨"><a href="#é’ˆå¯¹åµŒå¥—ä»å±ç±»å‹åç§°çš„åº”ç”¨" class="headerlink" title="é’ˆå¯¹åµŒå¥—ä»å±ç±»å‹åç§°çš„åº”ç”¨"></a>é’ˆå¯¹åµŒå¥—ä»å±ç±»å‹åç§°çš„åº”ç”¨</h3><p>å…ˆè®©æˆ‘ä»¬è®¤è¯†<strong>åµŒå¥—ä»å±ç±»å‹åç§°</strong>çš„å®šä¹‰ : </p><ul><li>ä»å± : ä¾èµ–äºæŸä¸ªtemplateå‚æ•°.</li><li>åµŒå¥— : åœ¨classå†…å‘ˆåµŒå¥—çŠ¶.</li><li>ä»å±åµŒå¥—ç±»å‹åç§° : åœ¨classå†…å‘ˆåµŒå¥—çŠ¶ä¸”ä¾èµ–äºæŸä¸ªtemplateå‚æ•°çš„ç±»å‹åç§°.</li></ul><p>æˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„ä»£ç æ¥ç†è§£ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> C&gt;                           </span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">print2nd</span><span class="hljs-params">(<span class="hljs-type">const</span> C&amp; container)</span>              </span><br><span class="hljs-function"></span>&#123;                                               <br>  <span class="hljs-keyword">if</span> (container.<span class="hljs-built_in">size</span>() &gt;= <span class="hljs-number">2</span>) &#123;<br>     <span class="hljs-function">C::const_iterator <span class="hljs-title">iter</span><span class="hljs-params">(container.begin())</span></span>;  <span class="hljs-comment">// è¿™é‡Œçš„C::const_iteratorä¾¿æ˜¯ä»å±åµŒå¥—ç±»å‹åç§°</span><br>     ++iter;                                    <br>     <span class="hljs-type">int</span> value = *iter;                        <br>     std::cout &lt;&lt; value;                        <br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç æ˜¯æ— æ³•é€šè¿‡ç¼–è¯‘çš„, æˆ‘ä»¬åªæœ‰åœ¨å‰å¤´åŠ ä¸Štypenameæ‰å¯ä»¥é€šè¿‡ç¼–è¯‘, è¿™æ˜¯å› ä¸ºç¼–è¯‘å™¨èµ·åˆå¹¶ä¸ç¡®å®š<code>C::const_iterator</code>æ˜¯ä¸€ä¸ªç±»å‹åç§°, æ‰€ä»¥å½“ä½ æ˜ç¡®æŒ‡æ˜å…¶æ˜¯ä¸€ä¸ªç±»å‹åç§°ä¹‹å, ç¼–è¯‘å™¨å°±å¯ä»¥æ­£å¸¸è¿ä½œäº†.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">typename</span> C::const_iterator <span class="hljs-title">iter</span><span class="hljs-params">(container.begin())</span></span>; <span class="hljs-comment">// è¿™æ ·å°±å¯ä»¥äº†</span><br></code></pre></td></tr></table></figure><ul><li><p>æ‰€ä»¥ä¸ºä»€ä¹ˆç¼–è¯‘å™¨æ— æ³•ç¡®å®šè¿™æ˜¯ä¸€ä¸ªç±»å‹åç§°å‘¢? </p><p>å…¶å®æ˜¯ä¸ºäº†ä»£ç çš„ä¸¥è°¨æ€§, æˆ‘ä»¬ä¸¾ä¸€ä¸ªæç«¯ä¸€ç‚¹çš„ä¾‹å­ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">C::const_iterator* x;<br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬å†™ä¸‹è¿™æ ·çš„ä»£ç æ—¶, ç¼–è¯‘å™¨å¹¶ä¸çŸ¥é“<code>const_iterator</code>æ˜¯Cä¸­çš„ç±»å‹è¿˜æ˜¯æˆå‘˜å˜é‡, å¦‚æœå®ƒæ˜¯æˆå‘˜å˜é‡çš„è¯, é‚£ä¹ˆè¿™å…¶å®æ˜¯ä¸€ä¸ªä¹˜æ³•è¿ç®—å¼, *æ˜¯ä¹˜å·; å¦‚æœä»–æ˜¯ç±»å‹, é‚£ä¹ˆè¿™å…¶å®å°±æ˜¯ä¸€ä¸ªå®šä¹‰å¼, *ä»£è¡¨ç€æŒ‡é’ˆ. è¿™ä¸¤ç§æƒ…å†µéƒ½å®Œå…¨åˆæ³•, å› æ­¤éœ€è¦ç¨‹åºå‘˜æ˜ç¡®æŒ‡å‡ºå…¶ç©¶ç«Ÿæ˜¯ä»€ä¹ˆæ‰è¡Œ.</p></li></ul><hr><h3 id="ä¸¤ä¸ªä¾‹å¤–"><a href="#ä¸¤ä¸ªä¾‹å¤–" class="headerlink" title="ä¸¤ä¸ªä¾‹å¤–"></a>ä¸¤ä¸ªä¾‹å¤–</h3><p>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹, typenameå¿…é¡»ä½œä¸ºåµŒå¥—ä»å±ç±»å‹åç§°çš„å‰ç¼€è¯, è¿™ä¸€è§„åˆ™çš„ä¾‹å¤–æ˜¯, typenameä¸å¯å‡ºç°åœ¨<strong>ç»§æ‰¿è¯­å¥å’Œåˆå§‹å€¼åˆ—è¡¨</strong>ä¸­, è¿™æ˜¯C++ä¸­å®šæ­»çš„, æ²¡æœ‰å¿…è¦å»äº†è§£ä¸ºä»€ä¹ˆ, è®°ä½å°±è¡Œ.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span>: <span class="hljs-keyword">public</span> Base&lt;T&gt;::Nested &#123; <span class="hljs-comment">// ç»§æ‰¿è¯­å¥ä¸å¯åŠ typename </span><br><span class="hljs-keyword">public</span>:                                 <br>  <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Derived</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span><br><span class="hljs-function">  : Base&lt;T&gt;::Nested(x)                  // åˆå§‹å€¼åˆ—è¡¨ä¸å¯åŠ typename</span><br><span class="hljs-function">  &#123;</span>                                    <br><br>    <span class="hljs-keyword">typename</span> Base&lt;T&gt;::Nested temp;      <span class="hljs-comment">// è¿™é‡Œå¯ä»¥åŠ </span><br>    ...                               <br>  &#125;                                    <br>&#125;;<br></code></pre></td></tr></table></figure><hr><h3 id="typenameå’Œtypedefçš„ç»„åˆä½¿ç”¨"><a href="#typenameå’Œtypedefçš„ç»„åˆä½¿ç”¨" class="headerlink" title="typenameå’Œtypedefçš„ç»„åˆä½¿ç”¨"></a>typenameå’Œtypedefçš„ç»„åˆä½¿ç”¨</h3><p>æˆ‘ä»¬çŸ¥é“äº†typenameä¼šä¸åµŒå¥—ä»å±ç±»å‹åç§°ç»‘å®š, å¹¶ä¸”å…¶å®åœ¨ä¸€äº›æƒ…å†µä¸‹åµŒå¥—ä»å±ç±»å‹åç§°æ˜¯å¾ˆé•¿çš„, æˆ‘ä»¬ä¼šä¹ æƒ¯æŠŠtypedefä¸typenameç»„åˆ, å°†ä¸€ä¸ªç±»å‹çš„ä¹¦å†™é•¿åº¦ç¼©çŸ­, æˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„ä¾‹å­äº†è§£ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> IterT&gt;</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">workWithIterator</span><span class="hljs-params">(IterT iter)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> std::iterator_traits&lt;IterT&gt;::value_type value_type;<br>  <span class="hljs-function">value_type <span class="hljs-title">temp</span><span class="hljs-params">(*iter)</span></span>;<br>  ...<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯è¿™ä¸ªç»„åˆçš„ç»å…¸ç”¨æ³•, åœ¨STLæ ‡å‡†åº“ä¸­å°±æœ‰å¤§é‡çš„ä½¿ç”¨.</p><p>è¿™é‡Œé€šè¿‡typedefå°†<code>typename std::iterator_traits&lt;IterT&gt;::value_type</code>è¿™ä¸ªå¦‚æ­¤é•¿çš„ç±»å‹ç¼©çŸ­åˆ°<code>value_type</code>, ä¸ç”¨æƒ³ä¹Ÿä¸€å®šä¼šå‡å°‘å¤§é‡çš„ä»£ç é‡. è‡³äºä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆé•¿çš„ç±»å‹, è¿™ä¸<code>iterator_traits</code>çš„èƒå–åŠŸèƒ½æœ‰å…³, ç®€å•æ¥è¯´å°±æ˜¯<code>IterT</code>æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ç±»å‹,è€Œ<code>iterator_traits</code>å¯ä»¥æ ¹æ®<code>iterT</code>é€šè¿‡<code>value_type</code>èƒå–å‡ºè¿­ä»£å™¨æ‰€æŒ‡å‘èµ„æºçš„çœŸå®ç±»å‹T. æˆ‘ä»¬å°†åœ¨æ¡æ¬¾47ä¸­å†ä½œè®¨è®ºè¿™éƒ¨åˆ†å†…å®¹, å¦‚æœæƒ³æ·±å…¥å­¦ä¹ çš„è¯ä¹Ÿå¯ä»¥å»<code>STLæºç å‰–æ</code>ä¸­ç ”è¯».</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>typenameä½œä¸ºtemplateå‚æ•°æ—¶, å’Œclassæ„ä¹‰å®Œå…¨ç›¸åŒ.</li><li>typenameå¿…é¡»ä½œä¸ºåµŒå¥—ä»å±ç±»å‹åç§°çš„å‰ç¼€è¯, é™¤éåœ¨ç»§æ‰¿è¯­å¥å’Œåˆå§‹å€¼åˆ—è¡¨ä¸­.</li><li>å°†typedefå’Œtypenameç»„åˆå¯ä»¥å‡å°ä»£ç å¤æ‚åº¦.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾41 éšå¼æ¥å£å’Œç¼–è¯‘æœŸå¤šæ€</title>
    <link href="/2025/01/03/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE41%20%E9%9A%90%E5%BC%8F%E6%8E%A5%E5%8F%A3%E5%92%8C%E7%BC%96%E8%AF%91%E6%9C%9F%E5%A4%9A%E6%80%81/"/>
    <url>/2025/01/03/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE41%20%E9%9A%90%E5%BC%8F%E6%8E%A5%E5%8F%A3%E5%92%8C%E7%BC%96%E8%AF%91%E6%9C%9F%E5%A4%9A%E6%80%81/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾41-äº†è§£éšå¼æ¥å£å’Œç¼–è¯‘æœŸå¤šæ€"><a href="#æ¡æ¬¾41-äº†è§£éšå¼æ¥å£å’Œç¼–è¯‘æœŸå¤šæ€" class="headerlink" title="æ¡æ¬¾41 : äº†è§£éšå¼æ¥å£å’Œç¼–è¯‘æœŸå¤šæ€"></a>æ¡æ¬¾41 : äº†è§£éšå¼æ¥å£å’Œç¼–è¯‘æœŸå¤šæ€</h2><blockquote><p>ä»æœ¬æ¡æ¬¾å¼€å§‹, æˆ‘ä»¬å°†å¼€å§‹è®¨è®ºæ¨¡æ¿ä¸æ³›å‹ç¼–ç¨‹, templatesæœ€åˆçŸ¥è¯†ä¸ºäº†å»ºç«‹ç±»å‹å®‰å…¨çš„æ³›ç”¨å®¹å™¨, ä½†åœ¨ä¸æ–­çš„å‘å±•ä¸­æ³›å‹ç¼–ç¨‹çš„è§‚å¿µé€æ¸æˆå‹, ä½¿å¾—æˆ‘ä»¬æ‹¥æœ‰äº†å°†å†™å‡ºçš„ä»£ç å’Œå…¶æ‰€å¤„ç†çš„å¯¹è±¡ç±»å‹å½¼æ­¤ç‹¬ç«‹çš„æŠ€æœ¯. åœ¨æœ¬æ¡æ¬¾ä¸­æˆ‘ä»¬å°†äº†è§£ä¸¤ä¸ªæ³›å‹ç¼–ç¨‹ä¸­çš„æ ¸å¿ƒæ¦‚å¿µâ€“éšå¼æ¥å£å’Œç¼–è¯‘æœŸå¤šæ€.</p></blockquote><p>åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­, <strong>æ˜¾ç¤ºæ¥å£å’Œè¿è¡ŒæœŸå¤šæ€</strong>æ˜¯æˆ‘ä»¬ä¸»è¦ç ”ç©¶çš„å¯¹è±¡ : </p><ul><li>æ˜¾ç¤ºæ¥å£ : å‡½æ•°çš„ç­¾åå¼(å‡½æ•°åç§°, å‚æ•°ç±»å‹, è¿”å›ç±»å‹).</li><li>è¿è¡ŒæœŸå¤šæ€ : åœ¨è¿è¡ŒæœŸé€šè¿‡å¯¹è±¡çš„åŠ¨æ€ç±»å‹è¿›è¡ŒåŠ¨æ€ç»‘å®š, å¯ä»¥ä½¿ç›¸åŒçš„ä»£ç å±•ç°å‡ºå¤šæ€çš„æ•ˆç”¨.</li></ul><p>è€Œåœ¨templatesåŠæ³›å‹ç¼–ç¨‹çš„ä¸–ç•Œ, åº•å±‚é€»è¾‘å’Œé¢å‘å¯¹è±¡æœ‰æ ¹æœ¬çš„ä¸åŒ, ä½†ä¹Ÿä¸æ˜¯æ¯«ä¸ç›¸å¹², åœ¨å…¶ä¸­æ˜¾ç¤ºæ¥å£å’Œè¿è¡ŒæœŸå¤šæ€ä»ç„¶å­˜åœ¨, ä½†æ˜¯é‡è¦æ€§é™ä½, <strong>éšå¼æ¥å£å’Œç¼–è¯‘æœŸå¤šæ€</strong>æ˜¯å…¶ä¸­çš„é‡ä¸­ä¹‹é‡.</p><p>æˆ‘ä»¬å…ˆæ¥ä¸¾ä¸€ä¸ªä¾‹å­, å¸®åŠ©æˆ‘ä»¬ç†è§£ä¸Šé¢ä¸¤ä¸ªæ–°æ¦‚å¿µ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Widget</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-built_in">Widget</span>();<br>  <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Widget</span>();<br><br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> std::<span class="hljs-type">size_t</span> <span class="hljs-title">size</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">normalize</span><span class="hljs-params">()</span></span>;<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(Widget&amp; other)</span></span>;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">doProcessing</span><span class="hljs-params">(Widget&amp; w)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span> (w.<span class="hljs-built_in">size</span>() &gt; <span class="hljs-number">10</span> &amp;&amp; w != someNastyWidget) &#123;<br>      <span class="hljs-function">Widget <span class="hljs-title">temp</span><span class="hljs-params">(w)</span></span>;<br>      temp.<span class="hljs-built_in">normalize</span>();<br>      temp.<span class="hljs-built_in">swap</span>(w);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰å®é™…æ„ä¹‰çš„<code>Widget</code>ç±», åªæ˜¯ä¸ºäº†ä¿ƒè¿›æˆ‘ä»¬çš„ç†è§£, æ¥ä¸‹æ¥æˆ‘ä»¬å°†ä¼šå†™ä¸€ä¸ª<code>doProcessing</code>çš„æ¨¡æ¿ç‰ˆæœ¬ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">doProcessing</span><span class="hljs-params">(T&amp; w)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span> (w.<span class="hljs-built_in">size</span>() &gt; <span class="hljs-number">10</span> &amp;&amp; w != someNastyWidget) &#123;<br>     <span class="hljs-function">T <span class="hljs-title">temp</span><span class="hljs-params">(w)</span></span>;<br>     temp.<span class="hljs-built_in">normalize</span>();<br>     temp.<span class="hljs-built_in">swap</span>(w);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸åŸç‰ˆçš„å®ç°ç›¸ä¼¼, ä½†æ˜¯åœ¨å®é™…ç¼–è¯‘ä¸­ä¼šæœ‰å¾ˆå¤§çš„å·®åˆ«, æˆ‘ä»¬æ¯”è¾ƒç›´è§‚çš„ä¸€ä¸ªæ„Ÿå—å°±æ˜¯<strong>ç±»å‹Tè‡³å°‘åº”è¯¥æœ‰operator&gt;é‡è½½, operator!&#x3D;é‡è½½, æ‹·è´æ„é€ å‡½æ•°, normalizeæˆå‘˜å‡½æ•°, swapæˆå‘˜å‡½æ•°(ç”±ä¸Šè‡³ä¸‹)</strong>, ä¸ç„¶ç¼–è¯‘è‚¯å®šä¼šæŠ¥é”™, è¿™ä¾¿æ˜¯<strong>éšå¼æ¥å£</strong>æœ€ç®€å•çš„ä¸€ä¸ªç†è§£.</p><ul><li>éšå¼æ¥å£åœ¨å®šä¹‰ä¸Šæ˜¯æ¨¡æ¿å‡½æ•°ä¸­çš„éƒ¨åˆ†<strong>æœ‰æ•ˆè¡¨è¾¾å¼</strong>.</li></ul><p>ç®€å•æ¥è¯´å°±æ˜¯<strong>ç±»å‹Tå¿…é¡»å¯ä»¥åšåˆ°è¡¨è¾¾å¼ä¸­çš„è¡Œä¸º</strong>, <strong>å¦‚æœåšä¸åˆ°é‚£ä¾¿æ˜¯éšå¼æ¥å£ä¸åŒ¹é…</strong>, ç¼–è¯‘ä¾¿æ— æ³•é€šè¿‡, åœ¨æœ¬ä¾‹ä¸­çš„æœ‰æ•ˆè¡¨è¾¾å¼ä¾¿æ˜¯<code>w.size() &gt; 10 &amp;&amp; w != someNastyWidget</code>, <code>T temp(w)</code>ç­‰. </p><p>å¹¶ä¸”ç”±äºå…¶æ˜¯éšå¼æ¥å£, ä¹Ÿå¯ä»¥é€šè¿‡<strong>éšå¼è½¬æ¢</strong>æ¥è¿›è¡ŒåŒ¹é…, è¿™ä¹ˆè¯´æ¯”è¾ƒæ™¦æ¶©, ä¸¾ä¸ªä¾‹å­å°±æ˜¯<code>w.size() &gt; 10</code>è¿™ä¸ªè¡¨è¾¾å¼æ˜¯åº”å½“è¿”å›ä¸€ä¸ªboolç±»å‹çš„å‚æ•°çš„, ä½†å¦‚æœä½ çš„operator&gt;é‡è½½è¿”å›çš„æ˜¯intç±»å‹, å¹¶ä¸”ä»¥1ä½œä¸ºtrue, 0ä½œä¸ºfalse, é‚£ä¹ˆåœ¨ç¼–è¯‘ä¸­å®Œå…¨å¯ä»¥å°†intéšå¼è½¬æ¢ä¸ºboolç±»å‹, è¿›è€Œç»§ç»­æ¥ä¸‹æ¥çš„åˆ¤æ–­.</p><ul><li>ç¼–è¯‘æœŸå¤šæ€ : â€œä»¥ä¸åŒçš„templateå‚æ•°(T)å…·ç°åŒ–å‡ºæ¥çš„function templatesâ€ä¼šå¯¼è‡´è°ƒç”¨ä¸åŒçš„å‡½æ•°.</li></ul><p>ç”¨æœ¯è¯­æ¥è®², ç¼–è¯‘æœŸå¤šæ€åŸºäº<strong>æ¨¡æ¿å…·ç°åŒ–å’Œå‡½æ•°é‡è½½è§£æ</strong>, ä½†å…¶å®å¾ˆå®¹æ˜“ç†è§£, ç™½è¯è®²å°±æ˜¯<strong>åœ¨ç¼–è¯‘æœŸæ ¹æ®ä¸åŒçš„ç±»å‹å¯ä»¥è°ƒç”¨ä¸åŒä¸”å¯¹åº”çš„æˆå‘˜å‡½æ•°</strong>, å…¶æ•ˆæœä¸è¿è¡Œæ—¶å¤šæ€åœ¨è¿è¡ŒæœŸåŠ¨æ€ç»‘å®šçš„è¡Œä¸ºç›¸ä¼¼, å› æ­¤è¢«ç§°ä¸ºç¼–è¯‘æœŸå¤šæ€.</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>classes å’Œ templates éƒ½æ”¯æŒæ¥å£å’Œå¤šæ€, templatesä¸åªæœ‰classesæ‹¥æœ‰çš„æ˜¾ç¤ºæ¥å£å’Œè¿è¡Œæ—¶å¤šæ€, ä¹Ÿæœ‰è‡ªå·±ç‹¬æœ‰çš„éšå¼æ¥å£å’Œç¼–è¯‘æœŸå¤šæ€.</li><li>éšå¼æ¥å£åŸºäºæœ‰æ•ˆè¡¨è¾¾å¼, ç¼–è¯‘å™¨å¤šæ€åŸºäºæ¨¡æ¿å…·ç°åŒ–å’Œå‡½æ•°é‡è½½è§£æ.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
      <tag>æ¨¡æ¿</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾40 å¤šé‡ç»§æ‰¿</title>
    <link href="/2025/01/01/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE40%20%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF/"/>
    <url>/2025/01/01/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE40%20%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾40-æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨å¤šé‡ç»§æ‰¿"><a href="#æ¡æ¬¾40-æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨å¤šé‡ç»§æ‰¿" class="headerlink" title="æ¡æ¬¾40 : æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨å¤šé‡ç»§æ‰¿"></a>æ¡æ¬¾40 : æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨å¤šé‡ç»§æ‰¿</h2><blockquote><p>ç›¸æ¯”äºjavaé€‰æ‹©å•ç»§æ‰¿+æ¥å£ç±»å¤šç»§æ‰¿çš„æ–¹å¼, C++é€‰æ‹©äº†æ›´åŠ ç›´æ¥çš„æ–¹å¼, å…¶å…è®¸å¤šé‡ç»§æ‰¿å­˜åœ¨. ä¸å¯å¦è®¤çš„æ˜¯ç¡®å®å¤§å¤šæ•°æƒ…å†µä¸‹å•ç»§æ‰¿éƒ½å¯ä»¥èƒœä»», ä½†æ˜¯åŒæ ·ä¸å¯å¦è®¤çš„æ˜¯å¤šé‡ç»§æ‰¿ä¹Ÿä¸€å®šæœ‰å…¶ç”¨æ­¦ä¹‹åœ°. åœ¨æœ¬æ¡æ¬¾ä¸­, æˆ‘ä»¬å°†è®¤è¯†å¤šé‡ç»§æ‰¿, äº†è§£è¾…åŠ©å…¶å®ç°çš„è™šç»§æ‰¿æœºåˆ¶, å¹¶ä¸”çŸ¥æ™“å¤šé‡ç»§æ‰¿çš„ä¸»è¦åº”ç”¨åœºæ™¯.</p></blockquote><p>å¤šé‡ç»§æ‰¿çš„æ„æ€æ˜¯<strong>ç»§æ‰¿ä¸€ä¸ªä»¥ä¸Šçš„åŸºç±»</strong>, ä¸€èˆ¬æ¥è¯´<strong>æˆ‘ä»¬ä¸å¸Œæœ›è¿™äº›åŸºç±»åœ¨ç»§æ‰¿ä½“ç³»ä¸­åˆæœ‰æ›´é«˜çº§çš„ç»§æ‰¿</strong>, è¿™æ ·ä¼šå¸¦æ¥è±å½¢ç»§æ‰¿çš„é—®é¢˜, å¹¶ä¸”ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜, æˆ‘ä»¬è¿˜è¦ç¥­å‡ºè™šç»§æ‰¿è¿™ä¸€æœºåˆ¶æ¥å…‹æœ, æ¥ä¸‹æ¥æˆ‘ä»¬å°†ä¼šé€ä¸€ç®€å•ä»‹ç»è±å½¢ç»§æ‰¿å’Œè™šç»§æ‰¿æœºåˆ¶.</p><hr><h3 id="è±å½¢ç»§æ‰¿"><a href="#è±å½¢ç»§æ‰¿" class="headerlink" title="è±å½¢ç»§æ‰¿"></a>è±å½¢ç»§æ‰¿</h3><p>ç®€è€Œè¨€ä¹‹å°±æ˜¯æ´¾ç”Ÿç±»ç»§æ‰¿çš„å¤šä¸ªåŸºç±»ä¸­, å«æœ‰å…±åŒçš„çˆ¶ç±». å¦‚ä¸‹å›¾æ‰€ç¤º : </p><p><img src="/../img/image/001.png"></p><p>å¦‚æ­¤è¿™èˆ¬, å‡è®¾<code>IOFile</code>ä¸­æœ‰æˆå‘˜, é‚£ä¹ˆ<code>InputFile</code>å’Œ<code>OutputFile</code>ä¸­ä¹Ÿä¼šç»§æ‰¿ç›¸åº”çš„æˆå‘˜, é‚£ä¹ˆFileå°±ç»§æ‰¿åˆ°äº†ä¸¤ä»½ç›¸åŒçš„æˆå‘˜. é‚£ä¹ˆå¦‚ä½•å¤„ç†è¿™ç§æƒ…å†µå°±æ˜¯C++è¦è§£å†³çš„é—®é¢˜, å¦‚ä½•è§£å†³æœ‰ä¸¤æ´¾è§‚ç‚¹ : </p><ul><li><p>Fileä¸­å°±æ˜¯æœ‰ä¸¤ä»½æˆå‘˜, è¿™æ˜¯æœ€ç›´è§‚çš„é€»è¾‘, æ‰€ä»¥è°ƒç”¨æ—¶éƒ½å¿…é¡»æŒ‡å®šæ˜ç¡®çš„åŸºç±».</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp">File f;<br>cout &lt;&lt; f.InputFile.a &lt;&lt; endl;  <span class="hljs-comment">// å‡è®¾IOFileä¸­æœ‰æˆå‘˜å˜é‡a</span><br>cout &lt;&lt; f.OutputFile.a &lt;&lt; endl;<br>cout &lt;&lt; f.a &lt;&lt; endl; <span class="hljs-comment">// ç¼–è¯‘é”™è¯¯!</span><br></code></pre></td></tr></table></figure></li><li><p><code>IOFile</code>åªæœ‰ä¸€ä¸ªæ–‡ä»¶åç§°, æ‰€ä»¥ç»§æ‰¿è‡ª<code>IOFile</code>çš„æˆå‘˜ä¸åº”å½“é‡å¤.</p></li></ul><p><strong>C++é»˜è®¤ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ¡ˆ, æ¯•ç«Ÿè¿™æ˜¯æœ€ç›´è§‚çš„é€»è¾‘, ä½†åŒæ—¶ä¹Ÿæä¾›äº†è™šç»§æ‰¿æœºåˆ¶ä»¥æ”¯æŒç¬¬äºŒç§æ–¹æ¡ˆ.</strong></p><hr><h3 id="è™šç»§æ‰¿"><a href="#è™šç»§æ‰¿" class="headerlink" title="è™šç»§æ‰¿"></a>è™šç»§æ‰¿</h3><p>ç®€è€Œè¨€ä¹‹å°±æ˜¯å¯¹å­˜åœ¨è±å½¢ç»§æ‰¿çš„åŸºç±»ä»¬åœ¨ç»§æ‰¿æ—¶å‰åŠ virtual, é‚£ä¹ˆä»¥åå°±ä¸ä¼šå‡ºç°ç»§æ‰¿ä¸¤ä»½çš„æƒ…å†µäº†, C++åœ¨åº•å±‚ä¼šè§£å†³æ‰€æœ‰é—®é¢˜.</p><p>å›¾ç¤ºå¦‚ä¸‹ : </p><p><img src="/../img/image/002.png"></p><p>ä»£ç å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">File</span> &#123; ... &#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">InputFile</span>: <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">public</span> File &#123; ... &#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OutputFile</span>: <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">public</span> File &#123; ... &#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">IOFile</span>: <span class="hljs-keyword">public</span> InputFile,<br>              <span class="hljs-keyword">public</span> OutputFile<br>&#123; ... &#125;;<br></code></pre></td></tr></table></figure><p>å…·ä½“å®ç°ç»†èŠ‚æˆ‘ä»¬ä¸å†è¯¦è¿°, ä½†æ˜¯æˆ‘ä»¬æœ‰å¿…è¦å†æ¬¡æ˜ç¡®è™šç»§æ‰¿çš„åŠ£åŠ¿ : </p><ul><li>ä½¿ç”¨è™šç»§æ‰¿äº§ç”Ÿçš„å¯¹è±¡ä¼š<strong>ä½“ç§¯æ›´å¤§, è®¿é—®é€Ÿåº¦æ›´æ…¢</strong>.</li><li>æ´¾ç”Ÿç±»å¿…é¡»ä¸ºä»è™šç»§æ‰¿è€Œæ¥çš„åŸºç±»ä¸­çš„æˆå‘˜å˜é‡è¿›è¡Œ<strong>æ‰‹åŠ¨åˆå§‹åŒ–</strong>.</li></ul><p>è¿™å¯¹æˆ‘ä»¬çš„ä»£ç ç¼–å†™å’Œå®é™…è¿è¡Œéƒ½æœ‰ä¸€å®šå½±å“.</p><p>å¯¹äºè™šç»§æ‰¿, æˆ‘ä»¬å»ºè®®è¦<strong>å°½é‡é¿å…ä½¿ç”¨</strong>, å¦‚æœæœ‰å¿…è¦ä¹Ÿ<strong>ä¸è¦åœ¨è™šåŸºç±»ä¸­æ·»ç½®æˆå‘˜å˜é‡ç­‰æ•°æ®</strong>.</p><hr><h3 id="å¤šé‡ç»§æ‰¿çš„ä½¿ç”¨æƒ…æ™¯"><a href="#å¤šé‡ç»§æ‰¿çš„ä½¿ç”¨æƒ…æ™¯" class="headerlink" title="å¤šé‡ç»§æ‰¿çš„ä½¿ç”¨æƒ…æ™¯"></a>å¤šé‡ç»§æ‰¿çš„ä½¿ç”¨æƒ…æ™¯</h3><p>ä¸Šé¢çš„ä¸¤ä¸ªçŸ¥è¯†éƒ½è¿ç”¨åœ¨ç‰¹æ®Šæƒ…å†µä¸‹, ç„¶è€Œæˆ‘ä»¬å¹³æ—¶ä¸ä¼šæƒ³ä¹Ÿä¸å»ºè®®å‡ºç°è±å½¢ç»§æ‰¿çš„æƒ…å†µ. ç†Ÿç»ƒä½¿ç”¨å¤šé‡ç»§æ‰¿å¯ä»¥åœ¨ä¸€äº›æƒ…æ™¯ä¸‹è¾¾åˆ°äº‹åŠåŠŸå€çš„æ•ˆæœ, æœ‰ä¸€ç§æƒ…å†µæœ€ä¸ºå¸¸è§, å¦‚æœæˆ‘ä»¬<strong>å¸Œæœ›æŸä¸ªç±»publicç»§æ‰¿è‡ªæŸä¸ªæ¥å£ç±», å¹¶ä¸”privateç»§æ‰¿æŸä¸ªååŠ©å…¶å®ç°çš„class</strong>, æˆ‘ä»¬æ¥ä¸‹æ¥ä¹Ÿä¼šä¸¾å‡ºä¸€ä¸ªè¿™æ ·çš„ä¾‹å­ : </p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¡‘æ¨¡äººçš„æ¥å£ç±» : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">IPerson</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">IPerson</span>();<br><br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> std::string <span class="hljs-title">name</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> std::string <span class="hljs-title">birthDate</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;<br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªå¯¹äººå¡‘æ¨¡çš„æŠ½è±¡åŸºç±», æˆ‘ä»¬å¸Œæœ›ä½¿ç”¨å·¥å‚å‡½æ•°åˆ›é€ å‡ºä¸€äº›å¯ä»¥è¢«å½“ä½œ<code>IPerson</code>æ¥ä½¿ç”¨çš„å¯¹è±¡, è¿™äº›å¯¹è±¡çš„é™æ€ç±»å‹æ˜¯<code>IPerson</code>, åŠ¨æ€ç±»å‹æ˜¯<code>IPersonçš„æ´¾ç”Ÿç±»</code>, å·¥å‚å‡½æ•°é€šè¿‡å„ç§éœ€æ±‚å’Œæ¡ä»¶ç”Ÿæˆå¯¹åº”çš„å¯¹è±¡, å¦å¤–é™„åŠ ä¸€ç‚¹, è¿™ä¸ªå·¥å‚å‡½æ•°è¦ç”Ÿæˆä¸€ä¸ªPersonéœ€è¦ä¸€ä¸ªå­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„å”¯ä¸€id, éœ€è¦ä»ç”¨æˆ·å¤„è·å–, ç„¶åä¾¿å¯é€šè¿‡idè·å–Personçš„åŸºæœ¬ä¿¡æ¯ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">std::shared_ptr&lt;IPerson&gt; <span class="hljs-title">makePerson</span><span class="hljs-params">(DatabaseID personIdentifier)</span></span>;  <span class="hljs-comment">// å·¥å‚å‡½æ•°, éœ€è¦ä¸€ä¸ªæ•°æ®åº“id</span><br><br><span class="hljs-function">DatabaseID <span class="hljs-title">askUserForDatabaseID</span><span class="hljs-params">()</span></span>;  <span class="hljs-comment">// å‘ç”¨æˆ·è·å–idçš„åŠŸèƒ½å‡½æ•°</span><br><br><span class="hljs-function">DatabaseID <span class="hljs-title">id</span><span class="hljs-params">(askUserForDatabaseID())</span></span>;  <span class="hljs-comment">// ç”¨è·å–åˆ°çš„idåˆ›å»ºDatabaseIDå¯¹è±¡</span><br><span class="hljs-function">std::shared_ptr&lt;IPerson&gt; <span class="hljs-title">pp</span><span class="hljs-params">(makePerson(id))</span></span>;  <span class="hljs-comment">// å°†è¯¥å¯¹è±¡ä¼ å…¥å·¥å‚å‡½æ•°ç”Ÿæˆéœ€æ±‚å¯¹è±¡</span><br></code></pre></td></tr></table></figure><p>æœ‰äº†è¿™äº›å‰æˆ, æˆ‘ä»¬å°±éœ€è¦æä¾›<code>IPerson</code>çš„æ´¾ç”Ÿç±»äº†, æˆ‘ä»¬å‡è®¾è¿™ä¸ªclassåä¸º<code>CPerson</code>, å…¶å¿…é¡»ç»§æ‰¿è‡ª<code>IPerson</code>, å½“ç„¶æˆ‘ä»¬è‡ªç„¶å¯ä»¥ä»æ— åˆ°æœ‰ä»å†™æ‰€æœ‰<code>IPerson</code>ä¼ æ¥çš„æ¥å£å‡½æ•°, ä½†æ˜¯å‡å¦‚æˆ‘ä»¬æœ‰ç°æˆçš„ä¸€ä¸ªå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°çš„ç±», ç»§æ‰¿å®ƒå¯èƒ½æ˜¯æœ€å¥½çš„é€‰æ‹© : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonInfo</span> &#123;<span class="hljs-comment">// è¿™ä¸ªç±»è¢«ç”¨æ¥ååŠ©ä»¥å„ç§æ ¼å¼æ‰“å°ä»æ•°æ®åº“ä¸­è°ƒå‡ºçš„æ•°æ®</span><br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">PersonInfo</span><span class="hljs-params">(DatabaseID pid)</span></span>;<br>  <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">PersonInfo</span>();<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> * <span class="hljs-title">theName</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> * <span class="hljs-title">theBirthDate</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>  ...<br><span class="hljs-keyword">private</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> * <span class="hljs-title">valueDelimOpen</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;      <span class="hljs-comment">// ä¼ å‡ºå­—ç¬¦ä¸²çš„å‰ç¼€</span><br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> * <span class="hljs-title">valueDelimClose</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;     <span class="hljs-comment">// ä¼ å‡ºå­—ç¬¦ä¸²çš„åç¼€</span><br>  ...<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">char</span> * <span class="hljs-title">PersonInfo::valueDelimOpen</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;[&quot;</span>;                       <span class="hljs-comment">// é»˜è®¤å‰ç¼€, å¯é‡å†™</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">char</span> * <span class="hljs-title">PersonInfo::valueDelimClose</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;]&quot;</span>;                       <span class="hljs-comment">// é»˜è®¤åç¼€, å¯é‡å†™</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">char</span> * <span class="hljs-title">PersonInfo::theName</span><span class="hljs-params">()</span> <span class="hljs-type">const</span>   <span class="hljs-comment">// è¿™ä¸ªå‡½æ•°å°†ä¼šé€šè¿‡ä¼ å…¥çš„æ•°æ®åº“idè°ƒå‡ºä¸”ç”ŸæˆåŠ å·¥åçš„name</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">static</span> <span class="hljs-type">char</span> value[Max_Formatted_Field_Value_Length];  <span class="hljs-comment">// ç¼“å­˜åŒº</span><br>  std::<span class="hljs-built_in">strcpy</span>(value, <span class="hljs-built_in">valueDelimOpen</span>());  <span class="hljs-comment">// å†™å…¥å‰ç¼€</span><br><br>  <span class="hljs-comment">// ä¸­é—´å¯èƒ½ä¼šå¾ˆé•¿, ä¼šå®ç°åˆ©ç”¨idä»æ•°æ®åº“ä¸­è°ƒç”¨nameçš„æ“ä½œ</span><br> <br>  std::<span class="hljs-built_in">strcat</span>(value, <span class="hljs-built_in">valueDelimClose</span>());  <span class="hljs-comment">// å†™å…¥åç¼€</span><br><br>  <span class="hljs-keyword">return</span> value;<br>&#125;<br></code></pre></td></tr></table></figure><p>äºæ˜¯æˆ‘ä»¬ä¾¿å¯å†™å‡ºä¸€ä¸ªpublicç»§æ‰¿è‡ª<code>IPerson</code>, privateç»§æ‰¿è‡ª<code>PersonInfo</code>çš„<code>CPerson</code>æ´¾ç”Ÿç±», ä»–<strong>é€šè¿‡PersonInfoæä¾›çš„åŠŸèƒ½å®ç°äº†IPersonç»§æ‰¿æ¥çš„æ¥å£</strong>, è¿™ç§å¤šé‡ç»§æ‰¿ç¡®å®æ˜¯<strong>æœ€åˆç†æœ€é«˜æ•ˆæœ€ç®€æ´</strong>çš„åšæ³• : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CPerson</span>: <span class="hljs-keyword">public</span> IPerson, <span class="hljs-keyword">private</span> PersonInfo &#123;     <span class="hljs-comment">// é‡‡ç”¨å¤šé‡ç»§æ‰¿</span><br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">CPerson</span><span class="hljs-params">(    DatabaseID pid)</span>: PersonInfo(pid) &#123;</span>&#125;<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> std::string <span class="hljs-title">name</span><span class="hljs-params">()</span> <span class="hljs-type">const</span>                      </span><br><span class="hljs-function">  </span>&#123; <span class="hljs-keyword">return</span> PersonInfo::<span class="hljs-built_in">theName</span>(); &#125;                     <span class="hljs-comment">// ç›´æ¥å–ç”¨PersonInfoçš„åŠŸèƒ½è°ƒå‡ºnameå­—ç¬¦ä¸²</span><br>                                                        <br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> std::string <span class="hljs-title">birthDate</span><span class="hljs-params">()</span> <span class="hljs-type">const</span>                 </span><br><span class="hljs-function">  </span>&#123; <span class="hljs-keyword">return</span> PersonInfo::<span class="hljs-built_in">theBirthDate</span>(); &#125;<span class="hljs-comment">// åŒç†</span><br>&#125;; <br></code></pre></td></tr></table></figure><p>å½“å‰name()ä¼ å‡ºçš„å­—ç¬¦ä¸²æ˜¯<code>[name]</code>è¿™ç§é£æ ¼, å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ ¹æ®éœ€æ±‚æ”¹å˜ä¿¡æ¯çš„æ ¼å¼, æˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å†™<code>PersonInfo</code>è™šå‡½æ•°çš„æ–¹å¼æ”¹å˜æ ¼å¼ :</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CPerson</span>: <span class="hljs-keyword">public</span> IPerson, <span class="hljs-keyword">private</span> PersonInfo &#123;   <br>    ...<br><span class="hljs-keyword">private</span>:                                                <br>  <span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">char</span> * <span class="hljs-title">valueDelimOpen</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&lt;&quot;</span>; &#125;    <span class="hljs-comment">// è¿™é‡Œé‡å†™è™šå‡½æ•°</span><br>  <span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">char</span> * <span class="hljs-title">valueDelimClose</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&gt;&quot;</span>; &#125;   <span class="hljs-comment">// ä¼ å‡ºçš„æ ¼å¼æ”¹ä¸º : &lt;name&gt;</span><br>&#125;; <br></code></pre></td></tr></table></figure><hr><h3 id="å°¾å£°"><a href="#å°¾å£°" class="headerlink" title="å°¾å£°"></a>å°¾å£°</h3><p>è¯·æŠŠå¤šé‡ç»§æ‰¿å½“ä½œæˆä¸€ä¸ªå·¥å…·, å®ƒå¯ä»¥å°†ä¸åŒçš„ç±»ä»¥ä¸åŒçš„æ–¹å¼ç»“åˆåˆ°ä¸€èµ·, publicç»§æ‰¿æ„å‘³ç€â€is-aâ€, privateç»§æ‰¿æ„å‘³ç€â€is-implemented-in-terms-ofâ€, å½“ç„¶å¦‚æœä½ æœ‰ä¸€ä¸ªå•ç»§æ‰¿çš„è®¾è®¡æ–¹æ¡ˆå¯ä»¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæœ, é‚£ä¹ˆè¿˜æ˜¯åº”å½“é€‰ç”¨å•ç»§æ‰¿. å¤šç»§æ‰¿åªæ˜¯åœ¨ä¸€äº›æƒ…å†µä¸‹æ˜¯æœ€åˆç†æœ€é«˜æ•ˆæœ€ç®€æ´çš„åšæ³•.</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>å¤šç»§æ‰¿ä¼šæ¯”å•ç»§æ‰¿å¤æ‚, å¹¶ä¸”æœ‰å¯èƒ½ä¼šå¯¼è‡´è±å½¢ç»§æ‰¿, å¼•å‘å¯¹è™šç»§æ‰¿çš„éœ€æ±‚.</li><li>è™šç»§æ‰¿ä¼šå¢åŠ å¤§å°, é€Ÿåº¦, åˆå§‹åŒ–ç­‰æˆæœ¬, å¦‚æœè™šç»§æ‰¿å»ºè®®è™šåŸºç±»ä¸è¦å¸¦ä»»ä½•æ•°æ®.</li><li>å¤šç»§æ‰¿ç¡®å®æœ‰å…¶ç”¨æ­¦ä¹‹åœ°, ä¸€ç§å¸¸è§æƒ…å†µæ˜¯â€æŸä¸ªç±»publicç»§æ‰¿è‡ªæŸä¸ªæ¥å£ç±», å¹¶ä¸”privateç»§æ‰¿æŸä¸ªååŠ©å…¶å®ç°çš„classâ€.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>ç»§æ‰¿</tag>
      
      <tag>Effectiv C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾38-39 å¤åˆå’Œprivateç»§æ‰¿</title>
    <link href="/2024/12/29/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE38-39%20%E5%A4%8D%E5%90%88%E5%92%8Cprivate%E7%BB%A7%E6%89%BF/"/>
    <url>/2024/12/29/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE38-39%20%E5%A4%8D%E5%90%88%E5%92%8Cprivate%E7%BB%A7%E6%89%BF/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾38-é€šè¿‡å¤åˆå¡‘è†œå‡ºhas-aæˆ–â€æ ¹æ®æŸç‰©å®ç°å‡ºâ€"><a href="#æ¡æ¬¾38-é€šè¿‡å¤åˆå¡‘è†œå‡ºhas-aæˆ–â€æ ¹æ®æŸç‰©å®ç°å‡ºâ€" class="headerlink" title="æ¡æ¬¾38 : é€šè¿‡å¤åˆå¡‘è†œå‡ºhas-aæˆ–â€æ ¹æ®æŸç‰©å®ç°å‡ºâ€"></a>æ¡æ¬¾38 : é€šè¿‡å¤åˆå¡‘è†œå‡ºhas-aæˆ–â€æ ¹æ®æŸç‰©å®ç°å‡ºâ€</h2><blockquote><p>åœ¨æ¡æ¬¾32ä¸­æˆ‘ä»¬è®¤è¯†äº†publicç»§æ‰¿æ„å‘³ç€is-a, æœ¬æ¡æ¬¾å°†ä¼šè®¤è¯†ä¸¤ä¸ªæ–°çš„å…³ç³», å‡å¯é€šè¿‡â€å¤åˆâ€è¿™ä¸€æ“ä½œå®ç°å‡ºæ¥.</p></blockquote><hr><h3 id="å¤åˆ"><a href="#å¤åˆ" class="headerlink" title="å¤åˆ"></a>å¤åˆ</h3><p>æ‰€è°“<strong>å¤åˆ</strong>, å°±æ˜¯<strong>æŸç§ç±»å‹çš„å¯¹è±¡å†…å«å…¶ä»–ç±»å‹çš„å¯¹è±¡,</strong> å…¶å®éå¸¸å®¹æ˜“ç†è§£, æˆ‘ä»¬é€šè¿‡ä»£ç ç†è§£ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> &#123; ... &#125;;           <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PhoneNumber</span> &#123; ... &#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  ...<br><span class="hljs-keyword">private</span>:<br>  std::string name;              <span class="hljs-comment">// å¤åˆstd::string</span><br>  Address address;               <span class="hljs-comment">// å¤åˆAddress</span><br>  PhoneNumber voiceNumber;       <span class="hljs-comment">// å¤åˆPhoneNumber</span><br>  PhoneNumber faxNumber;          <br>&#125;;<br></code></pre></td></tr></table></figure><p><code>Person</code>ç±»ä¾¿æ˜¯å¤åˆäº†<code>Address</code>å’Œ<code>PhoneNumber</code>ä¸¤ä¸ªç±».</p><hr><h3 id="ä¸¤ç§æ„ä¹‰"><a href="#ä¸¤ç§æ„ä¹‰" class="headerlink" title="ä¸¤ç§æ„ä¹‰"></a>ä¸¤ç§æ„ä¹‰</h3><p>ä½¿ç”¨å¤åˆæ‰‹æ³•åœ¨ä¸åŒé¢†åŸŸçš„å¯¹è±¡ä¸Š, æœ‰ä¸åŒçš„æ„ä¹‰, æˆ‘ä»¬å…ˆæ¥å®šä¹‰ä¸¤ä¸ªé¢†åŸŸ : </p><ul><li>åº”ç”¨åŸŸ : å½“ä¸€ä¸ªå†…ç½®å¯¹è±¡çš„ç›®çš„æ˜¯â€<strong>è¿™ä¸ªç±»èƒ½åšåˆ°ä»€ä¹ˆ(what)</strong>â€œ, å®ƒå±äºåº”ç”¨åŸŸ, ä¸Šé¢çš„åœ°å€å’Œç”µè¯ä¾¿æ˜¯å¦‚æ­¤.</li><li>å®ç°åŸŸ : å½“ä¸€ä¸ªå†…ç½®å¯¹è±¡çš„ç›®çš„æ˜¯â€<strong>è¿™ä¸ªç±»å¦‚ä½•åšåˆ°(how)</strong>â€œ, å®ƒå±äºå®ç°ç±».</li></ul><p>åœ¨è®¾ç½®ä¸åŒåŸŸçš„å¯¹è±¡å…¶ä»£è¡¨çš„æ„ä¹‰ä¹Ÿä¸åŒ, è®©æˆ‘ä»¬çœ‹ä¸‹é¢ä¸¤ç§æ„ä¹‰ : </p><ul><li><p><strong>has-a(æœ‰ä¸€ä¸ª)</strong> </p><p>å½“å¯¹è±¡å±äºåº”ç”¨åŸŸ, å¦‚æœAå¤åˆäº†B, åˆ™ä»£è¡¨Aæœ‰ä¸€ä¸ªB, Aå¯ä»¥åšå‡ºBçš„æ‰€æœ‰è¡Œä¸º, ä½†ä¸å¼ºåˆ¶, ä¾‹å¦‚äººæœ‰ä¸€ä¸ªå®¶.</p></li><li><p><strong>is-implemented-in-terms-of(æ ¹æ®æŸç‰©å®ç°å‡º)</strong> </p><p>å½“å¯¹è±¡å±äºå®ç°åŸŸ, å¦‚æœAå¤åˆäº†B, åˆ™ä»£è¡¨Aæ ¹æ®Bå®ç°å‡ºæ¥, Aæƒ³è¦å®ç°è‡ªå·±çš„åŠŸèƒ½è¦å€ŸåŠ©Bçš„åŠŸèƒ½, ä¾‹å¦‚æ ‡å‡†åº“ä¸­çš„unordered_setæ ¹æ®HashTableå®ç°å‡ºæ¥.</p><p>æˆ‘å¦‚æœä¸æƒ³ç”¨HashTableå®ç°set, ä¹Ÿå¯ä»¥ç”¨listæ¥å®ç°, ä¹¦ä¸­ç»™å‡ºçš„ä¾‹å­æ˜¯è¿™æ ·çš„ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;                 <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Set</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">member</span><span class="hljs-params">(<span class="hljs-type">const</span> T&amp; item)</span> <span class="hljs-type">const</span></span>;<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(<span class="hljs-type">const</span> T&amp; item)</span></span>;<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">remove</span><span class="hljs-params">(<span class="hljs-type">const</span> T&amp; item)</span></span>;<br>  <span class="hljs-function">std::<span class="hljs-type">size_t</span> <span class="hljs-title">size</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>  std::list&lt;T&gt; rep;                 <span class="hljs-comment">// å¤ç”¨listå®ç°å¦ä¸€ä¸ªç‰ˆæœ¬çš„set.</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>äºæ˜¯Setå°±å¯ä»¥ä¾é listæä¾›çš„æœºèƒ½æ¥å®ç°è‡ªå·±çš„åŠŸèƒ½ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-type">bool</span> Set&lt;T&gt;::<span class="hljs-built_in">member</span>(<span class="hljs-type">const</span> T&amp; item) <span class="hljs-type">const</span><br>&#123;<br>  <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">find</span>(rep.<span class="hljs-built_in">begin</span>(), rep.<span class="hljs-built_in">end</span>(), item) != rep.<span class="hljs-built_in">end</span>();<br>&#125;<br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-type">void</span> Set&lt;T&gt;::<span class="hljs-built_in">insert</span>(<span class="hljs-type">const</span> T&amp; item)<br>&#123;<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">member</span>(item)) rep.<span class="hljs-built_in">push_back</span>(item);<br>&#125;<br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-type">void</span> Set&lt;T&gt;::<span class="hljs-built_in">remove</span>(<span class="hljs-type">const</span> T&amp; item)<br>&#123;<br>  <span class="hljs-keyword">typename</span> std::list&lt;T&gt;::iterator it =               <br>    std::<span class="hljs-built_in">find</span>(rep.<span class="hljs-built_in">begin</span>(), rep.<span class="hljs-built_in">end</span>(), item);        <br>  <span class="hljs-keyword">if</span> (it != rep.<span class="hljs-built_in">end</span>()) rep.<span class="hljs-built_in">erase</span>(it);<br>&#125;<br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br>std::<span class="hljs-type">size_t</span> Set&lt;T&gt;::<span class="hljs-built_in">size</span>() <span class="hljs-type">const</span><br>&#123;<br>  <span class="hljs-keyword">return</span> rep.<span class="hljs-built_in">size</span>();<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>publicç»§æ‰¿çš„æ„ä¹‰å®Œå…¨ä¸åŒ.</li><li>åœ¨åº”ç”¨åŸŸä¸­, å¤åˆæ„å‘³ç€<code>has-a</code>. åœ¨å®ç°åŸŸ, å¤åˆæ„å‘³ç€<code>is-implemented-in-terms-of</code></li></ul><hr><h2 id="æ¡æ¬¾39-æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨privateç»§æ‰¿"><a href="#æ¡æ¬¾39-æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨privateç»§æ‰¿" class="headerlink" title="æ¡æ¬¾39 : æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨privateç»§æ‰¿"></a>æ¡æ¬¾39 : æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨privateç»§æ‰¿</h2><blockquote><p>é€šè¿‡æœ¬æ¡æ¬¾, ä½ å°†æ˜æ™°privateç»§æ‰¿åœ¨ç»§æ‰¿ä½“ç³»ä¸­å……å½“äº†ä»€ä¹ˆæ ·çš„è§’è‰², å…¶ä¸publicç»§æ‰¿å’Œå¤åˆåˆæœ‰æ€æ ·çš„åŒºåˆ«.</p></blockquote><p>æ²¡é”™, privateç»§æ‰¿ä¹Ÿæœ‰å…¶æ‰€æ„å‘³çš„ä¸œè¥¿, ä½†æ˜¯è¿™ä¸ªæ„ä¹‰æˆ‘ä»¬å·²ç»äº†è§£è¿‡äº†, é‚£å°±æ˜¯<strong>is-implemented-in-terms-of</strong>.</p><p>æ²¡é”™, privateç»§æ‰¿å’Œå¤åˆé™¤å¼€åœ¨åº•å±‚çš„å®ç°ç»†èŠ‚ä¸åŒ, å®ƒä»¬å¯ä»¥å®ç°ç›¸åŒçš„ç›®çš„, è™½ç„¶æœ‰ç€ä¸åŒçš„é™åˆ¶.</p><p>æˆ‘ä»¬è¿˜æ˜¯å…ˆå›å¿†ä¸€ä¸‹privateç»§æ‰¿ä¼šå‘ç”Ÿä»€ä¹ˆ : </p><ul><li>ç¼–è¯‘å™¨<strong>ä¸ä¼šè‡ªåŠ¨å°†è¯¥æ´¾ç”Ÿç±»å¯¹è±¡éšå¼è½¬æ¢ä¸ºåŸºç±»å¯¹è±¡</strong>, ä¹Ÿå°±æ˜¯è¯´åŸºç±»å‚æ•°æ¥å£å°†æ— æ³•æ¥å—è¯¥å¯¹è±¡.</li><li>æ‰€æœ‰ä»åŸºç±»ç»§æ‰¿è€Œæ¥çš„å±æ€§åœ¨æ´¾ç”Ÿç±»ä¸­<strong>éƒ½æ˜¯privateçš„</strong>, çºµä½¿å®ƒä»¬åŸæ¥æ˜¯public&#x2F;protect.</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123; <br>...<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">speak</span><span class="hljs-params">()</span></span>;    <br>    ...<br>&#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>: <span class="hljs-keyword">private</span> Person &#123; ... &#125;;     <span class="hljs-comment">// å¦‚æœæ˜¯privateç»§æ‰¿Person</span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">eat</span><span class="hljs-params">(<span class="hljs-type">const</span> Person&amp; p)</span></span>;   <span class="hljs-comment">// æŒ‰å¸¸ç†æ‰€æœ‰äººéƒ½å¯ä»¥åƒ</span><br><br>Person p;                                  <span class="hljs-comment">// p is a Person</span><br>Student s;                                 <span class="hljs-comment">// s is a Student</span><br><br><span class="hljs-built_in">eat</span>(p);                                    <span class="hljs-comment">// æ­£ç¡®</span><br><span class="hljs-built_in">eat</span>(s);   <span class="hljs-comment">// é”™è¯¯! æ— æ³•éšå¼è½¬æ¢ä¸ºåŸºç±»</span><br>cout &lt;&lt; s.<span class="hljs-built_in">speak</span>() &lt;&lt; endl;   <span class="hljs-comment">// é”™è¯¯! publicå·²ç»è½¬ä¸ºprivate</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºprivateç»§æ‰¿å’Œ<code>is-a</code>çš„å…³ç³»å®Œå…¨ä¸æ²¾è¾¹, æœ€ç»ˆçš„å®é™…æ•ˆæœå…¶å®å°±æ˜¯<code>is-implemented-in-terms-of</code>(æ ¹æ®æŸç‰©å®ç°å‡º).</p><p>è‹¥B privateç»§æ‰¿ è‡ªA, è¯´æ˜Aéœ€è¦é‡‡ç”¨Bä¸­å¤‡å¦¥çš„æŸäº›ç‰¹æ€§, Aä¸éœ€è¦ä¼ é€’Bçš„ä»€ä¹ˆæ¥å£, è€Œæ˜¯å¸Œæœ›ä½¿ç”¨Bçš„ä¸€éƒ¨åˆ†åŠŸèƒ½å®ç°, å¯ä»¥æ˜¯ç›´æ¥ä½¿ç”¨, ä¹Ÿå¯ä»¥æ˜¯æœ‰ç›®çš„çš„é‡å†™, æˆ‘ä»¬å¯ä»¥è‚¯å®šçš„æ˜¯è¿™æ ·è‡³å°‘è¦æ¯”æˆ‘ä»¬å•ç‹¬å®ç°ä¸€ä»½éœ€æ±‚çš„åŠŸèƒ½æ¥å¾—æ–¹ä¾¿.</p><hr><h3 id="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨privateç»§æ‰¿"><a href="#ä»€ä¹ˆæ—¶å€™ä½¿ç”¨privateç»§æ‰¿" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨privateç»§æ‰¿"></a>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨privateç»§æ‰¿</h3><p>æ—¢ç„¶æˆ‘ä»¬çŸ¥é“privateç»§æ‰¿å’Œå¤åˆéƒ½å¯ä»¥å®ç°<code>is-implemented-in-terms-of</code>çš„æ•ˆæœ, é‚£ä¹ˆåº”è¯¥é€‰å“ªä¸ªå‘¢? </p><p>ç­”æ¡ˆæ˜¯å¦‚æœå¯ä»¥é€‰å¤åˆ, æœ€å¥½ä¼˜å…ˆé€‰æ‹©å¤åˆ, æ¯•ç«Ÿprivateç»§æ‰¿æœ‰æ—¶ååˆ†æ™¦æ¶©, ä¼šå¤§å¤§é™ä½ä»£ç çš„å¯è¯»æ€§, æˆ‘ä»¬å¯¹privateç»§æ‰¿çš„ä½¿ç”¨åº”å½“æ˜¯<strong>æ˜æ™ºè€Œå®¡æ…</strong>çš„.</p><p>æ¥ä¸‹æˆ‘ä»¬å°†è¯´æ˜ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥é€‰ç”¨privateç»§æ‰¿ : </p><ul><li><p><strong>æ¶‰åŠprotectedæˆå‘˜&#x2F;virtualå‡½æ•°æ—¶</strong>. å½“æˆ‘ä»¬å¸Œæœ›ç»§æ‰¿å¹¶é‡å†™ä¸€äº›virtualå‡½æ•°æˆ–æ˜¯ä½¿ç”¨ä¸€äº›protectedæˆå‘˜æ—¶, å¦‚æœæˆ‘ä»¬<strong>ä¸å¸Œæœ›å®ƒä»¬å°†åŸºç±»æ¥å£æˆ–æˆå‘˜æš´éœ²å‡ºå»</strong>, å°±å¯ä»¥é‡‡ç”¨privateç»§æ‰¿, å› ä¸ºå…¶æœ‰å¤©ç„¶è½¬æ¢ä¸ºprivateçš„å±æ€§.</p><p>ä»¥ä¸‹æ˜¯ä¹¦ä¸­çš„ä¸€ä¸ªä¾‹å­, <code>Widget</code>æƒ³åˆ©ç”¨<code>Timer</code>ä¸­çš„è®¡æ—¶æœºåˆ¶æ¥å®ç°ä¸€äº›å®šæ—¶è§¦å‘çš„æœºåˆ¶, å®ƒå¸Œæœ›é‡å†™å…¶ä¸­çš„<code>onTick()</code> : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Timer</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Timer</span><span class="hljs-params">(<span class="hljs-type">int</span> tickFrequency)</span></span>;<br>   <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">onTick</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;     <span class="hljs-comment">// Timeræ¯è¿‡ä¸€æ®µæ—¶é—´å°±ä¼šè§¦å‘ä¸€æ¬¡onTick()</span><br>  ...<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Widget</span>: <span class="hljs-keyword">private</span> Timer &#123;<span class="hljs-comment">// privateç»§æ‰¿</span><br><span class="hljs-keyword">private</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">onTick</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;      <span class="hljs-comment">// é‡å†™Timerä¸­çš„onTick(), ä½¿å…¶å¯ä»¥å®šæ—¶æŸ¥çœ‹Widgetçš„æ•°æ®...</span><br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™æ ·ç”¨æˆ·å°±ä¸å¯èƒ½åœ¨å¤–éƒ¨è°ƒç”¨åˆ°ä»»ä½•çš„<code>onTick</code>å‡½æ•°(åŒ…æ‹¬åŸºç±»å’Œæ´¾ç”Ÿç±»çš„), æ¯•ç«Ÿè¿™åªæ˜¯ä¸ºäº†å®ç°å†…éƒ¨çš„åŠŸèƒ½.</p></li><li><p><strong>æœ‰æå¤§çš„ç©ºé—´è¦æ±‚æ—¶</strong>. æˆ‘ä»¬æœ‰æ—¶ä¼šé¢å¯¹ä¸€äº›ç©ºé—´ååˆ†æœ‰é™çš„æƒ…å†µ, æˆ‘ä»¬ä¼šéå¸¸å¸Œæœ›å»èŠ‚çœç©ºé—´, é‚£ä¹ˆæœ‰ä¸€é¡¹æŠ€æœ¯å€¼å¾—æˆ‘ä»¬ç ”ç©¶ : </p><p>å…ˆå¼•å…¥ä¸€äº›å‰æ, æˆ‘ä»¬æœ‰äº›æ—¶å€™ä¼šæœ‰åˆ›å»ºå¹¶ä½¿ç”¨ä¸€äº›<strong>ç©ºç±»</strong>çš„éœ€æ±‚, ç›®çš„åœ¨äºç”¨ä½œç±»å‹æ ‡è¯†, å ä½ç¬¦, ç©ºå¯¹è±¡ä¹‹ç±»çš„éœ€æ±‚, è¿™æ ·çš„éœ€æ±‚å§‹ç»ˆå­˜åœ¨å¹¶ä¸”åœ¨ç°ä»£C++çš„é‡è¦æ€§é€æ­¥æå‡, æ¯”å¦‚é€šè¿‡ç±»å‹è¡¨ç¤ºè¿›è¡Œç±»å‹æ¨å¯¼, å®ç°åœ¨ç¼–è¯‘æœŸå³å¯è¿›è¡Œåˆ¤æ–­çš„æŠ€æœ¯.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// ç±»å‹æ ‡è¯†ç©ºç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeA</span> &#123;&#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeB</span> &#123;&#125;;<br><br><span class="hljs-comment">//é€šè¿‡ if constexpr åœ¨ç¼–è¯‘æ—¶ç¡®å®šç±»å‹å¹¶æ‰§è¡Œä¸åŒçš„è¡Œä¸º, æé«˜äº†è¿è¡ŒæœŸæ•ˆç‡</span><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">identifyType</span><span class="hljs-params">(T obj)</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">if</span> <span class="hljs-title">constexpr</span> <span class="hljs-params">(std::is_same_v&lt;T, TypeA&gt;)</span> </span>&#123;   <span class="hljs-comment">// is_same_væ˜¯C++17å¼•å…¥çš„åˆ¤æ–­ç±»å‹æ˜¯å¦ç›¸åŒçš„ç±»å‹ç‰¹å¾</span><br>        std::cout &lt;&lt; <span class="hljs-string">&quot;TypeA\n&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-built_in">constexpr</span> (std::is_same_v&lt;T, TypeB&gt;) &#123;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;TypeB\n&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;Unknown type\n&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-built_in">identifyType</span>(TypeA&#123;&#125;);  <span class="hljs-comment">// è¾“å‡º &quot;TypeA&quot;</span><br>    <span class="hljs-built_in">identifyType</span>(TypeB&#123;&#125;);  <span class="hljs-comment">// è¾“å‡º &quot;TypeB&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è€Œä½¿ç”¨è¿™äº›ç©ºç±»ç¬¦åˆâ€is-implemented-in-terms-ofâ€çš„æ„å‘³, å‡è®¾æˆ‘ä»¬å°±æ˜¯ä¸ºäº†åšç±»å‹æ ‡è¯†, é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³èµ‹äºˆä¸€ä¸ªç±»å¯¹åº”çš„ç±»å‹æ ‡è¯†æ¥è¾¾åˆ°åˆ†ç±»çš„æ•ˆæœ, æˆ‘ä»¬å¯ä»¥è®©è¿™ä¸ªç±»å¤åˆæˆ–privateç»§æ‰¿ç©ºç±»æ¥å®ç°, åœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å»ºè®®ä¼˜å…ˆé€‰æ‹©privateç»§æ‰¿, è¿™æ ·å¯ä»¥é€šè¿‡ç»§æ‰¿çš„ç±»å‹åœ¨ç¼–è¯‘å™¨åšå‡ºæ›´å¤šçš„æ“ä½œ, å¹¶ä¸”ä¹Ÿå‡å°äº†å¯¹è±¡å¤§å°, è¿™å°±æ˜¯æ‰€è°“çš„<strong>EBO(ç©ºç™½åŸºç±»æœ€ä¼˜åŒ–)</strong>.</p><p>ç®€å•æ¥è¯´å°±æ˜¯å¤åˆä¼šå¢åŠ å¯¹è±¡å¤§å°(å°±ç®—æ˜¯ç©ºç±»ä¹Ÿä¼š), è€Œprivateç»§æ‰¿<strong>å®Œå…¨ä¸ä¼šå¢åŠ å¤§å°, è€Œä¸”è¿˜ç»™äº†æˆ‘ä»¬åœ¨ç¼–è¯‘æœŸçš„å¯æ“ä½œç©ºé—´</strong>, æˆ‘ä»¬å¯ä»¥åšåˆ°ä»¥ä¸‹ç¼–è¯‘æœŸç±»å‹è¯†åˆ«çš„æ•ˆæœ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// ç©ºç±»å‹æ ‡è¯†åŸºç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeA</span> &#123;&#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeB</span> &#123;&#125;;<br><br><span class="hljs-comment">// æ´¾ç”Ÿç±»ï¼Œé€šè¿‡privateç»§æ‰¿ä¸åŒçš„ç©ºåŸºç±»æ¥åœ¨ç¼–è¯‘æœŸåŒºåˆ†ç±»å‹</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> : <span class="hljs-keyword">private</span> TypeA &#123;&#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AnotherClass</span> : <span class="hljs-keyword">private</span> TypeB &#123;&#125;;<br><br><span class="hljs-comment">//é€šè¿‡ if constexpr åœ¨ç¼–è¯‘æ—¶ç¡®å®šç±»å‹å¹¶æ‰§è¡Œä¸åŒçš„è¡Œä¸º</span><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">identifyType</span><span class="hljs-params">(T obj)</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">if</span> <span class="hljs-title">constexpr</span> <span class="hljs-params">(std::is_base_of_v&lt;TypeA, T&gt;)</span> </span>&#123;   <span class="hljs-comment">// is_base_of_væ˜¯C++17å¼•å…¥çš„åˆ¤æ–­åŸºç±»ç±»å‹çš„ç±»å‹ç‰¹å¾</span><br>        std::cout &lt;&lt; <span class="hljs-string">&quot;Object is of TypeA\n&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-built_in">constexpr</span> (std::is_base_of_v&lt;TypeB, T&gt;) &#123;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;Object is of TypeB\n&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;Unknown type\n&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    MyClass a;<br>    AnotherClass b;<br><br>    <span class="hljs-built_in">identifyType</span>(a);  <span class="hljs-comment">// è¾“å‡º: Object is of TypeA</span><br>    <span class="hljs-built_in">identifyType</span>(b);  <span class="hljs-comment">// è¾“å‡º: Object is of TypeB</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ul><hr><h3 id="å¤åˆçš„ä¼˜åŠ¿"><a href="#å¤åˆçš„ä¼˜åŠ¿" class="headerlink" title="å¤åˆçš„ä¼˜åŠ¿"></a>å¤åˆçš„ä¼˜åŠ¿</h3><p>åœ¨ä¸Šæ–‡æˆ‘ä»¬è®²äº†ä¸¤ç§å»ºè®®ä½¿ç”¨privateç»§æ‰¿çš„æƒ…å†µ, é‚£ä¹ˆé™¤æ­¤ä¹‹å¤–æˆ‘ä»¬è¿˜æ˜¯æ¨èèƒ½ä½¿ç”¨å¤åˆå°±ä½¿ç”¨å¤åˆ, å…¶ä¼˜åŠ¿åœ¨äº : </p><ul><li>å¯è¯»æ€§é«˜.</li><li>ä½¿ç”¨å¤åˆå¯¹è±¡å¯ä»¥<strong>é˜²æ­¢æ´¾ç”Ÿç±»é‡å†™å…¶virtualå‡½æ•°</strong>. (privateç»§æ‰¿ä¸å¯, å› ä¸ºå°±ç®—æ˜¯privateç»§æ‰¿ä¹Ÿå¯ä»¥é‡å†™privateçš„virtualå‡½æ•°, ç„¶åé€šè¿‡åŸºç±»æŒ‡é’ˆè°ƒç”¨, è§æ¡æ¬¾35)</li><li>ä½¿ç”¨å¤åˆå°±å¯ä»¥<strong>ä½¿ç¼–è¯‘ä¾å­˜æ€§é™è‡³æœ€ä½</strong>, å¦‚æœç»§æ‰¿å¿…é¡»å¯è§å®šä¹‰, è€Œå¤åˆåªéœ€å£°æ˜å³å¯. (è¯¦è§æ¡æ¬¾31)</li></ul><hr><h3 id="â€œpublicç»§æ‰¿-å¤åˆâ€æ›¿ä»£privateç»§æ‰¿"><a href="#â€œpublicç»§æ‰¿-å¤åˆâ€æ›¿ä»£privateç»§æ‰¿" class="headerlink" title="â€œpublicç»§æ‰¿ + å¤åˆâ€æ›¿ä»£privateç»§æ‰¿"></a>â€œpublicç»§æ‰¿ + å¤åˆâ€æ›¿ä»£privateç»§æ‰¿</h3><p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡â€publicç»§æ‰¿ + å¤åˆâ€æ›¿ä»£ä¸€äº›åœºæ™¯ä¸‹privateç»§æ‰¿çš„ä½œç”¨, è™½ç„¶è¿™æ ·ä¼šéº»çƒ¦ä¸€äº›, ä½†å€¼å¾—æˆ‘ä»¬è€ƒé‡, æˆ‘ä»¬å°†ä¸Šæ–‡çš„Timeræ¡ˆä¾‹é‡å†™ä¸€ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Widget</span> &#123;<br><span class="hljs-keyword">private</span>:<br>  <span class="hljs-keyword">class</span> <span class="hljs-title class_">WidgetTimer</span>: <span class="hljs-keyword">public</span> Timer &#123;<br>  <span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">onTick</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>    ...<br>  &#125;;<br>   WidgetTimer timer;<br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªWidgetTimerçš„å†…éƒ¨ç±», å…¶publicç»§æ‰¿è‡ªTimer, å…¶é‡å†™äº†onTick(), å¹¶ä¸”æˆ‘ä»¬ç«‹é©¬åœ¨ä¸‹é¢åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„å¤ç”¨å¯¹è±¡, æˆ‘ä»¬å¯ä»¥å‘ç°è¿™ä¸ªprivateç»§æ‰¿çš„æ•ˆæœç±»ä¼¼, å¹¶ä¸”ä¹Ÿå¯ä»¥ä½“ç°ä¸Šè¿°å¤åˆçš„ä¼˜åŠ¿.</p><p>å½“ç„¶è¿™åªé€‚ç”¨äºéƒ¨åˆ†æƒ…å†µ, privateç»§æ‰¿è‚¯å®šè¿˜æ˜¯æœ‰ç”¨æ­¦ä¹‹åœ°çš„.</p><hr><h3 id="è¯·è®°ä½-1"><a href="#è¯·è®°ä½-1" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>privateç»§æ‰¿æ„å‘³ç€<code>is-implemented-in-terms-of</code>. </li><li>ä»»ä½•æ—¶å€™éƒ½ä¼˜å…ˆé€‰æ‹©å¤åˆ, é™¤éä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹.</li><li>privateç»§æ‰¿å¯ä»¥æ”¯æŒ<code>EBO</code>, å¹¶ä¸”åœ¨C++17ä¸­å¯ä»¥ç»§æ‰¿ç±»å‹æ ‡è¯†ç©ºç±»æ¥å®ç°ç¼–è¯‘æœŸé€»è¾‘åˆ¤æ–­.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
      <tag>ç»§æ‰¿</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾36-37 ä¸¤ä¸ªç»ä¸</title>
    <link href="/2024/12/20/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE36-37%20%E4%B8%A4%E4%B8%AA%E7%BB%9D%E4%B8%8D/"/>
    <url>/2024/12/20/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE36-37%20%E4%B8%A4%E4%B8%AA%E7%BB%9D%E4%B8%8D/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾36-ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°"><a href="#æ¡æ¬¾36-ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°" class="headerlink" title="æ¡æ¬¾36 : ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°"></a>æ¡æ¬¾36 : ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°</h2><p>æœ¬æ¡æ¬¾å¾ˆå®¹æ˜“ç†è§£, æ´å¼•ä»¥å‰çš„æ¡æ¬¾å°±å¯ä»¥è¯´æ˜ä¸ºä»€ä¹ˆ : </p><ul><li><p>æ¡æ¬¾34ä¸­å°±æåˆ°è¿‡ : non-virtualå‡½æ•°æ„å‘³ç€<strong>æ¥å£ + å¼ºåˆ¶æ€§å®ç°ç»§æ‰¿</strong>, å®ƒä¸åº”å½“è¢«æ”¹å˜. </p></li><li><p>é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°ä¼šè§¦å‘æ¡æ¬¾33ä¸­æ‰€è¯´çš„<strong>é®æ©</strong>æœºåˆ¶.</p></li><li><p>è§¦å‘é®æ©æœºåˆ¶å…¶å®æ˜¯å¯¹æ¡æ¬¾32ä¸­â€<strong>publicæ„å‘³ç€is-a</strong>â€œè¿™ä¸ªå®šç†çš„ç ´å.</p></li></ul><p>å¦‚æœä½ è¿™ä¹ˆåšäº†, è¿˜å¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹å¥‡æ€ªçš„æ•ˆæœ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">mf</span><span class="hljs-params">()</span></span>;<br>  ...<br>&#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">D</span>: <span class="hljs-keyword">public</span> B &#123;  <span class="hljs-comment">// Dæ´¾ç”Ÿè‡ªB</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">mf</span><span class="hljs-params">()</span></span>;   <span class="hljs-comment">// è¿™ä¸ªå®šä¹‰é®æ©äº†Bä¸­çš„mf()</span><br>&#125;;  <br><br><span class="hljs-comment">//--------------------------------------------//</span><br><br>D x;                              <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªDå¯¹è±¡</span><br><br>B *pB = &amp;x;                       <br>pB-&gt;<span class="hljs-built_in">mf</span>();                         <span class="hljs-comment">// è°ƒç”¨B::mf()</span><br><br>D *pD = &amp;x;                       <br>pD-&gt;<span class="hljs-built_in">mf</span>();    <span class="hljs-comment">// è°ƒç”¨D::mf()</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é€šè¿‡åŒä¸€ä¸ªå¯¹è±¡Dè°ƒç”¨çš„<code>mf()</code>å±…ç„¶æ•ˆæœä¸åŒ, è¿™ä¹Ÿå¾ˆå®¹æ˜“ç†è§£, æ¯•ç«Ÿnon-virtualå¹¶æ²¡åŠ¨æ€ç»‘å®š, åªæ˜¯ä¾æ®å½“å‰å¯¹è±¡çš„é™æ€ç±»å‹æ¥è°ƒç”¨çš„.</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸åº”é‡æ–°å®šä¹‰ä¸€ä¸ªç»§æ‰¿æ¥çš„non-virtualå‡½æ•°.</li></ul><hr><h2 id="æ¡æ¬¾37-ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„ç¼ºçœå‚æ•°å€¼"><a href="#æ¡æ¬¾37-ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„ç¼ºçœå‚æ•°å€¼" class="headerlink" title="æ¡æ¬¾37 : ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„ç¼ºçœå‚æ•°å€¼"></a>æ¡æ¬¾37 : ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„ç¼ºçœå‚æ•°å€¼</h2><blockquote><p>å…ˆç¼©å°æœ¬æ¡æ¬¾çš„èŒƒå›´, é€šè¿‡æ¡æ¬¾36æˆ‘ä»¬é¦–å…ˆåº”è¯¥çŸ¥é“ä¸åº”è¯¥ä¿®æ”¹ç»§æ‰¿æ¥çš„non-virtualå‡½æ•°, æ‰€ä»¥æœ¬æ¡æ¬¾çš„è®¨è®ºèŒƒå›´å°†å±€é™åœ¨â€ç»§æ‰¿ä¸€ä¸ªå¸¦æœ‰ç¼ºçœå‚æ•°çš„virtualå‡½æ•°â€.</p></blockquote><p>é¦–å…ˆæ˜ç¡®æœ¬æ¡æ¬¾çš„æ ¸å¿ƒçŸ¥è¯† : </p><ul><li><strong>virtualå‡½æ•°æœ¬èº«æ˜¯åŠ¨æ€ç»‘å®šçš„, ä½†æ˜¯ç¼ºçœå‚æ•°å€¼æ˜¯é™æ€ç»‘å®šçš„.</strong></li></ul><p>ç®€å•ç†è§£å°±æ˜¯virtualå‡½æ•°ä¼šæ ¹æ®å¯¹è±¡çš„å½“å‰ç±»å‹è¿›è¡ŒåŠ¨æ€ç»‘å®š, è€Œç¼ºçœå€¼æ— æ³•æ”¹å˜, åªå’Œä¸€å¼€å§‹å®šä¹‰çš„é™æ€ç±»å‹ç›¸å…³.</p><p>æˆ‘ä»¬æ¥çœ‹ä»£ç æ¥ç†è§£ :</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ShapeColor</span> &#123; Red, Green, Blue &#125;; <br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(ShapeColor color = Red)</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>; <span class="hljs-comment">// Shapeé»˜è®¤ç¼ºçœå€¼ä¸ºRed</span><br>  ...<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span>: <span class="hljs-keyword">public</span> Shape &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ªç³Ÿç³•çš„å†™æ³•!</span><br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(ShapeColor color = Green)</span> <span class="hljs-type">const</span></span>;  <span class="hljs-comment">// Shapeé»˜è®¤ç¼ºçœå€¼ä¸ºGreen, ä½†æ˜¯æœ‰ç”¨å—?</span><br>  ...<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span>: <span class="hljs-keyword">public</span> Shape &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(ShapeColor color)</span> <span class="hljs-type">const</span></span>;  <span class="hljs-comment">// æ— ç¼ºçœå€¼</span><br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œè®¾è®¡äº†ä¸€ä¸ªShapeåŸºç±», æ´¾ç”Ÿå‡ºä¸‰è§’å’Œåœ†, æˆ‘ä»¬æ¥çœ‹è°ƒç”¨æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ :</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// ä»¥ä¸‹çš„é™æ€ç±»å‹éƒ½æ˜¯åŸºç±»</span><br>Shape* ps;                       <br>Shape* pc = <span class="hljs-keyword">new</span> Circle;         <br>Shape* pr = <span class="hljs-keyword">new</span> Rectangle;      <br><br>pc-&gt;<span class="hljs-built_in">draw</span>();<br>pr-&gt;<span class="hljs-built_in">draw</span>();<br></code></pre></td></tr></table></figure><p>è¿™æ ·å­è°ƒç”¨çœ‹ä¸Šå»æ²¡æœ‰ä»»ä½•é—®é¢˜, å®é™…ä¸Šä¹Ÿç¡®å®ä¾é åŠ¨æ€ç»‘å®šè°ƒç”¨åˆ°äº†æ´¾ç”Ÿç±»å¯¹åº”çš„draw(), ä½†æ ¹æ®æµ‹è¯•<code>pc-&gt;draw()</code>ä¸­colorç¼ºçœå€¼æ˜¯Redè€ŒéGreen, è¿™ä¾¿æ˜¯å› ä¸ºæˆ‘ä»¬ä¸Šè¿°çš„ç†ç”±, ç¼ºçœå€¼çœ‹çš„æ˜¯é™æ€ç±»å‹, ä¹Ÿå°±æ˜¯Shape.</p><ul><li><p>ä¸ºä»€ä¹ˆC++ä¼šè®¾è®¡æˆä¼šè¿™æ ·?</p><p>å…¶å®æ˜¯å› ä¸ºåŠ¨æ€ç»‘å®šç¼ºçœå€¼çš„èŠ±é”€å®åœ¨è¿‡å¤§, C++ä¸ºäº†æ•ˆç‡åšäº†è¿™èˆ¬å–èˆ.</p></li></ul><hr><h3 id="ç”±æ­¤å¼•å‘å‡ºçš„å¦ä¸€ä¸ªé—®é¢˜"><a href="#ç”±æ­¤å¼•å‘å‡ºçš„å¦ä¸€ä¸ªé—®é¢˜" class="headerlink" title="ç”±æ­¤å¼•å‘å‡ºçš„å¦ä¸€ä¸ªé—®é¢˜"></a>ç”±æ­¤å¼•å‘å‡ºçš„å¦ä¸€ä¸ªé—®é¢˜</h3><ul><li><strong>å½“é™æ€ç±»å‹æ˜¯æ´¾ç”Ÿç±»æ—¶, å°†æ— æ³•è·å–åŸºç±»çš„ç¼ºçœå€¼!</strong></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// è¿™æ ·å¯ä»¥ä½¿ç”¨åŸºç±»çš„ç¼ºçœå€¼</span><br>Shape* pc = <span class="hljs-keyword">new</span> Circle;            <br>pc-&gt;<span class="hljs-built_in">draw</span>();<br><br><span class="hljs-comment">// è¿™æ ·ä¸è¡Œ!</span><br>Circle* cc = <span class="hljs-keyword">new</span> Circle;<br>cc.<span class="hljs-built_in">draw</span>();    <span class="hljs-comment">// é”™è¯¯, è‡ªå·±æ²¡æœ‰ç¼ºçœå€¼, å¹¶ä¸”ä¹Ÿè°ƒä¸åˆ°åŸºç±»çš„ç¼ºçœå€¼</span><br></code></pre></td></tr></table></figure><p>äºæ˜¯è¿™æ ·çš„æœºåˆ¶ä¼¼ä¹åœ¨é€¼è¿«æˆ‘ä»¬è¦æŠŠæ‰€æœ‰å«ç¼ºçœå€¼çš„virtualå‡½æ•°éƒ½æ‰‹åŠ¨å¡«ä¸Šå’ŒåŸºç±»ä¸€æ ·çš„ç¼ºçœå€¼, å°±åƒä¸‹é¢çš„ä»£ç ä¸€æ · : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ShapeColor</span> &#123; Red, Green, Blue &#125;; <br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(ShapeColor color = Red)</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;<br>  ...<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span>: <span class="hljs-keyword">public</span> Shape &#123;<br><span class="hljs-keyword">public</span>:<br><br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(ShapeColor color = Red)</span> <span class="hljs-type">const</span></span>;  <span class="hljs-comment">// éƒ½åŠ ä¸Šå’ŒåŸºç±»ç›¸åŒçš„ç¼ºçœå€¼</span><br>  ...<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span>: <span class="hljs-keyword">public</span> Shape &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(ShapeColor color = Red)</span> <span class="hljs-type">const</span></span>;  <span class="hljs-comment">// éƒ½åŠ ä¸Šå’ŒåŸºç±»ç›¸åŒçš„ç¼ºçœå€¼</span><br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>åªæœ‰è¿™æ ·ä½ æ‰å¯ä»¥ç¡®ä¿åœ¨ä»»ä½•ä½¿ç”¨åœºæ™¯ä¸‹ä½ çš„ç¼ºçœå€¼éƒ½å¯ä»¥æ­£å¸¸ç”Ÿæ•ˆ.</p><p>ä½†æ˜¯è¿™æ ·å€¼å¾—å—? æ˜¾ç„¶æ˜¯ä¸å€¼å¾—çš„, è¿™é‡ŒåŒ…å«äº†<strong>ä»£ç é‡å¤å’Œä»£ç ç›¸ä¾æ€§</strong>ä¸¤å¤§å¼Šç—…, åªè¦ä½ æƒ³ä¿®æ”¹åŸºç±»ä¸­çš„ç¼ºçœå€¼, é‚£ä¹ˆå…¶ä»–æ‰€æœ‰çš„æ´¾ç”Ÿç±»å°±éƒ½è¦ä¿®æ”¹, è¿™æ˜¯æˆ‘ä»¬éå¸¸ä¸å¸Œæœ›çœ‹åˆ°çš„, è¿˜å¥½æˆ‘ä»¬æœ‰ä¸€ä¸ªç°æˆçš„è§£å†³æ–¹æ³•.</p><hr><h3 id="è—‰ç”±NVIæ‰‹æ³•è§£å†³ä¸Šè¿°é—®é¢˜"><a href="#è—‰ç”±NVIæ‰‹æ³•è§£å†³ä¸Šè¿°é—®é¢˜" class="headerlink" title="è—‰ç”±NVIæ‰‹æ³•è§£å†³ä¸Šè¿°é—®é¢˜"></a>è—‰ç”±NVIæ‰‹æ³•è§£å†³ä¸Šè¿°é—®é¢˜</h3><p>æ²¡é”™, å°±æ˜¯æˆ‘ä»¬æ¡æ¬¾35è¯¦ç»†ä»‹ç»çš„NVIæ‰‹æ³•(æ²¡çœ‹è¿‡çš„å¯ä»¥çœ‹æˆ‘å¾€æœŸåšå®¢çš„å¯¹åº”éƒ¨åˆ†, è¿™å°†å¾ˆå½±å“ä¸‹æ–‡çš„ç†è§£), æˆ‘ä»¬<strong>è®©éè™šå‡½æ•°æ¥å£æœ‰ç¼ºçœå€¼, å¦‚æœæœ‰ç¼ºçœæƒ…å†µ, æŠŠè¿™ä¸ªç¼ºçœå€¼ä¼ å…¥å…·ä½“å®ç°çš„è™šå‡½æ•°</strong>å°±å¯ä»¥äº†! ä»£ç å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ShapeColor</span> &#123; Red, Green, Blue &#125;;<br><br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(ShapeColor color = Red)</span> <span class="hljs-type">const</span>           <span class="hljs-comment">// éè™šå‡½æ•°æ¥å£(åŒ…å«ç¼ºçœå€¼), è§æ¡æ¬¾35</span></span><br><span class="hljs-function">  </span>&#123;<br>    <span class="hljs-built_in">doDraw</span>(color);                                  <span class="hljs-comment">// å…·ä½“å®ç°çš„è™šå‡½æ•°æ¥å—color</span><br>  &#125;<br>  ...<br><span class="hljs-keyword">private</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">doDraw</span><span class="hljs-params">(ShapeColor color)</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;  <span class="hljs-comment">// è§æ¡æ¬¾35</span><br>&#125;;                                                  <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span>: <span class="hljs-keyword">public</span> Shape &#123;<br><span class="hljs-keyword">public</span>:<br>  ...<br><span class="hljs-keyword">private</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">doDraw</span><span class="hljs-params">(ShapeColor color)</span> <span class="hljs-type">const</span></span>;     <span class="hljs-comment">// è¿™æ ·å°±ä¸å¿…å†åŠ ç¼ºçœå€¼äº†!  </span><br>  ...                                                <br>&#125;;<br><br><span class="hljs-comment">//-----------------------//</span><br><br>Circle* cc = <span class="hljs-keyword">new</span> Circle;<br>cc.<span class="hljs-built_in">draw</span>();                 <span class="hljs-comment">// è¿™æ ·çš„è°ƒç”¨ä¹Ÿè¢«å…è®¸äº†!</span><br></code></pre></td></tr></table></figure><hr><h3 id="è¯·è®°ä½-1"><a href="#è¯·è®°ä½-1" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>ç»å¯¹ä¸è¦é‡æ–°å®šä¹‰ä¸€ä¸ªç»§æ‰¿è€Œæ¥çš„ç¼ºçœå‚æ•°å€¼, å› ä¸ºå®ƒæ˜¯é™æ€ç»‘å®šçš„.</li><li>å†æƒ³è®©virtualå‡½æ•°æºå¸¦ç¼ºçœå€¼æ˜¯, ä¸å¦¨ä½¿ç”¨NVIæ‰‹æ³•, <strong>è®©éè™šæ¥å£æ›¿è™šå‡½æ•°æºå¸¦ç¼ºçœå€¼</strong>.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
      <tag>ç»§æ‰¿</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾34 æ¥å£ç»§æ‰¿å’Œå®ç°ç»§æ‰¿</title>
    <link href="/2024/12/17/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE34%20%E6%8E%A5%E5%8F%A3%E7%BB%A7%E6%89%BF%E5%92%8C%E5%AE%9E%E7%8E%B0%E7%BB%A7%E6%89%BF/"/>
    <url>/2024/12/17/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE34%20%E6%8E%A5%E5%8F%A3%E7%BB%A7%E6%89%BF%E5%92%8C%E5%AE%9E%E7%8E%B0%E7%BB%A7%E6%89%BF/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾34-åŒºåˆ†æ¥å£ç»§æ‰¿å’Œå®ç°ç»§æ‰¿"><a href="#æ¡æ¬¾34-åŒºåˆ†æ¥å£ç»§æ‰¿å’Œå®ç°ç»§æ‰¿" class="headerlink" title="æ¡æ¬¾34 : åŒºåˆ†æ¥å£ç»§æ‰¿å’Œå®ç°ç»§æ‰¿"></a>æ¡æ¬¾34 : åŒºåˆ†æ¥å£ç»§æ‰¿å’Œå®ç°ç»§æ‰¿</h2><blockquote><p>ä½œä¸ºclassçš„è®¾è®¡è€…, æˆ‘ä»¬æœ‰æ—¶å¸Œæœ›æ´¾ç”Ÿç±»åªç»§æ‰¿æˆå‘˜å‡½æ•°çš„æ¥å£, æœ‰æ—¶åˆå¸Œæœ›åŒæ—¶ç»§æ‰¿æ¥å£å’Œå®ç°, æœ‰æ—¶åˆå¸Œæœ›èƒ½å¤Ÿé‡å†™æ‰€ç»§æ‰¿çš„å®ç°,  å› æ­¤æˆ‘ä»¬çš„é€‰æ‹©æ˜¯å¤šæ ·çš„, è¿™é‡Œå¤§æœ‰å¯ä»¥æ¢è®¨çš„åœ°æ–¹, æœ¬æ¡æ¬¾å°†å¸¦æˆ‘ä»¬åŒºåˆ†ä¸åŒçš„ç»§æ‰¿æ–¹æ³•, å¹¶å¯¹å…¶åšå‡ºå»ºè®®</p></blockquote><h3 id="ä¸‰ç§ç»§æ‰¿æ–¹å¼"><a href="#ä¸‰ç§ç»§æ‰¿æ–¹å¼" class="headerlink" title="ä¸‰ç§ç»§æ‰¿æ–¹å¼"></a>ä¸‰ç§ç»§æ‰¿æ–¹å¼</h3><p>é¦–å…ˆè®©æˆ‘ä»¬æ˜æ™°å„ç§ç»§æ‰¿æ–¹å¼çš„åŒºåˆ«, å¤§ä½“æœ‰ä¸‰ç§ç»§æ‰¿æ–¹å¼ : </p><ul><li><p>æ¥å£ç»§æ‰¿ : <strong>pure virtualå‡½æ•°</strong>å®ç°, å¼ºåˆ¶æ´¾ç”Ÿç±»<strong>ç»§æ‰¿æ¥å£</strong>.</p><p>è¿™ç§æ–¹å¼çš„é€šè¿‡å¼ºåˆ¶ç»§æ‰¿æ¥å£ç¡®ä¿å¿…éœ€åŠŸèƒ½çš„å®ç°.</p></li><li><p>æ¥å£ + ç¼ºçœå®ç°ç»§æ‰¿ : <strong>virtualå‡½æ•°</strong>å®ç°, æ´¾ç”Ÿç±»å¯ä»¥é€‰æ‹©é‡å†™, <strong>ç»§æ‰¿åŸºç±»æä¾›çš„æ¥å£å’Œç¼ºçœå®ç°</strong>.</p><p>è¿™ç§æ–¹å¼å¯ä»¥çµæ´»é€‰æ‹©æ˜¯ç»§æ‰¿ç¼ºçœç‰ˆæœ¬è¿˜æ˜¯é‡å†™.</p></li><li><p>æ¥å£ + å¼ºåˆ¶å®ç°ç»§æ‰¿ : <strong>non-virtualå‡½æ•°</strong>å®ç°, æ´¾ç”Ÿç±»<strong>ç»§æ‰¿æ¥å£å’Œå”¯ä¸€å®ç°</strong>.</p><p>è¿™ç§æ–¹å¼å°±æ˜¯ç»™æ•´ä¸ªç»§æ‰¿ä½“ç³»å¢åŠ äº†ä¸€ä¸ªå›ºå®šçš„å·¥å…·å‡½æ•°, è¯¥å‡½æ•°ä¸å¯é‡å†™.</p></li></ul><p>ç®€å•æ¥è¯´å°±æ˜¯ç»§æ‰¿ä¼šç»§æ‰¿æ¥å£, ä½†æ˜¯å¦ç»§æ‰¿ä¸€ä»½å®ç°æ˜¯çœ‹å…·ä½“æƒ…å†µè€Œå®šçš„.</p><hr><h3 id="çº¯è™šå‡½æ•°ä¹Ÿå¯ä»¥è¢«å®šä¹‰"><a href="#çº¯è™šå‡½æ•°ä¹Ÿå¯ä»¥è¢«å®šä¹‰" class="headerlink" title="çº¯è™šå‡½æ•°ä¹Ÿå¯ä»¥è¢«å®šä¹‰"></a>çº¯è™šå‡½æ•°ä¹Ÿå¯ä»¥è¢«å®šä¹‰</h3><p>åœ¨å‰é¢çš„æ¡æ¬¾ä¸­åº”è¯¥æœ‰æè¿‡çº¯è™šå‡½æ•°å®šä¹‰çš„é—®é¢˜, è¿™é‡Œå†ç€é‡ç ”ç©¶ä¸€ä¸‹ : </p><ul><li><strong>çº¯è™šå‡½æ•°å¯ä»¥è¢«å®šä¹‰</strong>, ä½†è°ƒç”¨å®ƒçš„å”¯ä¸€é€”å¾„æ˜¯è°ƒç”¨æ—¶<strong>æ˜ç¡®æŒ‡å‡ºå…¶classåç§°</strong>.</li></ul><p>å°±åƒå¦‚ä¸‹ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span><br>&#123;<br>  <span class="hljs-keyword">public</span>:  <br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;<br>  ...<br>&#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> : <span class="hljs-keyword">public</span> Shape &#123;...&#125;;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Shape::draw</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    cout &lt;&lt; <span class="hljs-string">&quot;draw&quot;</span> &lt;&lt; endl;<br>&#125;<br><br>Shape* ps = <span class="hljs-keyword">new</span> Rectangle;<br>ps-&gt;Shape::<span class="hljs-built_in">draw</span>(); <span class="hljs-comment">// è¿™æ ·ä¾¿å¯ä»¥è°ƒç”¨çº¯è™šå‡½æ•°</span><br></code></pre></td></tr></table></figure><p>æœ‰äº†è¯¥å®šä¹‰, ä¾¿å¯ä»¥ä¸ºä¸Šè¿°çš„ç¬¬äºŒç§ç»§æ‰¿æ–¹å¼æä¾›<strong>æ›´å¹³å¸¸æ›´å®‰å…¨çš„ç¼ºçœå®ç°</strong>.</p><hr><h3 id="â€œä½¿ç”¨çº¯è™šå‡½æ•°å¹¶å®šä¹‰â€æ¥æ›¿æ¢æ™®é€šè™šå‡½æ•°çš„ä½¿ç”¨"><a href="#â€œä½¿ç”¨çº¯è™šå‡½æ•°å¹¶å®šä¹‰â€æ¥æ›¿æ¢æ™®é€šè™šå‡½æ•°çš„ä½¿ç”¨" class="headerlink" title="â€œä½¿ç”¨çº¯è™šå‡½æ•°å¹¶å®šä¹‰â€æ¥æ›¿æ¢æ™®é€šè™šå‡½æ•°çš„ä½¿ç”¨"></a>â€œä½¿ç”¨çº¯è™šå‡½æ•°å¹¶å®šä¹‰â€æ¥æ›¿æ¢æ™®é€šè™šå‡½æ•°çš„ä½¿ç”¨</h3><p>å…ˆæ¥å¼•å…¥å‰æ, <strong>æ™®é€šè™šå‡½æ•°çš„é‡å†™å¹¶æ²¡æœ‰å¼ºåˆ¶æ€§, å¹¶ä¸”åœ¨æ²¡æœ‰é‡å†™çš„æƒ…å†µä¸‹ä¼šè‡ªåŠ¨ç»§æ‰¿ç¼ºçœç‰ˆæœ¬</strong>, è¿™ç‚¹åœ¨å®é™…åº”ç”¨ä¸­è¢«è®¤ä¸ºæ˜¯æœ‰é£é™©çš„. å› ä¸ºè‡ªåŠ¨ä½¿ç”¨æŸäº›åŠŸèƒ½æ€»æ˜¯æœ‰å¯èƒ½è¶…å‡ºä½¿ç”¨è€…çš„é¢„æœŸçš„, æœ‰äº›æ—¶å€™å¾€å¾€å¯èƒ½åªæ˜¯æˆ‘ä»¬å¿˜è®°é‡å†™, æœ¬èº«å¹¶ä¸å¸Œæœ›ä½¿ç”¨ç¼ºçœ, ä½†å®é™…å´è¿˜æ˜¯è°ƒç”¨åˆ°äº†ç¼ºçœ, è¿™å¾ˆæœ‰å¯èƒ½<strong>å’Œæˆ‘ä»¬æƒ³è¦å®ç°çš„ç›®çš„ä¸ä¸€è‡´, ä½†æ˜¯åœ¨è¯­æ³•ä¸Šæ˜¯æ­£ç¡®çš„, æˆ‘ä»¬ä¸ä¸€å®šä¼šæ„è¯†åˆ°æˆ‘ä»¬çš„é”™è¯¯</strong>. ä¹¦ä¸­ä¸¾å‡ºäº†ä¸€ä¸ªé£æœºå…¬å¸çš„ä¾‹å­, ä¸€å¼€å§‹æœ‰ä¸¤ç§å‹å·çš„é£æœºAå’ŒB, æ–°åŠ å…¥ä¸€ä¸ªå‹å·çš„é£æœºC,  å…¶é»˜è®¤çš„é£è¡Œæ–¹å¼å’ŒABéƒ½ä¸åŒ, å¦‚æœæˆ‘ä»¬å¿˜è®°é‡å†™flyå‡½æ•°, è‡ªåŠ¨è°ƒç”¨çš„ç¼ºçœå‡½æ•°å¯èƒ½ä¸ä¼šç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Airport</span> &#123; ... &#125;;                     <span class="hljs-comment">// represents airports</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Airplane</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">fly</span><span class="hljs-params">(<span class="hljs-type">const</span> Airport&amp; destination)</span></span>;<br>  ...<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Airplane::fly</span><span class="hljs-params">(<span class="hljs-type">const</span> Airport&amp; destination)</span></span><br><span class="hljs-function"></span>&#123;<br>   <span class="hljs-comment">// flyçš„ç¼ºçœè¡Œä¸º</span><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelA</span>: <span class="hljs-keyword">public</span> Airplane &#123; ... &#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelB</span>: <span class="hljs-keyword">public</span> Airplane &#123; ... &#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelC</span>: <span class="hljs-keyword">public</span> Airplane &#123;<br>  ...                                   <span class="hljs-comment">// å¿˜è®°é‡å†™Cçš„fly, è°ƒç”¨çš„ç¼ºçœè¡Œä¸ºä¹Ÿå¯èƒ½ä¸ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸ</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>ç†è§£èµ·æ¥å¹¶æ²¡æœ‰é‚£ä¹ˆéº»çƒ¦, å°±æ˜¯ä½¿ç”¨<code>virtual</code>å‡½æ•°å¹¶æ²¡æœ‰å¼ºåˆ¶æ€§æ£€æŸ¥, ç¨‹åºå‘˜çš„ç–å¿½å¯èƒ½å¯¼è‡´é”™è¯¯.</p><p>äºæ˜¯æˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªæ–°çš„æ–¹å¼æ›¿ä»£<code>virtual</code>å‡½æ•°(ç¬¬äºŒç§ç»§æ‰¿æ–¹æ¡ˆ) : </p><ul><li><strong>ä½¿ç”¨pure virtualå‡½æ•°å¹¶å®šä¹‰,  åœ¨æƒ³è¦ä½¿ç”¨ç¼ºçœç‰ˆæœ¬æ—¶æ˜¾ç¤ºæŒ‡å®šç¼ºçœç‰ˆæœ¬</strong>.</li></ul><p>ä»£ç å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Airplane</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">fly</span><span class="hljs-params">(<span class="hljs-type">const</span> Airport&amp; destination)</span> </span>= <span class="hljs-number">0</span>; <span class="hljs-comment">// çº¯è™šå‡½æ•°å£°æ˜fly</span><br>  ...<br>&#125;;<br><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Airplane::fly</span><span class="hljs-params">(<span class="hljs-type">const</span> Airport&amp; destination)</span>     </span><br><span class="hljs-function"></span>&#123;                                                  <br>  <span class="hljs-comment">// ç”¨çº¯è™šå‡½æ•°çš„å®šä¹‰å½“ä½œç¼ºçœç‰ˆæœ¬</span><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelA</span>: <span class="hljs-keyword">public</span> Airplane &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">fly</span><span class="hljs-params">(<span class="hljs-type">const</span> Airport&amp; destination)</span></span><br><span class="hljs-function">  </span>&#123; Airplane::<span class="hljs-built_in">fly</span>(destination); &#125;   <span class="hljs-comment">// åœ¨æƒ³è¦è°ƒç”¨ç¼ºçœç‰ˆæœ¬æ—¶æ˜¾ç¤ºè°ƒç”¨</span><br>  ...<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelB</span>: <span class="hljs-keyword">public</span> Airplane &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">fly</span><span class="hljs-params">(<span class="hljs-type">const</span> Airport&amp; destination)</span></span><br><span class="hljs-function">  </span>&#123; Airplane::<span class="hljs-built_in">fly</span>(destination); &#125;<br>  ...<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelC</span>: <span class="hljs-keyword">public</span> Airplane &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">fly</span><span class="hljs-params">(<span class="hljs-type">const</span> Airport&amp; destination)</span></span>;<br>  ...<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ModelC::fly</span><span class="hljs-params">(<span class="hljs-type">const</span> Airport&amp; destination)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">// è¿™é‡Œå¼ºåˆ¶æˆ‘ä»¬é‡å†™fly, ä¸æƒ³è°ƒç”¨ç¼ºçœç‰ˆæœ¬å°±åªèƒ½è€å®é‡å†™</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å¯ä»¥ç”¨æ›´å®‰å…¨åœ°æ–¹å¼å®ç°æ™®é€š<code>virtual</code>å‡½æ•°çš„ä½œç”¨, <strong>åˆ©ç”¨çº¯è™šå‡½æ•°å¿…é¡»é‡å†™çš„æœºåˆ¶æ¥è®©æˆ‘å¿…é¡»åœ¨ç¼ºçœå’Œé‡å†™ä¸­åšå‡ºé€‰æ‹©, è€Œæ²¡æœ‰â€å¿˜äº†â€è¿™ç§é€‰é¡¹</strong>.</p><hr><h3 id="ç»§æ‰¿æ–¹å¼çš„é€‰æ‹©"><a href="#ç»§æ‰¿æ–¹å¼çš„é€‰æ‹©" class="headerlink" title="ç»§æ‰¿æ–¹å¼çš„é€‰æ‹©"></a>ç»§æ‰¿æ–¹å¼çš„é€‰æ‹©</h3><p>å…·ä½“é€‰æ‹©è¿˜æ˜¯ä¾é æˆ‘ä»¬çš„éœ€æ±‚æ¥å†³å®š, æ¯ç§ç»§æ‰¿æ–¹å¼åº”ç”¨çš„åœºæ™¯æˆ‘ä»¬éƒ½åº”æ˜æ™°, æœ€ååšå‡ºæ˜æ™ºçš„åˆ¤æ–­, æœ€åä½œè€…è¿˜ç»™å‡ºäº†å‡ ç‚¹æé†’: </p><ul><li>é™¤éä½ çš„<code>class</code>æ²¡æœ‰å¤šæ€ç”¨é€”, ä¸è¦å°†æ‰€æœ‰å‡½æ•°å£°æ˜ä¸º<code>non-virtual</code>.</li><li>é™¤éä½ è¦å†™æ¥å£ç±», ä¸è¦å°†æ‰€æœ‰å‡½æ•°å£°æ˜ä¸º<code>virtual</code>, è¿™æ˜¯ä¸æƒ³æ€è€ƒçš„ä½“ç°.</li><li><code>virtual</code>å‡½æ•°æ˜¯æœ‰æˆæœ¬çš„, ä½†æ˜¯è€ƒè™‘åˆ°80-20æ³•åˆ™(ç¨‹åºæœ‰80%çš„æ—¶é—´èŠ±è´¹åœ¨20%çš„ä»£ç èº«ä¸Š), æœ‰80%çš„<code>virtual</code>å‡½æ•°ä¸ä¼šå¯¹æ•ˆç‡äº§ç”Ÿå†²å‡», è¿™éœ€è¦æˆ‘ä»¬åˆç†è€ƒé‡.</li></ul><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li><p><code>pure virtual</code>å‡½æ•°åªç¡®ä¿æ¥å£ç»§æ‰¿, ä½†æ˜¯ä¹Ÿå¯ä»¥è¿›è¡Œå®šä¹‰.</p></li><li><p><code>virtual</code>å‡½æ•°åœ¨æ¥å£ç»§æ‰¿çš„åŒæ—¶å¯ä»¥é€‰æ‹©æ˜¯å¦ç»§æ‰¿å®ç°, å¯ä»¥ç”¨â€ä½¿ç”¨çº¯è™šå‡½æ•°å¹¶å®šä¹‰â€çš„æ–¹å¼æ¥æ›¿æ¢ä»¥æé«˜å®‰å…¨æ€§.</p></li><li><p><code>non-virtual</code>å‡½æ•°åœ¨æ¥å£ç»§æ‰¿çš„åŒæ—¶ç»§æ‰¿ä¸€ä»½å¼ºåˆ¶æ€§å®ç°.</p></li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
      <tag>ç»§æ‰¿</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾33 ç»§æ‰¿, é‡è½½ä¸ä½œç”¨åŸŸ</title>
    <link href="/2024/12/16/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE33%20%E7%BB%A7%E6%89%BF,%20%E9%87%8D%E8%BD%BD%E4%B8%8E%E4%BD%9C%E7%94%A8%E5%9F%9F/"/>
    <url>/2024/12/16/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE33%20%E7%BB%A7%E6%89%BF,%20%E9%87%8D%E8%BD%BD%E4%B8%8E%E4%BD%9C%E7%94%A8%E5%9F%9F/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾33-é¿å…é®æ©ç»§æ‰¿è€Œæ¥çš„åç§°"><a href="#æ¡æ¬¾33-é¿å…é®æ©ç»§æ‰¿è€Œæ¥çš„åç§°" class="headerlink" title="æ¡æ¬¾33 : é¿å…é®æ©ç»§æ‰¿è€Œæ¥çš„åç§°"></a>æ¡æ¬¾33 : é¿å…é®æ©ç»§æ‰¿è€Œæ¥çš„åç§°</h2><blockquote><p>æœ¬æ¡æ¬¾å¹¶éå’Œç»§æ‰¿æœ‰å…³, è€Œæ˜¯åœ¨è®¨è®ºç”±ç»§æ‰¿å¼•å‘çš„ä½œç”¨åŸŸé—®é¢˜, å…¶æœ‰å¯èƒ½ç ´åæ¡æ¬¾32æ‰€ç¡®å®šçš„æ³•åˆ™, å› æ­¤æˆ‘ä»¬åœ¨å…¶ä¹‹åä»‹ç»æœ¬æ¡æ¬¾ã€‚</p></blockquote><p>æˆ‘ä»¬çŸ¥é“åœ¨ä¸åŒä½œç”¨åŸŸä¸‹å¦‚æœæœ‰ç›¸åŒåç§°çš„äº‹ç‰©, æ— è®ºå…¶åŠŸèƒ½æˆ–ç±»å‹, éƒ½æ˜¯å±€éƒ¨ä¼˜å…ˆçš„. ç»§æ‰¿çš„çˆ¶å­ç±»ä¹Ÿæ˜¯ç±»ä¼¼, ä¸ç®¡æ˜¯ä¸æ˜¯è™šå‡½æ•°, äº¦æˆ–æ˜¯çº¯è™šå‡½æ•°éƒ½å®Œå…¨æ²¡æœ‰å…³ç³», éƒ½éµå®ˆç›¸åŒåç§°å±€éƒ¨ä¼˜å…ˆçš„åŸåˆ™, æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€ä¸‹çš„ä»£ç  :  </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> &#123;<br><span class="hljs-keyword">private</span>:<br>  <span class="hljs-type">int</span> x;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">mf1</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">mf2</span><span class="hljs-params">()</span></span>;<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">mf3</span><span class="hljs-params">()</span></span>;<br>  ...<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span>: <span class="hljs-keyword">public</span> Base &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">mf1</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">mf2</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;<br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>åˆ†æä»£ç æˆ‘ä»¬å¯ä»¥å‘ç°, æ´¾ç”Ÿç±»çš„å‡½æ•°éƒ½å°†è¦†ç›–åŸºç±»ç›¸åŒåç§°çš„å‡½æ•°, ä½†æ²¡æœ‰ä»€ä¹ˆåŸåˆ™ä¸Šçš„é—®é¢˜.</p><p>ä½†æ˜¯å¦‚æœåŠ å…¥é‡è½½, äº‹æƒ…å°±å˜å¾—æœ‰äº›å¤æ‚äº†, æˆ‘ä»¬æ¥çœ‹çœ‹æ¥ä¸‹æ¥çš„ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> &#123;<br><span class="hljs-keyword">private</span>:<br>  <span class="hljs-type">int</span> x;<br><br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">mf1</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">mf1</span><span class="hljs-params">(<span class="hljs-type">int</span>)</span></span>;  <span class="hljs-comment">// mf1çš„é‡è½½</span><br><br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">mf2</span><span class="hljs-params">()</span></span>;<br><br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">mf3</span><span class="hljs-params">()</span></span>;<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">mf3</span><span class="hljs-params">(<span class="hljs-type">double</span>)</span></span>;  <span class="hljs-comment">// mf3çš„é‡è½½</span><br>  ...<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span>: <span class="hljs-keyword">public</span> Base &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">mf1</span><span class="hljs-params">()</span></span>;<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">mf3</span><span class="hljs-params">()</span></span>;<br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ç»è¿‡æµ‹è¯•å‘ç°, æ´¾ç”Ÿç±»è°ƒç”¨<code>mf1</code>å°†åªèƒ½è°ƒç”¨åˆ°<code>Derived</code>ä¸­çš„<code>mf1()</code>, <code>mf3</code>ä¹Ÿæ˜¯å¦‚æ­¤, è€ŒåŸºç±»ä¸­çš„é‡è½½ç‰ˆæœ¬å°†æ— æ³•å†è·å–(é™¤éç”¨<code>Base::</code>). ä»¥ä¸‹æˆ‘ä»¬å°†ä¼šä»‹ç»ä¸¤ç§åº”ç”¨äºä¸åŒæƒ…å†µä¸‹çš„è§£å†³åŠæ³•.</p><hr><h3 id="usingå£°æ˜å¼"><a href="#usingå£°æ˜å¼" class="headerlink" title="usingå£°æ˜å¼"></a>usingå£°æ˜å¼</h3><p>è®©æˆ‘ä»¬å›é¡¾æ¡æ¬¾32 : â€œ<strong>publicæ„å‘³is-a</strong>â€œ , ä¹Ÿå°±æ˜¯è¯´æ´¾ç”Ÿç±»å¯ä»¥å¹²å‡ºæ‰€æœ‰<code>Base</code>å¯ä»¥å¹²çš„äº‹, ä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹, åŸºç±»å¯ä»¥ä½¿ç”¨<code>mf1(int)</code>, è€Œæ´¾ç”Ÿç±»å´ä¸å¯, è¿™ä¾¿æ˜¯æ‰“ç ´äº†è¿™ä¸ªè§„åˆ™. å› æ­¤æˆ‘ä»¬å¯ä»¥å†åœ¨æ´¾ç”Ÿç±»é‡å†™å¯¹åº”çš„é‡è½½, äº¦æˆ–æ˜¯ç›´æ¥æ¥å—çˆ¶ç±»çš„é‡è½½ç‰ˆæœ¬, å°±åƒå¦‚ä¸‹ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span>: <span class="hljs-keyword">public</span> Base &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-keyword">using</span> Base::mf1;       <br>  <span class="hljs-keyword">using</span> Base::mf3;      <span class="hljs-comment">// æ‰€æœ‰Baseä¸­çš„mf1å’Œmf2åœ¨Derivedä¸­éƒ½å¯è§</span><br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">mf1</span><span class="hljs-params">()</span></span>;<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">mf3</span><span class="hljs-params">()</span></span>;<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">mf4</span><span class="hljs-params">()</span></span>;<br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>å¦‚æ­¤ä¾¿å¯<strong>é¿å…é®æ©ç»§æ‰¿è€Œæ¥çš„åç§°</strong>.</p><hr><h3 id="è½¬äº¤å‡½æ•°"><a href="#è½¬äº¤å‡½æ•°" class="headerlink" title="è½¬äº¤å‡½æ•°"></a>è½¬äº¤å‡½æ•°</h3><p><code>public</code>ç»§æ‰¿å¯ä»¥é€šè¿‡<code>using</code>æš´éœ²æ‰€æœ‰åŸºç±»çš„åç§°åŠå…¶å¯¹åº”çš„é‡è½½ç‰ˆæœ¬, ä½†å½“ç„¶ä¹Ÿä¼šæœ‰<code>private</code>ç»§æ‰¿(å…·ä½“ç»†èŠ‚åœ¨æ¡æ¬¾39ä¸­è®²è§£)æœ‰ç±»ä¼¼çš„éœ€æ±‚, ä½†<code>private</code>ç»§æ‰¿ä¸ä¸€å®šéœ€è¦ç»§æ‰¿æ‰€æœ‰åŸºç±»çš„é‡è½½ç‰ˆæœ¬, å¯èƒ½åªæ˜¯æŸä¸ªè¢«é®æ©çš„ç‰ˆæœ¬, äºæ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>è½¬äº¤å‡½æ•°</strong>, æ¥ç¼©å°è·å–çš„èŒƒå›´, è®©æˆ‘ä»¬çœ‹ä»¥ä¸‹ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">mf1</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">mf1</span><span class="hljs-params">(<span class="hljs-type">int</span>)</span></span>;<br>  ...                                   <br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span>: <span class="hljs-keyword">private</span> Base &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">mf1</span><span class="hljs-params">()</span></span><br><span class="hljs-function">  </span>&#123; Base::<span class="hljs-built_in">mf1</span>(); &#125;                     <span class="hljs-comment">// è½¬äº¤ç»™åŸºç±», é€‰å–å…¶ä¸­çš„æ— å‚æ•°ç‰ˆæœ¬</span><br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™æ ·<code>mf1</code>å°±åªä¼šæœ‰åŸºç±»æ— å‚æ•°ç‰ˆæœ¬çš„<code>mf1</code>å¯¹åº”çš„åŠŸèƒ½, è€Œä½¿ç”¨ä¸åˆ°å¸¦<code>int</code>çš„é‡è½½ç‰ˆæœ¬.</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>æ´¾ç”Ÿç±»ä¸­çš„åç§°ä¼šé®æ©åŸºç±»ä¸­çš„åç§°.</li><li><code>public</code>ç»§æ‰¿å¿…é¡»æ¥å—æ‰€æœ‰åŸºç±»ä¸­æ‰€æœ‰è¢«é®æ©çš„åç§°, æ•…ç”¨<code>using</code>å£°æ˜å¼.</li><li><code>private</code>ç»§æ‰¿ä¸­å¯èƒ½æœ‰éœ€è¦åŸºç±»ä¸­è¢«é®æ©ç‰©çš„éœ€æ±‚, å¯ä»¥ç”¨è½¬äº¤å‡½æ•°å£°æ˜è°ƒç”¨åŸºç±»å‡½æ•°.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾32 publicç»§æ‰¿</title>
    <link href="/2024/12/12/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE32%20public%E7%BB%A7%E6%89%BF/"/>
    <url>/2024/12/12/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE32%20public%E7%BB%A7%E6%89%BF/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾32-ç¡®å®šä½ çš„publicç»§æ‰¿å¡‘è†œå‡º-is-a-å…³ç³»"><a href="#æ¡æ¬¾32-ç¡®å®šä½ çš„publicç»§æ‰¿å¡‘è†œå‡º-is-a-å…³ç³»" class="headerlink" title="æ¡æ¬¾32 : ç¡®å®šä½ çš„publicç»§æ‰¿å¡‘è†œå‡º is-a å…³ç³»"></a>æ¡æ¬¾32 : ç¡®å®šä½ çš„publicç»§æ‰¿å¡‘è†œå‡º is-a å…³ç³»</h2><blockquote><p>ä»æœ¬æ¡æ¬¾å¼€å§‹æˆ‘ä»¬å°†æ­¥å…¥é¢å‘å¯¹è±¡ç¼–ç¨‹è¿™ä¸€é‡è¦é¢†åŸŸè¿›è¡Œè®¨è®º, é¦–å…ˆæˆ‘ä»¬å°†ä¼šå›´ç»•publicç»§æ‰¿, åˆ†æpublicç»§æ‰¿çš„æ„ä¹‰ä¸ç›®çš„, å†ä¸¾å‡ºä¸¤ä¸ªé”™è¯¯çš„publicç»§æ‰¿å…¸ä¾‹.</p></blockquote><h3 id="publicç»§æ‰¿æ„å‘³â€is-aâ€-æ˜¯ä¸€ç§-çš„å…³ç³»"><a href="#publicç»§æ‰¿æ„å‘³â€is-aâ€-æ˜¯ä¸€ç§-çš„å…³ç³»" class="headerlink" title="publicç»§æ‰¿æ„å‘³â€is-aâ€(æ˜¯ä¸€ç§)çš„å…³ç³»"></a>publicç»§æ‰¿æ„å‘³â€is-aâ€(æ˜¯ä¸€ç§)çš„å…³ç³»</h3><p>è¿™ä¾¿æ˜¯C++é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æœ€é‡è¦çš„ä¸€ä¸ªè§„åˆ™, è¯·æŠŠè¿™ä¸ªè§„åˆ™ç‰¢ç‰¢è®°åœ¨å¿ƒä¸­å§, ç›¸ä¿¡å¾ˆå¤šäººä»¥åŠå¯¹è¿™ç§è®¤çŸ¥æœ‰æ‰€è€³é—», æˆ‘ç”šè‡³åœ¨å­¦javaçš„å¤šæ€æ—¶éƒ½å¬åˆ°è¿‡è¿™ä¸ªæ¦‚å¿µ, å¯è§æ­¤æ€æƒ³å½±å“ä¹‹æ·±è¿œ.</p><p>å¦‚æœä½ ä»¤Bå…¬å¼€ç»§æ‰¿è‡ªA, é‚£ä¹ˆä»£è¡¨ç€<strong>Bæ˜¯ä¸€ç§A</strong>,  è¿›è€Œä»£è¡¨ç€<strong>æ‰€æœ‰å¯ä»¥ä½¿ç”¨Açš„åœºæ™¯éƒ½å¯ä»¥ä½¿ç”¨B, æ‰€æœ‰Aå¯ä»¥äº§ç”Ÿçš„è¡Œä¸ºBéƒ½å¯ä»¥äº§ç”Ÿ</strong>. åä¹‹åˆ™ä¸ç„¶, éœ€è¦Bçš„åœºæ™¯å¹¶ä¸èƒ½ç”¨Aæ›¿ä»£.</p><p>è¿™ç§è§„åˆ™è¡¨é¢ä¸Šå¾ˆå®¹æ˜“ç†è§£, ä½†æ˜¯æˆ‘ä»¬åº”å½“å¤šå»ç«™åœ¨è¯­æ³•å’Œç¨‹åºæœ¬èº«çš„è§’åº¦å»ç†è§£, å› ä¸ºæˆ‘ä»¬åœ¨ç”Ÿæ´»ä¸­çš„ç›´è§‰å¯èƒ½ä¼šè¯¯å¯¼æˆ‘ä»¬, å®ƒå¹¶ä¸ä¸€å®šæ˜¯å¯Œæœ‰é€»è¾‘æ€§è€Œä¸”ç¼œå¯†, è¿™ä¼šè®©æˆ‘ä»¬æƒ³å½“ç„¶åœ°å»è®¤ä¸ºxxxæ˜¯ä¸€ç§xxx.</p><p>è®©æˆ‘ä»¬é€šè¿‡ä¸¤ä¸ªä¾‹å­æ¥æ­éœ²è¿™ç§é”™è¯¯.</p><hr><h3 id="é¸Ÿä¼šé£"><a href="#é¸Ÿä¼šé£" class="headerlink" title="é¸Ÿä¼šé£?"></a>é¸Ÿä¼šé£?</h3><p>ç›´è§‰æ¥çœ‹, é¸Ÿåº”è¯¥æ˜¯ä¼šé£çš„, ä½†æ˜¯å½“æˆ‘ä»¬æƒ³åˆ°é¸µé¸Ÿå’Œä¼é¹…, äº‹æƒ…å°±å¼€å§‹ä¸å¯¹åŠ²äº†, æˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€ç‰ˆ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Bird</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">fly</span><span class="hljs-params">()</span></span>;                  <span class="hljs-comment">// é¸Ÿä¼šé£</span><br>  ...<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Penguin</span>:<span class="hljs-keyword">public</span> Bird &#123;            <span class="hljs-comment">// ä¼é¹…æ˜¯é¸Ÿ</span><br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡º, ä¼é¹…ç¡®å®æ˜¯é¸Ÿ, ä½†ä¼é¹…ç¡®å®ä¸ä¼šé£, å®ƒæœ¬å°±ä¸åº”è¯¥ç»§æ‰¿fly()å‡½æ•°, äºæ˜¯æˆ‘ä»¬å°±ä¼šæœ‰ä¸‹ä¸€ç‰ˆ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Bird</span> &#123;<br>  ...                                      <span class="hljs-comment">// ä¸åœ¨å£°æ˜fly()å‡½æ•°</span><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FlyingBird</span>: <span class="hljs-keyword">public</span> Bird &#123;<span class="hljs-comment">// ä¸€ä¸ªæ–°çš„æ´¾ç”Ÿç±», ç”¨æ¥åšæ‰€æœ‰é£é¸Ÿçš„åŸºç±»</span><br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">fly</span><span class="hljs-params">()</span></span>;<br>  ...<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Penguin</span>: <span class="hljs-keyword">public</span> Bird &#123;<br>  ...                                       <span class="hljs-comment">// è¿™é‡Œå°±ç»§æ‰¿ä¸åˆ°fly()äº†</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>è‡³æ­¤é€»è¾‘å°±åˆç†äº†,  è¿™ä¹Ÿåœ¨å‘Šè¯«æˆ‘ä»¬åº”å½“ä»”ç»†åˆ†æè®¾ç½®åœ¨ç±»ä¸­çš„æ¯ä¸ªæˆå‘˜å‡½æ•°æ˜¯å¦åˆç†.</p><hr><h3 id="è¿›ä¸€æ­¥æ¢³ç†"><a href="#è¿›ä¸€æ­¥æ¢³ç†" class="headerlink" title="è¿›ä¸€æ­¥æ¢³ç†"></a>è¿›ä¸€æ­¥æ¢³ç†</h3><p>ä¸Šä¸€ä¸ªä¾‹å­å› ä¸ºé¸Ÿæ˜¯å¦ä¼šé£çš„éœ€æ±‚è€Œäº§ç”Ÿäº†ä¸åŒçš„è®¾è®¡, ä½†æ˜¯ä¹¦ä¸­æƒ³å‘Šè¯‰æˆ‘ä»¬, <strong>ä¸–ç•Œä¸Šå¹¶ä¸å­˜åœ¨ä¸€ä¸ªâ€é€‚ç”¨äºæ‰€æœ‰è½¯ä»¶â€çš„å®Œç¾è®¾è®¡</strong>, å› ä¸ºæ—¶é—´åœ¨æµé€, éœ€æ±‚åœ¨å˜åŒ–, æˆ‘ä»¬çš„è®¾è®¡ä¸€å®šè¦ç¬¦åˆéœ€æ±‚, å‡å¦‚æˆ‘ä»¬æ•´ä¸ªä½“ç³»å°±æ˜¯é’ˆå¯¹é£é¸Ÿæ¥å»ºç«‹çš„, å®Œå…¨ä¸ä¼šä¸ä¼é¹…é¸µé¸Ÿç›¸å…³, é‚£ä¹ˆæœ€å¼€å§‹çš„è®¾è®¡å®Œå…¨æ˜¯å¯è¡Œçš„. ç®€å•æ¥è¯´, <strong>æˆ‘ä»¬è¦æ˜ç¡®éœ€æ±‚, æ ¹æ®éœ€æ±‚åˆ†æå„ç§ä¸åŒçš„æƒ…å†µ, åšå‡ºç¬¦åˆå½“å‰éœ€æ±‚çš„ç»§æ‰¿è®¾è®¡</strong>, å½“ç„¶ä¹Ÿå¯ä»¥æœ‰ä¸€å®šçš„å‰ç»æ€§, ä½†ä¸è¦ä¸å½“ä¸‹çš„éœ€æ±‚ç›¸æ‚–.</p><hr><h3 id="æ­£æ–¹å½¢æ˜¯ä¸€ç§çŸ©å½¢"><a href="#æ­£æ–¹å½¢æ˜¯ä¸€ç§çŸ©å½¢" class="headerlink" title="æ­£æ–¹å½¢æ˜¯ä¸€ç§çŸ©å½¢?"></a>æ­£æ–¹å½¢æ˜¯ä¸€ç§çŸ©å½¢?</h3><p>è¿™ç›¸æ¯”äºä¸Šä¸€ä¾‹ä¸­ç”±äºå¸¸è¯†äº§ç”Ÿçš„é”™è¯¯ä¸åŒ, è¿™å°±æ˜¯æ•°ç†æ–¹é¢çš„çœŸç†, ä½†ä»æœ€ç»ˆç»“æœä¸Šå¹¶ä¸é€‚åˆ<code>public</code>ç»§æ‰¿, æˆ‘ä»¬æ¥çœ‹ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">setHeight</span><span class="hljs-params">(<span class="hljs-type">int</span> newHeight)</span></span>;<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">setWidth</span><span class="hljs-params">(<span class="hljs-type">int</span> newWidth)</span></span>;<br><br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">int</span> <span class="hljs-title">height</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;               <span class="hljs-comment">// return current values</span><br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">int</span> <span class="hljs-title">width</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>    <br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addWidth</span><span class="hljs-params">()</span>               <span class="hljs-comment">// è°ƒç”¨è¿™ä¸ªå‡½æ•°ä¼šä½¿è¿™ä¸ªwidthå¢åŠ 10, å¹¶ä¸”heightä¸åŠ </span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">int</span> oldHeight = <span class="hljs-built_in">height</span>();<br>  <span class="hljs-built_in">setWidth</span>(<span class="hljs-built_in">width</span>() + <span class="hljs-number">10</span>);<br>  <span class="hljs-built_in">assert</span>(<span class="hljs-built_in">height</span>() == oldHeight);          <span class="hljs-comment">// æ£€å¯Ÿheightæ˜¯å¦å˜åŒ–</span><br>&#125; <br>  ...<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Square</span>: <span class="hljs-keyword">public</span> Rectangle &#123;...&#125;;<br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ç”¨<code>Square</code>å†™å‡ºå¦‚ä¸‹ä»£ç å°±ä¼šå‘ç”Ÿé—®é¢˜ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp">Square s;<br><span class="hljs-built_in">assert</span>(s.<span class="hljs-built_in">width</span>() == s.<span class="hljs-built_in">height</span>());           <span class="hljs-comment">// çœ‹æ­£æ–¹å½¢çš„æ€§è´¨æ˜¯å¦ä¿æŒ</span><br>s.<span class="hljs-built_in">addWidth</span>();   <span class="hljs-comment">// è°ƒç”¨addWidth</span><br><span class="hljs-built_in">assert</span>(s.<span class="hljs-built_in">width</span>() == s.<span class="hljs-built_in">height</span>());   <span class="hljs-comment">// çœ‹æ­£æ–¹å½¢çš„æ€§è´¨æ˜¯å¦ä¿æŒ</span><br></code></pre></td></tr></table></figure><p>æœ€åä¸€æ¡<code>assert</code>å°†ä¼šè§¦å‘, åŸå› å¾ˆå®¹æ˜“ç†è§£, <code>addWidth</code>åªå¢åŠ äº†å®½åº¦, è¿™æ‰“ç ´çš„æ­£æ–¹å½¢çš„æ€§è´¨.</p><p>è¿›ä¸€æ­¥åˆ†æ, <code>addWidth()</code>è¿™ä¸ªå‡½æ•°æœ¬èº«æ˜¯å®Œå…¨åˆç†çš„, å› ä¸ºä¸€ä¸ªçŸ©å½¢å°±æ˜¯å¯ä»¥åªå¢åŠ å®½åº¦è€Œä¸å¢åŠ é•¿åº¦, é”™çš„æ˜¯è‡ªé¡¾è‡ª<code>public</code>ç»§æ‰¿è‡ªå®ƒçš„<code>Square</code>, å› ä¸ºå®ƒå‡å®šäº†æ­£æ–¹å½¢æ˜¯ä¸€ç§çŸ©å½¢, å°½ç®¡è¿™åœ¨å…¬ç†ä¸Šç¡®å®æ˜¯æˆç«‹çš„,  ä½†æ˜¯æˆ‘ä»¬è¦æ±‚çš„æ˜¯<strong>æ­£æ–¹å½¢å¯ä»¥åšå‡ºæ‰€æœ‰çŸ©å½¢å¯ä»¥åšå‡ºçš„è¡Œä¸º</strong>, è¿™ä»¿ä½›å°±ä¸è¡Œäº†, å› ä¸ºçŸ©å½¢å¯ä»¥åªå¢åŠ å®½åº¦è€Œæ­£æ–¹å½¢ä¸å¯ä»¥.</p><hr><h3 id="å°¾å£°"><a href="#å°¾å£°" class="headerlink" title="å°¾å£°"></a>å°¾å£°</h3><p><code>is-a(æ˜¯ä¸€ç§)</code>å¹¶éæ˜¯å”¯ä¸€å­˜åœ¨äºç»§æ‰¿ä¸­å…³ç³», æˆ‘ä»¬è¿˜ä¼šå†æ¡æ¬¾38å’Œæ¡æ¬¾39è®¨è®ºå¦å¤–ä¸¤ä¸ªå¸¸è§çš„å…³ç³», <code>has-a(æœ‰ä¸€ä¸ª)</code>å’Œ<code>is-implemented-in-terms-of(æ ¹æ®æŸç‰©å®ç°å‡º)</code>, è€Œæˆ‘ä»¬ä¸Šæ–‡æ­£æ–¹å½¢å’ŒçŸ©å½¢çš„å…³ç³»ä¾¿å¯ä»¥ç”¨<code>has-a</code>æ¥è§£é‡Š. åœ¨å­¦å®Œå¦å¤–ä¸¤ç§å…³ç³»ä¹‹å, æˆ‘ä»¬ä¾¿åº”å½“å¥½å¥½äº†è§£è¿™äº›å…³ç³»ä¹‹é—´çš„å·®å¼‚, åœ¨ç»§æ‰¿ä¸­åšåˆ°æ­£ç¡®çš„é€‰æ‹©.</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li><code>public</code>ç»§æ‰¿æ„å‘³â€<code>is-a</code>â€œ(æ˜¯ä¸€ç§)çš„å…³ç³», è‹¥Bç»§æ‰¿è‡ªA, æ‰€æœ‰å¯ä»¥ä½¿ç”¨Açš„åœºæ™¯éƒ½å¯ä»¥ä½¿ç”¨B, æ‰€æœ‰Aå¯ä»¥äº§ç”Ÿçš„è¡Œä¸ºBéƒ½å¯ä»¥äº§ç”Ÿ.</li><li>ä¸è¦å¤ªç›¸ä¿¡ç›´è§‰, å½“ä½ è®¤ä¸ºæŸäº›äº‹ç‰©æœ‰ â€œ<code>is-a</code>â€œçš„å…³ç³», ä¸å¦¨å†çœ‹çœ‹æ˜¯å¦ç¬¦åˆä¸Šä¸€æ¡çš„ååŠå¥.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
      <tag>ç»§æ‰¿</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç“¦å°”ç™»æ¹–è¯»ä¹¦æ‘˜å½•(3)</title>
    <link href="/2024/12/11/%E7%93%A6%E5%B0%94%E7%99%BB%E6%B9%96%E8%AF%BB%E4%B9%A6%E6%91%98%E5%BD%95(3)/"/>
    <url>/2024/12/11/%E7%93%A6%E5%B0%94%E7%99%BB%E6%B9%96%E8%AF%BB%E4%B9%A6%E6%91%98%E5%BD%95(3)/</url>
    
    <content type="html"><![CDATA[<ul><li><p>åªè¦ç´§ç´§è·Ÿéšä½ çš„å¤©èµ‹, å®ƒæ¯æ—¶æ¯åˆ»éƒ½å°†è®©ä½ çœ‹åˆ°å…¨æ–°çš„æ™¯è‰².</p></li><li><p>ä»äº‹å•†ä¸šéœ€è¦æå…·è‡ªä¿¡, è®¤çœŸ, æœºè­¦, æ•¢äºå†’é™©å’Œä¸çŸ¥ç–²å€¦çš„ç²¾ç¥.</p></li><li><p>å½“äº†è§£æŸä¸ªäººçš„çœŸå®æ€§æ ¼ä»¥å, æˆ‘è‡ªè®¤ä¸ºæ˜¯ä¸å¯èƒ½å»æ”¹å˜å®ƒçš„, æ— è®ºæ˜¯è®©å®ƒå˜å¾—æ›´å¥½è¿˜æ˜¯æ›´å.</p></li><li><p>æˆ‘æ—¢å¯ä»¥å› ä¸ºçœ‹æˆè€Œæ„ŸåŠ¨, ä½†æˆ‘ä¹Ÿå¯ä»¥å¯¹å’Œæˆ‘æœ‰é‡è¦å…³ç³»çš„å®é™…äº‹ä»¶æ— åŠ¨äºè¡·.</p></li><li><p>æˆ‘ä»¬æ´»å¾—å¤ªæ‹¥æŒ¤, å› è¢­å½¼æ­¤çš„ç”Ÿæ´»æ–¹å¼, ç›¸äº’ä¹‹é—´ç£•ç£•ç»Šç»Š, æˆ‘æƒ³æˆ‘ä»¬å› æ­¤å¤±å»äº†å½¼æ­¤ä¹‹é—´çš„å°Šé‡. å¯¹æ‰€æœ‰çƒ­å¿±çš„äº¤å¾€æ¥è¯´, æ¬¡æ•°å†å°‘è‚¯å®šä¹Ÿæ˜¯è¶³å¤Ÿçš„.</p></li><li><p>æ¯ä¸ªäººæ¸…é†’è¿‡æ¥ä¹‹åéƒ½åº”è¯¥äº†è§£è‡ªå·±æ‰€å¤„çš„ä½ç½®, åªæœ‰åˆ°äº†å¤±å»è¿™ä¸ªä¸–ç•Œä¹‹å, æˆ‘ä»¬æ‰èƒ½å¼€å§‹æ‰¾åˆ°æˆ‘ä»¬è‡ªå·±, æ‰èƒ½å‘ç°æˆ‘ä»¬æ‰€å¤„çš„ä½ç½®, ä»¥åŠæˆ‘ä»¬ä¸ä¸‡äº‹ä¸‡ç‰©çš„è”ç³»æ˜¯å¤šä¹ˆç´§å¯†.</p></li><li><p>åˆ«è®©è°‹ç”Ÿå˜æˆè‹¦å·®äº‹, è€Œæ˜¯è®©å®ƒæˆä¸ºå¨±ä¹æ´»åŠ¨. å°½æƒ…åœ°äº«å—å¤§åœ°å§, ä½†åˆ«å»å æœ‰å®ƒ. ä¸–äººå¾€å¾€ç¼ºå°‘å†’é™©ç²¾ç¥å’Œä¿¡ä»°, æ‰€ä»¥ä»–ä»¬å¿™äºä¹°å–ç»è¥, è¿‡ç€å¥´éš¶èˆ¬çš„æ—¥å­.</p></li><li><p>äººä»¬æ¯å¤©åªå»ç¦»å®¶ä¸è¿œçš„ç”°é‡å’Œè¡—é“, åˆ°äº†å¤œé‡Œå°±ä¹–ä¹–å›å», ä»–ä»¬åˆ°åº•ç”Ÿå‘½æ¸æ¸å¤±å»äº†æ´»åŠ›, å› ä¸ºç¼ºä¹æ–°é²œçš„ç©ºæ°”.</p></li><li><p>æˆ‘æ—¢çƒ­çˆ±å–„è‰¯çš„äººæ€§, ä¹Ÿçƒ­çˆ±é‡è›®çš„å…½æ€§.</p></li><li><p>æ‰“çŒæ˜¯æˆ‘å—è¿‡æœ€å¥½çš„æ•™è‚², å°½ç®¡èµ·åˆä»–ä»¬åªèƒ½æ˜¯ç©ç©è€Œå·², æœ€åæœªå¿…èƒ½å¤Ÿæˆä¸ºå‰å®³çš„çŒäºº, è¿™æ ·ä»–ä»¬å°†æ¥åè€Œä¸ä¼šåœ¨è¿™ç‰‡æˆ–å…¶ä»–æ—·é‡ä¸Šæ»¥æ€æ— è¾œ, ä¸ä¼šä»¥åŒç±»ä¸ºæ¸”çŒçš„å¯¹è±¡.</p></li><li><p>å‡ ä¹æ‰€æœ‰çš„æˆè™«åƒçš„ä¸œè¥¿éƒ½æ¯”å¹¼è™«å°‘å¾—å¤š, é¥•é¤®è€…éƒ½æ˜¯å¤„äºå¹¼è™«æ—¶æœŸçš„äºº, æœ‰äº›æ°‘æ—æ•´ä¸ªéƒ½å¤„åœ¨è¿™ç§é˜¶æ®µ, é‚£äº›æ°‘æ—çš„äººæ²¡æœ‰ç†æƒ³å’Œåˆ›é€ åŠ›, æœ‰çš„æ˜¯å‡ºå–äº†ä»–ä»¬çš„ä¾¿ä¾¿å¤§è…¹.</p></li><li><p>åªè¦åšæŒèŒ¹ç´ , ä½ å°†ä¼šæ¬¢å¿«åœ°è¿æ¥ç™½å¤©å’Œé»‘å¤œçš„åˆ°æ¥, ç”Ÿæ´»å°†å¦‚é²œèŠ±å’ŒèŠ³è‰èˆ¬æ•£å‘ç€é¦™æ°”, å¹¶ä¸”å˜å¾—æ›´åŠ ä¹è§‚å’Œé«˜å°š, è€Œä¸”æ›´æœ‰ä»™æ°”â€”é‚£å°±æ˜¯ä½ çš„æˆåŠŸ.</p></li><li><p>ä¹Ÿè®¸æœ€è®©äººéœ‡æƒŠ, æœ€ä¸ºçœŸåˆ‡çš„äº‹å®ä»æ¥ä¸æ›¾åœ¨äººä¸äººä¹‹é—´äº¤æµè¿‡.</p></li><li><p>æˆ‘è®¤ä¸ºç™½æ°´æ˜¯å”¯ä¸€é€‚åˆæ™ºè€…çš„é¥®æ–™, é…’å¹¶éé«˜è´µçš„æ¶²ä½“, ä¸€æ¯å’–å•¡èƒ½å¤Ÿå†²èµ°æ¸…æ™¨çš„å¸Œæœ›, ä¸€æ¯çƒ­èŒ¶å¯ä»¥ç ´åå¤œæ™šçš„ç¾æ¢¦.</p></li><li><p>èƒ½å¤Ÿæ±¡ç§½äººçš„, ä¸æ˜¯åƒè¿›å˜´é‡Œçš„é£Ÿç‰©, è€Œæ˜¯ä¸çŸ¥é¤è¶³çš„é£Ÿæ¬². åº”è¯¥å—åˆ°è°´è´£çš„ä¸æ˜¯é£Ÿç‰©çš„äº‹åŠ¡æˆ–å“è´¨, è€Œæ˜¯å¯¹å£è…¹ä¹‹æ¬²çš„ç—´è¿·; åŠ å…¥ä½ åƒä¸œè¥¿ä¸æ˜¯ä¸ºäº†ç»´æŒæˆ‘ä»¬çš„ç”Ÿå‘½, ä¹Ÿä¸æ˜¯ä¸ºäº†æ¿€å‘æˆ‘ä»¬çš„çµæ„Ÿ, è€Œæ˜¯ä¸ºäº†å–‚é¥±æ§åˆ¶æˆ‘ä»¬çš„é¦‹è™«, é‚£ä¹ˆä½ åº”è¯¥æ„Ÿåˆ°æƒ­æ„§.</p></li><li><p>è®¸å¤šçƒ¦äººçš„å™ªéŸ³ä¼ åˆ°è¿œå¤„ä¹‹å, äººä»¬å±…ç„¶å°†å…¶å½“æˆéŸ³ä¹æ¥å€¾å¬, ç€å¯¹æˆ‘ä»¬ä½è´±çš„ç”Ÿæ´»æ¥è¯´, çœŸå®è«å¤§çš„è®½åˆº.</p></li><li><p>é¥•é¤®, è´ªæ¯, å¥½è‰²æˆ–å—œç¡å…¶å®æ˜¯ä¸€å›äº‹, å®ƒä»¬æ— ééƒ½æ˜¯è‚‰ä½“çš„æ¬²æ±‚, åªè¦çœ‹åˆ°æœ‰äººçŠ¯äº†å…¶ä¸­ä¹‹ä¸€, æˆ‘ä»¬ä¾¿çŸ¥é“ä»–æ˜¯è€½äºå£°è‰²çŠ¬é©¬ä¹‹å¾’, æ±¡ç§½ä¸çº¯æ´æ˜¯ä¸èƒ½å¹¶å­˜çš„.</p></li><li><p>æ™ºæ…§å’Œçº¯æ´å‡ºè‡ªå‹¤å¥‹, æ— çŸ¥ä¸å •è½æºäºæ‡’æƒ°. å¯¹å­¦ç”Ÿæ¥è¯´, å •è½å°±æ˜¯æ€è€ƒçš„æ‡’æƒ°.</p></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>é˜…è¯»</tag>
      
      <tag>ç“¦å°”ç™»æ¹–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾31 ç¼–è¯‘ä¾å­˜æ€§</title>
    <link href="/2024/12/11/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE31%20%E7%BC%96%E8%AF%91%E4%BE%9D%E5%AD%98%E6%80%A7/"/>
    <url>/2024/12/11/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE31%20%E7%BC%96%E8%AF%91%E4%BE%9D%E5%AD%98%E6%80%A7/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾31-å°†æ–‡ä»¶é—´çš„ç¼–è¯‘ä¾å­˜å…³ç³»é™è‡³æœ€ä½"><a href="#æ¡æ¬¾31-å°†æ–‡ä»¶é—´çš„ç¼–è¯‘ä¾å­˜å…³ç³»é™è‡³æœ€ä½" class="headerlink" title="æ¡æ¬¾31 : å°†æ–‡ä»¶é—´çš„ç¼–è¯‘ä¾å­˜å…³ç³»é™è‡³æœ€ä½"></a>æ¡æ¬¾31 : å°†æ–‡ä»¶é—´çš„ç¼–è¯‘ä¾å­˜å…³ç³»é™è‡³æœ€ä½</h2><blockquote><p>æœ¬æ¡æ¬¾å°†å¸¦æˆ‘ä»¬è®¤è¯†æ–‡ä»¶ç¼–è¯‘ä¾å­˜çš„é—®é¢˜, ä»¥åŠè§£å†³é—®é¢˜çš„ä¸¤ä¸ªæœ‰æ•ˆæ‰‹æ®µ.</p></blockquote><h3 id="é—®é¢˜å¼•å…¥"><a href="#é—®é¢˜å¼•å…¥" class="headerlink" title="é—®é¢˜å¼•å…¥"></a>é—®é¢˜å¼•å…¥</h3><p>é—®é¢˜çš„æ ¹æºæ¥è‡ªC++å¹¶æ²¡æœ‰æŠŠ**â€å°†æ¥å£ä»å®ç°ä¸­åˆ†ç¦»â€**è¿™äº‹åšå¾—å¾ˆå¥½, ç®€å•æ¥è¯´, ç”±äºC++æœ¬èº«æœºåˆ¶ä¸å®šä½çš„åŸå› , ä¸ºäº†è¾¾åˆ°æ›´å¤§çš„æ•ˆç‡å’Œå¯æ‰©å±•æ€§, C++å¼•å…¥<code>inline</code>å’Œ<code>template</code>ç­‰ç‰¹æ€§, è¿™äº›ç‰¹æ€§æ— ä¸éœ€è¦åœ¨å¤´æ–‡ä»¶ä¸­å‘æŒ¥ä½œç”¨, ä¹Ÿå°±ä»£è¡¨åŸæœ¬åªåº”è¯¥å­˜æ”¾å£°æ˜çš„å¤´æ–‡ä»¶ä¼šåŠ å…¥å¤ªå¤šçš„å®ç°ç»†ç›®, ä¹Ÿå°±æ˜¯æ‰€è°“çš„â€æ²¡æœ‰æŠŠå°†æ¥å£ä»å®ç°ä¸­åˆ†ç¦»è¿™äº‹åšå¾—å¾ˆå¥½â€.</p><p>è¿™å¸¦æ¥çš„é—®é¢˜æ˜¯æ—¢ç„¶<strong>å¾ˆå¤šå®šä¹‰åœ¨å¤´æ–‡ä»¶é‡Œ</strong>, ä¸€æ—¦æˆ‘ä»¬è¦ä¿®æ”¹è¿™äº›å®šä¹‰, é‚£ä¹ˆæ‰€æœ‰ä½¿ç”¨äº†è¿™ä¸ªå¤´æ–‡ä»¶çš„æ‰€æœ‰å®¢æˆ·(å¤´æ–‡ä»¶)å°±éƒ½éœ€è¦é‡æ–°ç¼–è¯‘, ä¸€ç¯åµŒä¸€ç¯, æœ€åéœ€è¦çš„<strong>ç¼–è¯‘æˆæœ¬å°±éå¸¸é«˜</strong>äº†, è¿™åœ¨ä¹¦ä¸­è¢«ç§°ä½œ**â€è¿ä¸²ç¼–è¯‘ä¾å­˜å…³ç³»â€**.</p><hr><h3 id="è¿›ä¸€æ­¥è§£æ"><a href="#è¿›ä¸€æ­¥è§£æ" class="headerlink" title="è¿›ä¸€æ­¥è§£æ"></a>è¿›ä¸€æ­¥è§£æ</h3><p><code>inline</code>å’Œ<code>template</code>æ— å¯åšé, è¿™æ˜¯ä¸ºäº†æ•ˆç‡æˆ‘ä»¬å¿…é¡»è¦è®©æ­¥çš„åœ°æ–¹, ä½†æ˜¯è®¸å¤š<strong>æˆå‘˜å˜é‡</strong>ä¹Ÿä¼šå®šä¹‰åœ¨ç±»çš„å®šä¹‰å¼ä¸­, è¿™å°±æœ‰æˆ‘ä»¬å¤„ç†çš„ä½™åœ°äº†, çœ‹çœ‹ä»¥ä¸‹ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;date.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;address.h&quot;</span> <span class="hljs-comment">// å¿…é¡»åŒ…å«ä¸‹æ–¹ç›¸å…³ç±»çš„å¤´æ–‡ä»¶</span></span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-built_in">Person</span>(<span class="hljs-type">const</span> std::string&amp; name, <span class="hljs-type">const</span> Date&amp; birthday,<br>         <span class="hljs-type">const</span> Address&amp; addr);<br>  <span class="hljs-function">std::string <span class="hljs-title">name</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>  <span class="hljs-function">std::string <span class="hljs-title">birthDate</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>  <span class="hljs-function">std::string <span class="hljs-title">address</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>  ...<br><br><span class="hljs-keyword">private</span>:<br>      std::string theName;        <span class="hljs-comment">// åç§°å®šä¹‰</span><br>      Date theBirthDate;          <span class="hljs-comment">// ç”Ÿæ—¥å®šä¹‰</span><br>      Address theAddress;         <span class="hljs-comment">// åœ°å€å®šä¹‰</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªäººçš„æŠ½è±¡ç±»å‹, é‡Œé¢æœ‰ä¸‰ç§ä¸åŒç±»å‹çš„æˆå‘˜å˜é‡, æˆ‘ä»¬å¯ä»¥è®¾æƒ³åˆ°çš„æ˜¯, åªè¦<code>Date</code>å’Œ<code>Address</code>çš„å†…éƒ¨å®šä¹‰å‘ç”Ÿå˜åŒ–, å°±ä¸€å®šä¼šè¿ä¸²å¯¼è‡´<code>Person</code>é‡æ–°ç¼–è¯‘, ç„¶åä½¿ç”¨<code>Person</code>çš„å®¢æˆ·ä¹Ÿéœ€è¦é‡æ–°ç¼–è¯‘.</p><p>éƒ¨åˆ†è¯­è¨€çš„è§£å†³æ–¹å¼æ˜¯ç›´æ¥åœ¨åº•å±‚å¤„ç†æˆæŒ‡é’ˆ, è¿™æ ·åˆ°å“ªé‡Œéƒ½æ˜¯åŸç”ŸæŒ‡é’ˆçš„å¤§å°, å°±æ— éœ€é€šè¿‡å¼•å…¥å¤´æ–‡ä»¶çŸ¥é“å…¶å¤§å°, äºæ˜¯å¯èƒ½å¤„ç†æˆå¦‚ä¸‹å®šä¹‰ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp">std::string* theName;        <br>Date* theBirthDate;   <br>Address* theAddress;<br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±ä¸éœ€è¦å¼•å…¥å¤´æ–‡ä»¶äº†,  åªéœ€è¦å£°æ˜æœ‰è¿™ä¹ˆä¸€ä¸ªç±»å°±è¡Œäº†, å½“ç„¶stringè¿˜æ˜¯å£°æ˜å¤´æ–‡ä»¶å§, å› ä¸ºæ ‡å‡†åº“çš„ç¼–è¯‘ä¸€èˆ¬ä¸ä¼šæˆä¸ºç¼–è¯‘ç“¶é¢ˆ.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span>             </span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Date</span>;                          <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span>;      <br></code></pre></td></tr></table></figure><p>ä½†æˆ‘ä»¬çš„C++å¹¶æ²¡æœ‰åœ¨åº•å±‚å®ç°è¿™ç§æœºåˆ¶, ä¹Ÿæ˜¯å› ä¸ºæ•ˆç‡å’Œä¸€äº›è®¾è®¡ç†å¿µçš„é—®é¢˜, ä½†æ²¡å…³ç³», æˆ‘ä»¬å¯ä»¥è‡ªå·±ä»¿ç…§è¿™ç§åšæ³•æ¥å®ç°, è¿™å°±è¯·æˆ‘ä»¬å›å¿†èµ·æ¡æ¬¾29ä¸­æåˆ°çš„<strong>pimpl idiom</strong>æ‰‹æ³•(æŒ‡é’ˆæŒ‡å‘å®ç°), æˆ‘ä»¬å°†åœ¨æœ¬æ¡æ¬¾ç»§ç»­æ·±å…¥å…¶ä½¿ç”¨, <strong>è®¾ç½®æ¥å£ç±»å’Œå®ç°ç±», åšåˆ°æ¥å£å’Œå®ç°åˆ†ç¦»</strong>, ä»¥ä¸‹æ˜¯æ¥å£ç±»çš„ä»£ç , å®ç°ç±»å°†åœ¨åæ–‡è¡¥å…… : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span>                      </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span>                      <span class="hljs-comment">// shared_ptræ‰€åœ¨</span></span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonImpl</span>;                      <span class="hljs-comment">// åŒæ—¶ä¹Ÿå£°æ˜å®ç°ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Date</span>;                        <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span>;                         <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br><span class="hljs-keyword">public</span>:<br><span class="hljs-built_in">Person</span>(<span class="hljs-type">const</span> std::string&amp; name, <span class="hljs-type">const</span> Date&amp; birthday,<br>        <span class="hljs-type">const</span> Address&amp; addr);<br><span class="hljs-function">std::string <span class="hljs-title">name</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br><span class="hljs-function">std::string <span class="hljs-title">birthDate</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br><span class="hljs-function">std::string <span class="hljs-title">address</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>...<br><br><span class="hljs-keyword">private</span>:                                   <br>  std::shared_ptr&lt;PersonImpl&gt; pImpl;  <span class="hljs-comment">// shared_pträ½¿ç”¨è§æ¡æ¬¾13</span><br>&#125;; <br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼šå®ç°ä¸€ä¸ª<code>PersonImpl</code>å°è£…ä¸Šæ–‡çš„ä¸‰ä¸ªå®šä¹‰, å¹¶ä¸”å®ç°å¯¹<code>Person</code>ä¸­æˆå‘˜å‡½æ•°çš„å®šä¹‰,  å› æ­¤<code>Person</code>ä¸­å°±åªæœ‰è¿™ä¸‰ä¸ªç±»å‹çš„å£°æ˜è€Œæ— å®šä¹‰äº†, å°±ç®—è¿™ä¸‰ä¸ªç±»å‘ç”Ÿä¿®æ”¹, ä¹Ÿæ— éœ€é‡æ–°ç¼–è¯‘Person, äºæ­¤é€šè¿‡æ¥å£ä¸å®ç°åˆ†ç¦», é™ä½äº†ç¼–è¯‘ä¾å­˜å…³ç³».</p><p>é¢å¤–è¯´ä¸€ä¸‹, <code>shared_ptr</code>å¹¶ä¸éœ€è¦è¢«ç®¡ç†ç±»çš„å¤´æ–‡ä»¶, ä¹Ÿæ˜¯å£°æ˜å³å¯, å°±åƒæ­£å¸¸çš„æŒ‡é’ˆä¸€æ ·.</p><hr><h3 id="æ€æƒ³å†…æ ¸"><a href="#æ€æƒ³å†…æ ¸" class="headerlink" title="æ€æƒ³å†…æ ¸"></a>æ€æƒ³å†…æ ¸</h3><p><strong>ç¼–è¯‘ä¾å­˜æ€§æœ€å°åŒ–</strong>çš„æœ¬è´¨åœ¨äº<strong>ä»¥â€å£°æ˜çš„ä¾å­˜æ€§â€æ›¿æ¢â€å®šä¹‰çš„ä¾å­˜æ€§â€</strong>, ç°å®ä¸­è®©å¤´æ–‡ä»¶<strong>å°½å¯èƒ½è‡ªæˆ‘æ»¡è¶³</strong>, ä¸‡ä¸€åšä¸åˆ°, åˆ™è®©å®ƒä¸å…¶å®ƒæ–‡ä»¶å†…<strong>å£°æ˜å¼</strong>ç›¸ä¾.</p><p>äºæ˜¯æˆ‘ä»¬å¯ä»¥è¡ç”Ÿå‡ºä¸‰ä¸ªè®¾è®¡ç­–ç•¥ : </p><ul><li>å¦‚æœå¯ä»¥ç”¨<strong>æŒ‡é’ˆæˆ–å¼•ç”¨</strong>å°±ä¸è¦ç›´æ¥ç”¨ç±»å®šä¹‰. <strong>ç±»å®šä¹‰éœ€è¦å¼•å…¥å¤´æ–‡ä»¶, ä½†æ˜¯æŒ‡é’ˆæˆ–å¼•ç”¨ä¸éœ€è¦, åªè¦å£°æ˜ç±»å‹å³å¯</strong>.</li><li>å¦‚æœèƒ½å¤Ÿ, å°½é‡<strong>ä»¥classå£°æ˜å¼æ›¿æ¢classå®šä¹‰å¼</strong>. <strong>å½“ä½ å£°æ˜ä¸€ä¸ªå‡½æ•°è€Œç”¨åˆ°æŸä¸ªclassæ—¶, ä½ å¹¶ä¸éœ€è¦æ”¹classçš„å®šä¹‰</strong>, çºµä½¿å‡½æ•°ä»¥<code>by value</code>çš„æ–¹å¼ä¼ é€’è¯¥ç±»å‹çš„å‚æ•°, å°±åƒä¸Šé¢çš„<code>Person</code>æ„é€ ä¸€æ ·.</li><li><strong>ä¸ºæ¥å£ç±»å’Œå®ç°ç±»(ä¹Ÿå°±æ˜¯å£°æ˜å’Œå®šä¹‰)æä¾›ä¸åŒçš„å¤´æ–‡ä»¶</strong>, åŸå› å¾ˆå®¹æ˜“ç†è§£, æœ¬æ¥åˆ†å¼€çš„ç›®çš„å°±æ˜¯ä¸ºäº†åœ¨å®ç°ç±»ä¿®æ”¹æ—¶æ— éœ€æ¥å£ç±»å†æ¬¡ç¼–è¯‘è¿›è€Œæ‰©æ•£å½±å“,  æ”¾åœ¨ä¸€ä¸ªå¤´æ–‡ä»¶ä¸­åˆ°æœ€åè¿˜ä¸æ˜¯ä¸€å—ç¼–è¯‘å—?</li></ul><p>è¿™é‡Œè¿˜éœ€è¦è§£é‡Šä¸ºä»€ä¹ˆä¸Šé¢çš„ç­–ç•¥éƒ½æ˜¯æ— éœ€å®šä¹‰, åªè¦å£°æ˜å°±å¯ä»¥äº†?</p><p>æˆ‘ä»¬å¯ä»¥æƒ³å¼€ä¸€ç‚¹, å°±æ˜¯åœ¨æ¥å£ç±»ä¸­çœŸçš„æœ‰æ²¡æœ‰æ— æ‰€è°“, åªè¦é€šè¿‡å£°æ˜è®¤ä¸ºå®ƒæœ‰å°±è¡Œ, çœŸæ­£ç”¨å®ƒçš„æ˜¯å®ç°ç±», <strong>ä¸€æ—¦ä»»ä½•äººè°ƒç”¨é‚£äº›å‡½æ•°, è°ƒç”¨ä¹‹å‰å®šä¹‰å¼ä¸€æ—¦å¾—å…ˆæ›å…‰æ‰è¡Œ</strong>(å°±æ˜¯ä½ è°ƒç”¨å‡½æ•°å‰è‚¯å®šä¼šä¼ å…¥å¯¹åº”çš„å‚æ•°å˜›), æ‰€ä»¥æˆ‘ä»¬æ˜¯<strong>å°†â€æä¾›å®šä¹‰å¼â€çš„ä¹‰åŠ¡ä»æ¥å£ç±»å¤´æ–‡ä»¶è½¬åˆ°äº†â€å†…å«è¯¥å‡½æ•°è°ƒç”¨â€çš„å®¢æˆ·æ–‡ä»¶ä¸­</strong>, è¿™æ ·å°±å¯ä»¥<strong>å°†â€éå¿…è¦ç±»å‹å®šä¹‰â€ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„ç¼–è¯‘ä¾å­˜æ€§å»æ‰</strong>.</p><p>æ¥ä¸‹æ¥å°†ä¼šæ ¹æ®æ€æƒ³å†…æ ¸æä¾›ä¸¤ç§å®ç°ç¼–è¯‘ä¾å­˜æ€§æœ€å°åŒ–çš„æœ€ç»ˆæ–¹æ¡ˆ : </p><hr><h3 id="Handle-classes"><a href="#Handle-classes" class="headerlink" title="Handle classes"></a>Handle classes</h3><p>æœ¬æ–¹æ¡ˆä»¥ä¸Šæ–‡çš„<strong>pimpl idiom</strong>æ‰‹æ³•ä¸ºæ ¸å¿ƒ, <code>Handle classes</code>æ„ä¸ºä½¿ç”¨å¥æŸ„çš„ç±», è¿™ä¸ªå¥æŸ„å°±æ˜¯<strong>pimpl idiom</strong>æ‰‹æ³•çš„æŒ‡é’ˆ, <code>Person</code>ç±»è¿˜æ˜¯å’Œä¸Šæ–‡ä¸€è‡´, <code>PersonImpl</code>ç±»<strong>åº”å½“å’ŒPersonæœ‰ç€å®Œå…¨ç›¸åŒçš„æˆå‘˜å‡½æ•°, å¹¶ä¸”æœ‰åŸæœ¬Personé¢„æƒ³æ‹¥æœ‰çš„æˆå‘˜å˜é‡</strong>,  å¯ä»¥ç†è§£ä¸º<code>PersonImpl</code>æ‰æ˜¯çœŸæ­£çš„<code>Person</code>ç±», ä»¥åæ‰€æœ‰çš„ä¿®æ”¹å°†åœ¨<code>PersonImpl</code>ä¸­è¿›è¡Œ.</p><p>ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬è¦å®ç°ä¸‰ä¸ªæ–‡ä»¶, ä¸€ä¸ª<code>Person.h</code>å­˜æ”¾ä¾›å®¢æˆ·ä½¿ç”¨çš„æ¥å£ç±», ä¸€ä¸ª<code>PersonImpl.h</code>å­˜æ”¾å¯¹åº”æ¥å£ç±»çš„å®ç°ç±», ä¸€ä¸ª<code>Person.cpp</code>å®ç°<code>Person</code>ä¸­å‡½æ•°å£°æ˜çš„å¯¹åº”å®šä¹‰.  æœ‰ç‚¹éº»çƒ¦, å¯ä»¥çœ‹ä»£ç ç†è§£, æ¥ä¸‹æ¥å°†ç»™å‡ºä¸¤ä¸ªåˆ†åˆ«å°è£…æ¥å£ç±»å’Œå®ç°ç±»çš„å¤´æ–‡ä»¶ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Person.h  å­˜æ”¾æ¥å£ç±», å’Œä¸Šæ–‡ä¸€è‡´</span><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span>                      </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span>                      <span class="hljs-comment">// shared_ptræ‰€åœ¨</span></span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonImpl</span>;                      <span class="hljs-comment">// åŒæ—¶ä¹Ÿå£°æ˜å®ç°ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Date</span>;                        <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span>;                         <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br><span class="hljs-keyword">public</span>:<br><span class="hljs-built_in">Person</span>(<span class="hljs-type">const</span> std::string&amp; name, <span class="hljs-type">const</span> Date&amp; birthday,<br>        <span class="hljs-type">const</span> Address&amp; addr);<br><span class="hljs-function">std::string <span class="hljs-title">name</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br><span class="hljs-function">std::string <span class="hljs-title">birthDate</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br><span class="hljs-function">std::string <span class="hljs-title">address</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>...<br><br><span class="hljs-keyword">private</span>:                                   <br>  std::shared_ptr&lt;PersonImpl&gt; pImpl;  <span class="hljs-comment">// shared_pträ½¿ç”¨è§æ¡æ¬¾13</span><br>&#125;; <br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// PersonImpl.h  å­˜æ”¾å®ç°ç±»</span><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Date.h&quot;</span>   <span class="hljs-comment">// å¯¹å®ç°æ‰€éœ€çš„å…¶ä»–ç±»è¿›è¡ŒåŒ…å«</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Address.h&quot;</span></span><br><br><span class="hljs-comment">// å®šä¹‰å®ç°ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonImpl</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">PersonImpl</span>(<span class="hljs-type">const</span> std::string&amp; n, <span class="hljs-type">const</span> Date&amp; b, <span class="hljs-type">const</span> Address&amp; a)<br>        :_name(n) ,_birthDate(b) ,_address(a)<br>    &#123;&#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">name</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> _name; &#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">birthDate</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> _birthDate.<span class="hljs-built_in">toString</span>(); &#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">address</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> _address.<span class="hljs-built_in">toString</span>(); &#125;<br><span class="hljs-keyword">private</span>:<br>    std::string _name;<br>    Date _birthDate;<br>    Address _address;<br>&#125;;<br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Person.cpp  åœ¨è¯¥æ–‡ä»¶å®ç°æ¥å£ç±»å’Œå®ç°ç±»çš„çœŸæ­£å…³è”</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Person.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;PersonImpl.h&quot;</span></span><br><br><span class="hljs-comment">// å®Œæˆå¯¹æ¥å£ç±»ä¸­å£°æ˜å‡½æ•°çš„å®šä¹‰</span><br>Person::<span class="hljs-built_in">Person</span>(<span class="hljs-type">const</span> std::string&amp; name, <span class="hljs-type">const</span> Date&amp; birthday, <span class="hljs-type">const</span> Address&amp; addr)<br>    : <span class="hljs-built_in">pImpl</span>(std::<span class="hljs-built_in">make_shared</span>&lt;PersonImpl&gt;(name, birthday, addr)) &#123;&#125;<br><br><span class="hljs-function">std::string <span class="hljs-title">Person::name</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> pImpl-&gt;<span class="hljs-built_in">name</span>(); &#125;<br><span class="hljs-function">std::string <span class="hljs-title">Person::birthDate</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> pImpl-&gt;<span class="hljs-built_in">birthDate</span>(); &#125;<br><span class="hljs-function">std::string <span class="hljs-title">Person::address</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> pImpl-&gt;<span class="hljs-built_in">address</span>(); &#125;<br></code></pre></td></tr></table></figure><p>å®è§‚æ¥è¯´<code>Person</code>æ›´åƒæ˜¯ä¸€ä¸ªå¤–å£³, å’Œ<code>PersonImpl</code>æœ‰è—•æ–­ä¸è¿çš„å…³ç³», è€Œ<code>PersonImpl</code>æ‰æ‹¥æœ‰æˆ‘ä»¬çš„æ ¸å¿ƒä»£ç , ä¸è¿‡å¯¹<code>PersonImpl</code>çš„ä¿®æ”¹å¹¶ä¸éœ€è¦<code>Person</code>æ‰€åœ¨å¤´æ–‡ä»¶é‡æ–°ç¼–è¯‘, å› ä¸ºå®ƒå’Œ<code>PersonImpl</code>çš„å…³ç³»éƒ½æ˜¯å£°æ˜æ¥çš„, åœ¨å®šä¹‰ä¸Šæ²¡æœ‰ä»»ä½•å…³è”.</p><p>äºæ˜¯å®¢æˆ·å°±å¯ä»¥è¿™æ ·è°ƒç”¨<code>Person</code>ç±» : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Person.h&quot;</span>  <span class="hljs-comment">// åªéœ€åŒ…å«æ¥å£ç±»å³å¯</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Date.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Address.h&quot;</span></span><br><span class="hljs-keyword">using</span> std::cout;<br><span class="hljs-keyword">using</span> std::endl;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-function">Date <span class="hljs-title">date</span><span class="hljs-params">(<span class="hljs-number">2024</span>, <span class="hljs-number">12</span>, <span class="hljs-number">10</span>)</span></span>;<br><span class="hljs-function">Address <span class="hljs-title">addr</span><span class="hljs-params">(<span class="hljs-string">&quot;NUC&quot;</span>)</span></span>;<br><span class="hljs-function">Person <span class="hljs-title">p</span><span class="hljs-params">(<span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>, date, addr)</span></span>;<br>cout &lt;&lt; p.<span class="hljs-built_in">name</span>() &lt;&lt; endl;<br>cout &lt;&lt; p.<span class="hljs-built_in">birthDate</span>() &lt;&lt; endl;<br>cout &lt;&lt; p.<span class="hljs-built_in">address</span>() &lt;&lt; endl;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="Interface-classes"><a href="#Interface-classes" class="headerlink" title="Interface classes"></a>Interface classes</h3><p>æœ¬æ–¹æ¡ˆæ ¸å¿ƒåœ¨äº<strong>ç»§æ‰¿</strong>, åƒæ˜¯<code>java</code>æœ‰ä¸“å±çš„æ¥å£ç±», <code>C++</code>ä¹Ÿå¯ä»¥æ¨¡æ‹Ÿç±»ä¼¼çš„<strong>æŠ½è±¡åŸºç±»ä½œä¸ºæ¥å£ç±», è€Œæ´¾ç”Ÿç±»ä½œä¸ºå®ç°ç±»</strong>, ä¹Ÿå¯ä»¥è¾¾åˆ°å’Œä¸Šä¸ªæ–¹æ¡ˆç›¸ä¼¼çš„æ•ˆæœ, ä½†æ˜¯å”¯ä¸€çš„é—®é¢˜æ˜¯<strong>å®¢æˆ·æ€ä¹ˆä½¿ç”¨æ¥å£ç±»</strong>? æ¥å£ç±»æ—¢ç„¶æ˜¯æŠ½è±¡åŸºç±», å°±ç»ä¸å¯èƒ½ç”Ÿæˆå¯¹è±¡, ä½†æ˜¯<strong>æŠ½è±¡åŸºç±»å¯ä»¥æœ‰æŒ‡é’ˆå’Œå¼•ç”¨</strong>, ç”±æ­¤å¯ä»¥<strong>åˆ©ç”¨å¤šæ€æœºåˆ¶é€šè¿‡åŸºç±»æŒ‡é’ˆè°ƒç”¨åˆ°æ´¾ç”Ÿçš„å®ç°ç±»</strong>, æ‰€ä»¥æˆ‘ä»¬è™½ç„¶å†™ä¸äº†æ„é€ å‡½æ•°, ä½†æ˜¯å¯ä»¥å†™ä¸€ä¸ª<strong>factory</strong>(å·¥å‚)å‡½æ•°æ¥è°ƒç”¨æ´¾ç”Ÿç±»çš„æ„é€ å‡½æ•°è¿›è€Œè¿”å›æ´¾ç”Ÿç±»çš„æŒ‡é’ˆ, ä»£ç è¿˜æ˜¯ä¸‰ä¸ªéƒ¨åˆ†, æˆ‘ä»¬æ¥é€ä¸€é˜…è¯» : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Person.h</span><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span>                      </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span>                      <span class="hljs-comment">// shared_ptræ‰€åœ¨</span></span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Date</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br><span class="hljs-keyword">public</span>:<br><span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Person</span>() = <span class="hljs-keyword">default</span>;    <span class="hljs-comment">// virtualææ„å‡½æ•°è§æ¡æ¬¾7</span><br><span class="hljs-function"><span class="hljs-keyword">virtual</span> std::string <span class="hljs-title">name</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;<br><span class="hljs-function"><span class="hljs-keyword">virtual</span> std::string <span class="hljs-title">birthDate</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;<br><span class="hljs-function"><span class="hljs-keyword">virtual</span> std::string <span class="hljs-title">address</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;<br><br>    <span class="hljs-comment">// å·¥å‚å‡½æ•°ä¸ºcreate, é€šè¿‡æä¾›çš„å‚æ•°æ„é€ ä¸åŒçš„æ´¾ç”Ÿç±»</span><br><span class="hljs-function"><span class="hljs-type">static</span> std::shared_ptr&lt;Person&gt;    </span><br><span class="hljs-function"><span class="hljs-title">create</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; name, <span class="hljs-type">const</span> Date&amp; birthday, <span class="hljs-type">const</span> Address&amp; addr)</span></span>;<br>&#125;;<br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// RealPerson.h  å­˜æ”¾å®ç°ç±»</span><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Person.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Date.h&quot;</span>   <span class="hljs-comment">// å¯¹å®ç°æ‰€éœ€çš„å…¶ä»–ç±»è¿›è¡ŒåŒ…å«</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Address.h&quot;</span></span><br><br><span class="hljs-comment">// å®šä¹‰å®ç°ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RealPerson</span> : <span class="hljs-keyword">public</span> Person &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">RealPerson</span>(<span class="hljs-type">const</span> std::string&amp; n, <span class="hljs-type">const</span> Date&amp; b, <span class="hljs-type">const</span> Address&amp; a)<br>        :_name(n), _birthDate(b), _address(a)<br>    &#123;&#125;<br>    <br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">RealPerson</span>() &#123;&#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">name</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> _name; &#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">birthDate</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> _birthDate.<span class="hljs-built_in">toString</span>(); &#125;<br>    <span class="hljs-function">std::string <span class="hljs-title">address</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> _address.<span class="hljs-built_in">toString</span>(); &#125;<br><span class="hljs-keyword">private</span>:<br>    std::string _name;<br>    Date _birthDate;<br>    Address _address;<br>&#125;;<br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Person.cpp</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Person.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;RealPerson.h&quot;</span></span><br><span class="hljs-comment">// ...</span><br><br><span class="hljs-function">std::shared_ptr&lt;Person&gt;</span><br><span class="hljs-function"><span class="hljs-title">Person2::create</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; name, <span class="hljs-type">const</span> Date&amp; birthday, <span class="hljs-type">const</span> Address&amp; addr)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">return</span> std::<span class="hljs-built_in">shared_ptr</span>&lt;RealPerson&gt;(std::<span class="hljs-built_in">make_shared</span>&lt;RealPerson&gt;(name, birthday, addr));<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿™é‡Œé‡ç‚¹ç†è§£<code>create</code>å·¥å‚å‡½æ•°, å®ƒçš„æœ€ç»ˆç›®çš„ä¸€å®šæ˜¯ä¼ å‡ºä¸€ä¸ªæ´¾ç”Ÿç±»çš„æ™ºèƒ½æŒ‡é’ˆ, å°½ç®¡ä¼ å‡ºæŒ‡é’ˆçš„é™æ€ç±»å‹æ˜¯<code>std::shared_ptr&lt;Person&gt;</code>, ä½†ä¹Ÿä¼šä¾é å¤šæ€æœºåˆ¶ç»‘å®šåˆ°æ­£ç¡®çš„æ´¾ç”Ÿç±»ç±»å‹. è‡³äºæ˜¯ä»€ä¹ˆæ´¾ç”Ÿç±»å¯ä»¥é€šè¿‡å‚æ•°å€¼, è¯»å–æ•°æ®åº“æ•°æ®, ç¯å¢ƒå˜é‡ç­‰å„ç§å› ç´ å½±å“, è¿™é‡Œæ˜¯å› ä¸ºåªå†™äº†<code>RealPerson</code>ä¸€ä¸ªæ´¾ç”Ÿç±»æ‰€ä»¥å°±ç›´æ¥è¿”å›äº†, å®é™…æƒ…å†µå¯ä»¥å†™æ›´å¤šçš„åˆ¤æ–­ç±»å‹è¿”å›ä¸åŒçš„æ´¾ç”Ÿç±»æŒ‡é’ˆ, æ¯”å¦‚ç”·äººå¥³äººä¼ªäººä¹‹ç±»çš„.</p><p>äºæ˜¯å®¢æˆ·å°±å¯ä»¥è¿™æ ·è°ƒç”¨<code>Person</code>ç±» : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Person.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Date.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Address.h&quot;</span></span><br><span class="hljs-keyword">using</span> std::cout;<br><span class="hljs-keyword">using</span> std::endl;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-function">Date <span class="hljs-title">date</span><span class="hljs-params">(<span class="hljs-number">2024</span>, <span class="hljs-number">12</span>, <span class="hljs-number">10</span>)</span></span>;<br><span class="hljs-function">Address <span class="hljs-title">addr</span><span class="hljs-params">(<span class="hljs-string">&quot;NUC&quot;</span>)</span></span>;<br><span class="hljs-function">std::shared_ptr&lt;Person&gt; <span class="hljs-title">pp</span><span class="hljs-params">(Person::create(<span class="hljs-string">&quot;æå››&quot;</span>, date, addr))</span></span>;<br><br>cout &lt;&lt; pp-&gt;<span class="hljs-built_in">name</span>() &lt;&lt; endl;<br>cout &lt;&lt; pp-&gt;<span class="hljs-built_in">birthDate</span>() &lt;&lt; endl;<br>cout &lt;&lt; pp-&gt;<span class="hljs-built_in">address</span>() &lt;&lt; endl;<br><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="ä¸¤ç§æ–¹æ¡ˆçš„å¼‚åŒ"><a href="#ä¸¤ç§æ–¹æ¡ˆçš„å¼‚åŒ" class="headerlink" title="ä¸¤ç§æ–¹æ¡ˆçš„å¼‚åŒ"></a>ä¸¤ç§æ–¹æ¡ˆçš„å¼‚åŒ</h3><p><code>Handle classes</code>åˆ©ç”¨<strong>pimpl idiom</strong>æ‰‹æ³•, æ„é€ å‡ºæ¥çš„æ˜¯ä¸€ä¸ªå®æ‰“å®çš„å¯¹è±¡, å› æ­¤å¯ä»¥é€šè¿‡å„ç§æ–¹å¼è°ƒç”¨å†…éƒ¨åŠŸèƒ½, ä½¿ç”¨è¾ƒä¸ºç®€å•.</p><p><code>Interface classes</code>åˆ©ç”¨<strong>ç»§æ‰¿å’Œå¤šæ€</strong>, æ„é€ å‡ºæ¥çš„åªèƒ½è¯´ä¸€ä¸ªæŒ‡å‘æ´¾ç”Ÿç±»å¯¹è±¡çš„æŒ‡é’ˆ, å› æ­¤åªå¯é€šè¿‡æŒ‡é’ˆè°ƒç”¨å†…éƒ¨åŠŸèƒ½, éœ€è¦é¢å¤–è°ƒç”¨å·¥å‚å‡½æ•°, ä½†æ˜¯åƒåˆ°äº†å¤šæ€çš„ä¾¿åˆ©æ€§, å¯ä»¥æœ‰æ›´å¤§çš„å¯æ‰©å±•æ€§.</p><p>äºŒè€…éƒ½å®ç°äº†å£°æ˜ä¸å®šä¹‰çš„åˆ†ç¦», ä½¿å¤´æ–‡ä»¶ç›¸ä¾äºå£°æ˜å¼è€Œéå®šä¹‰å¼, è§£é™¤äº†æ¥å£å’Œå®ç°ä¹‹é—´çš„è€¦åˆå…³ç³», ä»è€Œé™ä½äº†æ–‡ä»¶é—´çš„ç¼–è¯‘ä¾å­˜æ€§.</p><hr><h3 id="å°¾å£°"><a href="#å°¾å£°" class="headerlink" title="å°¾å£°"></a>å°¾å£°</h3><p>C++ç”±äºä¸“æ³¨äºè¿è¡Œæ—¶æ•ˆç‡çš„æå‡, å¼•å…¥<code>inline</code>ç­‰å„ç§æ–¹å¼æ¥ä¿ƒæˆè¯¥ç›®çš„, å†åŠ ä¸Š<code>template</code>, è¿™å…¶å®ç»™ç¼–è¯‘å¸¦æ¥äº†è¿‡å¤§çš„è´Ÿæ‹…, ä¹Ÿå°±æ˜¯è¯´å…¶å®æ˜¯ç‰ºç‰²äº†ç¼–è¯‘æ—¶è€Œæˆå…¨äº†è¿è¡Œæ—¶, æ”¾åœ¨ç°å®ä¸­å…¶å®å°±æ˜¯ç‰ºç‰²äº†ç¨‹åºå‘˜çš„æ—¶é—´æˆæœ¬è€Œæˆå…¨äº†å®¢æˆ·, è¿™æ— å¯åšé, ä½†è‹¥æ˜¯å› æ­¤å½±å“äº†å¼€å‘æ•ˆç‡å°±é¡¾æ­¤å¤±å½¼äº†, å› æ­¤æˆ‘ä»¬æ‰è¦ä¼˜åŒ–ç¼–è¯‘æ—¶é—´, æ‰è¦é™ä½ç¼–è¯‘ä¾å­˜æ€§, å°½ç®¡è¿™å¯èƒ½å¢åŠ äº›å¾®çš„è¿è¡Œæ—¶æˆæœ¬, ä½†è¿™ä»æ˜¯å¿…è¦çš„.</p><p>å¦å¤–æˆ‘ä»¬ä¹Ÿåº”æƒè¡¡<code>inline</code>, <code>template</code>å’Œä»¥ä¸Šä¸¤ç§æ–¹æ¡ˆçš„ä½¿ç”¨, å°±è®©å®ƒä»¬å‡ºç°åœ¨æœ€åº”è¯¥å‡ºç°çš„åœ°æ–¹å§.</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>æ”¯æŒâ€ç¼–è¯‘ä¾å­˜æ€§æœ€å°åŒ–â€çš„ä¸€èˆ¬æ„æƒ³æ˜¯ : ç›¸ä¾äºå£°æ˜å¼, ä¸è¦ç›¸ä¾äºå®šä¹‰å¼. åŸºäºæ­¤æ„æƒ³çš„ä¸¤ä¸ªæ‰‹æ®µæ˜¯<code>Handle classes</code>å’Œ<code>Interface classes</code>.</li><li>å¤´æ–‡ä»¶åº”è¯¥ä»¥â€å®Œå…¨ä¸”ä»…æœ‰å£°æ˜å¼â€çš„å½¢å¼å­˜åœ¨, é™¤éè¦ä½¿ç”¨<code>inline</code>æˆ–<code>template</code>, è€Œä¸”å°±ç®—ä½¿ç”¨<code>template</code>, ä¹Ÿå¯ä»¥åœ¨å¤´æ–‡ä»¶ä¸­å®ç°<code>template</code>çš„å£°æ˜, å°†å®šä¹‰ç½®å…¥éå¤´æ–‡ä»¶ä¸­,</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
      <tag>ç¼–è¯‘ä¾å­˜æ€§</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾30 inline</title>
    <link href="/2024/12/09/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE30%20inline/"/>
    <url>/2024/12/09/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE30%20inline/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾30-é€å½»äº†è§£inliningçš„é‡Œé‡Œå¤–å¤–"><a href="#æ¡æ¬¾30-é€å½»äº†è§£inliningçš„é‡Œé‡Œå¤–å¤–" class="headerlink" title="æ¡æ¬¾30 : é€å½»äº†è§£inliningçš„é‡Œé‡Œå¤–å¤–"></a>æ¡æ¬¾30 : é€å½»äº†è§£inliningçš„é‡Œé‡Œå¤–å¤–</h2><blockquote><p>inline å‡½æ•°, å¤šä¹ˆæ£’çš„ç‚¹å­! æœ¬æ¡æ¬¾å°†å¸¦æˆ‘ä»¬é€å½»äº†è§£inliningçš„é‡Œé‡Œå¤–å¤–, ä¸å¾€å¸¸çš„å½¢å¼ä¸åŒ, æˆ‘ä¼šä»¥çŸ¥è¯†ç‚¹é›†çš„å½¢å¼æŠŠä¹¦ä¸­å¯¹inlineçš„æè¿°åˆ—ä¸¾å¤„ç†, å¯æ›´ç®€å•æ˜äº†çš„è®¤è¯†inline.</p></blockquote><h2 id="inlineçš„ä¼˜åŠ£"><a href="#inlineçš„ä¼˜åŠ£" class="headerlink" title="inlineçš„ä¼˜åŠ£"></a>inlineçš„ä¼˜åŠ£</h2><ul><li><code>inline</code>å‡½æ•°, çœ‹èµ·æ¥åƒå‡½æ•°, åŠ¨ä½œåƒå‡½æ•°, å´æ¯”å®å¥½å¾—å¤š, è°ƒç”¨å®ƒä»¬<strong>ä¸ç”¨è’™å—å‡½æ•°è°ƒç”¨æ‰€å¸¦æ¥çš„é¢å¤–å¼€é”€</strong>.</li><li>ç¼–è¯‘å™¨ä¼šå¯¹<code>inline</code>å‡½æ•°æ‰§è¡Œè¯­å¢ƒç›¸å…³æœ€ä¼˜åŒ–, ä¼š<strong>æå‡ç¼–è¯‘æ•ˆç‡</strong>.</li><li>å¦‚æœå†…å­˜æœ‰é™, è¿‡åº¦<code>inlining</code>ä¼šé€ æˆç¨‹åº<strong>ä½“ç§¯å¤ªå¤§</strong>.</li><li><code>inline</code>ä¼šå¸¦æ¥<strong>ä»£ç è†¨èƒ€</strong>, è¿›è€Œå¯¼è‡´é¢å¤–çš„<strong>æ¢é¡µ</strong>è¡Œä¸º, é™ä½é«˜é€Ÿç¼“å­˜è£…ç½®çš„<strong>å‡»ä¸­ç‡</strong>.</li><li><strong>å¦‚æœinlineå‡½æ•°çš„æœ¬ä½“å¾ˆå°</strong>, ç¼–è¯‘å™¨é’ˆå¯¹â€å‡½æ•°æœ¬ä½“â€äº§å‡ºçš„ç å¯èƒ½æ¯”é’ˆå¯¹â€å‡½æ•°è°ƒç”¨â€äº§å‡ºçš„ç æ›´å°, åè€Œä¼šä¿ƒæˆä¸ä¸Šä¸€æ¡ç›¸åçš„æƒ…å†µ, å¯ä»¥å¯¼è‡´è¾ƒå°çš„ç›®æ ‡ç å’Œè¾ƒé«˜çš„é«˜é€Ÿç¼“å­˜è£…ç½®å‡»ä¸­ç‡.</li><li><code>inline</code>å‡½æ•°æ— æ³•éšç¨‹åºåº“çš„å‡çº§è€Œå‡çº§, ç®€å•è¯´å¦‚æœç¨‹åºåº“ä¸­æœ‰ä¸€ä¸ª<code>inline</code>å‡½æ•°, å¦‚æœå†³å®šæ”¹å˜è¯¥å‡½æ•°, é‚£ä¹ˆç¨‹åºåº“ä¸­æ‰€æœ‰ç”¨åˆ°è¯¥å‡½æ•°çš„ç¨‹åºå°±å¿…é¡»é‡æ–°ç¼–è¯‘. å¦‚æœæ˜¯<code>non-inline</code>å‡½æ•°,å®¢æˆ·ç«¯åªéœ€è¦é‡æ–°è¿æ¥å°±å¥½äº†, æ²¡æœ‰é‚£ä¹ˆå¤§çš„ç¼–è¯‘è´Ÿæ‹…, å¦‚æœæ˜¯åŠ¨æ€åº“å°±æ›´æ²¡æœ‰äº†.</li></ul><hr><h2 id="inlineçš„ç‰¹æ€§"><a href="#inlineçš„ç‰¹æ€§" class="headerlink" title="inlineçš„ç‰¹æ€§"></a>inlineçš„ç‰¹æ€§</h2><ul><li><p><strong>inlineä¸æ˜¯ä¸€ä¸ªå¼ºåˆ¶å‘½ä»¤, å®ƒåªæ˜¯å¯¹ç¼–è¯‘å™¨çš„ä¸€ä¸ªç”³è¯·!</strong> ç¼–è¯‘å™¨å¯ä»¥åŠ ä»¥å¿½ç•¥, å¤§éƒ¨åˆ†ç¼–è¯‘å™¨å°†æ‹’ç»å¤ªè¿‡å¤æ‚çš„å‡½æ•°(å«å¾ªç¯, é€’å½’, é•¿åº¦è¿‡é•¿)è¿›è¡Œ<code>inlining</code>. ç®€è€Œè¨€ä¹‹, <strong>ä¸€ä¸ªè¡¨é¢çœ‹ä¼¼inlineçš„å‡½æ•°æ˜¯å¦çœŸçš„æ˜¯inline, å–å†³äºä½ çš„å»ºç½®ç¯å¢ƒ, ä¸»è¦å–å†³äºç¼–è¯‘å™¨</strong>.</p></li><li><p><code>inline</code>å¯ä»¥æ˜ç¡®æå‡º, ä¹Ÿå¯ä»¥<strong>éšå–»æå‡º</strong>.</p></li><li><p>éšå–»æå‡ºçš„æ–¹å¼æ˜¯<strong>å°†å‡½æ•°å®šä¹‰åœ¨classå®šä¹‰å¼ä¸­</strong>. è¿™ä¾¿æ˜¯ä¸ºä»€ä¹ˆå¾ˆå¤š<code>class</code>ä¼šå°†å®ç°ç®€çŸ­çš„å‡½æ•°ç›´æ¥åœ¨<code>class</code>å®šä¹‰å¼ä¸­å°†å£°æ˜å®šä¹‰ä¸€å¹¶ç»™å‡º, å…¶å®å°±æ˜¯åœ¨æ–¹ä¾¿çš„å‰æä¸‹è¿˜éšå–»åœ°ä½¿ç”¨äº†<code>inline</code>å‡½æ•°, ä»¥è¾¾åˆ°â€æ²¡æœ‰å£°æ˜ä»»ä½•<code>inline</code>å´å¤„å¤„éƒ½æ˜¯<code>inline</code>â€œçš„æ•ˆæœ. </p></li><li><p>éšå–»<code>inline</code>å‡½æ•°é€šå¸¸æ˜¯<strong>æˆå‘˜å‡½æ•°</strong>, ä¹Ÿå¯ä»¥æ˜¯<code>friend</code>å‡½æ•°.</p></li><li><p>æ‰€æœ‰<code>virtual</code>å‡½æ•°ä¸è°ƒç”¨<code>virtual</code>çš„å‡½æ•°éƒ½æ— æ³•<code>inlining</code>. <code>virtual</code>ä»£è¡¨ç€ç­‰å¾…è¿è¡Œæ—¶åˆ¤å®š, è€Œ<code>inline</code>ä»£è¡¨ç¼–è¯‘æ—¶æå‰æ›¿æ¢, è¿™ä¸¤ç§è¡Œä¸ºæ˜¯ç»å¯¹å†²çªçš„.</p></li></ul><hr><h2 id="inlineçš„ä½¿ç”¨"><a href="#inlineçš„ä½¿ç”¨" class="headerlink" title="inlineçš„ä½¿ç”¨"></a>inlineçš„ä½¿ç”¨</h2><ul><li><code>inline</code>å‡½æ•°é€šå¸¸<strong>ä¸€å®šè¢«ç½®äºå¤´æ–‡ä»¶å†…</strong>, å› ä¸ºå¤§å¤šæ•°å»ºç½®ç¯å¢ƒéƒ½åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­è¿›è¡Œ<code>inline</code>.</li><li><code>templates</code>(æ³›å‹ç±»&#x2F;å‡½æ•°)é€šå¸¸ä¹Ÿè¢«ç½®äºå¤´æ–‡ä»¶å†…, å¾ˆå¤šç¨‹åºå‘˜è®¤ä¸ºæ³›å‹å‡½æ•°ä¸€å®šéƒ½æ˜¯<code>inline</code>, ä½†è¿™æ˜¯é”™è¯¯çš„, <strong>templateçš„å®ä¾‹åŒ–ä¸inlineæ— å…³</strong>, ä¸åº”è¯¥è¿™æ ·è€ƒé‡, è¿˜æ˜¯åº”è¯¥ä¾ç…§ä»£ç é•¿åº¦,å†…å®¹ä»¥åŠç¯å¢ƒåšå…·ä½“è€ƒé‡.</li><li><strong>æ„é€ å‡½æ•°å’Œææ„å‡½æ•°å¾€å¾€æ˜¯inliningçš„ç³Ÿç³•å€™é€‰äºº</strong>, å› ä¸ºå°±ç®—å®ƒä»¬æ˜¯ç©ºç™½çš„, ä¹Ÿæœ‰å¯èƒ½åœ¨åº•å±‚è¢«ç¼–è¯‘å™¨æ–½åŠ å¾ˆå¤šé¢å¤–çš„ä»£ç , ä¾‹å¦‚åŸºç±»çš„æ„é€ ä¸ææ„, è¿™å¯¼è‡´å®ƒä»¬çš„å®é™…ä»£ç é‡è¿œæ¯”æˆ‘ä»¬çœ‹è§çš„è¦å¤šå¾—å¤š, ä»¤å®ƒä»¬<code>inlining</code>å¾ˆæœ‰å¯èƒ½ä¼šå‘ç”Ÿä»£ç è†¨èƒ€.</li><li>ä¸€å¼€å§‹å…ˆä¸è¦å°†ä»»ä½•å‡½æ•°å£°æ˜æˆ<code>inline</code>, é™¤éä½ éå¸¸ç¬ƒå®šå®ƒå°±æ˜¯<code>inline</code>çš„å…¸å‹æ¡ˆä¾‹, å½“ä½ å¼€å§‹å…³å¿ƒæ•ˆç‡æ—¶, å†åˆ†ææ˜¯å¦å¯ä»¥<code>inlining</code>.</li></ul><hr><h2 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h2><ul><li>è¯·å°†å¤§å¤šæ•°çš„<code>inlining</code>é™åˆ¶åœ¨<strong>å°å‹, è¢«é¢‘ç¹è°ƒç”¨</strong>çš„å‡½æ•°èº«ä¸Š.</li><li>é€šè¿‡å°†å‡½æ•°å®šä¹‰åœ¨<code>class</code>å®šä¹‰å¼ä¸­å®ç°éšå–»<code>inline</code>.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾29 å¼‚å¸¸å®‰å…¨æ€§</title>
    <link href="/2024/12/08/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE29-%E5%BC%82%E5%B8%B8%E5%AE%89%E5%85%A8%E6%80%A7/"/>
    <url>/2024/12/08/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE29-%E5%BC%82%E5%B8%B8%E5%AE%89%E5%85%A8%E6%80%A7/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾29-ä¸ºâ€å¼‚å¸¸å®‰å…¨â€è€ŒåŠªåŠ›æ˜¯å€¼å¾—çš„"><a href="#æ¡æ¬¾29-ä¸ºâ€å¼‚å¸¸å®‰å…¨â€è€ŒåŠªåŠ›æ˜¯å€¼å¾—çš„" class="headerlink" title="æ¡æ¬¾29 : ä¸ºâ€å¼‚å¸¸å®‰å…¨â€è€ŒåŠªåŠ›æ˜¯å€¼å¾—çš„"></a>æ¡æ¬¾29 : ä¸ºâ€å¼‚å¸¸å®‰å…¨â€è€ŒåŠªåŠ›æ˜¯å€¼å¾—çš„</h2><blockquote><p>å¼‚å¸¸å®‰å…¨æ€§æ˜¯æˆ‘ä»¬æ¯ä¸ªç¨‹åºå‘˜éƒ½è¦è€ƒé‡çš„å†…å®¹, æˆ‘ä»¬æœ‰å¿…è¦çŸ¥é“æˆ‘ä»¬å†™å‡ºçš„æ¯ä¸ªå‡½æ•°ä¿è¯äº†æ€æ ·çš„å¼‚å¸¸å®‰å…¨, å› ä¸ºä¸€ä¸ªå‡½æ•°æ˜¯å¦ä¼šæŠ›å‡ºå¼‚å¸¸ä¸ä»…ä¼šå½±å“æˆ‘ä»¬æ˜¯å¦ä½¿ç”¨è¯¥å‡½æ•°çš„å†³ç­–, ä¹Ÿä¼šå½±å“éƒ¨åˆ†çš„ç¼–è¯‘å™¨ä¼˜åŒ–ç­–ç•¥, è®©æˆ‘ä»¬é€šè¿‡æœ¬æ¡æ¬¾æ¥å……åˆ†è®¤è¯†å¼‚å¸¸å®‰å…¨æ€§.</p></blockquote><p>å…ˆäº†è§£æœ¬æ¡æ¬¾çš„ä¾‹å­, å‡è®¾æœ‰ä¸ª<code>class</code>ç”¨æ¥è¡¨ç°å¤¹å¸¦èƒŒæ™¯å›¾æ¡ˆçš„GUIç•Œé¢, è¿™ä¸ª<code>class</code>ç”¨äºå¤šçº¿ç¨‹ç¯å¢ƒ, æ‰€ä»¥å®ƒæœ‰ä¸ªäº’æ–¥å™¨ä½œä¸ºå¹¶å‘æ§åˆ¶ä¹‹ç”¨ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PrettyMenu</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  ...<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">changeBackground</span><span class="hljs-params">(std::istream&amp; imgSrc)</span></span>;           <span class="hljs-comment">// ç”¨æ¥æ”¹å˜èƒŒæ™¯å›¾ç‰‡çš„æˆå‘˜å‡½æ•°</span><br><br><span class="hljs-keyword">private</span>:<br><br>  Mutex mutex;                    <span class="hljs-comment">// äº’æ–¥å™¨</span><br><br>  Image *bgImage;                 <span class="hljs-comment">// å½“å‰çš„èƒŒæ™¯å›¾åƒ</span><br>  <span class="hljs-type">int</span> imageChanges;               <span class="hljs-comment">// èƒŒæ™¯å›¾åƒè¢«æ”¹å˜çš„æ¬¡æ•°</span><br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PrettyMenu::changeBackground</span><span class="hljs-params">(std::istream&amp; imgSrc)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-built_in">lock</span>(&amp;mutex);                      <span class="hljs-comment">// ä¸Šé”</span><br><br>  <span class="hljs-keyword">delete</span> bgImage;                    <span class="hljs-comment">// é‡Šæ”¾åŸèƒŒæ™¯</span><br>  ++imageChanges;                    <span class="hljs-comment">// æ›´æ–°è®¡æ•°</span><br>  bgImage = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Image</span>(imgSrc);       <span class="hljs-comment">// ä¿®æ”¹æ–°èƒŒæ™¯</span><br><br>  <span class="hljs-built_in">unlock</span>(&amp;mutex);                    <span class="hljs-comment">// è§£é”</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä»å¼‚å¸¸å®‰å…¨æ€§çš„è§’åº¦æ¥çœ‹, <code>changeBackground</code>éå¸¸ç³Ÿç³•, å®ƒå¹¶æ²¡æœ‰æ»¡è¶³â€å¼‚å¸¸å®‰å…¨â€çš„ä¸¤ä¸ªå¿…è¦æ¡ä»¶ : </p><ul><li><p><strong>ä¸æ³„æ¼ä»»ä½•èµ„æº</strong>. </p><p>èµ„æºæ³„æ¼åŒ…æ‹¬å†…å­˜&#x2F;æ–‡ä»¶å¥æŸ„&#x2F;<code>socket</code>è¿æ¥&#x2F;é”ç­‰æ³„æ¼, è¿™é‡Œæˆ‘ä»¬çŸ¥é“<code>new Image(imgSrc)</code>æ˜¯ä¸€å®šå¯èƒ½æœ‰<code>bad_alloc</code>çš„å¼‚å¸¸çš„, å½“å¼‚å¸¸å‘ç”Ÿ, <code>unlock(&amp;mutex)</code>è¯­å¥å°†ä¸ä¼šæ‰§è¡Œ, é”å¹¶æ²¡æœ‰å¾—åˆ°é‡Šæ”¾, ä¹Ÿå°±æ˜¯è¯´å‘ç”Ÿäº†æ³„æ¼.</p></li><li><p><strong>ä¸å…è®¸æ•°æ®è´¥å</strong>.</p><p>æ•°æ®è´¥åå³æ•°æ®ä¸é¢„æœŸçš„æœ‰æ•ˆçŠ¶æ€ä¸ç¬¦, æ¯”å¦‚é‡æŒ‡é’ˆ. è¿™é‡Œå½“<code>new Image(imgSrc)</code>å¤„å‘ç”Ÿå¼‚å¸¸, <code>bgImage</code>çš„åŸèµ„æºå·²ç»é‡Šæ”¾å´æ²¡æœ‰è·å¾—æ–°èµ„æº, å®ƒçš„è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„, å¹¶ä¸”<code>imageChanges</code>ä¹Ÿå¢åŠ äº†ä¸€æ¬¡æœ¬ä¸å­˜åœ¨çš„è®¡æ•°, è¿™éƒ½æ˜¯æ•°æ®è´¥å.</p></li></ul><hr><h3 id="åˆ©ç”¨èµ„æºç®¡ç†ç±»è§£å†³èµ„æºæ³„æ¼"><a href="#åˆ©ç”¨èµ„æºç®¡ç†ç±»è§£å†³èµ„æºæ³„æ¼" class="headerlink" title="åˆ©ç”¨èµ„æºç®¡ç†ç±»è§£å†³èµ„æºæ³„æ¼"></a>åˆ©ç”¨èµ„æºç®¡ç†ç±»è§£å†³èµ„æºæ³„æ¼</h3><p>å½“æˆ‘ä»¬æ·±è°™æ¡æ¬¾13â€<strong>ä»¥å¯¹è±¡ç®¡ç†èµ„æº</strong>â€œçš„é“ç†å, èµ„æºæ³„æ¼å°†ä¸å†æ˜¯é—®é¢˜! èµ„æºç®¡ç†ç±»å¯ä»¥ç¡®ä¿èµ„æºåŠæ—¶ä¸”è‡ªåŠ¨åœ°é‡Šæ”¾, å¹¶ä¸”è¿˜å‡å°‘äº†æˆ‘ä»¬çš„ä»£ç é‡, äºæ˜¯æˆ‘ä»¬å°±å¯ä»¥ç”¨æ¡æ¬¾14ä¸­<code>RAII</code>é£æ ¼çš„<code>Lock</code>ç±»æ¥è§£å†³æœ¬æ¡æ¬¾çš„é”æ³„æ¼ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Lock</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Lock</span><span class="hljs-params">(Mutex *pm)</span></span><br><span class="hljs-function">  : mutexPtr(pm)</span><br><span class="hljs-function">  &#123;</span> <span class="hljs-built_in">lock</span>(mutexPtr); &#125;                          <span class="hljs-comment">// è·å¾—èµ„æº</span><br>  ~<span class="hljs-built_in">Lock</span>() &#123; <span class="hljs-built_in">unlock</span>(mutexPtr); &#125;                <span class="hljs-comment">// é‡Šæ”¾èµ„æº</span><br><span class="hljs-keyword">private</span>:<br>  Mutex *mutexPtr;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PrettyMenu::changeBackground</span><span class="hljs-params">(std::istream&amp; imgSrc)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-function">Lock <span class="hljs-title">ml</span><span class="hljs-params">(&amp;mutex)</span></span>;                <span class="hljs-comment">// è‡ªåŠ¨ç®¡ç†é”çš„é‡Šæ”¾</span><br>  <span class="hljs-keyword">delete</span> bgImage;<br>  ++imageChanges;<br>  bgImage = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Image</span>(imgSrc);    <span class="hljs-comment">// ä¸€æ—¦è§¦å‘å¼‚å¸¸ç¦»å¼€å‡½æ•°ä½œç”¨åŸŸå°±ä¼šè‡ªåŠ¨è§¦å‘Lockçš„ææ„å‡½æ•°é‡Šæ”¾é”</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç»å¤§å¤šæ•°å¼‚å¸¸å¼•å‘çš„èµ„æºæ³„æ¼éƒ½å¯ä»¥ç”¨èµ„æºç®¡ç†ç±»æ¥è§£å†³.</p><hr><h3 id="ä¸‰ç§å¼‚å¸¸å®‰å…¨ä¿è¯"><a href="#ä¸‰ç§å¼‚å¸¸å®‰å…¨ä¿è¯" class="headerlink" title="ä¸‰ç§å¼‚å¸¸å®‰å…¨ä¿è¯"></a>ä¸‰ç§å¼‚å¸¸å®‰å…¨ä¿è¯</h3><p>è¿™å°†æ˜¯æœ¬æ¡æ¬¾çš„é‡ç‚¹, ä¸€ä¸ªå¼‚å¸¸å®‰å…¨çš„å‡½æ•°åœ¨é¿å…èµ„æºæ³„æ¼ä¹‹å, ä¸ºäº†é˜²æ­¢æ•°æ®è´¥å, æˆ‘ä»¬è¿˜å¿…é¡»æ‹¥æœ‰ä¸‹é¢ä¸‰ä¸ªä¿è¯ä¹‹ä¸€, è¶Šå¾€åä¿è¯å¼ºåº¦è¶Šå¤§.</p><ul><li><p><strong>åŸºæœ¬æ‰¿è¯º</strong> : å¼‚å¸¸æŠ›å‡ºå, æ²¡æœ‰æ•°æ®æ³„æ¼, æ²¡æœ‰æ•°æ®è´¥å, æ‰€æœ‰äº‹ç‰©ä»ç„¶ä¿æŒæœ‰æ•ˆ, ä½†æ˜¯ä¸æ”¯æŒå®Œå…¨å›æ»š, æˆ‘ä»¬ä¸ç¡®å®šæ•°æ®åœ¨è¯¥å‡½æ•°ä¸­ä¿®æ”¹æˆä»€ä¹ˆæ ·äº†, å³ä½¿è¿™ç§çŠ¶æ€åˆæ³•, å…¶å®å°±æ˜¯ç¬¦åˆ<strong>ä¸¤ä¸ªå¿…è¦æ¡ä»¶ä½†æ˜¯ä¸åšä»»ä½•å¤„ç†</strong>. æˆ‘ä»¬çœ‹ä»¥ä¸‹çš„ä¾‹å­ç†è§£ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addElement</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; data)</span> </span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i = <span class="hljs-number">10</span>; i ++ )<br>        data.<span class="hljs-built_in">push_back</span>(i); <span class="hljs-comment">// å¦‚æœæ­¤å¤„æŠ›å‡ºå¼‚å¸¸ï¼Œvector è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œæ— æ³„æ¼</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¯¥ä¾‹å­ç¬¦åˆåŸºæœ¬æ‰¿è¯º, è¿™ä¸ªå‡½æ•°å‘<code>data</code>ä¸­æ’å…¥1åˆ°10, æ’å…¥åŠ¨ä½œä¼šæŠ›å‡ºå¼‚å¸¸, ä½†æ˜¯<code>vector</code>ä¼šè‡ªåŠ¨ç®¡ç†å†…å­˜, ä¸ä¼šæœ‰æ³„æ¼ä¸æ•°æ®è´¥å, ä½†æ˜¯åŠ å…¥æˆ‘ä»¬åœ¨æ’å…¥<code>i = 5</code>æ—¶å‡ºç°å¼‚å¸¸, é‚£ä¹ˆå¼‚å¸¸æŠ›å‡ºå°†ä¸ä¼šæ‰§è¡Œä¹‹åçš„è¯­å¥, ä¹Ÿå°±æ˜¯è¯´è¿™æ¬¡æ’å…¥çš„ç»“æœæ˜¯<code>data</code>å°¾æ’äº†1,2,3,4, ç„¶è€Œå‡ºç°å¼‚å¸¸åå®¢æˆ·å¹¶ä¸ä¼šçŸ¥é“å†…éƒ¨åˆ°åº•æ’å…¥äº†å¤šå°‘, è™½ç„¶è¯¥çŠ¶æ€åˆæ³•.</p></li><li><p><strong>å¼ºçƒˆä¿è¯</strong> : å¦‚æœå¼‚å¸¸è¢«æŠ›å‡º, å¯¹è±¡çŠ¶æ€ä¸ä¼šæ”¹å˜, ä¸è°ƒç”¨è¯¥å‡½æ•°å‰çŠ¶æ€ä¸€è‡´. å°±æ˜¯è¯´, æ²¡æœ‰å¼‚å¸¸å°±æ˜¯å®Œå…¨æˆåŠŸ, æŠ›å‡ºå¼‚å¸¸å¯¹è±¡çŠ¶æ€ä¼šå‘ç”Ÿ<strong>å›æ»š</strong>, å›æ»šè‡³è°ƒç”¨å‰çŠ¶æ€. </p></li><li><p><strong>ä¸æŠ›æ·ä¿è¯</strong> : æ‰¿è¯ºç»ä¸æŠ›å‡ºå¼‚å¸¸. è¿™ç§å‡½æ•°ä¸å¯èƒ½æ¶‰åŠä»»ä½•åŠ¨æ€å†…å­˜çš„åˆ†é…, ä¸€èˆ¬åªæ˜¯å¯¹<strong>å†…ç½®ç±»å‹</strong>è¿›è¡Œæ“ä½œ, å¦‚ç®—æœ¯ç±»å‹, æŒ‡é’ˆ, å¼•ç”¨ç­‰.å¹¶ä¸”è¿™ç§å‡½æ•°æˆ‘ä»¬ä¸€èˆ¬ä¼šåœ¨å…¶å‡½æ•°å®šä¹‰åæ·»åŠ <code>noexcept</code>å…³é”®å­—, è¿™ä»£è¡¨ä½ å‘ç¼–è¯‘å™¨å£°æ˜è¿™ä¸ªå‡½æ•°ç»ä¸ä¼šæŠ›å‡ºå¼‚å¸¸, ç¼–è¯‘å™¨å°±ä¼šåˆ å»å¯¹è¿™ä¸ªå‡½æ•°çš„å¼‚å¸¸å¤„ç†å·¥ä½œ, å®ç°æ•ˆç‡çš„æå‡.</p></li></ul><hr><h3 id="å®ç°å¼ºçƒˆä¿è¯"><a href="#å®ç°å¼ºçƒˆä¿è¯" class="headerlink" title="å®ç°å¼ºçƒˆä¿è¯"></a>å®ç°å¼ºçƒˆä¿è¯</h3><p>æˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯ç”±ä¸‹è‡³ä¸Šé€‰æ‹©å®‰å…¨ä¿è¯, ä¸æŠ›æ·ä¿è¯åªé€‚ç”¨äºå¯¹å†…ç½®ç±»å‹çš„æ“ä½œ, æ¯”è¾ƒå…¸å‹çš„å°±æ˜¯ç§»åŠ¨æ„é€ å’Œç§»åŠ¨èµ‹å€¼.</p><p>æ‰€ä»¥å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬æ›´æ„¿æ„å®ç°å¼ºçƒˆä¿è¯, æˆ‘ä»¬æ¥çœ‹çœ‹å°†<code>changeBackground</code>ä¿®æ”¹ä¸ºå¼ºçƒˆä¿è¯çš„æ­¥éª¤ : </p><ol><li>å°†<code>bgImage</code>è¿™ä¸ªæˆå‘˜å˜é‡ç”¨æ™ºèƒ½æŒ‡é’ˆä»£æ›¿, è¿™ä¸ªåªæ˜¯ä¸ºäº†å®ç°ä¸¤ä¸ªæ¡ä»¶ä¸­çš„é¿å…èµ„æºæ³„æ¼.</li><li>é‡æ–°æ”¹å˜è¯­å¥é¡ºåº, <strong>ä¸è¦ä¸ºäº†è¡¨ç¤ºæŸäº‹ä»¶çš„å‘ç”Ÿè€Œæ”¹å˜å¯¹è±¡çŠ¶æ€, é™¤éé‚£ä»¶äº‹çœŸçš„å‘ç”Ÿäº†</strong>.</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PrettyMenu</span> &#123;<br>  ...<br>  std::shared_ptr&lt;Image&gt; bgImage; <span class="hljs-comment">// æ”¹ç”¨æ™ºèƒ½æŒ‡é’ˆ</span><br>  ...<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PrettyMenu::changeBackground</span><span class="hljs-params">(std::istream&amp; imgSrc)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-function">Lock <span class="hljs-title">ml</span><span class="hljs-params">(&amp;mutex)</span></span>;<br>  bgImage.<span class="hljs-built_in">reset</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Image</span>(imgSrc));  <span class="hljs-comment">// ä»¥ new Image(imgSrc) çš„ç»“æœè®¾å®šä¸ºbfImageçš„å†…éƒ¨æŒ‡é’ˆ</span><br>     <span class="hljs-comment">// æ— éœ€deleteåŸèµ„æº, resetå†…éƒ¨ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨è°ƒç”¨delete</span><br>  ++imageChanges;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ†æä¸Šè¿°ä»£ç , æˆ‘ä»¬å¯ä»¥å¾ˆæƒŠå–œåœ°å‘ç°, å¦‚æœ<code>new Image(imgSrc)</code>å¤±è´¥, å¯¹è±¡çŠ¶æ€å°†ä¸å‘ç”Ÿä»»ä½•æ”¹å˜, <code>reset</code>å’Œ<code>++imageChanges</code>éƒ½ä¸ä¼šè§¦å‘,  ä¹Ÿå°±æ˜¯è¯´å¤±è´¥å³å›æ»š, æˆåŠŸå³å®Œå…¨, å†åŠ ä¸Šä¸ä¼šèµ„æºæ³„æ¼ä¸æ•°æ®è´¥å, å…¶ç¬¦åˆå¼ºçƒˆä¿è¯!</p><hr><h3 id="copy-and-swap"><a href="#copy-and-swap" class="headerlink" title="copy and swap"></a>copy and swap</h3><p>ä¸Šæ–‡æˆ‘ä»¬é€šè¿‡<strong>è°ƒæ•´è¯­åº</strong>æ¥å®ç°äº†å¼ºçƒˆä¿è¯, è¿™ç¡®å®æ˜¯æœ€åŸºç¡€çš„ä¸€ç§è§£å†³æ–¹æ³•, å…¶å†…æ ¸åœ¨äºâ€<strong>åœ¨æ‰€æœ‰å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„åŠ¨ä½œæˆåŠŸç»“æŸå‰ä¸è¦æ”¹å˜å¯¹è±¡çŠ¶æ€</strong>â€œ, ä½†æ˜¯è¿™ç§åšæ³•æ¯”è¾ƒè´¹è„‘, å¹¶ä¸”ä¸ä¸€å®šé€‚åˆæŸäº›åœºæ™¯. ç„¶è€Œæœ‰ä¸€ä¸ª<strong>ä¸€èˆ¬åŒ–çš„è®¾è®¡</strong>å¾ˆå…¸å‹åœ°ä¼šå¯¼è‡´å¼ºçƒˆä¿è¯, è¿™ä¸ªç­–ç•¥è¢«ç§°ä¸º<code>copy and swap</code>.</p><p>ä½¿ç”¨æ–¹æ³•å¾ˆç®€å•, <strong>ä¸ºä½ æ‰“ç®—ä¿®æ”¹çš„å¯¹è±¡åšå‡ºä¸€ä¸ªå‰¯æœ¬, åœ¨é‚£ä¸ªå‰¯æœ¬ä¸Šåšä»»ä½•çš„ä¿®æ”¹, å¾…æ‰€æœ‰æ”¹å˜æˆåŠŸåå†äº¤æ¢åŸå¯¹è±¡å’Œå‰¯æœ¬</strong>(æ³¨æ„è¿™ä¸ªåšæ³•çš„å‰æå»ºç«‹åœ¨<code>swap</code>æ˜¯<code>noexcept</code>çš„, è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ¡æ¬¾25ä¸€ç›´å¼ºè°ƒ<code>swap</code>ä¸æŠ›å¼‚å¸¸çš„é‡è¦æ€§). å…¶å†…æ ¸åœ¨äºâ€<strong>ä¿®æ”¹å¯¹è±¡æ•°æ®çš„å‰¯æœ¬, ç„¶ååœ¨ä¸€ä¸ªä¸æŠ›å¼‚å¸¸çš„å‡½æ•°ä¸­å°†æ•°æ®å’ŒåŸä»¶ç½®æ¢</strong>â€œ.</p><p>åœ¨çœ‹ä»£ç ä¹‹å‰, æœ‰ä¸€ä¸ªæ‰‹æ³•å¾ˆé€‚åˆå®ç°ä¸Šè¿°æ“ä½œ, å«åš<strong>pimpl idiom</strong>(pointer to implementation idiom)(æŒ‡é’ˆæŒ‡å‘å®ç°), è¿™ä¸ªæ‰‹æ³•åœ¨äºå°†æ‰€æœ‰éœ€è¦éšè—çš„æˆå‘˜å˜é‡å’Œæˆå‘˜å‡½æ•°åŒ…å…¥ä¸€ä¸ª<strong>å®ç°ç±»</strong>, å¤–éƒ¨æ„é€ ä¸€ä¸ª<strong>æ¥å£ç±»</strong>, è¯¥æ¥å£ç±»å­˜æ”¾è¯¥å®ç°ç±»çš„æŒ‡é’ˆ(ä¸€èˆ¬æ˜¯æ™ºèƒ½æŒ‡é’ˆ)ä¸å¤–æ”¾æ¥å£. æ¡æ¬¾31å°†è¯¦ç»†æè¿°è¯¥æ‰‹æ³•çš„ä¼˜åŠ¿, åœ¨æœ¬æ¡æ¬¾å°±æ˜¯å°†<strong>æ‰€æœ‰â€éš¶å±å¯¹è±¡çš„æ•°æ®â€ä»åŸå¯¹è±¡æ”¾è¿›å¦ä¸€ä¸ªå¯¹è±¡å†…, ç„¶åèµ‹å€¼åŸå¯¹è±¡ä¸€ä¸ªæŒ‡é’ˆ, æŒ‡å‘è¯¥å¯¹è±¡</strong>, <strong>è¿™æ ·æˆ‘ä»¬copy and swapçš„å¯¹è±¡å°±ä»…é™äºå­˜æ”¾æ•°æ®çš„å¯¹è±¡, è€Œä¸€åˆ‡æ“ä½œéƒ½åœ¨åŸå¯¹è±¡ä¸­è¿›è¡Œ</strong>.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">PMImpl</span> &#123;                               <span class="hljs-comment">// å®ç°ç±»</span><br>  std::shared_ptr&lt;Image&gt; bgImage;        <br>  <span class="hljs-type">int</span> imageChanges;                           <br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PrettyMenu</span> &#123;  <span class="hljs-comment">// æ¥å£ç±»</span><br>  ...<br><span class="hljs-keyword">private</span>:<br>  Mutex mutex;<br>  std::shared_ptr&lt;PMImpl&gt; pImpl;  <span class="hljs-comment">// ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆæŒ‡å‘å®ç°ç±»</span><br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PrettyMenu::changeBackground</span><span class="hljs-params">(std::istream&amp; imgSrc)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">using</span> std::swap;                            <span class="hljs-comment">// è§æ¡æ¬¾25</span><br>  <span class="hljs-function">Lock <span class="hljs-title">ml</span><span class="hljs-params">(&amp;mutex)</span></span>;                        <span class="hljs-comment">// é”çš„copy and swapæ˜¯æ²¡æœ‰æ„ä¹‰çš„</span><br>  <span class="hljs-function">std::shared_ptr&lt;PMImpl&gt; <span class="hljs-title">pNew</span><span class="hljs-params">(<span class="hljs-keyword">new</span> PMImpl(*pImpl))</span></span>; <span class="hljs-comment">// å¤åˆ¶å‰¯æœ¬</span><br><br>  pNew-&gt;bgImage.<span class="hljs-built_in">reset</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Image</span>(imgSrc));     <span class="hljs-comment">// å¯¹å‰¯æœ¬è¿›è¡Œæ‰€æœ‰ä¿®æ”¹</span><br>  ++pNew-&gt;imageChanges;<br><br>  <span class="hljs-built_in">swap</span>(pImpl, pNew);    <span class="hljs-comment">// åªæœ‰å‰é¢ä¸æŠ›å¼‚å¸¸æ‰ä¼šåˆ°è¿™é‡Œ, ç›´æ¥è¿›è¡Œäº¤æ¢, å†…ç½®ç±»å‹çš„äº¤æ¢ä¸€å®šä¸ä¼šæœ‰å¼‚å¸¸</span><br>&#125;                                     <br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šä¾¿é€šè¿‡<code>copy and swap</code>å®ç°äº†å¼ºçƒˆä¿è¯.</p><hr><h3 id="å®ç°å¼ºçƒˆä¿è¯çš„æœ€ç»ˆç­–ç•¥"><a href="#å®ç°å¼ºçƒˆä¿è¯çš„æœ€ç»ˆç­–ç•¥" class="headerlink" title="å®ç°å¼ºçƒˆä¿è¯çš„æœ€ç»ˆç­–ç•¥"></a>å®ç°å¼ºçƒˆä¿è¯çš„æœ€ç»ˆç­–ç•¥</h3><p><code>copy and swap</code>ç­–ç•¥æ˜¯<strong>å¯¹å¯¹è±¡çŠ¶æ€åšå‡ºâ€å…¨æœ‰æˆ–å…¨æ— â€æ”¹å˜</strong>çš„ä¸€ä¸ªå¾ˆå¥½åŠæ³•, ä½†æ˜¯å®ƒ<strong>ä¸ç­‰äºä¸€ä¸ªå‡½æ•°æœ‰å¼ºçƒˆä¿è¯</strong>.</p><p>åˆ†æèµ·æ¥æ¯”è¾ƒéº»çƒ¦, ç®€å•è¯´å°±æ˜¯<code>copy and swap</code><strong>åªç¡®å®šäº†å†…å­˜ç›¸å…³æ“ä½œçš„å¼ºçƒˆä¿è¯, ä½¿å¯¹è±¡çš„å±€éƒ¨çŠ¶æ€æœ‰äº†ä¸€è‡´æ€§</strong>, å³â€å…¨æœ‰æˆ–å…¨æ— â€, ç„¶è€Œæœ‰æ—¶å€™å¯¹è±¡å…¶å®æ˜¯ä¼šå¯¹â€<strong>éå±€éƒ¨æ€§æ•°æ®</strong>â€œäº§ç”Ÿå½±å“çš„, ä¾‹å¦‚æ•°æ®åº“è¿æ¥, ç½‘ç»œè¿æ¥, é”ç­‰, è¿™äº›ä¸œè¥¿ä¸ä¼šåªå› ä¸ºå†…å­˜æ•°æ®çš„æœ‰æ— è€Œç”Ÿæ•ˆæˆ–å¤±æ•ˆ, è¿æ¥è¿˜å’Œè¿æ¥çš„å¯¹è±¡æœ‰å…³, é”è¿˜å’Œçº¿ç¨‹åˆ†é…æœ‰å…³, å®ƒä»¬æ›´åå‘äºå…¨å±€çŠ¶æ€, è¿™ä¹Ÿæ˜¯ä¸Šé¢ä»£ç æˆ‘æ²¡æœ‰å°†<code>Lock ml</code>å­˜å…¥<code>PMImpl</code>çš„åŸå› .</p><p>å†è®²ä¸€ä¸ªä¾‹å­, å‡è®¾æˆ‘åœ¨å‡½æ•°ä¸­åˆ›å»ºçš„å‰¯æœ¬ä¸Šå¯¹<strong>æ•°æ®åº“</strong>è¿›è¡Œäº†ä¿®æ”¹, å¦‚æœä¹‹åå‘ç”Ÿäº†å¼‚å¸¸, å¦‚æœæˆ‘ä¸åšä»»ä½•å…¶ä»–çš„æ“ä½œ, é‚£ä¹ˆè¿™ä¸ªæ•°æ®åº“çš„ä¿®æ”¹æ˜¯ä¸€ç›´æˆç«‹çš„, å¹¶æ²¡æœ‰å› ä¸º<code>copy and swap</code>è€Œå›æ»š, è¿™æ˜¯å®Œå…¨å¯ä»¥ç†è§£çš„, ä»£ç å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modifyDataAndDatabase</span><span class="hljs-params">(std::vector&lt;<span class="hljs-type">int</span>&gt;&amp; localData, Database&amp; db)</span> </span>&#123; <span class="hljs-comment">// ä¿®æ”¹å±€éƒ¨æ•°æ®ä¸æ•°æ®åº“</span><br>    <br>    std::vector&lt;<span class="hljs-type">int</span>&gt; localDataCopy = localData; <span class="hljs-comment">// copy åˆ›å»ºå±€éƒ¨çŠ¶æ€çš„å‰¯æœ¬</span><br><br>    <span class="hljs-comment">// ä¿®æ”¹æ•°æ®åº“ï¼ˆéå±€éƒ¨æ•°æ®ï¼‰</span><br>    db.<span class="hljs-built_in">updateRecord</span>(<span class="hljs-string">&quot;key&quot;</span>, <span class="hljs-string">&quot;value&quot;</span>);<br>    <br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i) &#123;<br>        localDataCopy.<span class="hljs-built_in">push_back</span>(i);   <span class="hljs-comment">// å¦‚æœæ­¤å¤„å‘ç”Ÿå¼‚å¸¸, å‰é¢çš„æ•°æ®åº“ä¿®æ”¹æ— æ³•æ¢å¤!</span><br>    &#125;<br>    <span class="hljs-built_in">swap</span>(localData, localDataCopy);<br>&#125;<br></code></pre></td></tr></table></figure><p>å› æ­¤, æˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºå¯ä»¥å®ç°å¼ºçƒˆä¿è¯çš„å¤§ä½“ç­–ç•¥ :</p><ul><li><strong>å¦‚æœå‡½æ•°æœ‰å…³å†…å­˜æ•°æ®çš„ä¿®æ”¹, ä½¿ç”¨<code>copy and swap</code>ç­–ç•¥.</strong></li><li><strong>å¦‚æœå‡½æ•°æœ‰å…³éå±€éƒ¨æ•°æ®çš„ä¿®æ”¹, è‡ªå·±æ ¹æ®éå±€éƒ¨æ•°æ®çš„æ€§è´¨è¿›è¡Œå¯¹åº”çš„å¼‚å¸¸å›æ»šæ“ä½œ.</strong></li></ul><p>ä¾‹å¦‚ä¸Šæ–‡çš„æ•°æ®åº“, æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨å…¶<strong>äº‹åŠ¡</strong>çš„ç‰¹æ€§å®ç°å¼‚å¸¸å›æ»š : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modifyDataAndDatabase</span><span class="hljs-params">(std::vector&lt;<span class="hljs-type">int</span>&gt;&amp; localData, Database&amp; db)</span> </span>&#123;<br>    std::vector&lt;<span class="hljs-type">int</span>&gt; localDataCopy = localData;<br>    db.<span class="hljs-built_in">beginTransaction</span>(); <span class="hljs-comment">// å¼€å¯æ•°æ®åº“äº‹åŠ¡</span><br><br>    <span class="hljs-keyword">try</span> &#123;<br>        db.<span class="hljs-built_in">updateRecord</span>(<span class="hljs-string">&quot;key&quot;</span>, <span class="hljs-string">&quot;value&quot;</span>); <span class="hljs-comment">// ä¿®æ”¹æ•°æ®åº“æ•°æ®</span><br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i) &#123;<br>            localDataCopy.<span class="hljs-built_in">push_back</span>(i);  <span class="hljs-comment">// æ­¤åˆ»å‘ç”Ÿä»»ä½•å¼‚å¸¸éƒ½ä¼šè¢«æ•è·, åœ¨catchè¯­å¥ä¸­è§¦å‘å›æ»š</span><br>        &#125;<br><br>        db.<span class="hljs-built_in">commitTransaction</span>(); <span class="hljs-comment">// æ‰€æœ‰ä¿®æ”¹æˆåŠŸåï¼Œæäº¤äº‹åŠ¡</span><br>        std::<span class="hljs-built_in">swap</span>(localData, localDataCopy);<br>    &#125; <span class="hljs-built_in">catch</span> (...) &#123;<br>        db.<span class="hljs-built_in">rollbackTransaction</span>();  <span class="hljs-comment">// å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå›æ»šäº‹åŠ¡</span><br>        <span class="hljs-keyword">throw</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>äºæ˜¯<code>modifyDataAndDatabase</code>å‡½æ•°ä¹Ÿå°±æ‹¥æœ‰äº†å¼ºçƒˆä¿è¯, è¿™éƒ¨åˆ†çš„æœ€ç»ˆç­–ç•¥æ˜¯æˆ‘æ±‚è¯åè‡ªåˆ›çš„, ä¹¦ä¸­æ²¡æœ‰è¯¦ç»†æŒ‡å‡ºå¦‚æœ‰é—®é¢˜æˆ–è¡¥å……æ¬¢è¿æŒ‡å‡º.</p><hr><h3 id="å…³äºåµŒå¥—å‡½æ•°çš„é—®é¢˜"><a href="#å…³äºåµŒå¥—å‡½æ•°çš„é—®é¢˜" class="headerlink" title="å…³äºåµŒå¥—å‡½æ•°çš„é—®é¢˜"></a>å…³äºåµŒå¥—å‡½æ•°çš„é—®é¢˜</h3><p>ä¹¦ä¸­æŒ‡å‡º, åµŒå¥—å‡½æ•°ä¼šç¡®å®å½±å“å‡½æ•°æœ¬èº«çš„å¼‚å¸¸å®‰å…¨æ€§, é“ç†ä¹Ÿå¾ˆå®¹æ˜“ç†è§£, ä¸€ä¸ªæ²¡æœ‰å¼ºçƒˆä¿è¯çš„å‡½æ•°è¢«åµŒå…¥ä¸€ä¸ªå‡½æ•°, é‚£ä¹ˆè¿™ä¸ªå‡½æ•°ä¹Ÿä¸€å®šæ²¡æœ‰å¼ºçƒˆä¿è¯. ç„¶è€Œ<strong>æ‰€æœ‰åµŒå¥—å‡½æ•°éƒ½æ˜¯å¼ºçƒˆä¿è¯çš„å°±èƒ½ä½¿æœ¬å‡½æ•°æœ‰å¼ºçƒˆä¿è¯äº†å—, æœªå¿…!</strong> è®©æˆ‘ä»¬çœ‹ä¸‹é¢çš„å‡½æ•° : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">someFunc</span><span class="hljs-params">()</span> </span>&#123;<br>    ...                <span class="hljs-comment">// åˆ›å»ºå‰¯æœ¬</span><br>    <span class="hljs-built_in">f1</span>();              <span class="hljs-comment">// è°ƒç”¨ f1 å½“æˆè°ƒç”¨ modifyDataAndDatabase(localData);</span><br>    <span class="hljs-built_in">f2</span>();              <span class="hljs-comment">// è°ƒç”¨ f2</span><br>    ...                <span class="hljs-comment">// å°†ä¿®æ”¹åçš„å‰¯æœ¬äº¤æ¢åˆ°åŸçŠ¶æ€</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬æŠŠ<code>f1</code>å½“æˆä¸Šæ–‡çš„<code>modifyDataAndDatabase</code>, ä»”ç»†æƒ³æƒ³æœ‰ä»€ä¹ˆé—®é¢˜.</p><p>å¤§ä½¬å¯èƒ½ä¸€çœ¼å°±çœ‹å‡ºæ¥äº†, è™½ç„¶<code>f1</code>çš„æœ¬èº«æœ‰å¼ºçƒˆä¿è¯, ä½†æ˜¯å¦‚æœ<code>f2</code>æŠ›å‡ºäº†å¼‚å¸¸, <code>f1</code>ä¸­å¯¹<code>localData</code>çš„ä¿®æ”¹å›ºç„¶å¯ä»¥å› ä¸º<code>copy and swap</code>å›æ»š, ä½†æ˜¯æ•°æ®åº“çš„ä¿®æ”¹ä¸èƒ½å‘€, æˆ‘ä»¬åœ¨<code>f1</code>ä¸­çš„æ•°æ®åº“å›æ»šæ“ä½œæ— æ³•å»¶ç”³åˆ°<code>f2</code>ä¸­! æ‰€ä»¥æ— æ³•å®ç°å®Œå…¨çš„å›æ»š, è¿™ä¸ªå‡½æ•°æ˜¯æ²¡æœ‰å¼ºçƒˆä¿è¯çš„!</p><p>è¿™ç§é—®é¢˜ä¹¦ä¸­å«åšâ€<strong>è¿å¸¦å½±å“</strong>â€œ, å³å½“ä¸€ä¸ªå‡½æ•°å¯¹â€éå±€éƒ¨æ€§æ•°æ®â€æœ‰å½±å“æ—¶, å…¶è¢«åµŒå¥—åœ¨å…¶ä»–å‡½æ•°å†…éƒ¨æ—¶, å°±ç®—æœ¬èº«æœ‰å¼ºçƒˆä¿è¯, ä¹Ÿä¼šå› ä¸ºå¤–éƒ¨å¯èƒ½çš„å¼‚å¸¸è¿å¸¦äº§ç”Ÿé”™è¯¯. </p><p>è¿™ä¸ªé—®é¢˜æé†’æˆ‘ä»¬ä¸€ä¸ªå‡½æ•°å¦‚æœæƒ³æœ‰å¼ºçƒˆä¿è¯, ä¸è¦åµŒå¥—å½±å“â€éå±€éƒ¨æ•°æ®â€çš„å‡½æ•°, éè¦åµŒå¥—ä¹Ÿè¦ç¡®å®šå…¶åæ²¡æœ‰ä»»ä½•å¼‚å¸¸äº§ç”Ÿçš„å¯èƒ½æ€§.</p><hr><h3 id="å¼‚å¸¸å®‰å…¨æ€§å°±åƒæ€€å­•"><a href="#å¼‚å¸¸å®‰å…¨æ€§å°±åƒæ€€å­•" class="headerlink" title="å¼‚å¸¸å®‰å…¨æ€§å°±åƒæ€€å­• . . ."></a>å¼‚å¸¸å®‰å…¨æ€§å°±åƒæ€€å­• . . .</h3><p>ä½œè€…æå‡º, ä¸€ä½å¥³å£«è‹¥éæ€€å­•, å°±æ˜¯æ²¡æ€€å­•, ä¸å¯èƒ½è¯´å¥¹â€éƒ¨åˆ†æ€€å­•â€; åŒç†, ä¸€ä¸ªç³»ç»Ÿå†…å¦‚æœæœ‰ä¸€ä¸ªå‡½æ•°ä¸å…·å¤‡å¼‚å¸¸å®‰å…¨æ€§, æ•´ä¸ªç³»ç»Ÿå°±ä¸å…·å¤‡å¼‚å¸¸å®‰å…¨æ€§, å¾ˆä¸å¹¸, C++ç”±äºå¯¹Cçš„ç»§æ‰¿, å…¶å¾ˆå¤šä¼ ç»Ÿä»£ç å…¶å®æ˜¯ä¸å…·å¤‡å¼‚å¸¸å®‰å…¨æ€§çš„, ä¸è¿‡æˆ‘ä»¬åº”å½“å°½åŠ›è®©æˆ‘ä»¬çš„ä»£ç å…·å¤‡å¼‚å¸¸å®‰å…¨æ€§, åŒæ—¶ä¹Ÿ<strong>åº”å½“å°†è‡ªå·±å¯¹å‡½æ•°çš„å®‰å…¨æ€§å®šä¹‰å†™æˆæ–‡æ¡£, ä¸ºæˆ‘ä»¬çš„å®¢æˆ·å’ŒåæœŸç»´æŠ¤è€…ä½¿ç”¨</strong>.</p><hr><h3 id="ä¹¦ä¸­ä½œè€…éš¾å¾—å‘å‡ºæ„Ÿå¹-ç”±æ­¤æ‘˜å½•"><a href="#ä¹¦ä¸­ä½œè€…éš¾å¾—å‘å‡ºæ„Ÿå¹-ç”±æ­¤æ‘˜å½•" class="headerlink" title="ä¹¦ä¸­ä½œè€…éš¾å¾—å‘å‡ºæ„Ÿå¹, ç”±æ­¤æ‘˜å½•:"></a>ä¹¦ä¸­ä½œè€…éš¾å¾—å‘å‡ºæ„Ÿå¹, ç”±æ­¤æ‘˜å½•:</h3><p>å››åå¹´å‰, æ»¡è½½gotoçš„ä»£ç è¢«è§†ä¸ºä¸€ç§ç¾å¥½å®è·µ, è€Œä»Šæˆ‘ä»¬å´è‡´åŠ›äºå†™å‡ºç»“æ„åŒ–æ§åˆ¶æµ.</p><p>äºŒåå¹´å‰, å…¨å±€æ•°æ®è¢«è§†ä¸ºä¸€ç§ç¾å¥½å®è·µ, è€Œä»Šæˆ‘ä»¬å´è‡´åŠ›äºæ•°æ®çš„å°è£….</p><p>åå¹´å‰, æ’°å†™â€æœªå°†å¼‚å¸¸è€ƒè™‘åœ¨å†…â€çš„å‡½æ•°è¢«è§†ä¸ºä¸€ç§ç¾å¥½å®è·µ, è€Œä»Šæˆ‘ä»¬å´è‡´åŠ›äºå†™å‡ºâ€å¼‚å¸¸å®‰å…¨ç â€.</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>â€œä»¥å¯¹è±¡ç®¡ç†èµ„æºâ€å¯ä»¥é˜»æ­¢èµ„æºæ³„æ¼, è°ƒæ•´è¯­åºå’Œä¸‰ç§å¼‚å¸¸ä¿è¯å¯èƒ½å¯ä»¥é˜»æ­¢æ•°æ®è´¥å.</li><li>â€œåŸºæœ¬æ‰¿è¯ºâ€è¯šå¯è´µ, â€œå¼ºçƒˆä¿è¯â€ä»·æ›´é«˜, è‹¥ä¸ºâ€ä¸æŠ›æ·â€, äºŒè€…çš†å¯æŠ›.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
      <tag>å¼‚å¸¸å®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç“¦å°”ç™»æ¹–è¯»ä¹¦æ‘˜å½•(2)</title>
    <link href="/2024/12/07/%E7%93%A6%E5%B0%94%E7%99%BB%E6%B9%96%E8%AF%BB%E4%B9%A6%E6%91%98%E5%BD%95(2)/"/>
    <url>/2024/12/07/%E7%93%A6%E5%B0%94%E7%99%BB%E6%B9%96%E8%AF%BB%E4%B9%A6%E6%91%98%E5%BD%95(2)/</url>
    
    <content type="html"><![CDATA[<ul><li><p>å‡å¦‚æˆ‘ä»¬é†’æ¥å¹¶æ²¡æœ‰è¿‡ä¸Šæ¯”ç¡å‰æ›´å´‡é«˜çš„ç”Ÿæ´», é‚£ä¹ˆç™½å¤©ä¹Ÿå°±æ²¡ä»€ä¹ˆå¥½æœŸå¾…çš„äº†.</p></li><li><p>äººè¦æ˜¯ä¸ç›¸ä¿¡åœ¨å–§åš£çš„ç™½æ—¥ä¹‹å‰, æœ‰è€…æ›´ç¥åœ£,æ›´ç»šä¸½çš„æ—¶åˆ», é‚£ä¹ˆä»–å¯¹ç”Ÿæ´»è‚¯å®šå·²ç»æ„Ÿåˆ°ç»æœ›, è€Œä»–æ‰€èµ°çš„äººç”Ÿä¹‹è·¯è‚¯å®šæ˜¯æ±Ÿæ²³æ—¥ä¸‹, è¶Šæ¥è¶Šé»‘æš—çš„.</p></li><li><p>åªè¦æˆ‘æ¸…é†’ç€, å¿ƒä¸­æœ‰å…‰æ˜, é‚£å°±æ˜¯æ—©æ™¨.</p></li><li><p>æˆ‘ä»¬å¿…é¡»å­¦ä¼šå†æ¬¡è‹é†’, å¹¶ä¿æŒç€æ¸…é†’çš„çŠ¶æ€, ä½†è¦å€ŸåŠ©çš„ä¸æ˜¯æŸäº›ç”Ÿç¡¬çš„æªæ–½, è€Œæ˜¯å¯¹é»æ˜çš„æ— é™æœŸå¾…, è¿™æ˜¯åœ¨æˆ‘ä»¬ç¡å¾—æœ€ç†Ÿæ—¶ä¹Ÿä¼šä¹Ÿä¼šæœ‰çš„æœŸå¾….</p></li><li><p>ç‹—å±æ–°é—»!æœ€é‡è¦çš„æ˜¯å»äº†è§£é‚£äº›æ°¸ä¸è¿‡æ—¶çš„ä¸œè¥¿!</p></li><li><p>å¤§äººæ²¡èƒ½è¿‡ä¸Šæœ‰ä»·å€¼çš„ç”Ÿæ´», å´è‡ªè®¤ä¸ºæ›´èªæ˜, å› ä¸ºä»–ä»¬æ›´æœ‰ç»éªŒ, å¯æƒœä»–ä»¬çš„ç»éªŒå…¶å®å°±æ˜¯å¤±è´¥.</p></li><li><p>åªæœ‰æŒç»­ä¸æ–­åœ°æ¸—å…¥å’Œæµ¸æ³¡åœ¨å‘¨å›´çš„ç°å®ä¹‹ä¸­, æˆ‘ä»¬æ‰èƒ½ç†è§£ä¸€åˆ‡åœ£æ´è€Œé«˜è´µçš„ä¸œè¥¿.</p></li><li><p>è®©æˆ‘ä»¬æŠŠè‡ªå·±å®‰é¡¿ä¸‹æ¥, å¥½å¥½åœ°å·¥ä½œ, ç”¨åŠ›å»è¸©è¸è„šä¸‹çš„çƒ‚æ³¥, é‚£ç”±æˆè§,åè§,ä¼ ç»Ÿ,è°è¨€å’Œè¡¨è±¡æ…æˆçš„çƒ‚æ³¥, ç›´åˆ°æˆ‘ä»¬çš„è„šè§¦åŠæ›´åšç¡¬çš„åº•éƒ¨å’Œå®‰ç¨³çš„å²©çŸ³, ä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„ç°å®, æœ‰äº†è¿™ä¸ªç«‹è¶³ç‚¹, æˆ‘ä»¬å¾—ä»¥åœ¨å°†æ¥çš„ä¸–ä»£èƒ½å¤ŸçŸ¥é“, è°è¨€å’Œè¡¨è±¡çš„æ´ªæ°´æ›¾ç»ç§¯èšå¾—æœ‰å¤šæ·±.</p></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>é˜…è¯»</tag>
      
      <tag>ç“¦å°”ç™»æ¹–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾28 é¿å…è¿”å›handlesæŒ‡å‘å¯¹è±¡å†…éƒ¨æˆåˆ†</title>
    <link href="/2024/12/07/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE28%20%E9%81%BF%E5%85%8D%E8%BF%94%E5%9B%9Ehandles%E6%8C%87%E5%90%91%E5%AF%B9%E8%B1%A1%E5%86%85%E9%83%A8%E6%88%90%E5%88%86/"/>
    <url>/2024/12/07/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE28%20%E9%81%BF%E5%85%8D%E8%BF%94%E5%9B%9Ehandles%E6%8C%87%E5%90%91%E5%AF%B9%E8%B1%A1%E5%86%85%E9%83%A8%E6%88%90%E5%88%86/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾28-é¿å…è¿”å›handlesæŒ‡å‘å¯¹è±¡å†…éƒ¨æˆåˆ†"><a href="#æ¡æ¬¾28-é¿å…è¿”å›handlesæŒ‡å‘å¯¹è±¡å†…éƒ¨æˆåˆ†" class="headerlink" title="æ¡æ¬¾28 : é¿å…è¿”å›handlesæŒ‡å‘å¯¹è±¡å†…éƒ¨æˆåˆ†"></a>æ¡æ¬¾28 : é¿å…è¿”å›handlesæŒ‡å‘å¯¹è±¡å†…éƒ¨æˆåˆ†</h2><p>è®©æˆ‘ä»¬å…ˆæ¥æ˜ç¡®æœ¬æ¡æ¬¾ä¸­çš„ä¸¤ä¸ªæ¦‚å¿µ : </p><ul><li>handle : å³å¥æŸ„, å·ç ç‰Œ, å¯ä»¥ç†è§£ä¸ºå„ç§<strong>æŒ‡é’ˆ, å¼•ç”¨, è¿­ä»£å™¨</strong>.</li><li>å†…éƒ¨æˆåˆ† : <strong>privateæˆå‘˜å˜é‡å’Œæˆå‘˜å‡½æ•°</strong>.</li></ul><p>æœ‰äº†ä¸Šé¢ä¸¤ä¸ªæ¦‚å¿µ, å°±å¯ä»¥æ¯”è¾ƒç›´è§‚åœ°ç†è§£æœ¬æ¡æ¬¾äº†, ä¸è¿‡åœ¨é€šè¯»å®Œæœ¬æ¡æ¬¾å, æœ¬æ¡æ¬¾è™½è¯´æ˜¯<strong>é¿å…è¿”å›handlesæŒ‡å‘å¯¹è±¡å†…éƒ¨æˆåˆ†</strong>, ä½†æ˜¯å…¶å®å†…å®¹ç€é‡åœ¨è§£é‡Š<strong>åœ¨å¿…é¡»è¿”å›handlesæŒ‡å‘å¯¹è±¡å†…éƒ¨æˆåˆ†çš„æƒ…å†µä¸‹, ä¼šå¸¦æ¥ä»€ä¹ˆæ ·çš„é£é™©</strong>, ä»¥æ­¤å‘Šè¯«æˆ‘ä»¬æ³¨æ„. </p><hr><h3 id="é™ä½å¯¹è±¡å°è£…æ€§"><a href="#é™ä½å¯¹è±¡å°è£…æ€§" class="headerlink" title="é™ä½å¯¹è±¡å°è£…æ€§"></a>é™ä½å¯¹è±¡å°è£…æ€§</h3><p>ä¹¦ä¸­æŒ‡å‡º, <strong>è¿”å›handlesæŒ‡å‘å¯¹è±¡å†…éƒ¨æˆåˆ†</strong>, éšä¹‹è€Œæ¥çš„ä¾¿æ˜¯**â€é™ä½å¯¹è±¡å°è£…æ€§â€çš„é£é™©**, å¦‚æœä¸æ˜¯æœ‰æ„è®¾è®¡, æˆ‘ä»¬<strong>ä¸åº”ä»¤publicæˆå‘˜å‡½æ•°è¿”å›ä¸€ä¸ªhandleæŒ‡å‘privateçš„æˆå‘˜å˜é‡</strong>, è¿™ä¼šä½¿åè€…çš„<strong>å®é™…è®¿é—®çº§åˆ«å˜ä¸ºpublic</strong>, è¿™æ˜¯å®Œå…¨å¯ä»¥ç†è§£çš„.</p><p>ä¹¦ä¸­æè¿°äº†GUIä¸­å¸¸æœ‰çš„çŸ©å½¢, å®ƒä¸€èˆ¬ä¼šç”¨å·¦ä¸Šç‚¹å’Œå³ä¸‹ç‚¹è¡¨ç¤º : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span> &#123;                      <span class="hljs-comment">// åæ ‡ç‚¹</span><br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-built_in">Point</span>(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y);<br>  ...<br><br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setX</span><span class="hljs-params">(<span class="hljs-type">int</span> newVal)</span></span>;<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setY</span><span class="hljs-params">(<span class="hljs-type">int</span> newVal)</span></span>;<br>  ...<br>&#125;;<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">RectData</span> &#123;                    <span class="hljs-comment">// çŸ©å½¢èµ„æºç±»</span><br>  Point ulhc;                        <span class="hljs-comment">// å·¦ä¸Šç‚¹</span><br>  Point lrhc;                        <span class="hljs-comment">// å³ä¸‹ç‚¹</span><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> &#123;<span class="hljs-comment">// èµ„æºç®¡ç†ç±» è§æ¡æ¬¾13</span><br>  ...<br><span class="hljs-keyword">private</span>:<br>  std::shared_ptr&lt;RectData&gt; pData;    <span class="hljs-comment">// å­˜å…¥æ™ºèƒ½æŒ‡é’ˆè¿›è¡Œç®¡ç†    </span><br>&#125;;<br></code></pre></td></tr></table></figure><p>å®¢æˆ·ä¸€èˆ¬ä¼šè¦æ±‚ä½¿ç”¨çŸ©å½¢çš„ä½ç½®ä¿¡æ¯ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  ...<br>  <span class="hljs-function">Point&amp; <span class="hljs-title">upperLeft</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> pData-&gt;ulhc; &#125;<br>  <span class="hljs-function">Point&amp; <span class="hljs-title">lowerRight</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> pData-&gt;lrhc; &#125;<br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ç”¨ä¸¤ä¸ªå‡½æ•°åˆ†åˆ«è¿”å›å·¦ä¸Šç‚¹å’Œå³ä¸‹ç‚¹, è¿™ä¸ªæ“ä½œå¾ˆæ­£å¸¸, ä½†æ˜¯è¿™ç»™äº†å®¢æˆ·æ£ä¹±çš„æ–¹å¼ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">Point <span class="hljs-title">coord1</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)</span></span>;<br><span class="hljs-function">Point <span class="hljs-title">coord2</span><span class="hljs-params">(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-type">const</span> Rectangle <span class="hljs-title">rec</span><span class="hljs-params">(coord1, coord2)</span></span>;    <br><br>rec.<span class="hljs-built_in">upperLeft</span>().<span class="hljs-built_in">setX</span>(<span class="hljs-number">50</span>);  <span class="hljs-comment">// recçš„å·¦ä¸Šç‚¹å®é™…è¢«ä¿®æ”¹ä¸ºäº†(50, 0)!</span><br></code></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µåœ¨æ¡æ¬¾3ä¸­ä¹Ÿå®é™…å‘ç”Ÿè¿‡, å°±æ˜¯<strong>é€šè¿‡constæˆå‘˜å‡½æ•°çš„è¿”å›å€¼ä¿®æ”¹äº†ç±»çš„å†…éƒ¨æ•°æ®</strong>, åŸå› æ¡æ¬¾3ä¸­å·²ç»è§£é‡Šè¿‡äº†, è§£å†³æ–¹å¼ä¹Ÿå¾ˆç®€å•, ç»™è¿”å›å€¼ä¹ŸåŠ ä¸€ä¸ª<code>const</code>å°±å¥½äº† : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  ...<br>  <span class="hljs-function"><span class="hljs-type">const</span> Point&amp; <span class="hljs-title">upperLeft</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> pData-&gt;ulhc; &#125;<br>  <span class="hljs-function"><span class="hljs-type">const</span> Point&amp; <span class="hljs-title">lowerRight</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> pData-&gt;lrhc; &#125;<br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>é‡æ–°æ•´ç†æ€è·¯, å°è£…æ€§åœ¨äº<strong>æ•°æ®éšè—</strong>, åœ¨äº<strong>é™åˆ¶å¤–éƒ¨å¯¹å†…éƒ¨çš„è®¿é—®ä¸ä¿®æ”¹</strong>. ä»¥ä¸Šå‡½æ•°åšåˆ°äº†<strong>è®¿é—®æƒçš„è®©æ¸¡ä¸ä¿®æ”¹æƒçš„ç¦æ­¢</strong>, è®¿é—®æƒè®©æ¸¡æ˜¯å› ä¸ºæœ‰å¿…è¦çš„å®¢æˆ·éœ€æ±‚, ä¿®æ”¹æƒç¦æ­¢æ˜¯åº”ä¸ºå®¢æˆ·æ²¡æœ‰æƒé™ä¿®æ”¹å†…éƒ¨, ä»¥æ­¤åœ¨æä¾›å¿…è¦åŠŸèƒ½çš„å‰æä¸‹ä½¿å¯¹è±¡è¾¾åˆ°äº†æœ€å¥½çš„å°è£…æ€§.</p><hr><h3 id="ç©ºæ‚¬å¥æŸ„-dangling-handles"><a href="#ç©ºæ‚¬å¥æŸ„-dangling-handles" class="headerlink" title="ç©ºæ‚¬å¥æŸ„(dangling handles)"></a>ç©ºæ‚¬å¥æŸ„(dangling handles)</h3><p>ç©ºæ‚¬å¥æŸ„å’ŒCä¸­çš„é‡æŒ‡é’ˆå¾ˆç›¸ä¼¼, ä¹¦ä¸­ç»™å‡ºäº†æŸä¸ªå‡½æ•°è¿”å›GUIå¯¹è±¡çš„å¤–æ¡†(çŸ©å½¢)çš„ä¾‹å­ :</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">GUIObject</span> &#123; ... &#125;; <br><span class="hljs-function"><span class="hljs-type">const</span> Rectangle <span class="hljs-title">boundingBox</span><span class="hljs-params">(<span class="hljs-type">const</span> GUIObject&amp; obj)</span></span>;  <span class="hljs-comment">// è¿”å›ä¸€ä¸ªçŸ©å½¢    </span><br><br>GUIObject *pgo;   <br>...                                  <br><span class="hljs-type">const</span> Point *pUpperLeft = &amp;(<span class="hljs-built_in">boundingBox</span>(*pgo).<span class="hljs-built_in">upperLeft</span>());  <span class="hljs-comment">// è¿™é‡ŒpUpperLeftæ˜¯ä¸€ä¸ªç©ºæ‚¬å¥æŸ„                   </span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥è§£é‡Šæœ€åä¸€å¥ä»£ç  : </p><ol><li><code>boundingBox(*pgo)</code> åˆ©ç”¨<code>pgo</code>è°ƒç”¨<code>boundingBox</code>å‡½æ•°</li><li><code>boundingBox</code>å‡½æ•°è¿”å›ä¸€ä¸ªä¸´æ—¶çŸ©å½¢å¯¹è±¡(è¿™æ˜¯ä¸€ä¸ªåŒ¿åå¯¹è±¡, ä»¥ä¸‹ç®€ç§°<code>temp</code>)</li><li><code>temp</code>è°ƒç”¨<code>upperLeft()</code>å¾—åˆ°è¯¥ä¸´æ—¶å¯¹è±¡çš„å·¦ä¸Šç‚¹</li><li>å–å‡ºå³ä¸Šç‚¹çš„åœ°å€èµ‹å€¼ç»™<code>pUpperLeft</code></li></ol><p>æœ€åçš„ç»“æœå°±æ˜¯<code>pUpperLeft</code>è·å¾—äº†ä¸€ä¸ªæ¥è‡ªä¸´æ—¶å¯¹è±¡çš„æŒ‡é’ˆ, å½“æ§åˆ¶åŸŸç¦»å¼€è¯¥è¡Œ, è¿™ä¸ªæŒ‡é’ˆå°†æˆä¸ºä¸€ä¸ªé‡æŒ‡é’ˆ, åˆ™ç§°<code>pUpperLeft</code>æ˜¯ä¸€ä¸ªç©ºæ‚¬å¥æŸ„, å®ƒæŒ‡å‘äº†ä¸€ä¸ªä¸å­˜åœ¨çš„å¯¹è±¡.</p><p>å› æ­¤ä¹¦ä¸­å‘Šè¯‰æˆ‘ä»¬, <strong>è¿”å›handlesæŒ‡å‘å¯¹è±¡å†…éƒ¨æˆåˆ†æ€»æ˜¯å±é™©çš„</strong>, ä¸ç®¡è¿™ä¸ª<code>handle</code>æ˜¯å¦ä¸º<code>const</code> å”¯ä¸€é€ æˆå±é™©çš„äº‹å®å°±æ˜¯, <strong>æœ‰ä¸ªhandleè¢«ä¼ å‡ºå»äº†</strong>, å› æ­¤å°±æœ‰å¯èƒ½å‡ºç°<strong>handleæ¯”å…¶æ‰€æŒ‡å¯¹è±¡æ›´é•¿å¯¿</strong>çš„é£é™©, è¿™æ‰æ˜¯é—®é¢˜çš„æ ¸å¿ƒ.</p><p>ç„¶è€ŒæŒ‡å‡ºè¿™ä¸ªé£é™©ä¸æ˜¯è¯´å°±ä¸åº”è¯¥è¿”å›<code>handles</code>, æˆ‘ä»¬æ€»ä¼šæœ‰è®¸å¤šéœ€æ±‚éœ€è¦è®¿é—®å†…éƒ¨æˆåˆ†, è¿™ç§é£é™©é¿æ— å¯é¿, è€Œæ˜¯åœ¨å‘Šè¯«æˆ‘ä»¬æ—¶å¸¸æ³¨æ„ç©ºæ‚¬å¥æŸ„é—®é¢˜, <strong>ä¸è¦è®©æˆ‘ä»¬çš„æŒ‡é’ˆ&#x2F;å¼•ç”¨&#x2F;è¿­ä»£å™¨å› ä¸ºæ¯”å…¶æ‰€æŒ‡å¯¹è±¡æ›´é•¿å¯¿è€Œå¤±æ•ˆ</strong>.</p><p>æˆ‘ä»¬å¯ä»¥å†é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥åŠ æ·±ç†è§£ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp">vector&lt;<span class="hljs-type">int</span>&gt; v = &#123; <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span> &#125;;<br>vector&lt;<span class="hljs-type">int</span>&gt;::iterator it = v.<span class="hljs-built_in">begin</span>();<br><span class="hljs-keyword">while</span> (it != v.<span class="hljs-built_in">end</span>())<br>&#123;<br><span class="hljs-keyword">if</span> (*it == <span class="hljs-number">3</span>) v.<span class="hljs-built_in">erase</span>(it);<br>    ++it;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå°±æ˜¯éå¸¸ç»å…¸<strong>è¿­ä»£å™¨å¤±æ•ˆ</strong>é—®é¢˜, è¿™ä¸ªä¾‹å­åœ¨éå†<code>v</code>, å°†<code>v</code>ä¸­ç­‰äº3çš„å…ƒç´ åˆ é™¤, è¿™æ®µä»£ç çœ‹ä¼¼åˆç†, ä½†æ˜¯ç»“åˆæˆ‘ä»¬ä¸Šé¢çš„ç†è§£, åœ¨è§¦å‘<code>erase</code>å, <code>it</code>è¿­ä»£å™¨æŒ‡å‘çš„å¯¹è±¡å…¶å®å·²ç»è¢«é”€æ¯äº†, è¿™æ—¶<code>++it</code>å°±å˜ä¸ºäº†æœªå®šä¹‰çš„æ“ä½œ, åœ¨<code>vs</code>ä¸­ç”šè‡³ä¼šç›´æ¥æŠ¥é”™, å¦‚æœæˆ‘ä»¬å¯ä»¥æå‰å‘ç°è¿™ä¸ªé—®é¢˜, å°±å¯ä»¥åšå‡ºä»¥ä¸‹æ”¹è¿› : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp">vector&lt;<span class="hljs-type">int</span>&gt; v = &#123; <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span> &#125;;<br>vector&lt;<span class="hljs-type">int</span>&gt;::iterator it = v.<span class="hljs-built_in">begin</span>();<br><span class="hljs-keyword">while</span> (it != v.<span class="hljs-built_in">end</span>())<br>&#123;<br><span class="hljs-keyword">if</span> (*it == <span class="hljs-number">3</span>) it = v.<span class="hljs-built_in">erase</span>(it);<br>    <span class="hljs-keyword">else</span> ++it;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åˆ©ç”¨<code>erase</code>çš„è¿”å›å€¼å¯¹<code>it</code>é‡æ–°èµ‹å€¼, ä½¿å…¶å…äºå¤±æ•ˆ.</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>å°½å¯èƒ½é¿å…è¿”å›<code>handles</code>æŒ‡å‘å¯¹è±¡å†…éƒ¨æˆåˆ†, è¿™å¯ä»¥æå‡å¯¹è±¡å°è£…æ€§, é¿å…<code>dangling handles</code>å‡ºç°.</li><li>é¿æ— å¯é¿æ—¶è°¨æ…é‡Šå‡ºå†…éƒ¨æˆåˆ†çš„è®¿é—®æƒä¸ä¿®æ”¹æƒ, ä¿®æ”¹æƒå¯ç”¨<code>const</code>ç¦æ­¢, æ³¨æ„<code>dangling handles</code>é—®é¢˜.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾27 ç±»å‹è½¬æ¢</title>
    <link href="/2024/12/06/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE27%20%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/"/>
    <url>/2024/12/06/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE27%20%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾27-å°½é‡å°‘åšè½¬å‹åŠ¨ä½œ"><a href="#æ¡æ¬¾27-å°½é‡å°‘åšè½¬å‹åŠ¨ä½œ" class="headerlink" title="æ¡æ¬¾27 : å°½é‡å°‘åšè½¬å‹åŠ¨ä½œ"></a>æ¡æ¬¾27 : å°½é‡å°‘åšè½¬å‹åŠ¨ä½œ</h2><blockquote><p>ä¼˜è‰¯çš„C++ä»£ç å¾ˆå°‘ä½¿ç”¨è½¬å‹, ä½†æ˜¯è¦å®Œå…¨æ‘†è„±å®ƒä»¬åˆå¤ªè¿‡ä¸åˆ‡å®é™…, æˆ‘ä»¬åº”å½“ä¿è¯â€ç±»å‹é”™è¯¯â€ç»æ— å¯èƒ½å‘ç”Ÿ. æœ¬æ¡æ¬¾åœ¨äº†è§£å„ç§è½¬å‹åŠ¨ä½œçš„å‰æä¸‹, æŒ‡å‡ºäº†ä¸€äº›æœ‰é£é™©çš„è½¬å‹æ“ä½œåŠå…¶è§£å†³æ–¹æ³•.</p></blockquote><p>æˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹ç±»å‹è½¬æ¢ : </p><h4 id="æ—§å¼Cé£æ ¼è½¬å‹"><a href="#æ—§å¼Cé£æ ¼è½¬å‹" class="headerlink" title="æ—§å¼Cé£æ ¼è½¬å‹"></a>æ—§å¼Cé£æ ¼è½¬å‹</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp">(T)expression;<br><span class="hljs-built_in">T</span>(experssion);<br></code></pre></td></tr></table></figure><h4 id="æ–°å¼è½¬å‹"><a href="#æ–°å¼è½¬å‹" class="headerlink" title="æ–°å¼è½¬å‹"></a>æ–°å¼è½¬å‹</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">static_cast</span>&lt;T&gt;(expression)<br><span class="hljs-built_in">const_cast</span>&lt;T&gt;(expression)<br><span class="hljs-built_in">dynamic_cast</span>&lt;T&gt;(expression)<br><span class="hljs-built_in">reinterpret_cast</span>&lt;T&gt;(expression)<br></code></pre></td></tr></table></figure><ul><li>static_cast : å¼ºåˆ¶éšå¼è½¬æ¢, é€‚åˆé™¤å¸¸é‡æ€§ç§»é™¤ä¹‹å¤–çš„å¤§éƒ¨åˆ†è½¬æ¢åœºæ™¯.</li><li>const_cast : å”¯ä¸€å¯ä»¥å¸¸é‡æ€§ç§»é™¤çš„è½¬æ¢, è€Œä¸”èƒ½ä¸”ä»…èƒ½ç§»é™¤å¸¸é‡æ€§.</li><li>dynamic_cast : â€œå®‰å…¨å‘ä¸‹è½¬å‹â€, å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæœ‰å®‰å…¨ç±»å‹æ£€æŸ¥çš„å¯ä»¥å°†åŸºç±»è½¬ä¸ºæ´¾ç”Ÿç±»çš„<code>static_cast</code>.</li><li>reinterpret_cast : ä½çº§è½¬å‹, ç°åœ¨å¾ˆå°‘ç”¨äº†.</li></ul><hr><p>ä¹¦ä¸­æå‡ºç¬¬ä¸€ä¸ªè§‚ç‚¹ : é™¤éä½ ç¡®å®šè½¬å‹æ²¡æœ‰ä»»ä½•é£é™©, å¹¶ä¸”æ—§å¼è½¬å‹å¾ˆæ–¹ä¾¿, åº”å½“<strong>å§‹ç»ˆç†æ™ºä½¿ç”¨æ–°å¼è½¬å‹</strong>, ä»¥ä¸‹ä¸ºåŸå›  : </p><ol><li>æ–°å¼è½¬å‹<strong>å¾ˆå®¹æ˜“åœ¨ä»£ç ä¸­è¢«è¯†åˆ«å‡ºæ¥</strong>, æœ‰åŠ©äºç¼–è¯‘å™¨æˆ–å…¶ä»–å·¥å…·è¯†åˆ«.</li><li>æ–°å¼è½¬å‹<strong>ç»†åŒ–äº†è½¬å‹åŠ¨ä½œçš„ç›®æ ‡</strong>, ä½¿å¾—ç¼–è¯‘å™¨æ›´å®¹æ˜“è¯Šæ–­å‡ºé”™è¯¯çš„è¿ç”¨.</li></ol><hr><h4 id="é¿å…åšå‡ºâ€å¯¹è±¡åœ¨C-ä¸­å¦‚ä½•å¸ƒå±€â€çš„å‡è®¾"><a href="#é¿å…åšå‡ºâ€å¯¹è±¡åœ¨C-ä¸­å¦‚ä½•å¸ƒå±€â€çš„å‡è®¾" class="headerlink" title="é¿å…åšå‡ºâ€å¯¹è±¡åœ¨C++ä¸­å¦‚ä½•å¸ƒå±€â€çš„å‡è®¾"></a>é¿å…åšå‡ºâ€å¯¹è±¡åœ¨C++ä¸­å¦‚ä½•å¸ƒå±€â€çš„å‡è®¾</h4><p>ä¹¦ä¸­æé†’æˆ‘ä»¬, <strong>ç±»å‹è½¬æ¢å¹¶ä¸ä»…ä»…æ˜¯â€œå‘Šè¯‰ç¼–è¯‘å™¨ç±»å‹çš„å˜åŒ–â€</strong>, å®ƒæ˜¯ä¼šå®é™…äº§ç”Ÿé¢å¤–ä»£ç çš„, è€Œä¸”æœ‰å¯èƒ½å¯¹å½“å‰å¯¹è±¡å¸ƒå±€åšå‡ºè°ƒæ•´, ä¾‹å¦‚å°†åŸºç±»æŒ‡é’ˆä»åŸæœ¬çš„æŒ‡å‘çš„åŸºç±», æ”¹ä¸ºæŒ‡å‘æ´¾ç”Ÿç±», æˆ‘ä»¬ä¹Ÿè®¸ä¼šè®¤ä¸ºå‰è€…å’Œåè€…çš„æŒ‡é’ˆåœ°å€æ˜¯ä¸€æ ·çš„, å®é™…ä¹Ÿç¡®å®å¤§å¤šæ•°æƒ…å†µéƒ½æ˜¯ä¸€æ ·çš„(åŒ…æ‹¬æˆ‘æµ‹è¯•çš„), ä½†æ˜¯ä¹¦ä¸­è¯´å¯¹è±¡å¸ƒå±€æ–¹å¼ä¼šä¾ç…§ç¼–è¯‘å™¨çš„ä¸åŒè€Œä¸åŒ, ç¡®å®ä¼šå‘ç”Ÿå‰åè€…æŒ‡é’ˆä¸ä¸€æ ·çš„æƒ…å†µå‡ºç°, è€Œä¸”åœ¨å‡ºç°å¤šé‡ç»§æ‰¿æ˜¯è¿™ç§æƒ…å†µä¼šæ›´å¤š. æ‰€ä»¥ä½œè€…å‘Šè¯«æˆ‘ä»¬, <strong>â€œç”±äºçŸ¥é“å¯¹è±¡å¦‚ä½•å¸ƒå±€â€è€Œè®¾è®¡çš„è½¬å‹, åœ¨æŸäº›å¹³å°è¡Œå¾—é€š, åœ¨å…¶ä»–å¹³å°å¹¶ä¸ä¸€å®š</strong>.</p><hr><h4 id="é¿å…ç”¨ç±»å‹è½¬æ¢å†™å‡ºä¼¼æ˜¯è€Œéçš„ä»£ç "><a href="#é¿å…ç”¨ç±»å‹è½¬æ¢å†™å‡ºä¼¼æ˜¯è€Œéçš„ä»£ç " class="headerlink" title="é¿å…ç”¨ç±»å‹è½¬æ¢å†™å‡ºä¼¼æ˜¯è€Œéçš„ä»£ç "></a>é¿å…ç”¨ç±»å‹è½¬æ¢å†™å‡ºä¼¼æ˜¯è€Œéçš„ä»£ç </h4><p>åœ¨å†™GUIæ—¶ä¼šæœ‰å®šä¹‰å¾ˆå¤šçš„çª—å£ç±», è¿™ç§åº”ç”¨æ¡†æ¶ä¸€èˆ¬ä¼šåšæŒæ´¾ç”Ÿç±»çš„é‡å†™ä¼šå…ˆè°ƒç”¨çˆ¶ç±»ç‰ˆæœ¬, äºæ˜¯å°±æœ‰äº†ä»¥ä¸‹ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Window</span> &#123;                                <span class="hljs-comment">// base class</span><br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">onResize</span><span class="hljs-params">()</span> </span>&#123; ... &#125;             <span class="hljs-comment">// åŸºç±»çª—å£é‡ç½®å°ºå¯¸</span><br>  ...<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpecialWindow</span>: <span class="hljs-keyword">public</span> Window &#123;          <span class="hljs-comment">// derived class</span><br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">onResize</span><span class="hljs-params">()</span> </span>&#123;                   <span class="hljs-comment">// æ´¾ç”Ÿç±»é‡å†™</span><br>    <span class="hljs-built_in">static_cast</span>&lt;Window&gt;(*<span class="hljs-keyword">this</span>).<span class="hljs-built_in">onResize</span>();    <span class="hljs-comment">// å…ˆè°ƒç”¨çˆ¶ç±»ç‰ˆæœ¬çš„onResize()</span><br>    ...                                    <br>  &#125;                                          <br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬èµ·åˆçœ‹å¯èƒ½è¿˜åƒä¸€å›äº‹, ä½†æ˜¯å®é™…æ¼æ´ç™¾å‡º,  <code>static_cast&lt;Window&gt;(*this)</code>è¿™ä¸ªè¡¨è¾¾å¼è¿”å›çš„å…¶å®æ˜¯ä¸€ä¸ª**â€<em>thiså¯¹è±¡å€¼base classæˆåˆ†â€çš„ä¸´æ—¶æ‹·è´</em>*! <code>static_cast</code>åœ¨åº•å±‚è½¬æ¢ç±»å‹åè¿›è¡Œåˆ‡åˆ†, ç„¶åæŠŠåˆ‡åˆ†å‡ºæ¥çš„éƒ¨åˆ†æ‹·è´è¿”å›. ä¹Ÿå°±æ˜¯è¯´çœŸæ­£è°ƒç”¨åŸºç±»<code>onResize()</code>çš„æ˜¯è¿™ä¸ªä¸´æ—¶å¯¹è±¡, è€Œä¸æ˜¯å½“å‰å¯¹è±¡çš„åŸºç±»éƒ¨åˆ†, æƒ³è¦çœŸæ­£ä½¿å½“å‰å¯¹è±¡è°ƒç”¨åŸºç±»<code>onResize()</code>, åº”ä»¥å¦‚ä¸‹å†™æ³• : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpecialWindow</span>: <span class="hljs-keyword">public</span> Window &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">onResize</span><span class="hljs-params">()</span> </span>&#123;<br>    Window::<span class="hljs-built_in">onResize</span>();                    <span class="hljs-comment">// è¿™æ ·è°ƒç”¨</span><br>    ...                                   <br>  &#125;<br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><hr><h4 id="è°¨æ…ä½¿ç”¨dynamic-cast"><a href="#è°¨æ…ä½¿ç”¨dynamic-cast" class="headerlink" title="è°¨æ…ä½¿ç”¨dynamic_cast"></a>è°¨æ…ä½¿ç”¨dynamic_cast</h4><p>æˆ‘ä»¬ä¹‹æ‰€ä»¥éœ€è¦<code>dynamic_cast</code>, é€šå¸¸æ˜¯å› ä¸ºæˆ‘ä»¬æ‰‹æŒä¸€ä¸ª<strong>é™æ€ç±»å‹æ˜¯baseè€ŒåŠ¨æ€ç±»å‹æ˜¯derivedçš„æŒ‡é’ˆæˆ–å¼•ç”¨</strong>æ—¶, <strong>æƒ³è¦ä½¿ç”¨åªæœ‰derivedä¸­æœ‰çš„ä¸€ä¸ªæ™®é€šå‡½æ•°</strong>, å› ä¸ºå…¶ä¸æ˜¯è™šå‡½æ•°, æ‰€ä»¥æˆ‘ä»¬ç°åœ¨æ— æƒä½¿ç”¨å®ƒ, åªèƒ½ä¾é <code>dynamic_cast</code>æ¥è¿›è¡Œè¾ƒä¸ºå®‰å…¨çš„è½¬æ¢.</p><p>å‡è®¾æˆ‘ä»¬çš„<code>SpecialWindow</code>æœ‰ä¸€ä¸ªå•ç‹¬çš„é—ªçƒåŠŸèƒ½, æœ‰ä¸€ä¸ª<code>vector</code>ä¸­å­˜æ”¾äº†å¤§é‡çš„<code>Window</code>, æˆ‘ä»¬å¸Œæœ›éå†è¯¥<code>vector</code>, å¦‚æœå…¶åŠ¨æ€ç±»å‹æ˜¯<code>SpecialWindow</code>å°±è°ƒç”¨å…¶é—ªçƒåŠŸèƒ½, ä»£ç å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Window</span> &#123; ... &#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpecialWindow</span>: <span class="hljs-keyword">public</span> Window &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">blink</span><span class="hljs-params">()</span></span>;  <span class="hljs-comment">// ç‰¹æœ‰çš„blinkåŠŸèƒ½</span><br>  ...<br>&#125;;<br><br><span class="hljs-keyword">typedef</span> std::vector&lt;std::shared_ptr&lt;Window&gt; &gt; VPW;  <span class="hljs-comment">// å­˜æ”¾Windowæ™ºèƒ½æŒ‡é’ˆçš„æ•°ç»„</span><br>VPW winPtrs;<br>...<br><span class="hljs-keyword">for</span> (VPW::iterator iter = winPtrs.<span class="hljs-built_in">begin</span>(); iter != winPtrs.<span class="hljs-built_in">end</span>();  ++iter) &#123;<br>  <span class="hljs-comment">// dynamic_castè½¬æ¢æˆåŠŸè¯´æ˜æ˜¯SpecialWindowç±»å‹, pswä¸ä¸ºç©º, åˆ¤true, è°ƒç”¨blink</span><br>  <span class="hljs-comment">// è½¬æ¢å¤±è´¥è¯´æ˜ä¸æ˜¯, pswä¸ºnullptr, åˆ¤false</span><br>  <span class="hljs-keyword">if</span> (SpecialWindow *psw = <span class="hljs-built_in">dynamic_cast</span>&lt;SpecialWindow*&gt;(iter-&gt;<span class="hljs-built_in">get</span>()))<br>     psw-&gt;<span class="hljs-built_in">blink</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ç®—æ˜¯å¯¹<code>dynamic_cast</code>çš„æ—¥å¸¸ç”¨æ³•åšäº†ä¸€ä¸ªä»‹ç», ä½†æ˜¯ä½œè€…å‘Šè¯‰ä½ ä½¿ç”¨<code>dynamic_cast</code>åœ¨å¾ˆå¤šæƒ…å†µå¹¶ä¸å¿…è¦, <strong>èƒ½ä¸ä½¿ç”¨dynamic_castå°±å°½é‡ä¸ä½¿ç”¨</strong>, åŸå› åœ¨äº<code>dynamic_cast</code>ä¸ºäº†å®ç°å®‰å…¨æ€§æ£€æµ‹å’Œå…¶ä»–ä¸€äº›ç›®çš„, æ•ˆç‡ååˆ†ä½ä¸‹, ç›¸æ¯”äºå®ƒçš„å…¶ä»–å‡ ä¸ªå…„å¼Ÿæ•ˆç‡ä¸åªä½äº†ä¸€ç‚¹åŠç‚¹, é™¤éæœ‰<strong>å¿…é¡»æ˜¯å¤šæ€æƒ…å†µä¸‹ç”¨åŸºç±»ä½¿ç”¨æ´¾ç”Ÿç±»æ™®é€šå‡½æ•°çš„åœºæ™¯</strong>, æˆ‘ä»¬å¯ä»¥<strong>åšå‡ºä¸€äº›è®©æ­¥</strong>æ¥æå‡æˆ‘ä»¬çš„æ•ˆç‡, ä¹¦ä¸­ç»™å‡ºäº†ä¸¤ç§æ–¹æ³• : </p><ol><li><p><strong>æ”¾å¼ƒå¤šæ€éœ€æ±‚</strong>, ç¡®ä¿å®¹å™¨å†…åªæœ‰éœ€æ±‚æ´¾ç”Ÿç±»çš„æŒ‡é’ˆ.å…·ä½“æ¥è¯´å°±æ˜¯<code>VPW</code>å†…åªå­˜<code>shared_ptr&lt;SpecialWindow&gt;</code>, è®©<code>blink</code>çš„è°ƒç”¨æ™®éåŒ–.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> std::vector&lt;std::tr1::shared_ptr&lt;SpecialWindow&gt; &gt; VPSW; <span class="hljs-comment">// åªå­˜æ´¾ç”Ÿç±»æ™ºèƒ½æŒ‡é’ˆ</span><br>VPSW winPtrs;<br>...<br><span class="hljs-keyword">for</span> (VPSW::iterator iter = winPtrs.<span class="hljs-built_in">begin</span>(); iter != winPtrs.<span class="hljs-built_in">end</span>(); ++iter)<br>  (*iter)-&gt;<span class="hljs-built_in">blink</span>(); <span class="hljs-comment">// ç›´æ¥è°ƒç”¨</span><br></code></pre></td></tr></table></figure></li><li><p><strong>å°†æ™®é€šå‡½æ•°è½¬ä¸ºvirtualå‡½æ•°</strong>, <strong>ç•¥å¾®å¢åŠ å†™ä»£ç çš„æˆæœ¬</strong>.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Window</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">blink</span><span class="hljs-params">()</span> </span>&#123;&#125;  <span class="hljs-comment">// è¿™é‡Œä»€ä¹ˆéƒ½ä¸åš, å…¶ç›®çš„åªæ˜¯ä¸ºäº†è®©SpecialWindowé€šè¿‡å¤šæ€è°ƒç”¨æœ‰æ•ˆæœçš„blink()</span><br>  ...<br>&#125;;                                            <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpecialWindow</span>: <span class="hljs-keyword">public</span> Window &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">blink</span><span class="hljs-params">()</span> </span>&#123; ... &#125;;                 <br>  ...                                          <br>&#125;;<br><br><span class="hljs-keyword">typedef</span> std::vector&lt;std::tr1::shared_ptr&lt;Window&gt; &gt; VPW;<br>VPW winPtrs;                                    <br>...<br><span class="hljs-keyword">for</span> (VPW::iterator iter = winPtrs.<span class="hljs-built_in">begin</span>();<br>     iter != winPtrs.<span class="hljs-built_in">end</span>();<br>     ++iter)                                  <br>  (*iter)-&gt;<span class="hljs-built_in">blink</span>();  <span class="hljs-comment">// æ­£å¸¸çš„å¤šæ€ç”¨æ³•</span><br></code></pre></td></tr></table></figure></li></ol><p>æœ€åæ€»ç»“ä¸‹æ¥å°±æ˜¯, <strong>åœ¨å‡ºç°dynamic_castéœ€æ±‚åœºæ™¯æ—¶, å¦‚æœä»£ç å¯¹æ•ˆç‡æ²¡æœ‰å¤ªå¤šéœ€æ±‚, ç›´æ¥ä½¿ç”¨dynamic_cast, åä¹‹åˆ™æ€è€ƒæ˜¯å¦èƒ½åšå‡ºä¸Šé¢æ‰€è¯´çš„ä¸¤ç§è®©æ­¥, å¦‚æœå‰ä¸¤ç§è®©æ­¥çš„ä»£ä»·å®åœ¨å¤ªé«˜å†ä½¿ç”¨dynamic_cast</strong>.</p><p>ä¹¦ä¸­è¿˜æŒ‡å‡ºäº†ä¸€ç§åº”å½“æœç»çš„å†™æ³• : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Window</span> &#123; ... &#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpecialWindow1</span> &#123; ... &#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpecialWindow2</span> &#123; ... &#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpecialWindow3</span> &#123; ... &#125;;<br>...                    <br><span class="hljs-keyword">typedef</span> std::vector&lt;std::tr1::shared_ptr&lt;Window&gt; &gt; VPW;<br>VPW winPtrs;<br>...<br><br><span class="hljs-keyword">for</span> (VPW::iterator iter = winPtrs.<span class="hljs-built_in">begin</span>(); iter != winPtrs.<span class="hljs-built_in">end</span>(); ++iter)<br>&#123;<br>  <span class="hljs-keyword">if</span> (SpecialWindow1 *psw1 =<br>       <span class="hljs-built_in">dynamic_cast</span>&lt;SpecialWindow1*&gt;(iter-&gt;<span class="hljs-built_in">get</span>())) &#123; ... &#125;<br>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (SpecialWindow2 *psw2 =<br>            <span class="hljs-built_in">dynamic_cast</span>&lt;SpecialWindow2*&gt;(iter-&gt;<span class="hljs-built_in">get</span>())) &#123; ... &#125;<br>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (SpecialWindow3 *psw3 =<br>            <span class="hljs-built_in">dynamic_cast</span>&lt;SpecialWindow3*&gt;(iter-&gt;<span class="hljs-built_in">get</span>())) &#123; ... &#125;<br>  ...<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·å­çš„ä»£ç , ä¸ä»…æ•ˆç‡ä½, è€Œä¸”å¯ç»´æŠ¤æ€§å·®, æœ€å¥½å°†è¿™ç§éœ€æ±‚<strong>æ”¹å†™æˆæŸç§virtualå‡½æ•°</strong>æ¥å®ç°, ä¸è¦å»ä¾èµ–<code>dynamic_cast</code>.</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li><strong>å°½é‡é¿å…è½¬å‹</strong>, å°¤å…¶åœ¨æ³¨é‡æ•ˆç‡çš„ç¨‹åºä¸­é¿å…<code>dynamic_cast</code>.</li><li>è½¬å‹å¹¶éä»€ä¹ˆéƒ½æ²¡åš, ä¼šäº§ç”Ÿå®é™…çš„èŠ±é”€.</li><li>å¦‚æœè½¬å‹æ˜¯å¿…è¦çš„, <strong>å¯ä»¥æŠŠè½¬å‹è¿‡ç¨‹æ”¾åœ¨ä¸€ä¸ªå‡½æ•°ä¸­</strong>, è®©å®¢æˆ·è°ƒç”¨è¯¥å‡½æ•°ä»¥å®ç°è½¬å‹, è€Œä¸éœ€è¦å°†è½¬å‹å†™å…¥ä»–ä»¬çš„ä»£ç .</li><li>æœ€å¥½ä½¿ç”¨<code>C++</code>é£æ ¼çš„æ–°å¼è½¬å‹.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾26 å°½å¯èƒ½å»¶åå˜é‡å®šä¹‰å¼çš„å‡ºç°æ—¶é—´</title>
    <link href="/2024/12/05/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE26%20%E5%B0%BD%E5%8F%AF%E8%83%BD%E5%BB%B6%E5%90%8E%E5%8F%98%E9%87%8F%E5%AE%9A%E4%B9%89%E5%BC%8F%E7%9A%84%E5%87%BA%E7%8E%B0%E6%97%B6%E9%97%B4/"/>
    <url>/2024/12/05/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE26%20%E5%B0%BD%E5%8F%AF%E8%83%BD%E5%BB%B6%E5%90%8E%E5%8F%98%E9%87%8F%E5%AE%9A%E4%B9%89%E5%BC%8F%E7%9A%84%E5%87%BA%E7%8E%B0%E6%97%B6%E9%97%B4/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾26-å°½å¯èƒ½å»¶åå˜é‡å®šä¹‰å¼çš„å‡ºç°æ—¶é—´"><a href="#æ¡æ¬¾26-å°½å¯èƒ½å»¶åå˜é‡å®šä¹‰å¼çš„å‡ºç°æ—¶é—´" class="headerlink" title="æ¡æ¬¾26 : å°½å¯èƒ½å»¶åå˜é‡å®šä¹‰å¼çš„å‡ºç°æ—¶é—´"></a>æ¡æ¬¾26 : å°½å¯èƒ½å»¶åå˜é‡å®šä¹‰å¼çš„å‡ºç°æ—¶é—´</h2><p>åªè¦ä½ å®šä¹‰äº†ä¸€ä¸ªå˜é‡, å¹¶ä¸”å…¶ç±»å‹å¸¦æœ‰æ„é€ å‡½æ•°æˆ–ææ„å‡½æ•°, é‚£ä¹ˆå½“ç¨‹åºæ§åˆ¶æµåˆ°è¾¾å˜é‡å®šä¹‰å¼æ—¶, ä½ ä¾¿å¾—æ‰¿æ‹…æ„é€ æˆæœ¬; å½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸæ—¶, ä½ ä¾¿å¾—æ‰¿æ‹…ææ„æˆæœ¬. æœ¬æ¡æ¬¾å¸Œæœ›æˆ‘ä»¬é¿å…<strong>å®šä¹‰å˜é‡ä½†æœ€ç»ˆå¹¶æœªä½¿ç”¨</strong>çš„æƒ…å†µ, ä¸è¦ç™½ç™½æµªè´¹æ„é€ å’Œææ„çš„æˆæœ¬.</p><p>å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°å®šä¹‰å˜é‡ä½†æœ€ç»ˆå¹¶æœªä½¿ç”¨ : </p><p>è¿™æ˜¯ä¸€ä¸ªå¯†ç åŠ å¯†çš„å‡½æ•°, ç”±äºå¯†ç æœ¬èº«ä¸èƒ½ä¿®æ”¹, æ‰€ä»¥è¦å®šä¹‰å¹¶è¿”å›ä¸€ä¸ª<code>encryted</code>æ¥è¡¨ç¤º<strong>åŠ å¯†åçš„å¯†ç </strong>.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">string <span class="hljs-title">encryptPassword</span><span class="hljs-params">(<span class="hljs-type">const</span> string&amp; password)</span></span><br><span class="hljs-function"></span>&#123;<br>  string encrypted;<br>  <span class="hljs-keyword">if</span> (password.<span class="hljs-built_in">length</span>() &lt; MinimumPasswordLength) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-built_in">logic_error</span>(<span class="hljs-string">&quot;Password is too short&quot;</span>);<br>  &#125;<br>  ...                        <br>  <span class="hljs-keyword">return</span> encrypted;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°, å½“å¯†ç çš„é•¿åº¦å°äºæœ€å°å€¼æ—¶, æˆ‘ä»¬çš„å‡½æ•°æ— æ³•æä¾›å¯¹åº”çš„æœåŠ¡, æ‰€ä»¥è¦æŠ›å‡ºä¸€ä¸ª<code>logic_error</code>å¼‚å¸¸, ç„¶åå°±ç¦»å¼€è¯¥å‡½æ•°äº†, ä¹Ÿå°±æ˜¯è¯´å…ˆå‰æ„é€ çš„<code>encrypted</code>ç¡®å®æ²¡æœ‰å‘æŒ¥ä»»ä½•ä½œç”¨.</p><p>æ²¡é”™, <code>encrypted</code>å¹¶éå®Œå…¨æœªè¢«ä½¿ç”¨, ä½†æ˜¯ä»ç„¶ä¼šæœ‰æœªè¢«ä½¿ç”¨çš„æƒ…å†µå­˜åœ¨, ä¸ºäº†ä¸æ— ç«¯ä»˜å‡ºæ„é€ å’Œææ„çš„æˆæœ¬, æˆ‘ä»¬åº”å°†å…¶<strong>å®šä¹‰å¼å¾€åç§»</strong>, ä»£ç å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">string <span class="hljs-title">encryptPassword</span><span class="hljs-params">(<span class="hljs-type">const</span> string&amp; password)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span> (password.<span class="hljs-built_in">length</span>() &lt; MinimumPasswordLength) &#123;<br>     <span class="hljs-keyword">throw</span> <span class="hljs-built_in">logic_error</span>(<span class="hljs-string">&quot;Password is too short&quot;</span>);<br>  &#125;<br>  string encrypted;<br>  ...                     <br>  <span class="hljs-keyword">return</span> encrypted;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å‡è®¾è¿˜æœ‰ä¸€ä¸ª<code>encrypt</code>å‡½æ•°, é‡Œé¢é€šè¿‡å¤æ‚çš„ç®—æ³•å°†<code>password</code>åŠ å¯†, é‚£ä¹ˆæˆ‘ä»¬åº”å½“æŠŠ<code>password</code>èµ‹å€¼ç»™<code>encrypted</code>, å†æŠŠ<code>encrypted</code>ä¼ è¿›å», è¿›è€Œä½¿å‡½æ•°ä¿®æ”¹<code>encrypted</code>å®ç°åŠ å¯† : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">string <span class="hljs-title">encryptPassword</span><span class="hljs-params">(<span class="hljs-type">const</span> string&amp; password)</span></span><br><span class="hljs-function"></span>&#123;<br>  ...<br>  string encrypted;         <br>  encrypted = password;  <span class="hljs-comment">// èµ‹å€¼             </span><br><br>  <span class="hljs-built_in">encrypt</span>(encrypted);<span class="hljs-comment">// ä¼ å…¥</span><br>  <span class="hljs-keyword">return</span> encrypted;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œå°±åˆæœ‰å¯ä»¥æå‡æ•ˆç‡çš„åœ°æ–¹äº†, è¿™é‡Œçš„è¡Œä¸ºæ˜¯<code>defalut</code>æ„é€  + èµ‹å€¼, ä½†æ˜¯æˆ‘ä»¬åœ¨æ¡æ¬¾4å°±è®¨è®ºè¿‡ : â€œ<strong>é€šè¿‡defaultæ„é€ å‡½æ•°æ„é€ å‡ºä¸€ä¸ªå¯¹è±¡ç„¶åå¯¹å®ƒèµ‹å€¼æ¯”ç›´æ¥åœ¨æ„é€ æ˜¯æŒ‡å®šåˆå€¼æ•ˆç‡å·®</strong>â€œ, å°±å’Œ<code>vector</code>ä¸­<code>emplace_back</code>æ¯”<code>push_back</code>æ•ˆç‡é«˜ä¸€ä¸ªé“ç†, äºæ˜¯æˆ‘ä»¬å¯ä»¥æœ‰ä»¥ä¸‹çš„æ”¹è‰¯æ“ä½œ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">string <span class="hljs-title">encryptPassword</span><span class="hljs-params">(<span class="hljs-type">const</span> string&amp; password)</span></span><br><span class="hljs-function"></span>&#123;<br>  ...                                   <br>  <span class="hljs-function">string <span class="hljs-title">encrypted</span><span class="hljs-params">(password)</span></span>;     <br>  <span class="hljs-built_in">encrypt</span>(encrypted);<br>  <span class="hljs-keyword">return</span> encrypted;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”±æ­¤æˆ‘ä»¬å†å›é¡¾æœ¬æ¡æ¬¾çš„å†…å®¹ : <strong>å°½å¯èƒ½å»¶åå˜é‡å®šä¹‰å¼çš„å‡ºç°æ—¶é—´</strong>.</p><p>æˆ‘ä»¬å¯ä»¥ç†è§£åˆ°â€å°½å¯èƒ½å»¶åâ€çš„çœŸæ­£æ„ä¹‰, åœ¨äº<strong>æˆ‘ä»¬ä¸åº”å½“åªå»¶åå˜é‡çš„å®šä¹‰, ç›´åˆ°éå¾—ä½¿ç”¨è¯¥å˜é‡çš„å‰ä¸€åˆ»ä¸ºæ­¢, ç”šè‡³åº”è¯¥å°è¯•å»¶åè¿™ä»½å®šä¹‰ç›´åˆ°èƒ½å¤Ÿç»™å®ƒåˆå€¼å®å‚ä¸ºæ­¢</strong>. è¿™æ ·ä¸åªèƒ½<strong>é¿å…æ„é€ éå¿…è¦å¯¹è±¡</strong>, è¿˜èƒ½<strong>é¿å…æ— æ„ä¹‰çš„defalutæ„é€ è¡Œä¸º</strong>. æ›´æ·±ä¸€å±‚è¯´, ä»¥â€å…·æ˜æ˜¾æ„ä¹‰å€¼åˆå€¼â€å°†å˜é‡åˆå§‹åŒ–, è¿˜å¯ä»¥é™„å¸¦è¯´æ˜å˜é‡çš„ç›®çš„, <strong>æé«˜ä»£ç çš„å¯è¯»æ€§</strong>.</p><hr><p>è¿˜æœ‰ä¸€ä¸ªå°é—®é¢˜, å¾ªç¯æ€ä¹ˆåŠ? æˆ‘ä»¬åœ¨å¾ªç¯å¤–å®šä¹‰åªéœ€è¦å®šä¹‰ä¸€æ¬¡, åœ¨å¾ªç¯å†…éœ€è¦å®šä¹‰næ¬¡, å»¶åä¸æ˜¯ä»£ä»·æ›´å¤§å—?</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp">Widget w;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i)&#123;         <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i) &#123;<br>  w = å–å†³äºæŸä¸ªiçš„å€¼;       <span class="hljs-function">Widget <span class="hljs-title">w</span><span class="hljs-params">(å–å†³äºæŸä¸ªiçš„å€¼)</span></span>;<br>  ...                                  ...<br>&#125;                                    &#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åˆ†æä¸¤ç§å†™æ³•çš„æˆæœ¬ : </p><ul><li>å¾ªç¯å¤– : 1æ„é€  + 1ææ„ + nèµ‹å€¼</li><li>å¾ªç¯å†… : næ„é€  + nææ„</li></ul><p>ç¡®å®å°±å®é™…è€Œè¨€, å¾ªç¯å¤–çš„åšæ³•å¤§ä½“æ¯”è¾ƒé«˜æ•ˆ, ä½†è¿™å»ºç«‹åœ¨: </p><ol><li>ä½ çŸ¥é“èµ‹å€¼æ¯”â€æ„é€  + ææ„â€çš„æˆæœ¬ä½çš„æƒ…å†µä¸‹.</li><li>ä½ çš„è¿™éƒ¨åˆ†ä»£ç å¯¹æ•ˆç‡é«˜åº¦æ•æ„Ÿ.</li></ol><p>å¦åˆ™ä½ åº”è¯¥ä½¿ç”¨å¾ªç¯å†…çš„åšæ³•.</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>å°½å¯èƒ½å»¶åå˜é‡å®šä¹‰å¼çš„å‡ºç°. è¿™æ ·æœ‰åŠ©äº<strong>é¿å…æµªè´¹, æå‡æ•ˆç‡, æé«˜ä»£ç å¯è¯»æ€§</strong>.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾25 è€ƒè™‘å†™å‡ºä¸€ä¸ªä¸æŠ›å¼‚å¸¸çš„swapå‡½æ•°</title>
    <link href="/2024/12/04/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE25%20%E8%80%83%E8%99%91%E5%86%99%E5%87%BA%E4%B8%80%E4%B8%AA%E4%B8%8D%E6%8A%9B%E5%BC%82%E5%B8%B8%E7%9A%84swap%E5%87%BD%E6%95%B0/"/>
    <url>/2024/12/04/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE25%20%E8%80%83%E8%99%91%E5%86%99%E5%87%BA%E4%B8%80%E4%B8%AA%E4%B8%8D%E6%8A%9B%E5%BC%82%E5%B8%B8%E7%9A%84swap%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾25-è€ƒè™‘å†™å‡ºä¸€ä¸ªä¸æŠ›å¼‚å¸¸çš„swapå‡½æ•°"><a href="#æ¡æ¬¾25-è€ƒè™‘å†™å‡ºä¸€ä¸ªä¸æŠ›å¼‚å¸¸çš„swapå‡½æ•°" class="headerlink" title="æ¡æ¬¾25 : è€ƒè™‘å†™å‡ºä¸€ä¸ªä¸æŠ›å¼‚å¸¸çš„swapå‡½æ•°"></a>æ¡æ¬¾25 : è€ƒè™‘å†™å‡ºä¸€ä¸ªä¸æŠ›å¼‚å¸¸çš„swapå‡½æ•°</h2><blockquote><p>swap æ˜¯ä¸€ä¸ªæœ‰è¶£çš„å‡½æ•°, åŸæœ¬å®ƒåªæ˜¯STLçš„ä¸€éƒ¨åˆ†, è€Œåæˆä¸ºäº†å¼‚å¸¸å®‰å…¨æ€§ç¼–ç¨‹ä¸­çš„è„ŠæŸ±, æœ‰å…³å¼‚å¸¸å®‰å…¨æ€§æˆ‘åœ¨æ¡æ¬¾11ä¸­ä»‹ç»è¿‡, åœ¨ä¹‹åçš„æ¡æ¬¾29ä¸­ä¹Ÿå°†ç€é‡ç€å¢¨. ç”±äºswapç›¸å½“æœ‰ç”¨, é€‚å½“çš„å®ç°éå¸¸é‡è¦, å¥½çš„swapè®¾è®¡å¯ä»¥å¸¦æ¥éå‡¡çš„æ•ˆç‡æå‡.</p></blockquote><p>swapé¡¾åæ€ä¹‰, æ„ä¸ºå°†ä¸¤å¯¹è±¡çš„å€¼å½¼æ­¤èµ‹äºˆå¯¹æ–¹, åœ¨ç°ä»£æ ‡å‡†åº“ä¸­çš„å®ç°æ˜¯è¿™æ · : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">namespace</span> std &#123;<br>    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(T&amp; a, T&amp; b)</span> <span class="hljs-keyword">noexcept</span> </span>&#123;<br>        T temp = std::<span class="hljs-built_in">move</span>(a);  <span class="hljs-comment">// ä½¿ç”¨ç§»åŠ¨æ‹·è´ä¼šå¤§å¤§æé«˜æ•ˆç‡ä¸”ä¸æŠ›å‡ºå¼‚å¸¸</span><br>        a = std::<span class="hljs-built_in">move</span>(b);<br>        b = std::<span class="hljs-built_in">move</span>(temp);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºè¿™åªæ˜¯ç®€å•çš„ç§»åŠ¨æ‹·è´è€Œå·², è€Œæˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨ä¸€ä¸ªæ‰‹æ³•å«åš<code>pimpl idiom</code>, å…¶â€<strong>ä»¥æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå¯¹è±¡, å†…æ¶µçœŸæ­£çš„æ•°æ®</strong>â€œ, è¿™ç§æ‰‹æ³•æ„åœ¨å°†æ•°æ®ç®¡ç†å’Œæ“ä½œç®¡ç†è§£è€¦, å¯ä»¥è¿›è¡Œæ›´æœ‰æ•ˆçš„è®¾è®¡, è€Œè¿™ç§ç±»è°ƒç”¨æ ‡å‡†åº“çš„<code>std::swap</code>å¾€å¾€æ˜¯æ•ˆç‡ä½ä¸‹çš„, ä¹¦ä¸­ç»™å‡ºçš„ä»£ç å¦‚ä¸‹:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WidgetImpl</span> &#123;                          <span class="hljs-comment">// ä¿å­˜Widgetçš„æ•°æ®</span><br><span class="hljs-keyword">public</span>:                                    <br>  ...<br><span class="hljs-keyword">private</span>:<br>  <span class="hljs-type">int</span> a, b, c;                            <br>  std::vector&lt;<span class="hljs-type">double</span>&gt; v;                  <br>  ...<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Widget</span> &#123;                              <span class="hljs-comment">// æ—¥å¸¸ä½¿ç”¨çš„Widget</span><br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-built_in">Widget</span>(<span class="hljs-type">const</span> Widget&amp; rhs);<br>  ...<br><span class="hljs-keyword">private</span>:<br>  WidgetImpl *pImpl;                         <span class="hljs-comment">// ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æ•°æ®</span><br>&#125;;           <br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬è°ƒç”¨æ ‡å‡†åº“ä¸­çš„<code>std::swap</code>, å…¶æ¶ˆè€—æ˜¯<strong>ä¸‰æ¬¡ç§»åŠ¨æ‹·è´å¹¶ä¸”è¿˜æœ‰å¯èƒ½å¤šä½™åœ°æ‹·è´åŒæ–¹çš„åº•å±‚èµ„æº</strong>, æœ‰å¯èƒ½äº§ç”Ÿæ›´å¤§çš„èŠ±é”€, æ‰€ä»¥æˆ‘ä»¬å¸Œæœ›è‡ªå®šä¹‰çš„<code>swap</code>å¯ä»¥åªäº¤æ¢<code>pImpl</code>çš„æŒ‡é’ˆå³å¯.</p><p>ç°åœ¨æˆ‘ä»¬ç°åœ¨éœ€è¦é‡æ–°æ‹Ÿå®šä¸€ä¸‹æˆ‘ä»¬çš„ç›®æ ‡, å…¶ä¸€<strong>ç¡®ä¿æˆ‘ä»¬çš„swapå‡½æ•°ä¸æŠ›å¼‚å¸¸</strong>, è¿™æ˜¯ä¸ºäº†å…¶åœ¨å¼‚å¸¸å®‰å…¨æ€§ä¸Šçš„åŠŸèƒ½å¾—ä»¥å®ç°; å…¶äºŒ<strong>è®©å…¶ä»–äººè°ƒç”¨swapæ—¶éƒ½èƒ½å–å¾—æˆ‘ä»¬æä¾›çš„é«˜æ•ˆçš„ç‰ˆæœ¬</strong>.</p><hr><p>å‰è€…åªéœ€æˆ‘ä»¬è®°å¾—ä¸åšæœ‰å¼‚å¸¸é£é™©çš„ä¸¾åŠ¨å°±è¡Œäº†, ä½†æ˜¯åœ¨<code>C++11</code>å·²ç»æ¨è¡Œçš„å½“ä¸‹, æˆ‘ä»¬è¿˜åº”<strong>å¿…é¡»</strong>ç»™æˆ‘ä»¬çš„å‡½æ•°è´´å¿ƒåœ°åŠ ä¸Š<code>noexpect</code>æ ‡è¯†ç¬¦, ç”¨æ¥å¯¹ç¼–è¯‘å™¨ä¿è¯è¯¥å‡½æ•°ç»ä¸ä¼šæŠ›å‡ºå¼‚å¸¸, <strong>ç¼–è¯‘å™¨ä¹Ÿä¼šå›åº”ä½ çš„ä¿è¯, åˆ å»é’ˆå¯¹è¯¥å‡½æ•°çš„å¼‚å¸¸å¤„ç†, ä½¿æ•ˆç‡æé«˜</strong>. </p><hr><p>ç°åœ¨å¼€å§‹åˆ†æåè€…, è¿™é‡Œæˆ‘ä»¬è¦çŸ¥é“ä¸€ä¸ªå‰æ, å¤§å¤šæ•°ç”¨æˆ·è°ƒç”¨<code>swap</code>å…¶å®éƒ½æ˜¯ä»¥æ ‡å‡†åº“ä¸­çš„å½¢å¼æ¥è°ƒç”¨çš„, ä¹Ÿå°±æ˜¯è¯´ä¸ä¼šé€šè¿‡å¯¹è±¡è°ƒç”¨<code>swap</code>æˆå‘˜å‡½æ•°, è€Œæ˜¯éƒ½æ˜¯<code>swap(lhs, rhs)</code>è¿™æ ·çš„å½¢å¼, ç°åœ¨å…ˆç ”ç©¶åœ¨<code>C++98</code>ç‰ˆæœ¬ä¸‹å¦‚ä½•è§£å†³ :</p><p>ä¹¦ä¸­ç»™å‡ºçš„æ­¥éª¤å¦‚ä¸‹:</p><ol><li>åƒæˆ‘ä»¬å…ˆå‰ä¸€æ ·å†™ä¸€ä¸ªå®Œç¾çš„ä¸æŠ›å¼‚å¸¸çš„<code>swap</code>æˆå‘˜å‡½æ•°.</li><li>åœ¨è¯¥<code>class</code>çš„å‘½åç©ºé—´ä¸‹å†™ä¸€ä¸ª<code>non-member swap</code>å‡½æ•°, å¹¶ä½¿å®ƒè°ƒç”¨è¯¥<code>class</code>çš„æˆå‘˜å‡½æ•°.</li><li>æœ€åå¦‚æœä½ çš„<code>class</code>ä¸æ˜¯<code>class template</code>(æ¨¡æ¿ç±»), ä¸ºä½ çš„<code>class</code>å…¨ç‰¹åŒ–<code>std::swap</code>.</li></ol><p>æˆ‘ä»¬æ¥è§£é‡Šä¸ºä»€ä¹ˆè¦å†™ä¸‰ä¸ªå‡½æ•°, å³<strong>member + non-member + stdå…¨ç‰¹åŒ–</strong> :</p><p>ç®€å•æ¥è¯´å°±æ˜¯ä½¿åœ¨å®¢æˆ·è°ƒç”¨<code>swap(a, b)</code>æ—¶, å¦‚æœè¿™ä¸ªå‡½æ•°åœ¨<code>WidgetStuff</code>å‘½åç©ºé—´ä¸­, å°±ä¼šç›´æ¥åŒ¹é…<code>non-member</code>ç‰ˆæœ¬, è¿›è€Œè°ƒç”¨ç›¸åŒå‘½åç©ºé—´ä¸‹çš„<code>member</code>ç‰ˆæœ¬, ä¸ä¼šå› ä¸ºå‚æ•°ä¸åŒ¹é…è€Œæ²¡æœ‰è°ƒç”¨åˆ°<code>member</code>ç‰ˆæœ¬. è€Œå½“å®¢æˆ·è°ƒç”¨æ ‡å‡†åº“<code>swap</code>æ—¶, ç”±äºæ¨¡æ¿å…¨ç‰¹åŒ–, ä¹Ÿä¼šè‡ªåŠ¨è°ƒç”¨<code>member</code>ç‰ˆæœ¬.è¿™æ ·å°±æå¤§ç¨‹åº¦ä¸Šä½¿å¾—è°ƒç”¨åˆ°çš„ç‰ˆæœ¬éƒ½æ˜¯æˆ‘ä»¬çš„ç‰¹åŒ–ç‰ˆæœ¬.</p><p>ç”±ä¸Šé¢ä¸Šè¿°æ„æˆçš„æœ€ç»ˆæ–¹æ¡ˆå¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">namespace</span> WidgetStuff &#123;  <span class="hljs-comment">// Widgetæ‰€åœ¨çš„å‘½åç©ºé—´</span><br>  ...                                   <br>  <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;      <br>  <span class="hljs-keyword">class</span> <span class="hljs-title class_">Widget</span> &#123; <br>  <span class="hljs-keyword">public</span>:<br>    ...<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(Widget&amp; other)</span>  </span>&#123; <br>            <span class="hljs-keyword">using</span> std::swap;   <span class="hljs-comment">// ä¸‹é¢è§£é‡ŠåŸå› </span><br>        <span class="hljs-built_in">swap</span>(pImpl, other.pImpl); <br>    &#125;<br>    ...<br>  &#125;;  <br>  ...<br>  <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;    </span><br><span class="hljs-function">  <span class="hljs-type">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(Widget&lt;T&gt;&amp; a, Widget&lt;T&gt;&amp; b)</span>   <span class="hljs-comment">// non-member                                      </span></span><br><span class="hljs-function">  </span>&#123;<br>    a.<span class="hljs-built_in">swap</span>(b);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">namespace</span> std &#123;<br>  <span class="hljs-keyword">template</span>&lt;&gt;                       <span class="hljs-comment">// å¯¹äºswapé’ˆå¯¹Widgetç±»å‹çš„å…¨ç‰¹åŒ–</span><br>  <span class="hljs-type">void</span> <span class="hljs-built_in">swap</span>&lt;Widget&gt;(Widget&amp; a, Widget&amp; b)<br>  &#123;<br>    a.<span class="hljs-built_in">swap</span>(b);                 <br>  &#125;                                <br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œè¦è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆ<code>member</code>ç‰ˆæœ¬ä¸­è¦åŠ <code>using std::swap;</code>è€Œä¸æ˜¯ç›´æ¥ç”¨<code>std::swap(pImpl, other.pImpl)</code>, å› ä¸ºä¸å¿…å†™æ­»åªç”¨æ ‡å‡†åº“, <code>pImpl</code>ä¹Ÿæœ‰å¯èƒ½æ˜¯æœ‰è‡ªå®šä¹‰<code>swap</code>å‡½æ•°çš„ç±»å¯¹è±¡, è¿™æ ·å­å¯ä»¥<strong>è®©ç¼–è¯‘å™¨ä¼˜å…ˆé€‰æ‹©ç±»çš„è‡ªå®šä¹‰swap</strong>, å¹¶ä¸”é€šè¿‡<code>using std::swap;</code>æš´éœ²äº†æ ‡å‡†åº“æ¥å£, <strong>åœ¨æ²¡æœ‰è‡ªå®šä¹‰çš„æƒ…å†µä¸‹æœ€åä¹Ÿä¼šé€‰æ‹©æ ‡å‡†åº“ç‰ˆæœ¬</strong>.</p><hr><p>ä»¥ä¸Šæ˜¯<code>C++98</code>ç‰ˆæœ¬çš„è§£å†³æ–¹æ³•, ä½†åœ¨<code>C++11</code>å·²ç»å¼•å…¥çš„å½“ä¸‹, æ¨å‡ºäº†ä¸€ä¸ªæ–°çš„æœºåˆ¶<strong>å‚æ•°ä¾èµ–æŸ¥æ‰¾ (ADL, Argument-Dependent Lookup)</strong>, è¿™ä¸ªæœºåˆ¶ç®€å•æ¥è¯´å°±æ˜¯åœ¨<code>C++98</code>æ—¶çš„å‡½æ•°æŸ¥æ‰¾æœºåˆ¶éƒ½<strong>åªæ˜¯åœ¨å½“å‰ä½œç”¨åŸŸæˆ–usingå£°æ˜ä¸­æŸ¥æ‰¾</strong>,  <strong>è€ŒADLå¯ä»¥é€šè¿‡å‚æ•°çš„ç±»å‹å°†è¯¥ç±»å‹æ‰€åœ¨çš„å‘½åç©ºé—´çº³å…¥æŸ¥æ‰¾èŒƒå›´</strong>. è¿™å¯¹æˆ‘ä»¬ä¸Šè¿°çš„è§£å†³åŠæ³•æœ‰ä½•åŠ©ç›Š? ç­”æ¡ˆæ˜¯æˆ‘ä»¬ä¸éœ€è¦æ‰§è¡Œç¬¬ä¸‰æ­¥äº†, ä¹Ÿå°±æ˜¯è¯´å¯ä»¥æ”¾å¼ƒå¯¹<code>std::swap</code>çš„å…¨ç‰¹åŒ–äº†.</p><p>åœ¨C++98çš„æƒ…å†µä¸‹, å¦‚æœå½“å‰ä½œç”¨åŸŸä¸­æ²¡æœ‰<code>non-member</code>ç‰ˆæœ¬, å°±ä¸€å®šä¼šå›åˆ°ä½¿ç”¨æ ‡å‡†åº“çš„æƒ…å†µ, æ‰€ä»¥å¯¹<code>std::swap</code>è¿›è¡Œå…¨ç‰¹åŒ–æ˜¯æœ‰å¿…è¦çš„. è€Œ<code>ADL</code>å¯ä»¥é€šè¿‡å‚æ•°ç±»å‹å¼•å…¥ä½œç”¨åŸŸ, åªè¦<code>non-member</code>ç‰ˆæœ¬å’Œ<code>member</code>ç‰ˆæœ¬åœ¨åŒä¸€å‘½åç©ºé—´ä¸‹, å°±ä¸€å®šå¯ä»¥è°ƒç”¨æˆåŠŸ, å°±æ˜¯è¯´<strong>åªè¦ä½ è®¤çœŸå®ç°äº†å‰ä¸¤æ­¥, å°±ä¸€å®šä¸ä¼šåœ¨å‘ç”Ÿè°ƒç”¨æ ‡å‡†åº“<code>swap</code>çš„æƒ…å†µ</strong>, æˆ‘ä»¬å¯¹æ ‡å‡†åº“swapçš„éœ€æ±‚å°±å·²ç»é™ä½åˆ°äº†åªéœ€è¦é»˜è®¤ç‰ˆæœ¬çš„ç¨‹åº¦, ä¸éœ€è¦ä»»ä½•çš„ç‰¹åŒ–, æ‰€è°“çš„ç‰¹åŒ–å·²ç»æˆä¸ºâ€98å¾€äº‹â€äº†, ä»£ç å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">namespace</span> WidgetStuff &#123;  <span class="hljs-comment">// Widgetæ‰€åœ¨çš„å‘½åç©ºé—´</span><br>  ...                                   <br>  <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;      <br>  <span class="hljs-keyword">class</span> <span class="hljs-title class_">Widget</span> &#123; <br>  <span class="hljs-keyword">public</span>:<br>    ...<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(Widget&amp; other)</span> <span class="hljs-keyword">noexcept</span> </span>&#123; <br>            <span class="hljs-keyword">using</span> std::swap;   <span class="hljs-comment">// ä¸Šé¢å·²ç»è§£é‡ŠåŸå› </span><br>        <span class="hljs-built_in">swap</span>(pImpl, other.pImpl); <br>    &#125;<br>    ...<br>  &#125;;  <br>  ...<br>  <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;    </span><br><span class="hljs-function">  <span class="hljs-type">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(Widget&lt;T&gt;&amp; a, Widget&lt;T&gt;&amp; b)</span> <span class="hljs-keyword">noexcept</span>   <span class="hljs-comment">// non-member                                      </span></span><br><span class="hljs-function">  </span>&#123;<br>    a.<span class="hljs-built_in">swap</span>(b);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ä¸ºäº†ç¬¦åˆ<code>C+11</code>ç‰ˆæœ¬, æˆ‘ä»¬æ–°åŠ äº†<code>noexcept</code>å…³é”®å­—, æ·»åŠ çš„åŸå› ä¸Šæ–‡å·²ç»è¯´æ˜.</p><hr><p>è¿™æ¬¡æˆ‘åŸºäº<code>C++11</code>çš„æ–°å¢æœºåˆ¶å¯¹ä¹¦ä¸­æ¡æ¬¾çš„è§£è¯»åšå‡ºäº†æ¯”è¾ƒå¤§çš„å˜åŒ–, è®©å…¶æ›´é€‚åº”2024å¹´çš„ç°åœ¨, å†™äº†å¾ˆå¤šåŸæœ¬ä¹¦ä¸­æ²¡æœ‰çš„å†…å®¹, å¯èƒ½ä¼šæœ‰è‡ªå·±è€ƒè™‘ä¸å‘¨çš„åœ°æ–¹, æ¬¢è¿è¯„è®ºæŒ‡æ­£!</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li><strong>å½“std::swapå¯¹ä½ çš„ç±»å‹æ•ˆç‡ä¸é«˜æ—¶, æä¾›swapçš„memberç‰ˆæœ¬å’Œnon-memberç‰ˆæœ¬, ç¡®å®šè¿™ä¸¤ä¸ªå‡½æ•°ä¸æŠ›å‡ºå¼‚å¸¸, å¹¶ä¸”æ ‡æ˜noexpect</strong>.</li><li>å¦‚æœä½ çš„ç‰ˆæœ¬è¿˜åœ¨<code>C++98</code>, å¯èƒ½è¿˜è¦è€ƒè™‘å¤šæä¾›å¯¹<code>std::swap</code>çš„å…¨ç‰¹åŒ–.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾24 ç±»å‹è½¬æ¢ä¸non-memberå‡½æ•°</title>
    <link href="/2024/12/03/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE24-%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E4%B8%8Enon-member%E5%87%BD%E6%95%B0/"/>
    <url>/2024/12/03/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE24-%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E4%B8%8Enon-member%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾24-è‹¥æ‰€æœ‰å‚æ•°çš†éœ€ç±»å‹è½¬æ¢-è¯·ä¸ºæ­¤é‡‡ç”¨non-memberå‡½æ•°"><a href="#æ¡æ¬¾24-è‹¥æ‰€æœ‰å‚æ•°çš†éœ€ç±»å‹è½¬æ¢-è¯·ä¸ºæ­¤é‡‡ç”¨non-memberå‡½æ•°" class="headerlink" title="æ¡æ¬¾24: è‹¥æ‰€æœ‰å‚æ•°çš†éœ€ç±»å‹è½¬æ¢, è¯·ä¸ºæ­¤é‡‡ç”¨non-memberå‡½æ•°"></a>æ¡æ¬¾24: è‹¥æ‰€æœ‰å‚æ•°çš†éœ€ç±»å‹è½¬æ¢, è¯·ä¸ºæ­¤é‡‡ç”¨non-memberå‡½æ•°</h2><blockquote><p>è™½ç„¶ä»¤classesæ”¯æŒéšå¼ç±»å‹è½¬æ¢æ˜¯ä¸€ä¸ªåä¸»æ„, ä½†å¸¸å¸¸æœ‰è®¸å¤šæ„å¤–å‡ºç°, æœ‰äº›ç±»å‹ä¹‹é—´çš„å…³è”å®åœ¨å¤ªå¼º, æˆ‘ä»¬ç»å¸¸æƒ³æŠŠå®ƒä»¬æ”¾åœ¨ä¸€èµ·ç”¨,       ä¾‹å¦‚æ”¯æŒintç±»å‹éšå¼è½¬æ¢ä¸ºRational(æœ‰ç†æ•°), å½“å¯¹ä¾¿åˆ©æ€§çš„éœ€æ±‚éå¸¸å¼ºçƒˆä¹‹å, ä¹Ÿè®¸æ”¯æŒéšå¼ç±»å‹è½¬æ¢ä¹Ÿæœªå¿…æ˜¯åäº‹.</p></blockquote><p>ä¹¦ä¸­ç»™å‡ºäº†ä¸€ä¸ª<code>Rational</code>ç±», å®ƒå¯ä»¥ç”±<code>int</code>ç±»å‹éšå¼è½¬åŒ–è€Œæ¥ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rational</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-built_in">Rational</span>(<span class="hljs-type">int</span> numerator = <span class="hljs-number">0</span>,        <span class="hljs-comment">// è¿™é‡Œæ²¡æœ‰åŠ explicit</span><br>           <span class="hljs-type">int</span> denominator = <span class="hljs-number">1</span>);     <span class="hljs-comment">// ä¼ å…¥intç±»å‹å¯éšå¼è½¬æ¢ä¸ºåˆ†æ¯æ˜¯1çš„Rationalç±»å‹</span><br><br>  <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">numerator</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;             <span class="hljs-comment">// è·å–åˆ†å­</span><br>  <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">denominator</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;           <span class="hljs-comment">// è·å–åˆ†æ¯  // è§æ¡æ¬¾22</span><br><br><span class="hljs-keyword">private</span>:<br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¸€å®šå¸Œæœ›<code>Rational</code>ç±»å‹å¯ä»¥å’Œintç±»å‹ç›¸ä¹˜, æ‰€ä»¥æˆ‘ä»¬æ¥å†™ä¸€ä¸ªæˆå‘˜å‡½æ•° : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rational</span> &#123;<br><span class="hljs-keyword">public</span>:<br>...<br><span class="hljs-type">const</span> Rational <span class="hljs-keyword">operator</span>*(<span class="hljs-type">const</span> Rational&amp; rhs) <span class="hljs-type">const</span><br>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Rational</span>(<span class="hljs-keyword">this</span>-&gt;<span class="hljs-built_in">numerator</span>() * rhs.<span class="hljs-built_in">numerator</span>(),<br>                       <span class="hljs-keyword">this</span>-&gt;<span class="hljs-built_in">denominator</span>() * rhs.<span class="hljs-built_in">denominator</span>());<br>&#125;<br>    ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>æœ‰äº†ä»¥ä¸Šçš„å‡½æ•°, æˆ‘ä»¬çœ‹çœ‹èƒ½é€šè¿‡å“ªäº›ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">Rational <span class="hljs-title">oneEighth</span><span class="hljs-params">(<span class="hljs-number">1</span>, <span class="hljs-number">8</span>)</span></span>;<br><span class="hljs-function">Rational <span class="hljs-title">oneHalf</span><span class="hljs-params">(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)</span></span>;<br>Rational result = oneHalf * oneEighth;            <span class="hljs-comment">// fine</span><br>result = result * oneEighth;                      <span class="hljs-comment">// fine</span><br><br>result = oneHalf * <span class="hljs-number">2</span>;                           <span class="hljs-comment">// fine</span><br>result = <span class="hljs-number">2</span> * oneHalf;                             <span class="hljs-comment">// error!</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°æœ€åä¸€ä¸ªä¾‹å­æ— æ³•é€šè¿‡ç¼–è¯‘, åŸå› å¾ˆå®¹æ˜“ç†è§£, è®©æˆ‘ä»¬é‡å†™ä¸€ä¸‹ä¸Šè¿°ä¸¤ä¸ªå¼å­ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp">result = oneHalf.<span class="hljs-keyword">operator</span>*(<span class="hljs-number">2</span>);                    <span class="hljs-comment">// fine</span><br>result = <span class="hljs-number">2.</span><span class="hljs-keyword">operator</span>*(oneHalf);                    <span class="hljs-comment">// 2è¿˜æ²¡éšå¼è½¬æ¢, æ€ä¹ˆå¯èƒ½ä½¿ç”¨operator*</span><br></code></pre></td></tr></table></figure><p>å› æ­¤æˆ‘ä»¬æœ‰äº†è¿™æ ·çš„æ¨è®º : <strong>åªæœ‰å½“å‚æ•°è¢«åˆ—äºå‚æ•°åˆ—å†…, è¿™ä¸ªå‚æ•°æ‰æ˜¯éšå¼è½¬æ¢çš„åˆæ ¼å‚ä¸è€…</strong>.</p><p>è‡³äºâ€è¢«è°ƒç”¨ä¹‹æˆå‘˜å‡½æ•°æ‰€éš¶å±çš„å“ªä¸ªå¯¹è±¡â€, å³<strong>thiså¯¹è±¡</strong>, ç»ä¸æ˜¯éšå¼è½¬æ¢çš„åˆæ ¼å‚ä¸è€….</p><p>ä¸ºäº†æ”¯æŒè¿™æ ·çš„æ··åˆç®—æœ¯è¿ç®—, å¯è¡Œä¹‹é“æ‹¨äº‘è§æ—¥ : </p><p><strong>è®©operator*æˆä¸ºä¸€ä¸ªnon-memberæˆå‘˜å‡½æ•°</strong>, å³å¯è®©ç¼–è¯‘å™¨åœ¨æ¯ä¸€ä¸ªå®å‚ä¸Šæ‰§è¡Œéšå¼ç±»å‹è½¬æ¢. </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rational</span> &#123;<br>  ... <br>&#125;;<br><br><span class="hljs-type">const</span> Rational <span class="hljs-keyword">operator</span>*(<span class="hljs-type">const</span> Rational&amp; lhs,     <span class="hljs-comment">// non-member</span><br>                         <span class="hljs-type">const</span> Rational&amp; rhs) <br>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Rational</span>(lhs.<span class="hljs-built_in">numerator</span>() * rhs.<span class="hljs-built_in">numerator</span>(),<br>                  lhs.<span class="hljs-built_in">denominator</span>() * rhs.<span class="hljs-built_in">denominator</span>());<br>&#125;<br><span class="hljs-comment">//-----------------------//</span><br><span class="hljs-function">Rational <span class="hljs-title">oneFourth</span><span class="hljs-params">(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>)</span></span>;<br>Rational result;<br>result = oneFourth * <span class="hljs-number">2</span>;                           <span class="hljs-comment">// fine</span><br>result = <span class="hljs-number">2</span> * oneFourth;                           <span class="hljs-comment">// fine</span><br></code></pre></td></tr></table></figure><p>é—®é¢˜è§£å†³, çš†å¤§æ¬¢å–œ. æœ‰äº†ä»¥ä¸Šçš„ç»éªŒ, æˆ‘ä»¬åœ¨çœ‹åˆ«äººä»£ç æ—¶, å°±ä¸ä¼šå¥‡æ€ªäºä¸ºä»€ä¹ˆæ€»æ˜¯è¦æŠŠåŒç›®è¿ç®—ç¬¦çš„é‡è½½éƒ½æ”¾åœ¨ç±»å¤–ä½œä¸º<code>non-member</code>å®šä¹‰äº†, è¯´æ˜ä»–ä»¬ä¹Ÿæ·±è°™ä¸Šè¿°çš„é“ç†, ä¹Ÿè®¸æœ‰æ—¶å¹¶æ²¡æœ‰éšå¼è½¬æ¢çš„éœ€æ±‚å¤§å®¶è¿˜æ˜¯è¿™æ ·å†™, å¯èƒ½æ˜¯å› ä¸ºä¹ æƒ¯äº†.</p><hr><p>æœ‰äººå¯èƒ½è®¤ä¸º<code>operator*</code>å¯ä»¥ä½œä¸ºå‹å…ƒä¸<code>Rational</code>ç±»åŠ å¼ºè”ç³», ä½†å®Œå…¨æ²¡å¿…è¦, é™¤éå®ƒè¦è°ƒç”¨<code>Rational</code>çš„<code>private</code>æ•°æ®, ä¸ç„¶è¿™æ ·åªä¼šé™ä½å…¶å°è£…æ€§(è§æ¡æ¬¾23), æˆ‘ä»¬<strong>ä¸åº”å½“åªå› å‡½æ•°ä¸è¯¥æˆä¸ºmember, å°±è‡ªåŠ¨è®©å®ƒæˆä¸ºfriend</strong>.</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>å¦‚æœä½ éœ€è¦ä¸ºæŸä¸ªå‡½æ•°çš„æ‰€æœ‰å‚æ•°è¿›è¡Œç±»å‹è½¬æ¢, é‚£ä¹ˆè¿™ä¸ªå‡½æ•°å¿…é¡»æ˜¯ä¸ª<code>non-member</code>.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç“¦å°”ç™»æ¹–è¯»ä¹¦æ‘˜å½•(1)</title>
    <link href="/2024/12/02/%E7%93%A6%E5%B0%94%E7%99%BB%E6%B9%96%E8%AF%BB%E4%B9%A6%E6%91%98%E5%BD%95(1)/"/>
    <url>/2024/12/02/%E7%93%A6%E5%B0%94%E7%99%BB%E6%B9%96%E8%AF%BB%E4%B9%A6%E6%91%98%E5%BD%95(1)/</url>
    
    <content type="html"><![CDATA[<ul><li><p>äººåªæœ‰æƒ³èµ·è‡ªå·±çš„æ— çŸ¥æ‰èƒ½æœ‰é•¿è¿›, ä½†ä»–å¦‚æ­¤å¿™ç¢Œäºè¿ç”¨è‡ªå·±å·²æœ‰çš„çŸ¥è¯†, åˆå¦‚ä½•èƒ½æƒ³å¾—èµ·æ¥å‘¢?</p></li><li><p>å—åˆ¶äºå¯¹è‡ªå·±çš„çœ‹æ³•, å—åˆ¶äºä»–é€šè¿‡è‡ªå·±è¡ŒåŠ¨æ‰€èµ¢å¾—çš„åèª‰.</p></li><li><p>å¤§å®¶å¥½åƒéƒ½é€‰æ‹©äº†ç›¸åŒçš„ç”Ÿæ´»æ¨¡å¼, å¥½åƒè¿™ç§æ¨¡å¼æ˜¯åœ¨ä»–ä»¬æ¸…é†’æ—¶åšå‡ºçš„é€‰æ‹©, ç„¶è€Œå…¶å®ä»–ä»¬å¹¶ä¸è®¤ä¸ºè¿˜æœ‰å…¶ä»–æ¨¡å¼å¯é€‰, ä½†èªæ•è€Œå¥åº·çš„äººè®°å¾—å¤ªé˜³æ¯å¤©éƒ½ä¼šå‡èµ·.</p></li><li><p>æ‰€æœ‰çš„æ”¹å˜éƒ½æ˜¯å¥‡è¿¹, ä½†è¿™ç§å¥‡è¿¹æ—¶æ—¶åˆ»åˆ»éƒ½åœ¨å‘ç”Ÿ.</p></li><li><p>åœ¨å½“å‰çš„å¢ƒå†µä¸­æ‰¾åˆ°ä»–ä»¬çš„å‹‡æ°”å’Œçµæ„Ÿ, æ€€ç€æ‹äººèˆ¬çš„æ€œçˆ±å’Œçƒ­æƒ…, çæƒœç€æ­¤æ—¶æ­¤åˆ»çš„ç”Ÿæ´».</p></li><li><p>æ²¡æœ‰äººä¼šå› ä¸ºè¡£æœä¸Šæœ‰è¡¥ä¸è€Œæ˜¾å¾—å‘è´±.ç„¶è€Œæˆ‘æ•¢è¯´, æ™®éè€Œè¨€, äººä»¬è¿½æ±‚è¡£æœæ—¶é«¦æˆ–è€…è‡³å°‘å¹²å‡€å¹¶ä¸”æ²¡æœ‰è¡¥ä¸çš„å¿ƒæƒ…, è¿œæ¯”è¿½æ±‚è‰¯çŸ¥å®Œæ•´æ— æŸçš„å¿ƒæƒ…è¦è¿«åˆ‡.</p></li><li><p>å•†å“çš„ä»·æ ¼å°±æ˜¯ä½ ç”¨æ¥æ¢å®ƒçš„é‚£éƒ¨åˆ†ç”Ÿå‘½.</p></li><li><p>è®©ç¾¤ä¼—çƒ­åˆ‡åœ°è·Ÿé£çš„æ—¶å°šå…¶å®éƒ½æ˜¯å¥¢é¡æµªè´¹çš„äººè®¾å®šçš„.</p></li><li><p>æœ€å¥½çš„è‰ºæœ¯ä½œå“åº”è¯¥è¡¨ç°äººå¦‚ä½•å¥‹æ–—ç€å°†è‡ªå·±ä»è¿™ç§å¢ƒå†µä¸­è§£æ”¾å‡ºæ¥, ä½†æˆ‘ä»¬çš„è‰ºæœ¯å´åªè‡´åŠ›äºä½¿æŸç§å¢ƒç•Œå˜å¾—èˆ’é€‚, å¹¶è®©äººå¿˜è®°æ›´é«˜çº§çš„å¢ƒç•Œ.</p></li><li><p>åœ¨ç”¨ç¾ä¸½çš„ç‰©å“è£…é¥°æˆ¿å­ä¹‹å‰, æˆ‘ä»¬å¿…é¡»æ¸…ç†å¢™å£, æ¸…ç†æˆ‘ä»¬çš„ç”Ÿæ´», è¿˜å¿…é¡»æœ‰ç¾ä¸½çš„å®¶åŠ¡ç®¡ç†å’Œç¾ä¸½çš„ç”Ÿæ´»æ–¹å¼åšåŸºç¡€.</p></li><li><p>å¯¹äºç”Ÿæ´», å¤§å­¦ç”Ÿä¸åº”æŠ±ç€ç©ä¹çš„æ€åº¦, ä¹Ÿä¸åº”åªæ˜¯ç ”ç©¶å®ƒ, è€Œæ˜¯è‡ªå§‹è‡³ç»ˆçœŸè¯šåœ°å»è¿‡å¥½å®ƒ.</p></li><li><p>æˆ‘ç›¼æœ›æ¯ä¸ªäººéƒ½èƒ½éå¸¸æ¸…é†’åœ°å»å‘ç°å’Œè¿½æ±‚ä»–è‡ªå·±çš„ç”Ÿæ´»æ–¹å¼.</p></li><li><p>åšå¥½äº‹, åšäººä»¬å¸¸è¯´çš„å¥½äº‹, ç»ä¸åº”æˆä¸ºæˆ‘äººç”Ÿçš„ä¸»è¦ç›®æ ‡, è€Œä¸”åŸºæœ¬ä¸Šç»ä¸åº”åˆ»æ„ä¸ºä¹‹.ä¸å…¶å»åšå¥½äº‹, ä¸å¦‚åšä¸ªå¥½äºº.</p></li><li><p>äººä¸–é—´æœ€éš¾é—»çš„è«è¿‡äºå˜äº†å‘³çš„å¥½äº‹.</p></li><li><p>åšå¥½äº‹å‡ ä¹æ˜¯äººäººéƒ½ç§°èµçš„ç¾å¾·, äººä»¬ä¸ä»…ç§°èµä»–, è¿˜ç»™äºˆä»–è¿‡é«˜çš„è¯„ä»·; è€Œé«˜ä¼°ä»–çš„, æ­£æ˜¯æˆ‘ä»¬çš„è‡ªç§å¿ƒ.</p></li><li><p>æˆ‘ä»¬åº”è¯¥æ•£å‘å‡ºå»çš„, ä¸æ˜¯ç»æœ›, è€Œæ˜¯å‹‡æ°”, ä¸æ˜¯ç—…æ€, è€Œæ˜¯å¥å…¨.</p></li><li><p>æ‰€æœ‰çš„å¥åº·å’ŒæˆåŠŸéƒ½å¯¹æˆ‘æœ‰ç›Šå¤„, å“ªæ€•ä»–å¯èƒ½æ˜¾å¾—é¥ä¸å¯åŠ; æ‰€æœ‰çš„ç–¾ç—…å’Œå¤±è´¥åªä¼šè®©æˆ‘æ„Ÿåˆ°æ‚²ä¼¤å’Œå¯¹æˆ‘æœ‰åå¤„, å“ªæ€•ä»–èƒ½å¼•èµ·æˆ‘çš„æ€œæ‚¯, æˆ–è€…è®©æˆ‘å¾—åˆ°è®¸å¤šåŒæƒ….</p></li><li><p>æˆ‘ä»¬ä¸è¦å»åšç®¡ç†ç©·äººçš„å®˜å‘˜, è€Œæ˜¯è¦åŠªåŠ›æˆä¸ºå¯¹è¿™ä¸ªä¸–ç•Œæœ‰è´¡çŒ®çš„äºº.</p></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>é˜…è¯»</tag>
      
      <tag>ç“¦å°”ç™»æ¹–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾22-23 å°è£…æ€§ç›¸å…³</title>
    <link href="/2024/12/02/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE22-23%20%E5%B0%81%E8%A3%85%E6%80%A7%E7%9B%B8%E5%85%B3/"/>
    <url>/2024/12/02/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE22-23%20%E5%B0%81%E8%A3%85%E6%80%A7%E7%9B%B8%E5%85%B3/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾22-å°†æˆå‘˜å˜é‡å£°æ˜ä¸ºprivate"><a href="#æ¡æ¬¾22-å°†æˆå‘˜å˜é‡å£°æ˜ä¸ºprivate" class="headerlink" title="æ¡æ¬¾22 : å°†æˆå‘˜å˜é‡å£°æ˜ä¸ºprivate"></a>æ¡æ¬¾22 : å°†æˆå‘˜å˜é‡å£°æ˜ä¸ºprivate</h2><p>æœ¬æ¡æ¬¾ä¸­, ä½œè€…æ˜ç¡®å£°æ˜, å¦‚æœæ²¡æœ‰å¿…è¦çš„åŸå› , åŠ¡å¿…å°†æˆå‘˜å˜é‡å£°æ˜ä¸º<code>private</code>, è€Œé<code>public/protected</code>, å¹¶è‹¦å£å©†å¿ƒåœ°åˆ—ä¸¾å‡ºäº†éå¸¸å¤šä½¿ç”¨<code>private</code>çš„ä¼˜åŠ¿, è®©æˆ‘ä»¬é€ä¸€é˜…è§ˆ : </p><ul><li><h4 id="ä¿è¯äº†è¯­æ³•ä¸€è‡´æ€§"><a href="#ä¿è¯äº†è¯­æ³•ä¸€è‡´æ€§" class="headerlink" title="ä¿è¯äº†è¯­æ³•ä¸€è‡´æ€§"></a>ä¿è¯äº†è¯­æ³•ä¸€è‡´æ€§</h4><p>å½“å®¢æˆ·é€šè¿‡å¯¹è±¡è°ƒç”¨æ—¶, å¦‚æœå°†æˆå‘˜å˜é‡å£°æ˜ä¸º<code>private</code>, é‚£ä¹ˆå°±çœå»äº†å®¢æˆ·æ€è€ƒè¦ä¸è¦åŠ å°æ‹¬å·çš„é—®é¢˜, åªè¦æ— è„‘åŠ æ‹¬å·å°±è¡Œäº†.</p></li><li><h4 id="å¯¹æˆå‘˜å˜é‡çš„å¤„ç†æ›´åŠ ç²¾ç¡®"><a href="#å¯¹æˆå‘˜å˜é‡çš„å¤„ç†æ›´åŠ ç²¾ç¡®" class="headerlink" title="å¯¹æˆå‘˜å˜é‡çš„å¤„ç†æ›´åŠ ç²¾ç¡®"></a>å¯¹æˆå‘˜å˜é‡çš„å¤„ç†æ›´åŠ ç²¾ç¡®</h4><p>å½“ä½ æŠŠæˆå‘˜å˜é‡å£°æ˜ä¸º<code>public</code>æ—¶, å®¢æˆ·æ‹¥æœ‰å¯¹è¯¥å˜é‡çš„æ‰€æœ‰ç‰¹æƒ, å¯è¯»å¯å†™, ç„¶è€Œæˆ‘ä»¬ä¸€å®šä¸å¸Œæœ›è¿™æ ·, å¦‚æœæˆ‘ä»¬æŠŠæˆå‘˜å˜é‡å£°æ˜ä¸º<code>private</code>, é€šè¿‡<code>public</code>å‡½æ•°, æˆ‘ä»¬å¸Œæœ›å®¢æˆ·è¯»æ—¶å°±è¿”å›ä¸€ä¸ª<code>const reference</code>, å¸Œæœ›å†™å°±è®©å®¢æˆ·ä¼ å…¥ä¿®æ”¹å€¼, åœ¨å‡½æ•°å†…éƒ¨ä¿®æ”¹, å¦‚æœä¸å¸Œæœ›è¯»å†™å°±ä¸æš´éœ²åœ¨å¤–ç½®æ¥å£ä¸­.</p></li><li><h4 id="ä¿è¯äº†å°è£…æ€§"><a href="#ä¿è¯äº†å°è£…æ€§" class="headerlink" title="ä¿è¯äº†å°è£…æ€§"></a>ä¿è¯äº†å°è£…æ€§</h4><p>ä¹¦ä¸­æå‡º : <strong>Publicæ„å‘³ä¸å°è£…, ä¸å°è£…æ„å‘³ä¸å¯æ”¹å˜</strong>, å› ä¸ºæˆå‘˜å˜é‡å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ä¼šè¢«å¹¿æ³›ä½¿ç”¨çš„, ä¼šå‡ºç°åœ¨æ— æ•°å®¢æˆ·ä»£ç ä¸­, å¦‚æ­¤ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«, å°±ç®—ä½ ä»¥åæƒ³æ”¹, å¯å®¢æˆ·å°±ä¸ä¸€å®šæƒ³æ”¹äº†. <code>protected</code>ä¹Ÿæ˜¯åŒç†, <strong>protectedæˆå‘˜å˜é‡å°±åƒpublicæˆå‘˜å˜é‡ä¸€æ ·ç¼ºä¹å°è£…æ€§</strong>, è™½ç„¶æˆå‘˜å˜é‡å¹¶ä¸å¼€æ”¾ç»™å®¢æˆ·, ä½†æ˜¯å¦‚æœä½ ä¹‹ä¸‹æœ‰æ— æ•°çš„æ´¾ç”Ÿç±», å¸¦æ¥çš„ä¿®æ”¹éš¾åº¦ä¹Ÿæ˜¯éåŒä¸€èˆ¬, ç”±æ­¤å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®º : <strong>æˆå‘˜å˜é‡çš„å°è£…æ€§ä¸â€æˆå‘˜å˜é‡çš„å†…å®¹æ”¹å˜æ‰€ç ´åçš„ä»£ç æ•°é‡â€æˆåæ¯”</strong>.</p><p>è€Œå½“æˆ‘ä»¬ä½¿ç”¨privateæˆå‘˜å˜é‡, æˆ‘ä»¬çš„ä¿®æ”¹èŒƒå›´å°±ä»…ä»…åªå±€é™åœ¨ç±»å†…, éå¸¸æ˜“äºäº‹åçš„ä¿®æ”¹. <strong>å°±ç®—å¤–éƒ¨å¯ä»¥é€šè¿‡å‡½æ•°è®¿é—®è¯¥æˆå‘˜å˜é‡, æ—¥åå¸Œæœ›å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œæ›¿æ¢æˆ–ä¿®æ”¹, å¤–éƒ¨ä¹Ÿå…¨ç„¶ä¸çŸ¥. ä¹Ÿå°±æ˜¯è¯´, æŠŠæˆå‘˜å˜é‡éšè—åœ¨å‡½æ•°æ¥å£èƒŒå, å¯ä»¥ä¸ºæ‰€æœ‰å¯èƒ½çš„å®ç°æä¾›å¼¹æ€§</strong>.</p><p>ä¹¦ä¸­ç»™å‡ºäº†ä¸€ä¸ªé€Ÿåº¦æ”¶é›†å™¨çš„ç±», ä¿å­˜æ¯æ¬¡æµ‹é‡åˆ°çš„é€Ÿåº¦, å¯ä»¥è¿”å›å½“å‰çŠ¶æ€ä¸‹çš„é€Ÿåº¦å¹³å‡å€¼, é›å‹å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpeedDataCollection</span> &#123;<br><span class="hljs-keyword">private</span>:<br>  vector&lt;<span class="hljs-type">int</span>&gt; data;<br>  ...<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addValue</span><span class="hljs-params">(<span class="hljs-type">int</span> speed)</span></span>;          <span class="hljs-comment">// å°†æ”¶é›†åˆ°çš„é€Ÿåº¦å­˜å…¥dataä¸­</span><br>  <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">averageSoFar</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;       <span class="hljs-comment">// é€šè¿‡æŸäº›ç®—æ³•æ±‚å¾—å¹³å‡å€¼å¹¶è¿”å›</span><br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥å‡å®šä¸€ä¸ªæƒ…æ™¯, è¿™ä¸ªç±»ä½¿ç”¨äºä¸€ä¸ªåµŒå…¥å¼æ¨¡æ¿å†…, ä¸€å¼€å§‹æˆ‘ä»¬çš„å¯ä½¿ç”¨å†…å­˜å¾ˆå°‘, ä¹Ÿä¸æ˜¯å¾ˆè¦æ±‚é«˜æ•ˆ, äºæ˜¯æˆ‘ä»¬åœ¨<code>averageSoFar()</code>ä¸­çš„ç­–ç•¥å°±æ˜¯éå†<code>data</code>, æ±‚å‡ºæ€»å’Œå†æ±‚å¹³å‡å€¼. </p><p>å½“æˆ‘ä»¬æŠ€æœ¯ä¸æ–­æé«˜, å¯ä½¿ç”¨å†…å­˜å˜å¤§äº†, å¯¹è®¡ç®—æ•ˆç‡æœ‰äº†éœ€æ±‚, æˆ‘ä»¬å°±å¯ä»¥å¤šåŠ ä¸€ä¸ª<code>private</code>æˆå‘˜å˜é‡<code>sum</code>é¢å¤–è®°å½•<code>data</code>çš„æ€»å’Œ, ç„¶åä¿®æ”¹<code>averageSoFar()</code>ä¸­çš„å¤„ç†é€»è¾‘, è®©å…¶ç›´æ¥ç”¨<code>sum</code>æ±‚å¹³å‡å€¼, æ•ˆç‡å¯ä»¥ä»<code>O(N)</code>æåˆ°<code>O(1)</code>. </p><p>ç„¶è€Œä¸ç®¡æˆ‘ä»¬ä¿®æ”¹äº†ä»€ä¹ˆ, å¤–éƒ¨<code>averageSoFar()</code>çš„ä½¿ç”¨è€…éƒ½ä¸ä¼šçŸ¥é“.</p><p>è¿™ç§<strong>æŠŠæˆå‘˜å˜é‡éšè—åœ¨å‡½æ•°æ¥å£èƒŒå</strong>çš„æ–¹å¼, é™¤äº†ä»¥ä¸Šè¡Œä¸º, <strong>è¿˜å¯ä»¥ä½¿å¾—æˆå‘˜å˜é‡è¢«è¯»å†™æ—¶è½»æ¾åŒæ—¶å…¶ä»–å¯¹è±¡, éªŒè¯classçš„çº¦æŸæ¡ä»¶ä»¥åŠå‡½æ•°çš„å‰æå’Œäº‹åæ¡ä»¶, å®ç°åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­æ‰§è¡ŒåŒæ­¥æ§åˆ¶</strong>.</p></li></ul><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>åˆ‡è®°å°†æˆå‘˜å˜é‡å£°æ˜ä¸º<code>private</code>. è¿™æœ‰åŠ©äºä¸€è‡´æ€§, è®¿é—®æ§åˆ¶, å…è®¸çº¦æŸæ¡ä»¶è·å¾—ä¿è¯, æå‡ç±»çš„å®ç°å¼¹æ€§.</li><li><code>protected</code>å¹¶ä¸æ¯”<code>public</code>æ›´å…·å°è£…æ€§.</li></ul><hr><h2 id="æ¡æ¬¾23-å®ä»¥non-memeber-non-friendæ›¿æ¢memberå‡½æ•°"><a href="#æ¡æ¬¾23-å®ä»¥non-memeber-non-friendæ›¿æ¢memberå‡½æ•°" class="headerlink" title="æ¡æ¬¾23 : å®ä»¥non-memeber non-friendæ›¿æ¢memberå‡½æ•°"></a>æ¡æ¬¾23 : å®ä»¥non-memeber non-friendæ›¿æ¢memberå‡½æ•°</h2><p>æœ¬æ¡æ¬¾å‘Šè¯‰æˆ‘ä»¬, å¦‚æœä¸€ä¸ªæˆå‘˜å‡½æ•°æ²¡æœ‰ç›´æ¥è®¿é—®æˆå‘˜å˜é‡çš„éœ€æ±‚, é‚£ä¹ˆæ¨èå°†å…¶æ›¿æ¢ä¸º<code>non-memeber</code>ä¸”<code>non-friend</code>çš„å‡½æ•°.</p><p>æƒ³ç†è§£æœ¬æ¡æ¬¾å¯ä»¥å…ˆå¯¹å°è£…æ€§æœ‰è¿›ä¸€æ­¥çš„è®¤çŸ¥ : </p><p>ä¹¦ä¸­æå‡º, å°è£…çš„æœ¬è´¨åœ¨äº<strong>éšè—å†…éƒ¨å®ç°å’Œæš´éœ²æœ‰é™æ¥å£</strong>, è‡³äºæˆ‘ä»¬ä¸ºä»€ä¹ˆæ¨å´‡å°è£…, æ˜¯å› ä¸ºå®ƒ<strong>ä½¿æˆ‘ä»¬èƒ½æ”¹å˜çš„äº‹åŠ¡åªå½±å“æœ‰é™å®¢æˆ·</strong>, å°±æ˜¯è¯´å¤§å¤§é™ä½äº†æˆ‘ä»¬åæœŸåšå‡ºæ”¹å˜æ—¶çš„ç»´æŠ¤æˆæœ¬. </p><p><strong>ä¸€ä¸ªç±»çš„å°è£…æ€§å’Œå®ƒçš„æ•°æ®, ä¹Ÿå°±æ˜¯æˆå‘˜å˜é‡æ¯æ¯ç›¸å…³</strong>, æ„ˆå°‘çš„ä»£ç å¯ä»¥çœ‹åˆ°æ•°æ®, æ„ˆå¤šçš„æ•°æ®å°±å¯ä»¥è¢«å°è£…, å°è£…æ€§ä¹Ÿå°±è¶Šå¼º. </p><p>ç„¶è€Œæˆ‘ä»¬é€šå¸¸æƒ…å†µä¸‹è®¤ä¸ºæ•°æ®ä»¥åŠæ“ä½œæ•°æ®çš„é‚£äº›å‡½æ•°åº”è¯¥è¢«æ†ç»‘åœ¨ä¸€èµ·, è¿™æ ·å­æ˜¯åœ¨å®ç°æ‰€è°“çš„å°è£…, ç„¶è€Œæ­£å¦‚æˆ‘ä»¬å‰é¢æ‰€è¯´, <strong>æ„ˆå¤šæˆå‘˜å‡½æ•°å¯ä»¥è®¿é—®æ•°æ®, æ•°æ®çš„å°è£…æ€§å°±è¶Šä½</strong>.</p><p>æˆå‘˜å‡½æ•°æ˜¯å®ç°å°è£…çš„å¿…è¦æ‰‹æ®µ, ä½†å¹¶ä¸ä»£è¡¨æˆ‘ä»¬å¯ä»¥æ¯«æ— é¡¾è™‘åœ°å¢åŠ æˆå‘˜å˜é‡, æ¯æœ‰ä¸€ä¸ªå‡½æ•°å¯ä»¥è®¿é—®åˆ°å†…éƒ¨æ•°æ®, æˆ‘ä»¬çš„ç»´æŠ¤æˆæœ¬å°±ä¼šæé«˜ä¸€äº›, å› ä¸ºä½ ä¸ä¸€å®šä¼šè®°å¾—å“ªä¸ªå‡½æ•°æœ‰æ²¡æœ‰åœ¨ä»€ä¹ˆä¸èµ·çœ¼çš„åœ°æ–¹è°ƒç”¨äº†æˆ‘ä»¬çš„åº•å±‚æ•°æ®. å½“ç„¶å¦‚æœä½ é¢„æƒ³çš„æˆå‘˜å‡½æ•°å¿…é¡»è°ƒç”¨æˆå‘˜å˜é‡, é‚£å®Œå…¨æ²¡æœ‰é—®é¢˜. </p><p>ä¹¦ä¸­ç»™å‡ºäº†ä¸€ä¸ªç”¨äºç®¡ç†ç½‘ç»œæµè§ˆå™¨çš„ç±», å…¶ä¸­æœ‰ä¸€äº›ç”¨æ¥æ¸…ç†çš„å‡½æ•°, æœ‰çš„ç”¨æ¥æ¸…ç†é«˜é€Ÿç¼“å†²åŒº, æœ‰çš„ç”¨æ¥æ¸…ç†å†å²è®°å½•, æœ‰çš„ç”¨æ¥ç§»é™¤<code>cookie</code>, è®©æˆ‘ä»¬çœ‹çœ‹ä¹¦ä¸­çš„ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WebBrowser</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  ...<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">clearCache</span><span class="hljs-params">()</span></span>;<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">clearHistory</span><span class="hljs-params">()</span></span>;<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">removeCookies</span><span class="hljs-params">()</span></span>;<br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯å¸Œæœ›åŒæ—¶è°ƒç”¨è¿™ä¸‰ä¸ªå‡½æ•°çš„, äºæ˜¯æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªç»Ÿåˆå‡½æ•°<code>clearBrowser()</code>, æŒ‰ç…§ä¹ æƒ¯æˆ‘ä»¬å¯èƒ½å°±æŠŠå®ƒå†™ä¸ºæˆå‘˜å‡½æ•°äº†, ä½†æœ‰äº†ä¸Šé¢çš„è®¤çŸ¥, æˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠå®ƒå†™æˆä¸€ä¸ª<code>non-memeber non-friend</code>å‡½æ•°,  ä»£ç å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WebBrowser</span> &#123;<br><span class="hljs-keyword">public</span>:<br>...<br>    <span class="hljs-comment">// void clearBrowser(WebBrowser&amp; wb); // è¯·æ”¾å¼ƒè¿™ç§å†™æ³•</span><br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">clearBrowser</span><span class="hljs-params">(WebBrowser&amp; wb)</span></span><br><span class="hljs-function"></span>&#123;<br>  wb.<span class="hljs-built_in">clearCache</span>();<br>  wb.<span class="hljs-built_in">clearHistory</span>();<br>  wb.<span class="hljs-built_in">removeCookies</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬çŸ¥é“<code>clearBrowser</code>å†…éƒ¨ä¸ä¼šä»¥ä»»ä½•å½¢å¼ç›´æ¥è°ƒç”¨æ•°æ®,  æ‰€ä»¥å¹²è„†ç›´æ¥æŠŠ<code>clearBrowser</code>æ’é™¤åœ¨å¤–, è¿™ä¸åªæ˜¯å‘Šè¯‰æœªæ¥çš„è‡ªå·±, ä¹Ÿæ˜¯åœ¨å‘Šè¯‰å°†è¦ç»´æŠ¤è¿™ä»½ä»£ç çš„å…¶ä»–äºº, è¿™ä¸ªå‡½æ•°ä»æœºç†ä¸Šå°±ä¸å¯èƒ½è§¦åŠåº•å±‚æ•°æ®, æ˜¯ç»å¯¹å®‰å…¨çš„, å°è£…æ€§å› æ­¤å¾—åˆ°æå‡.</p><p>å½“ç„¶è¿˜æ˜¯è¦æŠŠä»–ä¿©æ”¾åœ¨<strong>åŒä¸€ä¸ªå‘½åç©ºé—´</strong>å†…, ä¸ç„¶å°±çœŸäº’ç›¸æ‰¾ä¸åˆ°äº† : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">namespace</span> WebBrowserStuff &#123;<br>  ...<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WebBrowser</span> &#123; ... &#125;;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">clearBrowser</span><span class="hljs-params">(WebBrowser&amp; wb)</span></span>;<br>  ...<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¹¦ä¸­è¿˜æå‡º : åƒæ˜¯è¿™ç§<code>clearBrowser</code>ä¸è§¦åŠåº•å±‚æ•°æ®çš„ä¼ªæˆå‘˜å‡½æ•°, æˆ‘ä»¬ä¸€èˆ¬ç§°å…¶ä¸ºä¾¿åˆ©å‡½æ•°, <strong>å°†æ‰€æœ‰çš„ä¾¿åˆ©å‡½æ•°æ”¾åœ¨å¤šä¸ªå¤´æ–‡ä»¶å†…ä½†éš¶å±äºåŒä¸€ä¸ªå‘½åç©ºé—´, å¯ä»¥ä½¿ç¼–å†™è€…è½»æ¾æ‰¾åˆ°å¹¶æ‰©å±•æŸäº›æ–¹å‘çš„ä¾¿åˆ©å‡½æ•°</strong>, ç¤ºä¾‹å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">namespace</span> WebBrowserStuff &#123;<br>   <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebBrowser</span> &#123; ... &#125;;<span class="hljs-comment">// æ ¸å¿ƒæœºèƒ½</span><br>     ...                                <br>&#125;<br><br><span class="hljs-comment">// header &quot;webbrowserclear.h&quot;</span><br><span class="hljs-keyword">namespace</span> WebBrowserStuff &#123;<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">clearBrowser</span><span class="hljs-params">(WebBrowser&amp; wb)</span></span>; <span class="hljs-comment">// æœ‰å…³å†…å­˜æ¸…ç†çš„ä¾¿åˆ©å‡½æ•°</span><br>  ...                                   <br>&#125;   <br><br><span class="hljs-comment">// header &quot;webbrowserbookmarks.h&quot;</span><br><span class="hljs-keyword">namespace</span> WebBrowserStuff &#123;<br>  ...                                   <span class="hljs-comment">// æœ‰å…³ä¹¦ç­¾æ—¥å¿—çš„ä¾¿åˆ©å‡½æ•°</span><br>&#125;                                       <br><br><span class="hljs-comment">// header &quot;webbrowsercookies.h&quot;</span><br><span class="hljs-keyword">namespace</span> WebBrowserStuff &#123;<br>  ...                                   <span class="hljs-comment">// æœ‰å…³cookieçš„ä¾¿åˆ©å‡½æ•°</span><br>&#125;                                      <br>...<br></code></pre></td></tr></table></figure><hr><h3 id="è¯·è®°ä½-1"><a href="#è¯·è®°ä½-1" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>å®ä»¥<code>non-memeber non-friend</code>æ›¿æ¢<code>member</code>å‡½æ•°, å¦‚æœè¿™ä¸ªå‡½æ•°æ²¡æœ‰è®¿é—®åº•å±‚æ•°æ®çš„å¿…è¦çš„è¯. è¿™æ ·å­å¯ä»¥å¢åŠ å°è£…æ€§, åŒ…è£¹å¼¹æ€§å’Œå¯æ‰©å±•æ€§.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾21 å¿…é¡»è¿”å›å¯¹è±¡æ—¶, åˆ«å¦„æƒ³è¿”å›å…¶reference</title>
    <link href="/2024/12/01/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE21%20%E5%BF%85%E9%A1%BB%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1%E6%97%B6,%E5%88%AB%E5%A6%84%E6%83%B3%E8%BF%94%E5%9B%9E%E5%85%B6reference/"/>
    <url>/2024/12/01/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE21%20%E5%BF%85%E9%A1%BB%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1%E6%97%B6,%E5%88%AB%E5%A6%84%E6%83%B3%E8%BF%94%E5%9B%9E%E5%85%B6reference/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾21-å¿…é¡»è¿”å›å¯¹è±¡æ—¶-åˆ«å¦„æƒ³è¿”å›å…¶reference"><a href="#æ¡æ¬¾21-å¿…é¡»è¿”å›å¯¹è±¡æ—¶-åˆ«å¦„æƒ³è¿”å›å…¶reference" class="headerlink" title="æ¡æ¬¾21 : å¿…é¡»è¿”å›å¯¹è±¡æ—¶, åˆ«å¦„æƒ³è¿”å›å…¶reference"></a>æ¡æ¬¾21 : å¿…é¡»è¿”å›å¯¹è±¡æ—¶, åˆ«å¦„æƒ³è¿”å›å…¶reference</h2><blockquote><p>å½“ç¨‹åºå‘˜é¢†æ‚Ÿäº†æ¡æ¬¾20æ‰€è®²çš„pass-by-valueçš„ç§ç§æ•ˆç‡é—®é¢˜ä¹‹å, å¾€å¾€ä¼šå˜æˆåå­—å†›æˆ˜å£«, ä¸€å¿ƒä¸€æ„æ ¹é™¤pass-by-valueçš„å­˜åœ¨, ç„¶è€Œè¿™å´ä¼šè®©ä»–ä»¬çŠ¯ä¸‹ä¸€äº›è‡´å‘½çš„é”™è¯¯, é€šè¿‡æœ¬æ¡æ¬¾è®©æˆ‘ä»¬æ¥äº†è§£.</p></blockquote><p>é˜…è¯»å®Œæœ¬æ–‡ç« , æˆ‘æ›´å€¾å‘äºæŠŠæœ¬æ¡æ¬¾è§£é‡Šä¸º :</p><ul><li>å¿…é¡»è¿”å›<strong>æ–°</strong>å¯¹è±¡æ—¶, åˆ«å¦„æƒ³è¿”å›å…¶reference.</li></ul><p>è¿™æ ·å­ä¼šæ›´ä¾¿äºç†è§£.</p><p>ä¹¦ä¸­ç»™å‡ºäº†ä¸€ä¸ªæœ‰ç†æ•°ç±», ç”¨äºè®¡ç®—ä¸€ä¸ªæœ‰ä¹˜ç§¯çš„æœ‰ç†æ•° : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rational</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-built_in">Rational</span>(<span class="hljs-type">int</span> numerator = <span class="hljs-number">0</span>,<span class="hljs-type">int</span> denominator = <span class="hljs-number">1</span>);<br>  ...<br><span class="hljs-keyword">private</span>:<br>  <span class="hljs-type">int</span> n, d;  <span class="hljs-comment">// æœ‰ç†æ•°çš„åˆ†å­å’Œåˆ†æ¯</span><br><br><span class="hljs-keyword">friend</span> <span class="hljs-type">const</span> Rational <span class="hljs-keyword">operator</span>*(<span class="hljs-type">const</span> Rational&amp; lhs, <span class="hljs-type">const</span> Rational&amp; rhs);<br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯æˆ‘ä»¬æœ€åˆçš„è®¾æƒ³, <code>operator*</code>æ˜¯ä¼ å€¼è¿”å›çš„, è¿™ä¸ç”±å¾—å¼•å‘æˆ‘ä»¬é¡¾è™‘, æˆ‘ä»¬ç¡®å®æ˜¯å¸Œæœ›å…¶è¿”å›ä¸€ä¸ªæ–°çš„ä»£è¡¨<code>lhs</code>å’Œ<code>rhs</code>ä¹˜ç§¯çš„<code>Rational</code>å¯¹è±¡, ä½†æ˜¯ä¼ å€¼è¿”å›çš„æ‹·è´æ„é€ æˆæœ¬ä¹Ÿè®¸ä¼šå¾ˆé«˜, å› æ­¤æœ‰ä¸åŒçš„ç¨‹åºå‘˜æƒ³å‡ºäº†ä¸‰ç§ä¸åŒè¿”å›ç­–ç•¥, ä½†æ— ä¸€ä¾‹å¤–éƒ½æ˜¯é”™è¯¯çš„, è®©æˆ‘ä»¬çœ‹ä¹¦ä¸­é€ä¸€åé©³.</p><hr><h4 id="è¿”å›ä¸€ä¸ªpointer-referenceæŒ‡å‘ä¸€ä¸ª-local-stack-å¯¹è±¡"><a href="#è¿”å›ä¸€ä¸ªpointer-referenceæŒ‡å‘ä¸€ä¸ª-local-stack-å¯¹è±¡" class="headerlink" title="è¿”å›ä¸€ä¸ªpointer&#x2F;referenceæŒ‡å‘ä¸€ä¸ª local stack å¯¹è±¡"></a>è¿”å›ä¸€ä¸ªpointer&#x2F;referenceæŒ‡å‘ä¸€ä¸ª local stack å¯¹è±¡</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">const</span> Rational&amp; <span class="hljs-keyword">operator</span>*(<span class="hljs-type">const</span> Rational&amp; lhs,   <span class="hljs-comment">// é”™è¯¯çš„ä»£ç !</span><br>                          <span class="hljs-type">const</span> Rational&amp; rhs)<br>&#123;<br>  <span class="hljs-function">Rational <span class="hljs-title">result</span><span class="hljs-params">(lhs.n * rhs.n, lhs.d * rhs.d)</span></span>;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>é¦–å…ˆæˆ‘ä»¬çš„ç›®çš„æ˜¯é¿å…è°ƒç”¨æ„é€ å‡½æ•°, è¿™æ ·ä¸ä»…æ²¡æœ‰é¿å…, è€Œä¸”<code>result</code>è¿˜æ˜¯ä¸€ä¸ª<code>local</code>å¯¹è±¡, å‡ºäº†ä½œç”¨åŸŸå°±ä¼šè¢«é”€æ¯, è¿”å›çš„å¼•ç”¨æ˜¯ä¸€ä¸ªæ‚¬æŒ‚å¼•ç”¨! æˆ‘ä»¬é¦–å…ˆåº”å½“çŸ¥é“çš„, å°±æ˜¯ä¸è¦è®©å‡½æ•°è¿”å›ä¸€ä¸ªå‡½æ•°å†…å±€éƒ¨å˜é‡çš„<code>reference</code>, ä¹Ÿå°±æ˜¯è¿”å›å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸä¸€å®šè¦å¤§.</p><hr><h4 id="è¿”å›ä¸€ä¸ªreferenceæŒ‡å‘ä¸€ä¸ªheap-allocatedå¯¹è±¡"><a href="#è¿”å›ä¸€ä¸ªreferenceæŒ‡å‘ä¸€ä¸ªheap-allocatedå¯¹è±¡" class="headerlink" title="è¿”å›ä¸€ä¸ªreferenceæŒ‡å‘ä¸€ä¸ªheap-allocatedå¯¹è±¡"></a>è¿”å›ä¸€ä¸ªreferenceæŒ‡å‘ä¸€ä¸ªheap-allocatedå¯¹è±¡</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">const</span> Rational&amp; <span class="hljs-keyword">operator</span>*(<span class="hljs-type">const</span> Rational&amp; lhs,   <span class="hljs-comment">// é”™è¯¯çš„ä»£ç !</span><br>                          <span class="hljs-type">const</span> Rational&amp; rhs)<br>&#123;<br>  Rational *result = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Rational</span>(lhs.n * rhs.n, lhs.d * rhs.d);<br>  <span class="hljs-keyword">return</span> *result;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸€è¿˜æ˜¯ä¼šè¿›è¡Œæ„é€ , å…¶äºŒè¿™ä¼šå¸¦æ¥ä¸¥é‡çš„å†…å­˜æ³„éœ², é¦–å…ˆä½ å¿…é¡»è®°å¾—åœ¨å¤–éƒ¨è¦æ‰§è¡Œdelete, å…¶æ¬¡å½“ä½ è¿›è¡Œè¿ä¹˜æ—¶, ä¾‹å¦‚<code>a * b * c</code> , ä½ æ°¸è¿œæ— æ³•è·å¾—<code>b*c</code>æ˜¯newå‡ºæ¥çš„æŒ‡é’ˆ, ä¹Ÿå°±æ˜¯è¯´å¿…ç„¶å†…å­˜æ³„éœ².</p><hr><h4 id="è¿”å›ä¸€ä¸ªpointer-referenceæŒ‡å‘ä¸€ä¸ªlocal-staticå¯¹è±¡è€Œæœ‰å¯èƒ½åŒæ—¶éœ€è¦å¤šä¸ªè¿™æ ·çš„å¯¹è±¡"><a href="#è¿”å›ä¸€ä¸ªpointer-referenceæŒ‡å‘ä¸€ä¸ªlocal-staticå¯¹è±¡è€Œæœ‰å¯èƒ½åŒæ—¶éœ€è¦å¤šä¸ªè¿™æ ·çš„å¯¹è±¡" class="headerlink" title="è¿”å›ä¸€ä¸ªpointer&#x2F;referenceæŒ‡å‘ä¸€ä¸ªlocal staticå¯¹è±¡è€Œæœ‰å¯èƒ½åŒæ—¶éœ€è¦å¤šä¸ªè¿™æ ·çš„å¯¹è±¡"></a>è¿”å›ä¸€ä¸ªpointer&#x2F;referenceæŒ‡å‘ä¸€ä¸ªlocal staticå¯¹è±¡è€Œæœ‰å¯èƒ½åŒæ—¶éœ€è¦å¤šä¸ªè¿™æ ·çš„å¯¹è±¡</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">const</span> Rational&amp; <span class="hljs-keyword">operator</span>*(<span class="hljs-type">const</span> Rational&amp; lhs,    <span class="hljs-comment">// æœ‰é£é™©çš„ä»£ç !</span><br>                          <span class="hljs-type">const</span> Rational&amp; rhs)    <br>&#123;<br>  <span class="hljs-type">static</span> Rational result; <br>  result = ...;            <br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªåŸç†ä¸Šçœ‹æ¥æ²¡æœ‰é—®é¢˜, ä½†æ˜¯åªè¦ä½¿ç”¨<code>static</code>å¯¹è±¡å°±ä¸€å®šä¼šä¼´éšç€å¤šçº¿ç¨‹æƒ…å†µä¸‹çš„é£é™©, è¿™æ ·å°±æ˜¾å¾—æœ‰å¼Šç«¯äº†, é™¤éä½ å¯ä»¥ä¿è¯è¿™ä¸ªä»£ç ä¸ä¼šåœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹å‡ºé—®é¢˜æˆ–æ˜¯é€šè¿‡é”ä¿è¯äº†çº¿ç¨‹å®‰å…¨, å°±åƒæˆ‘ä»¬æ¡æ¬¾4ä¸­æåˆ°çš„åˆå§‹åŒ–ç­–ç•¥ä¸€æ · : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">TimeKeeper&amp; <span class="hljs-title">tk</span><span class="hljs-params">()</span> <span class="hljs-comment">// è¿™é‡Œç”¨tkå‡½æ•°æ›¿ä»£å†…ç½®å‹å¯¹è±¡tk</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">static</span> TimeKeeper timekeeper;  <span class="hljs-comment">// å½“ç”¨æˆ·çœŸæ­£è°ƒç”¨tk()æ—¶, æ‰ä¼šåœ¨å‡½æ•°å†…éƒ¨ç”Ÿæˆä¸€ä¸ªå±€éƒ¨é™æ€å˜é‡(local static)</span><br>    <span class="hljs-keyword">return</span> timekeeper;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼šç¡®ä¿è¿™ä¸ªå‡½æ•°åœ¨å¤šçº¿ç¨‹ä¹‹å‰çš„å•çº¿ç¨‹é˜¶æ®µå°±éƒ½è°ƒç”¨è¿‡ä¸€æ¬¡æ¥å®ç°åˆå§‹åŒ–.</p><hr><p>çœ‹è¿‡ä»¥ä¸Šçš„ä¸‰ç§æƒ…å†µå, æœ€åè¿˜æ˜¯ç›´æ¥è¿”å›å¯¹è±¡å§!</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">inline</span> <span class="hljs-type">const</span> Rational <span class="hljs-keyword">operator</span>*(<span class="hljs-type">const</span> Rational&amp; lhs, <span class="hljs-type">const</span> Rational&amp; rhs)<br>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Rational</span>(lhs.n * rhs.n, lhs.d * rhs.d);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¹¦ä¸­è¯´å³ä½¿è¦æ‰¿æ‹…æ„é€ å’Œææ„çš„æˆæœ¬, ä¹Ÿè¿˜æ˜¯æ¨èç›´æ¥ä¼ å€¼è¿”å›, ä½†æ˜¯è¦çŸ¥é“Effective C++å·²ç»æ˜¯åå‡ å¹´å‰çš„è€ä¹¦äº†, ç°åœ¨ä¼´éšç€C++11çš„å¼•å…¥, å¸¦æ¥äº†<strong>ç§»åŠ¨è¯­ä¹‰</strong>çš„æ–°æœºåˆ¶, è¿™ç§æœºåˆ¶å¯¹ä¼ å€¼è¿”å›å¸¦æ¥äº†æå¤§çš„ä¼˜åŒ–, ç®€å•æ¥è¯´å°±æ˜¯ä¸ä¼šæœ‰å¤šä½™çš„æ„é€ å’Œææ„äº†, <strong>ç¼–è¯‘å™¨ä¼šç›´æ¥åœ¨åŸæœ¬è¦ææ„çš„ä¸´æ—¶å¯¹è±¡ä¸Šç›´æ¥æ„å»ºè¦ä¼ å‡ºçš„æ–°å¯¹è±¡</strong>, ä¹Ÿå°±æ˜¯è¯´ä¼ å€¼è¿”å›çš„æ•ˆç‡å¾—åˆ°äº†æå¤§çš„æå‡, è€Œè¿™ä¹Ÿä¸æœ¬æ¡æ¬¾çš„è¦æ±‚ä¸è°‹è€Œåˆ, å¯è§Effective C++çš„æ¡æ¬¾è¿˜æ˜¯ç¦å¾—ä½æ—¶é—´å†ç»ƒçš„.</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li><p>ç»å¯¹ä¸è¦è¿”å›ä¸€ä¸ª<code>pointer/reference</code>æŒ‡å‘ä¸€ä¸ª<code>local stack</code>å¯¹è±¡, è¿”å›ä¸€ä¸ª<code>reference</code>æŒ‡å‘ä¸€ä¸ª<code>heap-allocated</code>å¯¹è±¡, è¿”å›ä¸€ä¸ª<code>pointer/reference</code>æŒ‡å‘ä¸€ä¸ª<code>local static</code>å¯¹è±¡è€Œæœ‰å¯èƒ½åŒæ—¶éœ€è¦å¤šä¸ªè¿™æ ·çš„å¯¹è±¡. </p></li><li><p>è¯·ä¼˜å…ˆè€ƒè™‘ä¼ å€¼è¿”å›å§, åœ¨C++11å¼•å…¥ç§»åŠ¨è¯­ä¹‰åå®ƒå¦‚æœ‰ç¥åŠ©!</p></li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾20 å®ä»¥pass-by-reference-to-constæ›¿æ¢pass-by-value</title>
    <link href="/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE20%20%E5%AE%81%E4%BB%A5pass-by-reference-to-const%E6%9B%BF%E6%8D%A2pass-by-value/"/>
    <url>/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE20%20%E5%AE%81%E4%BB%A5pass-by-reference-to-const%E6%9B%BF%E6%8D%A2pass-by-value/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾20-å®ä»¥pass-by-reference-to-constæ›¿æ¢pass-by-value"><a href="#æ¡æ¬¾20-å®ä»¥pass-by-reference-to-constæ›¿æ¢pass-by-value" class="headerlink" title="æ¡æ¬¾20 : å®ä»¥pass-by-reference-to-constæ›¿æ¢pass-by-value"></a>æ¡æ¬¾20 : å®ä»¥pass-by-reference-to-constæ›¿æ¢pass-by-value</h2><blockquote><p>æœ¬æ¡æ¬¾å°†å‘Šè¯‰æˆ‘ä»¬å‡½æ•°ä¼ å‚æ—¶çš„æœ€ä½³ç­–ç•¥.</p></blockquote><p>æˆ‘ä»¬éƒ½çŸ¥é“, <code>pass-by-value</code>(ä¼ å€¼ä¼ å‚)æ˜¯ä¸€ä¸ªè´¹æ—¶è´¹åŠ›çš„è¿‡ç¨‹, å®ƒä¼šç›´æ¥å¤åˆ¶ä¸€ä¸ªåŸä»¶çš„æ‹·è´, å¦‚æœæ˜¯è‡ªå®šä¹‰ç±»å°±ä¼šè°ƒç”¨ä¸€æ¬¡æ‹·è´æ„é€ æ¥å®ç°å¤åˆ¶, å‡½æ•°ç»“æŸæ—¶è¿˜è¦é¢å¤–è°ƒç”¨ä¸€æ¬¡ææ„å‡½æ•°, æˆ‘ä»¬ä¼šå¾ˆæœ‰æ„æ„¿å»å‰Šå‡è¿™æ–¹é¢çš„èŠ±é”€.</p><p>ç›¸ä¿¡æˆ‘ä»¬åœ¨åˆ«å¤„çš„å¾ˆå¤šå‡½æ•°ä¸­éƒ½çœ‹è§è¿‡<code>pass-by-reference-to-const</code>çš„å­˜åœ¨, åœ¨æœ¬ä¹¦ä¸­ä¹ŸæåŠ›æ¨èè¿™ç§å†™æ³•, è¶³çŸ£è§å¾—è¿™ç§å†™æ³•çš„é«˜æ•ˆä¸å¹¿æ³›, å°±åƒä¸‹é¢è¿™è¡Œå‡½æ•°å®šä¹‰ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">validateStudent</span><span class="hljs-params">(<span class="hljs-type">const</span> Student&amp; s)</span></span>;<br></code></pre></td></tr></table></figure><p>referenceçš„åº•å±‚ä¸€èˆ¬æ˜¯ä¸ªæŒ‡é’ˆ, ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªæ˜¯ç”¨äº†ä¸€ä¸ªä¼ é€’æŒ‡é’ˆçš„èŠ±é”€å°±å®ç°äº†å‚æ•°çš„ä¼ é€’, å†åŠ ä¸Šconst, è¿™å¯¹æˆ‘ä»¬ä¼ å…¥å¼•ç”¨çš„å®‰å…¨æ€§ç»™äºˆäº†ä¿è¯,  ä½¿å¾—è¿™ä¸ªå†™æ³•<strong>å…¼å…·äº†æ•ˆç‡ä¸å®‰å…¨</strong>, æ˜¯ä¸å¯å¤šå¾—çš„å¥½äº‹.</p><p>å¦å¤–ä¹¦ä¸­è¿˜ç»™å‡ºäº†ä¸€ä¸ªå¥½å¤„ : <strong>é¿å…å¯¹è±¡åˆ‡å‰²é—®é¢˜</strong>.</p><p>æˆ‘ä»¬éƒ½çŸ¥é“å¤šæ€ä¸­çš„åŠ¨æ€ç±»å‹æ˜¯ä¾é æŒ‡é’ˆå’Œå¼•ç”¨æ¥è§¦å‘çš„, ç®€å•æ¥è¯´å°±æ˜¯ä¹Ÿè®¸æŸä¸ªæŒ‡é’ˆæˆ–å¼•ç”¨çš„é™æ€ç±»å‹æ˜¯åŸºç±», ä½†æ˜¯åŠ¨æ€ç±»å‹å¯ä»¥é€šè¿‡å®é™…çš„èµ‹å€¼æ¥æ”¹å˜, å®ç°åŠ¨æ€ç±»å‹çš„ç»‘å®š, è¿™ç‚¹å¯æ˜¯ä¸€ä¸ªæ™®é€šçš„ç±»å¯¹è±¡åšä¸åˆ°çš„. å½“æˆ‘ä»¬ä½¿ç”¨<code>pass-by-reference-to-const</code>, å…¶å®ä¹Ÿå°±ç¬¦åˆäº†è¿™ç§æ€§è´¨, æˆ‘ä»¬æ¥çœ‹ä»£ç ç†è§£ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Window</span> &#123;<span class="hljs-comment">// æ™®é€šçª—å£</span><br><span class="hljs-keyword">public</span>:<br>  ...<br>  <span class="hljs-function">std::string <span class="hljs-title">name</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;           <span class="hljs-comment">// è¿”å›çª—å£å</span><br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">display</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;       <span class="hljs-comment">// çª—å£æ˜¾ç¤ºå‡½æ•°</span><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowWithScrollBars</span>: <span class="hljs-keyword">public</span> Window &#123;<span class="hljs-comment">// é«˜çº§çª—å£! å®ƒå¸¦æ»šåŠ¨æ¡!</span><br><span class="hljs-keyword">public</span>:<br>  ...<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">display</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<span class="hljs-comment">// å¯¹çª—å£é‡å†™</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯ä¸€å¯¹çˆ¶å­ç±», ä¸‹é¢æ˜¯åˆ†åˆ«ç”¨ä¸¤ç§ä¼ å€¼æ–¹æ³•çš„å‡½æ•° : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">printNameAndDisplay</span><span class="hljs-params">(Window w)</span>         <span class="hljs-comment">// pass-by-value</span></span><br><span class="hljs-function"></span>&#123;                             <br>  std::cout &lt;&lt; w.<span class="hljs-built_in">name</span>();<br>  w.<span class="hljs-built_in">display</span>();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">printNameAndDisplay</span><span class="hljs-params">(<span class="hljs-type">const</span> Window&amp; w)</span>   <span class="hljs-comment">// pass-by-reference-to-const</span></span><br><span class="hljs-function"></span>&#123;                                           <br>  std::cout &lt;&lt; w.<span class="hljs-built_in">name</span>();<br>  w.<span class="hljs-built_in">display</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹çš„ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp">WindowWithScrollBars wwsb;<br><span class="hljs-built_in">printNameAndDisplay</span>(wwsb);<br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬è°ƒç”¨å‰è€…, ç­”æ¡ˆæ˜¯åªèƒ½è°ƒç”¨åŸºç±»çš„<code>display()</code>, å› ä¸º<strong>å¯¹è±¡è¢«åˆ‡å‰²äº†</strong>, <code>wwsb</code>è¢«å¼ºè¡Œä»æ´¾ç”Ÿç±»è¢«åˆ‡å‰²æˆäº†åŸºç±», è¿™å¾ˆæ­£å¸¸, ä¼ ä¸€ä¸ªå¯¹è±¡å¯æ²¡æœ‰ä»€ä¹ˆå¤šæ€çš„æœºåˆ¶.</p><p>å¦‚æœæˆ‘ä»¬è°ƒç”¨åè€…, ç»“æœå¾ˆæˆåŠŸ, è°ƒç”¨çš„å°±æ˜¯æ´¾ç”Ÿç±»çš„<code>display()</code>, å› ä¸º<code>w</code>è™½ç„¶é™æ€ç±»å‹æ˜¯<code>Window</code>, ä½†ç”±äºå¼•ç”¨çš„å¯¹è±¡<code>wwsb</code>ç±»å‹æ˜¯<code>WindowWithScrollBars</code>, æ‰€ä»¥åŠ¨æ€ç±»å‹ç»‘å®šä¸ºäº†æ´¾ç”Ÿç±», è°ƒç”¨å°±æ­£ç¡®äº†. è¯´çš„æœ‰äº›å¤æ‚äº†, å¯ä»¥å®è§‚ç†è§£ä¸º<code>pass-by-reference-to-const</code>æ˜¯è™šå‡½æ•°æœºåˆ¶å®ç°çš„å¿…è¦æ‰‹æ®µ.</p><hr><p>å¹äº†é‚£ä¹ˆä¹…<code>pass-by-reference-to-const</code>, é‚£ä¹ˆå°±æ²¡æœ‰ä»€ä¹ˆæƒ…å†µè¦ç”¨<code>pass-by-value</code>çš„å—?</p><p>ç­”æ¡ˆæ˜¯æœ‰çš„, å…ˆçœ‹ä¹¦ä¸­ç»™å‡ºçš„æœ€ç»ˆç»“è®º : <strong>å†…ç½®ç±»å‹, STLè¿­ä»£å™¨, å‡½æ•°å¯¹è±¡æ¨èç”¨pass-by-value</strong>.</p><p>åŸå› å¾ˆç®€å•, <code>pass-by-reference-to-const</code>è¯´åˆ°åº•ä¹Ÿå°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆçš„èŠ±é”€, <strong>ä¸€äº›å†…ç½®ç±»å‹çš„èŠ±é”€ç”šè‡³æ¯”æŒ‡é’ˆèŠ±é”€è¿˜å°</strong>, è€Œ<strong>STLè¿­ä»£å™¨å’Œå‡½æ•°å¯¹è±¡å†…éƒ¨ä¹Ÿå°±æ˜¯ä¸€ä¸ªæˆ–å‡ ä¸ªæŒ‡é’ˆ</strong>è€Œå·², å·®ä¸äº†å¤šå°‘, å½“ç„¶ä¹Ÿæœ‰ä¸€éƒ¨åˆ†åŸå› æ˜¯ä¹ æƒ¯æ‰€è‡´.</p><p>æœ‰äººå¯èƒ½è®¤ä¸ºåªåŒ…å«å°å‹å¯¹è±¡çš„è‡ªå®šä¹‰ç±»å‹ä¹Ÿå¯ä»¥ç”¨<code>pass-by-value</code>, è¿™æ ·çš„æƒ³æ³•æ˜¯æœ‰æ¼æ´çš„.</p><p>ä¹¦ä¸­ç»™å‡ºäº†ä¸‰ä¸ªåŸå›  : </p><ol><li>å¯¹è±¡å°ä¸ä»£è¡¨<strong>æ„é€ å’Œææ„å‡½æ•°çš„èŠ±é”€</strong>å°±ä¸å°, å¦‚æœä½ ç›´æ¥<code>pass-by-value</code>ä¸€ä¸ªSTLçš„<code>set</code>, å…¶å†…éƒ¨å¯¹è±¡ä¹Ÿå°±æ˜¯å‡ ä¸ªæŒ‡é’ˆ, æ˜¯æ‰€è°“çš„â€å°å¯¹è±¡â€, ä½†æ˜¯æ„é€ å’Œææ„çš„å¼€é”€å°±ä¸çŸ¥é“å¤§å¤šå°‘å€äº†.</li><li><strong>æŸäº›ç¼–è¯‘å™¨å¯¹å¾…å†…ç½®ç±»å‹å’Œè‡ªå®šä¹‰ç±»å‹çš„æ€åº¦æˆªç„¶ä¸åŒ</strong>, ç¼–è¯‘å™¨å¾ˆä¹æ„æŠŠå†…ç½®ç±»å‹å¯¹è±¡æ”¾è¿›ç¼“å­˜å™¨, ä½†ä¸€ä¸ªè‡ªå®šä¹‰ç±»å¯¹è±¡å°±ä¸ä¼šæœ‰æ­¤èˆ¬å…³æ€€.</li><li><strong>ä¸€ä¸ªç±»åˆ›å»ºå®Œåæ˜¯éœ€è¦ç»´æŠ¤çš„</strong>, ä½ ç°åœ¨å¯¹è±¡å°, ä¸ä»£è¡¨ä»¥åå°±ä¸ä¼šæ ¹æ®å®¢æˆ·éœ€æ±‚åŠ å…¥é¢å¤–çš„å˜é‡, é™¤éä½ åœ¨ä¸€å¼€å§‹å°±æŠŠæ¡†æ¶å®šæ­»äº†.</li></ol><p>å› æ­¤ä¹¦ä¸­æ‰ç»™å‡ºäº†æˆ‘ä»¬ä¸Šé¢çš„æœ€ç»ˆç»“è®º.</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>å°½é‡ä»¥pass-by-reference-to-constæ›¿æ¢pass-by-value, å‰è€…é«˜æ•ˆ, å®‰å…¨, å¹¶ä¸”æœ‰æ•ˆè§£å†³äº†åˆ‡å‰²é—®é¢˜.</li><li>ä»¥ä¸Šè§„åˆ™ä¸é€‚ç”¨äºå†…ç½®ç±»å‹, STLè¿­ä»£å™¨, å‡½æ•°å¯¹è±¡, å®ƒä»¬é€‚åˆpass-by-value.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾19 è®¾è®¡classçŠ¹å¦‚è®¾è®¡type</title>
    <link href="/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE19%20%E8%AE%BE%E8%AE%A1class%E7%8A%B9%E5%A6%82%E8%AE%BE%E8%AE%A1type/"/>
    <url>/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE19%20%E8%AE%BE%E8%AE%A1class%E7%8A%B9%E5%A6%82%E8%AE%BE%E8%AE%A1type/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾19-è®¾è®¡classçŠ¹å¦‚è®¾è®¡type"><a href="#æ¡æ¬¾19-è®¾è®¡classçŠ¹å¦‚è®¾è®¡type" class="headerlink" title="æ¡æ¬¾19 : è®¾è®¡classçŠ¹å¦‚è®¾è®¡type"></a>æ¡æ¬¾19 : è®¾è®¡classçŠ¹å¦‚è®¾è®¡type</h2><blockquote><p>C++ æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€, å½“ä½ å®šä¹‰äº†ä¸€ä¸ªæ–°class, ä¹Ÿå°±å®šä¹‰äº†ä¸€ä¸ªæ–°type. ç„¶è€Œè®¾è®¡ä¸€ä¸ªä¼˜ç§€çš„classæ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡, æ­£å¦‚è®¾è®¡ä¸€ä¸ªå¥½çš„typeæ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡. æœ¬æ¡æ¬¾å°†ä¾ç…§ä¸€ä¸ªå¥½çš„ç±»å‹åº”æœ‰çš„è¡Œä¸ºæ¥æŒ‡å¯¼æˆ‘ä»¬classçš„è®¾è®¡, å¹¶ä¸€ä¸€åˆ—ä¸¾å‡ºæ¥.</p></blockquote><p>å½“æˆ‘ä»¬è¦è®¾è®¡ä¸€ä¸ª<code>class</code>æ—¶, è®©æˆ‘ä»¬å¯¹è‡ªå·±æå‡ºè¿™äº›é—®é¢˜å§ : </p><ul><li><p><strong>æ–°typeçš„å¯¹è±¡åº”è¯¥å¦‚ä½•åˆ›å»ºå’Œé”€æ¯?</strong></p><p>æƒ³æƒ³<code>class</code>çš„æ„é€ å’Œææ„æ˜¯å¦å¯ä»¥é»˜è®¤ç”Ÿæˆ ä¸èƒ½çš„è¯è¯¥æ€æ ·ç¼–å†™.</p><p>æƒ³æƒ³æ˜¯å¦è¦æ˜¯è®¾è®¡å†…å­˜çš„åˆ†é…å‡½æ•°å’Œé‡Šæ”¾å‡½æ•°.</p></li><li><p><strong>å¯¹è±¡çš„åˆå§‹åŒ–å’Œå¯¹è±¡çš„èµ‹å€¼è¯¥æœ‰ä»€ä¹ˆæ ·çš„å·®åˆ«?</strong></p><p>æƒ³æƒ³åœ¨<code>class</code>æ„é€ æ—¶éœ€è¦æœ‰ä»€ä¹ˆç‰¹æ®Šçš„æ­¥éª¤, ä»¥åŠæ˜¯å¦éœ€è¦è®¾ç½®ä¸€ä¸ª<code>init</code>å‡½æ•°è¾…åŠ©æ„é€ .</p><p>æƒ³æƒ³<code>copying</code>æ—¶çš„ç­–ç•¥æ˜¯æ€æ ·çš„. (è§æ¡æ¬¾14)</p></li><li><p><strong>æ–°typeçš„å¯¹è±¡å¦‚æœè¢« pass-by-value(ä»¥å€¼ä¼ å‚) , æ„å‘³ç€ä»€ä¹ˆ?</strong></p><p>è®°ä½copyæ„é€ å‡½æ•°ç”¨æ¥å®šä¹‰ä¸€ä¸ª<code>type</code>è¢« <code>pass-by-value</code> åº”å½“äº§ç”Ÿçš„è¡Œä¸º.</p></li><li><p><strong>ä»€ä¹ˆæ˜¯æ–°typeçš„â€åˆæ³•å€¼â€?</strong></p><p>æƒ³æƒ³classçš„æˆå‘˜å˜é‡åœ¨ä½ çš„é¢„æœŸä¸­æ˜¯å¦æœ‰ä¸€ä¸ªåˆæ³•çš„èŒƒå›´, æƒ³æƒ³è¯¥æ€æ ·çº¦æŸ.</p><p>æƒ³æƒ³æ˜¯å¦è¦è®¾ç½®è¶…å‡ºåˆæ³•èŒƒå›´æ—¶è§¦å‘çš„æ£€æŸ¥æœºåˆ¶.</p></li><li><p><strong>æ–°typeéœ€è¦é…åˆæŸä¸ªç»§æ‰¿å›¾ç³»å—?</strong></p><p>å¦‚æœå…¶ç»§æ‰¿è‡ªæŸäº›æ—¢æœ‰çš„<code>class</code>, ä½ å°±åº”å½“å—åˆ°é‚£äº›<code>class</code>è®¾è®¡çš„æŸç¼š, å¥½å¥½åˆ†æé‚£äº›<code>virtual</code>å‡½æ•°æ˜¯å¦è¦é‡å†™, å“ªäº›ä¸ç”¨.</p><p>å°¤å…¶çœ‹çœ‹ææ„å‡½æ•°æ˜¯å¦ä¸º<code>virtual</code>. (è§æ¡æ¬¾7)</p></li><li><p><strong>æ–°typeéœ€è¦ä»€ä¹ˆæ ·çš„è½¬æ¢?</strong></p><p>æƒ³æƒ³ä½ çš„<code>class</code>å¯ä»¥å’Œå…¶ä»–<code>class</code>äº§ç”Ÿä»€ä¹ˆå¯èƒ½ä¸”åˆç†çš„è½¬æ¢, å¦‚æœæœ‰å¯ä»¥è€ƒè™‘å®æ–½.</p><p>å¦‚æœæœ‰å°±å†™ä¸€ä¸ªç±»å‹è½¬æ¢å‡½æ•°æˆ–æ¥å—å…¶ä»–ç±»å‹çš„æ„é€ å‡½æ•°, æ²¡æœ‰è¯·å£°æ˜<code>explicit</code>.</p></li><li><p><strong>ä»€ä¹ˆæ ·çš„æ“ä½œç¬¦å’Œå‡½æ•°å¯¹æ­¤æ–°typeè€Œè¨€æ˜¯åˆç†çš„?</strong></p><p>è¿™ä¸ªå±äºä½ çš„è®¾è®¡ç§äº‹, ä½†ä¹Ÿå¿…é¡»è€ƒè™‘æ¸…æ¥š.</p></li><li><p><strong>ä»€ä¹ˆæ ·çš„é»˜è®¤æˆå‘˜å‡½æ•°åº”è¯¥é©³å›?</strong></p><p>å°†éœ€è¦é©³å›çš„æˆå‘˜å‡½æ•°è®¾ç½®ä¸º<code>private</code>æˆ–è€…ç›´æ¥<code>delete</code>æ‰. (è§æ¡æ¬¾6)</p></li><li><p><strong>è°è¯¥å–ç”¨æ–°typeçš„æˆå‘˜?</strong></p><p>æƒ³æƒ³å“ªäº›æˆå‘˜åº”è®¾ä¸º<code>public</code>, å“ªäº›åº”è®¾ä¸º<code>protected</code>, å“ªäº›åº”è®¾ä¸º<code>private</code>. </p><p>æƒ³æƒ³å“ªäº›<code>classes/functions</code>åº”æ˜¯<code>friends</code>. </p></li><li><p><strong>ä»€ä¹ˆæ˜¯æ–°typeçš„â€æœªå£°æ˜æ¥å£â€?</strong></p><p>æƒ³æƒ³ä½ çš„<code>class</code>ä¸å¯¹å¤–çš„åº•å±‚å‡½æ•°å¯ä»¥æä¾›ä»€ä¹ˆæ ·çš„æœåŠ¡, æ˜¯å¦è¿›è¡Œèµ„æºè¿ç”¨, æ˜¯å¦éœ€è¦åº”å¯¹å¤šçº¿ç¨‹æƒ…å†µ, ä»¥æ­¤åœ¨å®ç°ä¸­åŠ ä¸Šç›¸åº”çš„çº¦æŸæ¡ä»¶.</p></li><li><p><strong>æ–°typeæœ‰å¤šä¹ˆä¸€èˆ¬åŒ–?</strong></p><p>æƒ³æƒ³ä½ çš„<code>class</code>æ˜¯å¦è¦æ¥å—æ³›å‹ç¼–ç¨‹, æœ‰æ²¡æœ‰ä½¿ç”¨æ³›å‹ç¼–ç¨‹çš„å¿…è¦.</p></li><li><p><strong>çœŸçš„éœ€è¦ä¸€ä¸ªæ–°typeå—?</strong></p><p>æƒ³æƒ³çœŸçš„è¦å®šä¹‰ä¸€ä¸ªæ–°çš„classå—? åœ¨ä½ å®šä¹‰<code>derived class</code>æ—¶, å¦‚æœåªæ˜¯å•çº¯åœ°æƒ³æ·»åŠ ä¸€äº›æœºèƒ½, è€Œä¸æ˜¯å‡ºäºå¤šæ€è€ƒè™‘, é‚£ä¹ˆè¯´ä¸å®šå•çº¯å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ª <code>non-member</code> å‡½æ•°æˆ– <code>templates</code>, æ›´èƒ½å¤Ÿè¾¾åˆ°ç›®æ ‡. å°±åƒæ˜¯<code>STL</code>æºç ä¸­çš„<code>priority_queue</code>, ä¸ºäº†ä½¿ç”¨å †æœºåˆ¶å…¶å®å¹¶æ²¡å†å»ºç«‹ä¸€ä¸ªä¸“å±çš„å †ç±», è€Œæ˜¯å†™äº†å‡ ä¸ªç”¨äºè°ƒæ•´å †ç»“æ„çš„å‡½æ•°, å†å¥—åœ¨<code>vector</code>ä¸Šå°±å®ç°äº†å †çš„åŠŸèƒ½.</p></li></ul><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li><code>class</code>çš„è®¾è®¡å°±æ˜¯<code>type</code>çš„è®¾è®¡, åœ¨è®¾è®¡ä¸€ä¸ª<code>class</code>ä¹‹å‰è¯·ç¡®å®šæ€è€ƒè¿‡æœ¬æ¡æ¬¾æ‰€æå‡ºçš„æ‰€æœ‰é—®é¢˜.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾18 è®¾è®¡æ­£ç¡®æ˜“ç”¨çš„æ¥å£</title>
    <link href="/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE18%20%20%E8%AE%BE%E8%AE%A1%E6%AD%A3%E7%A1%AE%E6%98%93%E7%94%A8%E7%9A%84%E6%8E%A5%E5%8F%A3/"/>
    <url>/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE18%20%20%E8%AE%BE%E8%AE%A1%E6%AD%A3%E7%A1%AE%E6%98%93%E7%94%A8%E7%9A%84%E6%8E%A5%E5%8F%A3/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾18-è®©æ¥å£å®¹æ˜“è¢«æ­£ç¡®ä½¿ç”¨-ä¸æ˜“è¢«è¯¯ç”¨"><a href="#æ¡æ¬¾18-è®©æ¥å£å®¹æ˜“è¢«æ­£ç¡®ä½¿ç”¨-ä¸æ˜“è¢«è¯¯ç”¨" class="headerlink" title="æ¡æ¬¾18 : è®©æ¥å£å®¹æ˜“è¢«æ­£ç¡®ä½¿ç”¨, ä¸æ˜“è¢«è¯¯ç”¨."></a>æ¡æ¬¾18 : è®©æ¥å£å®¹æ˜“è¢«æ­£ç¡®ä½¿ç”¨, ä¸æ˜“è¢«è¯¯ç”¨.</h2><blockquote><p>C++åœ¨æ¥å£ä¹‹æµ·æ¼‚æµ®, ä¸€ä¸ªå¥½çš„æ¥å£å¾ˆå®¹æ˜“è¢«æ­£ç¡®ä½¿ç”¨, ä¸å®¹æ˜“è¢«è¯¯ç”¨.</p></blockquote><p>æ¡æ¬¾18å…¶å®æ˜¯ä¸€ä¸ªå¾ˆå®è§‚çš„æ¡æ¬¾, è®©æ¥å£å˜å¾—æ­£ç¡®æ˜“ç”¨, ç®€å•æ¥è¯´å°±æ˜¯â€<strong>ä¿ƒè¿›æ­£ç¡®ä½¿ç”¨</strong>â€œå’Œâ€<strong>é˜»æ­¢è¯¯ç”¨</strong>â€œ.</p><p>æˆ‘ä»¬å…ˆä»<strong>é˜»æ­¢è¯¯ç”¨</strong>çš„è§’åº¦è€ƒè™‘, å¯¹æ¥å£æ¥è¯´, æ˜¯å¦è¯¯ç”¨æ— éå°±æ˜¯å‚æ•°ä¼ é€’çš„ç±»å‹å¯¹ä¸å¯¹, å‚æ•°æ˜¯å¦åˆæ³•, æ˜¯å¦ç¬¦åˆè®¾è®¡è€…çš„è®¾æƒ³.</p><p>ä¹¦ä¸­ç»™å‡ºäº†ä¸€ä¸ªæ—¥æœŸç±», åˆ†åˆ«ç”±å¹´æœˆæ—¥çš„æˆå‘˜å˜é‡, æˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªç»™å‡ºçš„æ„é€ å‡½æ•° : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Date</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-built_in">Date</span>(<span class="hljs-type">int</span> month, <span class="hljs-type">int</span> day, <span class="hljs-type">int</span> year);<br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™æ ·è®¾è®¡åœ¨è®¾è®¡è€…çœ‹æ¥å¾ˆåˆç†, ä½†æ˜¯æ²¡æœ‰ä»»ä½•åˆæ³•æ€§æ£€æŸ¥åªä¼šå¸¦æ¥æ— ç©·çš„éšæ‚£, æˆ‘ä»¬å¯ä»¥ä»ä¸­çœ‹å‡ºä»¥ä¸‹é—®é¢˜ : </p><ul><li>å®¢æˆ·ä¸ä¸€å®šçŸ¥é“æ˜¯æŒ‰æœˆæ—¥å¹´çš„é¡ºåºæ¥è¾“å…¥, å¦‚æœæ˜¯æˆ‘ä»¬çš„æ—¥å¸¸ä¹ æƒ¯, å¯èƒ½ä¼šè¾“å…¥å¹´æœˆæ—¥.</li></ul><p>å¦‚ä½•ä½¿ç”¨æˆ·åœ¨ç¼–å†™è¿‡ç¨‹ä¸­å°±çŸ¥é“è‡ªå·±å†™é”™äº†å‘¢? </p><p>ä¹¦ä¸­å‘Šè¯‰æˆ‘ä»¬çš„æ–¹æ³•æ˜¯ : <strong>å¯¼å…¥æ–°ç±»å‹</strong>, å› ä¸ºé—®é¢˜çš„æ ¹æºæ˜¯å¹´æœˆæ—¥çš„å˜é‡ç±»å‹éƒ½æ˜¯ç›¸åŒçš„<code>int</code>, å¦‚æœè®¾å®šä¸ºä¸åŒçš„ç±»å‹, å°±å¯ä»¥ç¡®ä¿è¾“å…¥çš„æ­£ç¡®æ€§äº†, ä»£ç å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Day</span> &#123;            <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Month</span> &#123;                <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Year</span> &#123;<br>  <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Day</span><span class="hljs-params">(<span class="hljs-type">int</span> d)</span>     <span class="hljs-keyword">explicit</span> <span class="hljs-title">Month</span><span class="hljs-params">(<span class="hljs-type">int</span> m)</span>         <span class="hljs-keyword">explicit</span> <span class="hljs-title">Year</span><span class="hljs-params">(<span class="hljs-type">int</span> y)</span></span><br><span class="hljs-function">  :val(d) &#123;</span>&#125;              :<span class="hljs-built_in">val</span>(m) &#123;&#125;                    :<span class="hljs-built_in">val</span>(y)&#123;&#125;<br><br>  <span class="hljs-type">int</span> val;                <span class="hljs-type">int</span> val;                      <span class="hljs-type">int</span> val;<br>&#125;;                      &#125;;                            &#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Date</span> &#123;<br><span class="hljs-keyword">public</span>:<br><span class="hljs-built_in">Date</span>(<span class="hljs-type">const</span> Month&amp; m, <span class="hljs-type">const</span> Day&amp; d, <span class="hljs-type">const</span> Year&amp; y);<br>...<br>&#125;;<br><span class="hljs-function">Date <span class="hljs-title">d</span><span class="hljs-params">(<span class="hljs-number">30</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1995</span>)</span></span>;                      <span class="hljs-comment">// é”™è¯¯, ä¸æ˜¯int!</span><br><span class="hljs-function">Date <span class="hljs-title">d</span><span class="hljs-params">(Day(<span class="hljs-number">30</span>), Month(<span class="hljs-number">3</span>), Year(<span class="hljs-number">1995</span>))</span></span>;    <span class="hljs-comment">// é”™è¯¯, é¡ºåºé”™äº†!</span><br><span class="hljs-function">Date <span class="hljs-title">d</span><span class="hljs-params">(Month(<span class="hljs-number">3</span>), Day(<span class="hljs-number">30</span>), Year(<span class="hljs-number">1995</span>))</span></span>;    <span class="hljs-comment">// æ­£ç¡®, ç±»å‹å’Œé¡ºåºç›¸å¯¹åº”</span><br></code></pre></td></tr></table></figure><p>å½“ç„¶è¿˜æœ‰ä¸€äº›æ•°å€¼æˆ‘ä»¬å¯ä»¥æå‰é™åˆ¶, æ¯”å¦‚ä¸€å¹´è‚¯å®šåªæœ‰12ä¸ªæœˆ, æˆ‘ä»¬å°±å¯ä»¥è®©ç”¨æˆ·ä¸ç”¨ç›´æ¥é€šè¿‡æ„é€ ä¼ å‚, è€Œæ˜¯ç”¨å‡½æ•°è¿”å›éœ€æ±‚çš„<code>Month</code>å¯¹è±¡, ä»£ç å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Month</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-type">static</span> Month <span class="hljs-title">Jan</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-built_in">Month</span>(<span class="hljs-number">1</span>); &#125; <br>  <span class="hljs-function"><span class="hljs-type">static</span> Month <span class="hljs-title">Feb</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-built_in">Month</span>(<span class="hljs-number">2</span>); &#125;  <br>  ...                                       <br>  <span class="hljs-function"><span class="hljs-type">static</span> Month <span class="hljs-title">Dec</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-built_in">Month</span>(<span class="hljs-number">12</span>); &#125; <br>  ...                                      <br><span class="hljs-keyword">private</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Month</span><span class="hljs-params">(<span class="hljs-type">int</span> m)</span></span>;  <span class="hljs-comment">// ä¸è®©ç”¨æˆ·æ˜¾å¼ä½¿ç”¨æ„é€ , åªèƒ½é€šè¿‡æˆå‘˜å‡½æ•°å†…éƒ¨è°ƒç”¨</span><br>&#125;;<br><br><span class="hljs-function">Date <span class="hljs-title">d</span><span class="hljs-params">(Month::Mar(), Day(<span class="hljs-number">30</span>), Year(<span class="hljs-number">1995</span>))</span></span>;  <span class="hljs-comment">// è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è¿™æ ·è°ƒç”¨äº†</span><br></code></pre></td></tr></table></figure><p> ä¹¦ä¸­æå‡º<strong>ä»¥å‡½æ•°æ›¿æ¢å¯¹è±¡</strong>ä¹Ÿæ˜¯ä¸€ç§é¢„é˜²å®¢æˆ·è¾“å…¥é”™è¯¯çš„æ–¹å¼.</p><p>å½“ç„¶é€šè¿‡<strong>consté™åˆ¶ç±»å‹æ“ä½œ</strong>ä¹Ÿæ˜¯ä¸€ç§æ–¹å¼, è¿™é‡Œå°±ä¸å†ä¸¾ä¾‹.</p><hr><p>è®²å®Œäº†é˜»æ­¢è¯¯ç”¨, é‚£ä¹ˆå¦‚ä½•<strong>ä¿ƒè¿›æ­£ç¡®ä½¿ç”¨</strong>å‘¢? </p><p>æ­£ç¡®ä½¿ç”¨, ç®€å•æ¥è¯´å°±æ˜¯<strong>ç¬¦åˆä½¿ç”¨è€…çš„ä¹ æƒ¯</strong>, ä½¿ç”¨è€…çš„ä¹ æƒ¯æ˜¯ä»€ä¹ˆå‘¢? å½“ç„¶æ˜¯<strong>ä½¿ç”¨å†…ç½®ç±»å‹</strong>å‘€, ä½¿ç”¨è€…å½“ç„¶å¸Œæœ›å¯ä»¥åƒä½¿ç”¨<code>int</code>ä¸€æ ·ä½¿ç”¨å…¶ä»–è‡ªå®šä¹‰çš„ç±»å‹.</p><p>å› æ­¤ä¹¦ä¸­æå‡º: <strong>é™¤éæœ‰å¥½ç†ç”±, å¦åˆ™åº”è¯¥å°½é‡ä»¤ä½ çš„è‡ªå®šä¹‰ç±»å‹çš„è¡Œä¸ºä¸å†…ç½®ç±»å‹ä¸€è‡´.</strong></p><p>å®é™…æ¥è¯´å°±æ˜¯<strong>ç”¨å¥½è¿ç®—ç¬¦é‡è½½, æœ‰å¿…è¦æ—¶è€ƒè™‘è¿­ä»£å™¨çš„è®¾è®¡æ¨¡å¼</strong>.</p><hr><p>ä¹¦ä¸­è¿˜æå‡ºäº†ä¸€ä¸ªé‡è¦è§‚ç‚¹ : </p><ul><li><strong>ä»»ä½•æ¥å£å¦‚æœè¦æ±‚ç”¨æˆ·å¿…é¡»è®°å¾—åšæŸäº›äº‹æƒ…, å°±æ˜¯æœ‰è€…â€ä¸æ­£ç¡®ä½¿ç”¨â€çš„å€¾å‘.</strong></li></ul><blockquote><p>æ¥ä¸‹æ¥çš„å†…å®¹æœ‰å…³æ¡æ¬¾13å’Œ14, æ²¡æœ‰çœ‹è¿‡çš„å¯ä»¥çœ‹æˆ‘å¾€æœŸçš„åšå®¢.</p></blockquote><p>è®©æˆ‘ä»¬å›åˆ°æ¡æ¬¾13ä¸­æå‡ºçš„<code>createInvestment()</code>å·¥å‚å‡½æ•°, ä»–ä¼šè¿”å›ä¸€ä¸ªèµ„æºçš„åŸå§‹æŒ‡é’ˆ, è€Œæˆ‘ä»¬åº”å½“ç”¨<code>shared_ptr</code>å»å°è£…è¯¥æŒ‡é’ˆ, è¿™å°±æˆäº†ç”¨æˆ·å¿…é¡»è®°å¾—åšçš„äº‹æƒ…, é‚£ä¹ˆä¸ºäº†è®©è¯¥å‡½æ•°è¿”å›çš„å†…å®¹æ›´æ˜“ç”¨, æˆ‘ä»¬å¯ä»¥åœ¨ç›´æ¥è¿”å›ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆ, å‡½æ•°å£°æ˜å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Investment* createInvestment();</span><br><span class="hljs-function">std::shared_ptr&lt;Investment&gt; <span class="hljs-title">createInvestment</span><span class="hljs-params">()</span></span>;<br></code></pre></td></tr></table></figure><hr><p>å‡½æ•°å†…éƒ¨å®ç°å¹¶éæœ¬æ¡æ¬¾çš„é‡ç‚¹, ä½†æ˜¯ä¹¦ä¸­ä¹ŸèŠ±äº†éƒ¨åˆ†ç¯‡å¹…å»è®²è§£, æˆ‘ä¹Ÿä¼šè·Ÿç€è§£é‡Šæ¸…æ¥š, å…ˆçœ‹å†…éƒ¨çš„ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp">std::<span class="hljs-function">tr1::shared_ptr&lt;Investment&gt; <span class="hljs-title">createInvestment</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-function">std::shared_ptr&lt;Investment&gt; <span class="hljs-title">retVal</span><span class="hljs-params">(<span class="hljs-keyword">static_cast</span>&lt;Investment*&gt;(<span class="hljs-literal">nullptr</span>), getRidOfInvestment)</span></span>;<br>    <br>  ...                                <span class="hljs-comment">// ä¸­é—´éƒ¨åˆ†å®ç°å·¥å‚å‡½æ•°çš„å†…å­˜åˆ†é…æ­¥éª¤</span><br>      <br>  <span class="hljs-keyword">return</span> retVal;<br>&#125;<br></code></pre></td></tr></table></figure><p>çœ‹åˆ°<code>shared_ptr</code>æ„é€ çš„ä¸¤ä¸ªå‚æ•°æˆ‘ä»¬å¯èƒ½ä¼šæœ‰ç‚¹æ‡µ, æˆ‘ä»¬æ¥ä¸€ä¸ªä¸ªåˆ†æ : </p><p>é¦–å…ˆæˆ‘ä»¬æ˜ç¡®<code>stl</code>ä¸­<code>shared_ptr</code>æ„é€ çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<strong>åŸå§‹èµ„æºç±»å‹çš„æŒ‡é’ˆ</strong>, ç¬¬äºŒä¸ªå‚æ•°æ˜¯<strong>åˆ é™¤å™¨å‡½æ•°</strong>.</p><p>å…ˆè®²ç¬¬äºŒä¸ªå‚æ•°, çœ‹è¿‡æ¡æ¬¾14çš„éƒ½çŸ¥é“, <code>getRidOfInvestmen</code>tåº”å½“æ˜¯æˆ‘ä»¬æä¾›ç»™<code>shared_ptr</code>åœ¨ææ„æ—¶ä½¿ç”¨çš„å‡½æ•°, å®ƒå­˜åœ¨çš„æ„ä¹‰åœ¨äºæŸäº›ç±»å‹æ²¡æœ‰ä¼ ç»Ÿçš„ææ„, è€Œæ˜¯ä¸€äº›ç‰¹æ®Šçš„é‡Šæ”¾å‡½æ•°, éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è°ƒç”¨, æˆ‘ä»¬æŠŠè¿™äº›å‡½æ•°æ”¾åœ¨åˆ é™¤å™¨ä¸­, å°±å¯ä»¥åŒ–æ‰‹åŠ¨ä¸ºè‡ªåŠ¨, æˆ‘ä»¬è¿™é‡Œæ˜¯å‡å®š<code>Investment</code>æ˜¯æœ‰è¿™ç§éœ€æ±‚çš„ç±»å‹, å¦‚æœä¸æ˜¯å½“ç„¶å¯ä»¥ä¸å†™. è¿™ç§ç”±è®¾è®¡è€…è‡ªå·±å®šåˆ¶åˆ é™¤å™¨çš„è¡Œä¸ºå…¶å®ä¹Ÿæ˜¯åœ¨å‡å°‘å®¢æˆ·ä¸å¿…è¦çš„é‡Šæ”¾æ­¥éª¤, ä¸æœ¬æ¡æ¬¾çš„ç†å¿µç›¸ç¬¦åˆ.</p><p>æ¥ä¸‹æ¥æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°, æˆ‘ä»¬åº”å½“ä¼ å…¥ä¸€ä¸ªåŸå§‹èµ„æºç±»å‹çš„æŒ‡é’ˆ, æŒ‰é“ç†æ¥è¯´åº”è¯¥æ˜¯é€šè¿‡<code>new Investment()</code> è¿”å›ä¸€ä¸ªæŒ‡é’ˆç›´æ¥å­˜è¿›å», ä½†è¿™é‡Œé€‰æ‹©å…ˆä¸è¿›è¡ŒåŠ¨æ€åˆ†é…, ç›´æ¥å­˜å…¥ä¸€ä¸ª<code>nullptr</code>, è€Œä¸”ç”±äº<code>shared_ptr</code>æ„é€ ä¸å…è®¸éšå¼ç±»å‹è½¬æ¢, æ‰€ä»¥è¦æŠŠ<code>nullptr</code>å¼ºè½¬æˆ<code>Investment*</code>ç±»å‹, ä¹Ÿå°±æ˜¯<code>static_cast&lt;Investment*&gt;(nullptr)</code>äº†, å› æ­¤<code>retVal</code>åˆšç”Ÿæˆæ—¶å¹¶æ²¡æœ‰åˆ†é…åˆ°èµ„æº, æ˜¯åœ¨æ¥ä¸‹æ¥ä¸­é—´éƒ¨åˆ†å®ç°å†…å­˜åˆ†é….</p><p>è¿™é‡Œæ·±å…¥ä¸€ä¸‹, ä¸ºä»€ä¹ˆå·¥å‚å‡½æ•°ä¸­è¦å…ˆæ„é€ æŒ‡é’ˆå†åˆ†é…å†…å­˜, è€Œä¸æ˜¯å…ˆåˆ†é…å†…å­˜å†ç»™æŒ‡é’ˆæ„é€ ? è¿™é‡Œæœ‰ä¸¤ç‚¹åŸå›  : </p><ol><li><p>å¯èƒ½éœ€è¦<strong>é€šè¿‡ä¸åŒçš„æ¡ä»¶ä»¥ä¸åŒçš„æ–¹å¼åˆ†é…å†…å­˜</strong>, è¿™æ˜¯ä¹Ÿæ˜¯å·¥å‚å‡½æ•°å­˜åœ¨çš„æ„ä¹‰æ‰€åœ¨.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">std::shared_ptr&lt;Investment&gt; <span class="hljs-title">createInvestment</span><span class="hljs-params">(<span class="hljs-type">bool</span> isPremium)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function">std::shared_ptr&lt;Investment&gt; <span class="hljs-title">retVal</span><span class="hljs-params">(<span class="hljs-keyword">static_cast</span>&lt;Investment*&gt;(<span class="hljs-literal">nullptr</span>), getRidOfInvestment)</span></span>;<br><br>    <span class="hljs-comment">// æ ¹æ®æ¡ä»¶é€‰æ‹©ä¸åŒçš„åˆ†é…æ–¹å¼</span><br>    <span class="hljs-keyword">if</span> (isPremium) &#123;<br>        retVal = std::<span class="hljs-built_in">make_shared</span>&lt;PremiumInvestment&gt;();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        retVal = std::<span class="hljs-built_in">make_shared</span>&lt;RegularInvestment&gt;();<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> retVal;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ†æä»¥ä¸Šä»£ç , æˆ‘ä»¬å¯ä»¥çŸ¥é“<code>Investment*</code>çš„é™æ€ç±»å‹æ˜¯ä¸€ä¸ªåŸºç±»æŒ‡é’ˆ, ä½†æ˜¯é€šè¿‡<code>isPremium</code>å’Œå¤šæ€æœºåˆ¶, æˆ‘ä»¬å¯ä»¥æ ¹æ®ä¼ å…¥çš„<code>isPremium</code>æ¥é€‰æ‹©å…¶åŠ¨æ€ç±»å‹æ˜¯æ´¾ç”Ÿç±»çš„<code>PremiumInvestment</code>è¿˜æ˜¯<code>RegularInvestment</code>è¿›è€Œäº§ç”Ÿä¸åŒçš„å†…å­˜åˆ†é…ç­–ç•¥, è€Œè¿™èµ·ç è¦æˆ‘ä»¬å…ˆæœ‰ä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡æ‰è¡Œ.</p></li><li><p><strong>åˆ†é…å†…å­˜æ˜¯æœ‰å¯èƒ½å‡ºç°å¼‚å¸¸çš„</strong>, å¦‚æœå‡ºç°å¼‚å¸¸å…ˆå‰åˆ†é…çš„å†…å­˜å°±æ³„éœ²äº†, ä½†å¦‚æœæå‰æ„é€ æŒ‡é’ˆ, å†ç”¨<code>make_shared</code>å‡½æ•°è·å–å†…å­˜, å°±ç®—å‘ç”Ÿå¼‚å¸¸ä¹Ÿä¸€å®šæ˜¯å®‰å…¨çš„, å› ä¸º<strong>æŒ‡é’ˆä¼šè°ƒç”¨ææ„æŠŠå…ˆå‰çš„å†…å­˜é‡Šæ”¾</strong>.</p></li></ol><p>ä¹Ÿè®¸ç•¥å¾®æœ‰äº›è·‘é¢˜, ä½†æ˜¯æˆ‘è§‰å¾—èƒ½çœ‹é€é—®é¢˜çš„æœ¬è´¨æ‰æ˜¯æœ€é‡è¦çš„, å› æ­¤å¤šä¸‹äº†ä¸€äº›åŠŸå¤«.</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li><strong>é˜»æ­¢è¯¯ç”¨çš„æ–¹æ³•åŒ…æ‹¬ : å¯¼å…¥æ–°ç±»å‹, ä»¥å‡½æ•°æ›¿æ¢å¯¹è±¡, åˆ©ç”¨consté™åˆ¶, æ¶ˆé™¤å®¢æˆ·çš„èµ„æºç®¡ç†è´£ä»», ä¸è¦è®©å®¢æˆ·å¿…é¡»è®°å¾—æŸäº›äº‹æƒ….</strong></li><li><strong>ä¿ƒè¿›æ­£ç¡®ä½¿ç”¨çš„æ–¹æ³•åŒ…æ‹¬ : ä¿è¯æ¥å£çš„ä¸€è‡´æ€§, ä¸å†…ç½®ç±»å‹è¡Œä¸ºå…¼å®¹.</strong></li><li>å¯ä»¥é€šè¿‡è®¾å®šå®šåˆ¶çš„åˆ é™¤å™¨å‡å°‘å®¢æˆ·æ‰‹åŠ¨è°ƒç”¨é‡Šæ”¾å‡½æ•°çš„è´Ÿæ‹….</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾16-17 new å’Œ delete</title>
    <link href="/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE16-17%20new%20%E5%92%8C%20delete/"/>
    <url>/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE16-17%20new%20%E5%92%8C%20delete/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾16-æˆå¯¹ä½¿ç”¨newå’Œdeleteæ—¶è¦é‡‡ç”¨ç›¸åŒå½¢å¼"><a href="#æ¡æ¬¾16-æˆå¯¹ä½¿ç”¨newå’Œdeleteæ—¶è¦é‡‡ç”¨ç›¸åŒå½¢å¼" class="headerlink" title="æ¡æ¬¾16 : æˆå¯¹ä½¿ç”¨newå’Œdeleteæ—¶è¦é‡‡ç”¨ç›¸åŒå½¢å¼"></a>æ¡æ¬¾16 : æˆå¯¹ä½¿ç”¨newå’Œdeleteæ—¶è¦é‡‡ç”¨ç›¸åŒå½¢å¼</h2><p>ç›´æ¥çœ‹ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp">std::string *stringPtr1 = <span class="hljs-keyword">new</span> std::string;<br>std::string *stringPtr2 = <span class="hljs-keyword">new</span> std::string[<span class="hljs-number">100</span>];<br>...<br><span class="hljs-keyword">delete</span> stringPtr1;                     <br><span class="hljs-keyword">delete</span> [] stringPtr2;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå…¶å®æ²¡ä»€ä¹ˆå¥½è¯´çš„, å…¶å®å°±æ˜¯ç›¸å¯¹åº”å°±è¡Œ.</p><hr><h2 id="æ¡æ¬¾17-ä»¥ç‹¬ç«‹è¯­å¥å°†newedå¯¹è±¡ç½®å…¥æ™ºèƒ½æŒ‡é’ˆ"><a href="#æ¡æ¬¾17-ä»¥ç‹¬ç«‹è¯­å¥å°†newedå¯¹è±¡ç½®å…¥æ™ºèƒ½æŒ‡é’ˆ" class="headerlink" title="æ¡æ¬¾17 : ä»¥ç‹¬ç«‹è¯­å¥å°†newedå¯¹è±¡ç½®å…¥æ™ºèƒ½æŒ‡é’ˆ"></a>æ¡æ¬¾17 : ä»¥ç‹¬ç«‹è¯­å¥å°†newedå¯¹è±¡ç½®å…¥æ™ºèƒ½æŒ‡é’ˆ</h2><p>åœ¨æ¡æ¬¾15æˆ‘ä»¬çŸ¥é“Cé£æ ¼APIå–œæ¬¢ç›´æ¥è°ƒç”¨åŸå§‹èµ„æº, é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¸ç”¨ç›´æ¥è°ƒç”¨åŸå§‹èµ„æºçš„API : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">processWidget</span><span class="hljs-params">(std::tr1::shared_ptr&lt;Widget&gt; pw, <span class="hljs-type">int</span> priority)</span></span>;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°ç”¨æ¥åœ¨æŸåŠ¨æ€åˆ†é…çš„Widgetä¸Šè¿›è¡ŒæŸäº›å¸¦æœ‰ä¼˜å…ˆæƒçš„æ“ä½œ, æ‰€ä»¥éœ€è¦ä¼ å…¥ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆå’Œä¸€ä¸ªä¼˜å…ˆåº¦, é‚£ä¹ˆç°åœ¨<strong>å‡å®šå»æ±‚ä¼˜å…ˆåº¦å…¶å®æ˜¯ä¸€ä¸ªå¾ˆå¤æ‚çš„è¿‡ç¨‹</strong>, æˆ‘ä»¬éœ€è¦é¢å¤–å°è£…ä¸€ä¸ªå‡½æ•°æ¥è¿”å›æ±‚å¾—çš„ä¼˜å…ˆåº¦ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">priority</span><span class="hljs-params">()</span></span>;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬è®¾æƒ³çš„è°ƒç”¨<code>processWidget</code>çš„æ–¹æ³•å¯èƒ½æ˜¯è¿™æ ·çš„ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">processWidget</span>(<span class="hljs-keyword">new</span> Widget, <span class="hljs-built_in">priority</span>());<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>priority()</code>å‡½æ•°åµŒå¥—æ˜¯æ²¡æœ‰é—®é¢˜çš„, æˆ‘ä»¬æ—¥å¸¸ä¸­ä¹Ÿæ¨èå¤šç”¨è¿™ç§æ‰‹æ³•, ä½†æ˜¯å‰é¢çš„newå°±æœ‰é—®é¢˜äº†, å› ä¸º<code>shared_ptr</code>ä¸æ”¯æŒéšå¼è½¬æ¢, ä¹Ÿå°±æ˜¯æ— æ³•é€šè¿‡<code>new</code>å‡ºä¸€ä¸ª<code>Widget*</code>å†è½¬æ¢æˆ<code>shared_ptr&lt;Widget&gt;</code>, é‚£ä¹ˆä¸‹é¢çš„ä¿®æ”¹æ˜¯å¦åˆç† : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">processWidget</span>(std::tr1::<span class="hljs-built_in">shared_ptr</span>&lt;Widget&gt;(<span class="hljs-keyword">new</span> Widget), <span class="hljs-built_in">priority</span>());<br></code></pre></td></tr></table></figure><p>ä¸€çœ¼çœ‹ä¸Šå»éå¸¸åˆç†, ä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€äº›éšæ‚£åœ¨å…¶ä¸­, æˆ‘ä»¬çŸ¥é“<code>priority()</code>æ˜¯ä¸€ä¸ªå¾ˆå¤æ‚çš„è¿‡ç¨‹, æ—¢ç„¶å¤æ‚å°±æœ‰å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸, æŠ›å‡ºå¼‚å¸¸æœ¬èº«å¹¶ä¸å¯æ€•, æˆ‘ä»¬å¯ä»¥è®¾ç½®å¯¹åº”çš„å¤„ç†é€»è¾‘, ä½†æ˜¯åœ¨è¿™æ ·çš„è°ƒç”¨å‘ç”Ÿå¼‚å¸¸å°±æœ‰é¢å¤–çš„é—®é¢˜äº†.</p><p>é—®é¢˜æ ¸å¿ƒåœ¨äº<strong>C++åœ¨å‡½æ•°å‚æ•°çš„è°ƒç”¨ä¸Šå¼¹æ€§å¾ˆå¤§, å¹¶ä¸ç¡®å®šå®é™…çš„è°ƒç”¨æ­¥éª¤</strong> , çœŸæ­£çš„è°ƒç”¨æ­¥éª¤ç”±ç¼–è¯‘å™¨é€‰æ‹©æ•ˆç‡æœ€é«˜çš„æ­¥éª¤.</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æŒ‰é¡ºåºä¼šå‘ç”Ÿä»€ä¹ˆ : </p><ul><li>æ‰§è¡Œ <code>&quot;new Widget&quot;</code> è¡¨è¾¾å¼</li><li>è°ƒç”¨<code>shared_ptr</code>æ„é€ å‡½æ•°</li><li>è°ƒç”¨<code>priority()</code></li></ul><p>è™½ç„¶æˆ‘ä»¬ç¡®å®šæ‰§è¡Œ <code>&quot;new Widget&quot;</code> è¡¨è¾¾å¼ä¸€å®šåœ¨è°ƒç”¨<code>shared_ptr</code>æ„é€ å‡½æ•°ä¹‹å‰, ä½†æ˜¯æˆ‘ä»¬ç¡®å®ä¸ç¡®å®š<code>priority()</code>çš„è°ƒç”¨æ—¶æœº : </p><ul><li>æ‰§è¡Œ <code>&quot;new Widget&quot;</code> è¡¨è¾¾å¼</li><li>è°ƒç”¨<code>priority()</code></li><li>è°ƒç”¨<code>shared_ptr</code>æ„é€ å‡½æ•°</li></ul><p>å¦‚æœæ˜¯è¿™æ ·çš„è¯, åœ¨priority()è°ƒç”¨è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¼‚å¸¸, å°±ç®—ä¹‹åå¼‚å¸¸å¾—åˆ°äº†å¤„ç†,<code> &quot;new Widget&quot;</code>å¾—åˆ°çš„èµ„æºä¹Ÿå¾ˆå¤§å¯èƒ½æ˜¯è¢«æ³„éœ²äº†.</p><p>è¿™ä¸€åˆ‡çš„é—®é¢˜æ¥æºäº<strong>åœ¨â€èµ„æºè¢«åˆ›å»ºâ€å’Œâ€èµ„æºè¢«è½¬æ¢ä¸ºèµ„æºç®¡ç†å¯¹è±¡â€ä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹é—´æœ‰å¯èƒ½å‘ç”Ÿå¼‚å¸¸å¹²æ‰°</strong>.</p><p>è§£å†³æ–¹æ³•å¾ˆç®€å•, é‚£å°±æ˜¯æ ‡é¢˜ : <strong>åšæŒä»¥ç‹¬ç«‹è¯­å¥å°†newedå¯¹è±¡ç½®å…¥æ™ºèƒ½æŒ‡é’ˆ</strong>, è¿™æ ·å°±å¯ä»¥æœç»ä¸€åˆ‡å¼‚å¸¸å¹²æ‰°äº†.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">std::shared_ptr&lt;Widget&gt; <span class="hljs-title">pw</span><span class="hljs-params">(<span class="hljs-keyword">new</span> Widget)</span></span>;  <br><span class="hljs-built_in">processWidget</span>(pw, <span class="hljs-built_in">priority</span>()); <br></code></pre></td></tr></table></figure><p>äºæ˜¯ä»¥ä¸Šæ“ä½œå°±æ²¡æœ‰ä»»ä½•é—®é¢˜äº†!</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>æˆå¯¹ä½¿ç”¨<code>new</code>å’Œ<code>delete</code>æ—¶è¦é‡‡ç”¨ç›¸åŒå½¢å¼.</li><li>ä»¥ç‹¬ç«‹è¯­å¥å°†<code>newed</code>å¯¹è±¡ç½®å…¥æ™ºèƒ½æŒ‡é’ˆ.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾15 åœ¨èµ„æºç®¡ç†ç±»ä¸­æä¾›å¯¹åŸå§‹èµ„æºçš„è®¿é—®</title>
    <link href="/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE15%20%E5%9C%A8%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%B1%BB%E4%B8%AD%E6%8F%90%E4%BE%9B%E5%AF%B9%E5%8E%9F%E5%A7%8B%E8%B5%84%E6%BA%90%E7%9A%84%E8%AE%BF%E9%97%AE/"/>
    <url>/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE15%20%E5%9C%A8%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%B1%BB%E4%B8%AD%E6%8F%90%E4%BE%9B%E5%AF%B9%E5%8E%9F%E5%A7%8B%E8%B5%84%E6%BA%90%E7%9A%84%E8%AE%BF%E9%97%AE/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾15-åœ¨èµ„æºç®¡ç†ç±»ä¸­æä¾›å¯¹åŸå§‹èµ„æºçš„è®¿é—®"><a href="#æ¡æ¬¾15-åœ¨èµ„æºç®¡ç†ç±»ä¸­æä¾›å¯¹åŸå§‹èµ„æºçš„è®¿é—®" class="headerlink" title="æ¡æ¬¾15 : åœ¨èµ„æºç®¡ç†ç±»ä¸­æä¾›å¯¹åŸå§‹èµ„æºçš„è®¿é—®"></a>æ¡æ¬¾15 : åœ¨èµ„æºç®¡ç†ç±»ä¸­æä¾›å¯¹åŸå§‹èµ„æºçš„è®¿é—®</h2><blockquote><p>æˆ‘ä»¬å°†èµ„æºå­˜å…¥èµ„æºç®¡ç†ç±», ä¸ºçš„æ˜¯å¯ä»¥å…å»èµ„æºç®¡ç†çš„éº»çƒ¦, ä½†åŒæ—¶æˆ‘ä»¬ä¹Ÿå¸Œæœ›<strong>å¯ä»¥æ­£å¸¸åˆç†åœ°é€šè¿‡èµ„æºç®¡ç†ç±»æ¥ä½¿ç”¨èµ„æº, å°±åƒç›´æ¥ä½¿ç”¨èµ„æºä¸€æ ·</strong>, ä¸ºæ­¤æˆ‘ä»¬ä¸€å®šéœ€è¦åœ¨èµ„æºç®¡ç†ç±»ä¸­æä¾›å¯¹åŸå§‹èµ„æºçš„è®¿é—®;</p></blockquote><p>æˆ‘ä»¬å…ˆæ¥è§£ç­”ä¸€äº›ç–‘é—® : </p><ul><li><h4 id="ä¸ºä»€ä¹ˆè¦å¯¹åŸå§‹èµ„æºè¿›è¡Œè®¿é—®-ä¸ºä»€ä¹ˆè¦è·å–åŸå§‹èµ„æºçš„æŒ‡é’ˆ"><a href="#ä¸ºä»€ä¹ˆè¦å¯¹åŸå§‹èµ„æºè¿›è¡Œè®¿é—®-ä¸ºä»€ä¹ˆè¦è·å–åŸå§‹èµ„æºçš„æŒ‡é’ˆ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å¯¹åŸå§‹èµ„æºè¿›è¡Œè®¿é—®(ä¸ºä»€ä¹ˆè¦è·å–åŸå§‹èµ„æºçš„æŒ‡é’ˆ)?"></a>ä¸ºä»€ä¹ˆè¦å¯¹åŸå§‹èµ„æºè¿›è¡Œè®¿é—®(ä¸ºä»€ä¹ˆè¦è·å–åŸå§‹èµ„æºçš„æŒ‡é’ˆ)?</h4><p>æœ‰æ—¶å€™éœ€è¦æˆ‘ä»¬ä¼ é€’åŸå§‹èµ„æºçš„æŒ‡é’ˆ, å› ä¸ºå¾ˆå¤š<code>C API</code>éƒ½æ˜¯è¦æ±‚ä¼ é€’åŸå§‹æŒ‡é’ˆæ‰èƒ½è¿ä½œ.</p></li><li><h4 id="å¦‚ä½•è¿›è¡Œèµ„æºè®¿é—®å‘¢"><a href="#å¦‚ä½•è¿›è¡Œèµ„æºè®¿é—®å‘¢" class="headerlink" title="å¦‚ä½•è¿›è¡Œèµ„æºè®¿é—®å‘¢?"></a>å¦‚ä½•è¿›è¡Œèµ„æºè®¿é—®å‘¢?</h4><p><strong>æ˜¾å¼è½¬æ¢</strong> æˆ– <strong>éšå¼è½¬æ¢</strong> .</p></li></ul><hr><p><strong>æ˜¾ç¤ºè½¬æ¢</strong> : èµ„æºç®¡ç†ç±»ç›´æ¥æä¾›ä¸€ä¸ªè¿”å›åŸå§‹èµ„æºçš„<code>get()</code>å‡½æ•°, <code>C++</code>æä¾›çš„æ™ºèƒ½æŒ‡é’ˆä¹Ÿæä¾›ç›¸åº”çš„åŠŸèƒ½.</p><p>ä¹¦ä¸­ä¸¾äº†ä¸€ä¸ªæœ‰å…³å­—ä½“èµ„æºç®¡ç†çš„ä¾‹å­, ä»£ç å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Font</span> &#123;                           <span class="hljs-comment">// å¯¹äºFontHandleçš„èµ„æºç®¡ç†ç±»</span><br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Font</span><span class="hljs-params">(FontHandle fh)</span> :f(fh) &#123;</span>&#125;                                   <br>  ~<span class="hljs-built_in">Font</span>() &#123; <span class="hljs-built_in">releaseFont</span>(f); &#125;         <br>    <br>    <span class="hljs-function">FontHandle <span class="hljs-title">get</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> f; &#125; <span class="hljs-comment">// ç›´æ¥æ˜¾ç¤ºè°ƒç”¨è¯¥å‡½æ•°å³å¯è·å¾—è¯¥èµ„æº</span><br><br><span class="hljs-keyword">private</span>:<br>  FontHandle f;                        <span class="hljs-comment">// åŸå§‹çš„å­—ä½“èµ„æºæŒ‡é’ˆ</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>å‡è®¾æœ‰ä¸€ä¸ª<code>C API</code>å¯ä»¥é€šè¿‡æ¥å—å­—ä½“èµ„æºå’Œå­—ä½“å¤§å°æ¥æ”¹å˜å­—ä½“ :</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// è¿™æ˜¯å‡½æ•°</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">changeFont</span><span class="hljs-params">(FontHandle f, <span class="hljs-type">int</span> newSize)</span></span>;     <span class="hljs-comment">// Cé£æ ¼çš„APIå‡½æ•°</span><br><span class="hljs-comment">// ä»¥ä¸‹æ˜¯ç”¨æˆ·å…·ä½“ä½¿ç”¨ä¾‹å­</span><br><span class="hljs-function">Font <span class="hljs-title">f</span><span class="hljs-params">(getFont())</span></span>;<br><span class="hljs-type">int</span> newFontSize;<br>...<br><span class="hljs-built_in">changeFont</span>(f.<span class="hljs-built_in">get</span>(), newFontSize);<span class="hljs-comment">// ä½¿ç”¨f.get()</span><br></code></pre></td></tr></table></figure><hr><p><strong>éšå¼è½¬æ¢</strong> : <strong>æä¾›operator-&gt;å’Œoperator*çš„é‡è½½</strong> æˆ– <strong>ç›´æ¥æä¾›éšå¼è½¬æ¢å‡½æ•°</strong></p><p>å‰è€…æ”¯æŒå°†èµ„æºç®¡ç†ç±»æŒ‡é’ˆéšå¼è½¬æ¢ä¸ºåº•éƒ¨åŸå§‹æŒ‡é’ˆ, ä»¥æ­¤å¯ä»¥ç›´æ¥è°ƒç”¨èµ„æºå‡½æ•°æˆ–å–å‡ºèµ„æºæˆå‘˜å˜é‡ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Font</span> &#123;                           <span class="hljs-comment">// å¯¹äºFontHandleçš„èµ„æºç®¡ç†ç±»</span><br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Font</span><span class="hljs-params">(FontHandle fh)</span> :f(fh) &#123;</span>&#125;                                   <br>  ~<span class="hljs-built_in">Font</span>() &#123; <span class="hljs-built_in">releaseFont</span>(f); &#125;         <br>    <br>    <span class="hljs-function">FontHandle <span class="hljs-title">get</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> f; &#125; <span class="hljs-comment">// ç›´æ¥æ˜¾ç¤ºè°ƒç”¨è¯¥å‡½æ•°å³å¯è·å¾—è¯¥èµ„æº</span><br>    <br>    <span class="hljs-comment">// é‡è½½ operator-&gt;ï¼Œè¿”å›åŸå§‹çš„ FontHandle æŒ‡é’ˆ</span><br>    FontHandle* <span class="hljs-keyword">operator</span>-&gt;() &#123;<br>        <span class="hljs-keyword">return</span> &amp;f;  <span class="hljs-comment">// è¿”å› FontHandle çš„æŒ‡é’ˆï¼Œå…è®¸è®¿é—® FontHandle çš„æˆå‘˜</span><br>    &#125;<br><br>    <span class="hljs-comment">// é‡è½½ operator*ï¼Œè¿”å›å¯¹ FontHandle çš„å¼•ç”¨</span><br>    FontHandle&amp; <span class="hljs-keyword">operator</span>*() &#123;<br>        <span class="hljs-keyword">return</span> f;  <span class="hljs-comment">// è¿”å› FontHandle çš„å¼•ç”¨ï¼Œå…è®¸è®¿é—® FontHandle çš„æˆå‘˜</span><br>    &#125;<br><br><span class="hljs-keyword">private</span>:<br>  FontHandle f;                        <span class="hljs-comment">// åŸå§‹çš„å­—ä½“èµ„æºæŒ‡é’ˆ</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®Œå…¨å°†èµ„æºç®¡ç†ç±»å½“åšä¸€ä¸ªæŒ‡é’ˆçœ‹å¾…, <strong>é€šè¿‡*å–å‡ºåŸå§‹èµ„æº, é€šè¿‡-&gt;è°ƒç”¨åŸå§‹èµ„æºçš„æˆå‘˜</strong>.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">changeFont</span>(*f, newFontSize);  <span class="hljs-comment">// å‡è£…fæ˜¯ä¸€ä¸ªæŒ‡é’ˆ, é€šè¿‡è§£å¼•ç”¨è°ƒå‡ºèµ„æº</span><br></code></pre></td></tr></table></figure><hr><p>åè€…åœ¨ä½¿ç”¨èµ„æºç®¡ç†ç±»æ—¶å°±ä¼šé»˜è®¤è½¬æ¢åˆ°åº•éƒ¨åŸå§‹æŒ‡é’ˆ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Font</span> &#123;                           <span class="hljs-comment">// å¯¹äºFontHandleçš„èµ„æºç®¡ç†ç±»</span><br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Font</span><span class="hljs-params">(FontHandle fh)</span> :f(fh) &#123;</span>&#125;                                   <br>  ~<span class="hljs-built_in">Font</span>() &#123; <span class="hljs-built_in">releaseFont</span>(f); &#125;         <br>    <br>    <span class="hljs-function"><span class="hljs-keyword">operator</span> <span class="hljs-title">FontHandle</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> f; &#125;        <span class="hljs-comment">// éšå¼è½¬æ¢å‡½æ•°</span><br><br><span class="hljs-keyword">private</span>:<br>  FontHandle f;                        <span class="hljs-comment">// åŸå§‹çš„å­—ä½“èµ„æºæŒ‡é’ˆ</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™æ ·ç›´æ¥å†™få°±è¡Œäº† : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">changeFont</span>(f, newFontSize);<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ä¹¦ä¸­å¹¶ä¸æ¨èè¿™æ ·ä½¿ç”¨, å› ä¸ºè¿™æ˜¯ä¸€ç§<strong>å®Œå…¨æŠŠèµ„æºç®¡ç†ç±»ä½œä¸ºåŸå§‹èµ„æº</strong>çš„åšæ³•, ä¹Ÿå°±æ˜¯è¯´<strong>æ— æ³•å†ä½¿ç”¨æœ‰å…³ä»»ä½•èµ„æºç®¡ç†ç±»è‡ªå·±çš„æ“ä½œ</strong>, å½“æˆ‘ä»¬æƒ³è¿›è¡Œèµ„æºç®¡ç†ç±»çš„æ‹·è´èµ‹å€¼ç­‰æ“ä½œæ—¶, ç”±äºå·²ç»éšå¼è½¬æ¢ä¸ºäº†èµ„æº, è¿™æ ·åšå‡ ä¹ä¸ä¼šæœ‰å¥½ä¸‹åœº, å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¿è¯å®Œå…¨ä¸ä½¿ç”¨ä¹Ÿä¸è®¾è®¡è¿™ç±»æ“ä½œ, è®©å®ƒå•ç‹¬åšå¥½èµ„æºç®¡ç†çš„æœ¬èŒå·¥ä½œ, ä¹Ÿæ˜¯å®Œå…¨å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•çš„.</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li><code>API</code> å¾€å¾€è¦æ±‚è®¿é—®åŸå§‹èµ„æº, æ‰€ä»¥<strong>æ¯ä¸ªèµ„æºç®¡ç†ç±»éƒ½åº”æä¾›ä¸€ä¸ªå–å¾—å…¶åŸå§‹èµ„æºçš„æ–¹æ³•</strong>.</li><li>å¯¹äºåŸå§‹èµ„æºçš„è®¿é—®, æ˜¾ç¤ºè½¬æ¢ä¸€èˆ¬æ¯”è¾ƒ<strong>å®‰å…¨</strong>, ä½†éšå¼è½¬æ¢å¯¹å®¢æˆ·æ¯”è¾ƒ<strong>æ–¹ä¾¿</strong>, è‡ªå·±æ–Ÿé…Œåˆ©å¼Š.</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾14 åœ¨èµ„æºç®¡ç†ç±»ä¸­å°å¿ƒ copying è¡Œä¸º</title>
    <link href="/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE14%20%E5%9C%A8%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%B1%BB%E4%B8%AD%E5%B0%8F%E5%BF%83%20copying%20%E8%A1%8C%E4%B8%BA/"/>
    <url>/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE14%20%E5%9C%A8%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%B1%BB%E4%B8%AD%E5%B0%8F%E5%BF%83%20copying%20%E8%A1%8C%E4%B8%BA/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾14-åœ¨èµ„æºç®¡ç†ç±»ä¸­å°å¿ƒ-copying-è¡Œä¸º"><a href="#æ¡æ¬¾14-åœ¨èµ„æºç®¡ç†ç±»ä¸­å°å¿ƒ-copying-è¡Œä¸º" class="headerlink" title="æ¡æ¬¾14 : åœ¨èµ„æºç®¡ç†ç±»ä¸­å°å¿ƒ copying è¡Œä¸º"></a>æ¡æ¬¾14 : åœ¨èµ„æºç®¡ç†ç±»ä¸­å°å¿ƒ copying è¡Œä¸º</h2><blockquote><p>æœ¬æ¡æ¬¾æ˜¯åœ¨æˆ‘ä»¬è‡ªå·±å»ºç«‹èµ„æºç®¡ç†ç±»æ—¶è¦æ³¨æ„çš„è¡Œä¸º, ä½†æ˜¯å½’æ ¹ç»“åº•, æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è‡ªå·±å»ºç«‹èµ„æºç®¡ç†ç±»å‘¢ ? ä¸ºä»€ä¹ˆä¸ç”¨ shared_ptr ? è¿™æ˜¯æˆ‘ä»¬åœ¨æœ¬æ¡æ¬¾ä¸­éœ€è¦é¦–å…ˆè§£å†³è¿­ä»£é—®é¢˜.</p></blockquote><p>ä¹¦ä¸­æå‡º, C++æä¾›çš„æ™ºèƒ½æŒ‡é’ˆæ˜¯é€‚é…äº<code>heap-based</code>èµ„æºä¸Šçš„, å…¶è¦æ±‚ä¸ç®¡æ˜¯è‡ªåŠ¨ç”Ÿæˆè¿˜æ˜¯æ‰‹åŠ¨å®Œæˆ, è¯¥èµ„æº<strong>å¿…é¡»è¦æœ‰ææ„å‡½æ•°</strong>, ç„¶è€Œå¹¶éæ‰€æœ‰çš„èµ„æºéƒ½æ˜¯<code>heap-based</code>çš„, ç®€å•æ¥è¯´å°±æ˜¯æœ‰äº›èµ„æº<strong>æ²¡æœ‰å¯¹åº”çš„ææ„å‡½æ•°</strong>, è€Œæ˜¯é€‰æ‹©äº†åˆ«çš„æ–¹å¼è¿›è¡Œèµ„æºçš„é‡Šæ”¾, éå¸¸å…¸å‹çš„å°±æ˜¯<strong>æ–‡ä»¶å¥æŸ„</strong>, å…¶å¿…é¡»è¦è°ƒç”¨<code>close()</code>å‡½æ•°é‡Šæ”¾, ä½ å¦‚æœç›´æ¥æŠŠå…¶äº¤ç»™<code>shared_ptr</code>è€Œä¸åšå…¶ä»–åŠ¨ä½œ, å¯ä»¥ç¡®å®šçš„æ˜¯<code>shared_ptr</code>å¹¶ä¸ä¼šæ™ºèƒ½åˆ°æŠŠ<code>close()</code>åŠ åˆ°æ™ºèƒ½å‡½æ•°ä¸­, æ–‡ä»¶å¥æŸ„ä¸ä¼šè¢«é‡Šæ”¾, è¿™æ ·çš„èµ„æºè¿˜æœ‰å¾ˆå¤š, è€Œä¸”å¤§éƒ¨åˆ†éƒ½å¾ˆå…³é”®, æ¯”å¦‚<strong>é”, æ•°æ®åº“è¿æ¥, ç½‘ç»œsocket</strong>ç­‰. å› æ­¤æˆ‘ä»¬éœ€è¦è‡ªå·±å»ºç«‹è‡ªå·±çš„èµ„æºç®¡ç†ç±»(å½“ç„¶ä¹Ÿæœ‰äº›å…¶ä»–çš„æ–¹å¼).</p><hr><h3 id="æ€ä¹ˆå»ºç«‹è‡ªå·±çš„èµ„æºç®¡ç†ç±»"><a href="#æ€ä¹ˆå»ºç«‹è‡ªå·±çš„èµ„æºç®¡ç†ç±»" class="headerlink" title="æ€ä¹ˆå»ºç«‹è‡ªå·±çš„èµ„æºç®¡ç†ç±»?"></a>æ€ä¹ˆå»ºç«‹è‡ªå·±çš„èµ„æºç®¡ç†ç±»?</h3><p>ç®€å•æ¥è¯´è¿˜æ˜¯<strong>éµå¾ªRAIIåŸåˆ™</strong>, æ„é€ å³åˆå§‹åŒ–, ææ„å³é‡Šæ”¾èµ„æº, è¿™é‡Œçš„é‡Šæ”¾èµ„æºå…·ä½“åˆ°æ–‡ä»¶å°±æ˜¯è°ƒç”¨<code>close()</code>, å…·ä½“åˆ°é”å°±æ˜¯è°ƒç”¨<code>unlock()</code>, æˆ‘ä»¬è‡ªå·±åº”å½“è€ƒé‡, è€Œæˆ‘ä»¬ä¸€èˆ¬ç§°å…¶ä¸º <strong>RAIIé£æ ¼çš„XXX</strong> .</p><p>ä¹¦ä¸­ç»™å‡ºäº†ä¸€æ®µä»£ç , ç”¨äºå®ç°<strong>RAIIé£æ ¼çš„é”</strong> : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Lock</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Lock</span><span class="hljs-params">(Mutex *pm)</span></span><br><span class="hljs-function">  : mutexPtr(pm)</span><br><span class="hljs-function">  &#123;</span> <span class="hljs-built_in">lock</span>(mutexPtr); &#125;                          <span class="hljs-comment">// è·å¾—èµ„æº</span><br><br>  ~<span class="hljs-built_in">Lock</span>() &#123; <span class="hljs-built_in">unlock</span>(mutexPtr); &#125;                <span class="hljs-comment">// é‡Šæ”¾èµ„æº</span><br><br><span class="hljs-keyword">private</span>:<br>  Mutex *mutexPtr;<br>&#125;;<br></code></pre></td></tr></table></figure><p>äºæ˜¯æˆ‘ä»¬å°±å¯ä»¥å®ç°ä»¥ä¸‹ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp">Mutex m;                    <span class="hljs-comment">// è®¾ç½®ä¸€ä¸ªäº’æ–¥å™¨</span><br>...<br>&#123;                           <span class="hljs-comment">// è¿™æ˜¯ä¸€å—ä½œç”¨åŸŸ, å¯ä»¥æ˜¯ä¸€ä¸ªè¦æ±‚çº¿ç¨‹å®‰å…¨çš„å‡½æ•°å†…éƒ¨</span><br><span class="hljs-function">Lock <span class="hljs-title">ml</span><span class="hljs-params">(&amp;m)</span></span>;            <span class="hljs-comment">// ç›´æ¥ç”¨äº’æ–¥å™¨ä¸Šé”</span><br>...                     <span class="hljs-comment">// æ‰§è¡Œå¯¹é”æœ‰éœ€æ±‚çš„è¡Œä¸º</span><br>&#125;    <span class="hljs-comment">// ç¦»å¼€ä½œç”¨åŸŸè‡ªåŠ¨è°ƒç”¨ææ„, ææ„ä¸­è‡ªåŠ¨unlock</span><br></code></pre></td></tr></table></figure><hr><h3 id="è¨€å½’æ­£ä¼ -å½“ä¸€ä¸ªRAIIå¯¹è±¡è¢«å¤åˆ¶-ä¼šå‘ç”Ÿä»€ä¹ˆäº‹"><a href="#è¨€å½’æ­£ä¼ -å½“ä¸€ä¸ªRAIIå¯¹è±¡è¢«å¤åˆ¶-ä¼šå‘ç”Ÿä»€ä¹ˆäº‹" class="headerlink" title="è¨€å½’æ­£ä¼ , å½“ä¸€ä¸ªRAIIå¯¹è±¡è¢«å¤åˆ¶, ä¼šå‘ç”Ÿä»€ä¹ˆäº‹ ?"></a>è¨€å½’æ­£ä¼ , å½“ä¸€ä¸ªRAIIå¯¹è±¡è¢«å¤åˆ¶, ä¼šå‘ç”Ÿä»€ä¹ˆäº‹ ?</h3><p>ä»¥ä¸‹æ˜¯å¯èƒ½å‘ç”Ÿçš„å¤åˆ¶ç­–ç•¥ : </p><ul><li><p><strong>ç¦æ­¢å¤åˆ¶</strong> : å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¹¶ä¸å¸Œæœ›èµ„æºç®¡ç†ç±»å¯ä»¥å¤åˆ¶, å°±åƒé”, æˆ‘ä»¬ä¸€å®šä¸å¸Œæœ›å¤šä¸ªé”å¯¹è±¡æ§åˆ¶åŒä¸€ä¸ªåº•å±‚çš„äº’æ–¥å™¨, è¿™æœ‰è¿é”è®¾è®¡çš„åˆè¡·, æ‰€ä»¥ç›´æ¥ç¦æ­¢å°±å¥½äº†, è¿™æ—¶æˆ‘ä»¬çš„<code>Uncopyable</code>ç±»å°±æœ‰ç”¨äº† : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Lock</span>: <span class="hljs-keyword">private</span> Uncopyable &#123;        <span class="hljs-comment">// ç›´æ¥privateç»§æ‰¿è‡ªUncopyable</span><br><span class="hljs-keyword">public</span>:                                    <br>...                                     <span class="hljs-comment">// åŒä¸Š   </span><br>&#125;;<br></code></pre></td></tr></table></figure></li><li><p><strong>å¯¹åº•å±‚èµ„æºç¥­å‡ºâ€å¼•ç”¨è®¡æ•°æ³•â€</strong> : è¿™ä¸ªå…¶å®å°±æ˜¯åˆ©ç”¨<code>shared_ptr</code>å®ç°èµ„æºå…±äº«å°±å¥½äº†.</p><p>éœ€è¦æ³¨æ„çš„å°±æ˜¯, <code>shared_ptr</code>è¿˜æœ‰ä¸€ä¸ªå’Œå…±äº«å†…å­˜æ— å…³çš„æ€§è´¨â€”<strong>åˆ é™¤å™¨</strong>, è¿™æ˜¯ä¸€ä¸ªå‡½æ•°, å¯ä»¥ä¼ å…¥<code>shared_ptr</code>æ„é€ å‡½æ•°çš„ç¬¬äºŒå‚æ•°, å¦‚æœæ²¡æœ‰åˆ é™¤å™¨ä¼šé»˜è®¤è°ƒç”¨ææ„, æœ‰åˆ é™¤å™¨å°±è°ƒç”¨åˆ é™¤å™¨, è¿™å…¶å®å°±åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†æ™ºèƒ½æŒ‡é’ˆåªèƒ½é’ˆå¯¹<code>heap-based</code>èµ„æºçš„é—®é¢˜, è®©æ²¡æœ‰ææ„å‡½æ•°çš„èµ„æºä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨åˆ é™¤å™¨å®ç°é‡Šæ”¾, ä»¥ä¸‹æ˜¯ä¹¦ä¸­çš„ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Lock</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Lock</span><span class="hljs-params">(Mutex *pm)</span>       </span><br><span class="hljs-function">  : mutexPtr(pm, unlock)         // åˆå§‹åŒ–æ™ºèƒ½æŒ‡é’ˆ, å°†unlockè®¾ç½®ä¸ºåˆ é™¤å™¨</span><br><span class="hljs-function">    lock(mutexPtr.get());</span><br>  &#125;<br>  <br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">unlock</span><span class="hljs-params">(Mutex* mtx)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (mtx) &#123;<br>        mtx-&gt;<span class="hljs-built_in">unlock</span>();<br>  &#125;<br>        <br>    <span class="hljs-comment">// ä¸éœ€è¦å†™ææ„å‡½æ•°äº†, å®ƒå¯ä»¥è¢«åˆ é™¤å™¨æ›¿ä»£</span><br>&#125;<br>   <br><span class="hljs-keyword">private</span>:<br>  std::tr1::shared_ptr&lt;Mutex&gt; mutexPtr;    <span class="hljs-comment">// ä½¿ç”¨ shared_ptr</span><br>&#125;;                     <br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„å¦‚æœæˆ‘ä»¬å†™çš„èµ„æºç®¡ç†ç±»ä¸å¸Œæœ›å…±äº«èµ„æº, <code>shared_ptr</code>å¯ä»¥å…±äº«å°±å¸¦æ¥äº†éšæ‚£, åƒæ˜¯ä¸Šé¢çš„é”, å…¶å®æ›´æ¨èç¦æ­¢æ‹·è´çš„åšæ³•, è¿™ç§åšæ³•åªæ˜¯å‘Šè¯‰æˆ‘ä»¬ä¸€ç§å…¶ä»–çš„åšæ³•è€Œå·².</p></li><li><p><strong>å¤åˆ¶åº•å±‚èµ„æº</strong> : è¿™å…¶å®å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„æ·±æ‹·è´.</p></li><li><p><strong>è½¬ç§»åº•éƒ¨èµ„æºçš„æ‹¥æœ‰æƒ</strong> : ä¸ºäº†ä¿è¯èµ„æºçš„ç‹¬å æ€§, æˆ‘ä»¬å¯ä»¥é€‰æ‹©è¿™ç§ç­–ç•¥.</p></li></ul><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>å¤åˆ¶<code>RAIIå¯¹è±¡</code>å¿…é¡»ä¸€å¹¶å¤åˆ¶ä»–æ‰€ç®¡ç†çš„èµ„æº, èµ„æºçš„<code>copying</code>è¡Œä¸ºå†³å®š<code>RAIIå¯¹è±¡</code>çš„<code>copying</code>è¡Œä¸º.</li><li>æ™®éçš„<code>copying</code>è¡Œä¸ºæ˜¯ç¦æ­¢å¤åˆ¶æˆ–æ–½è¡Œå¼•ç”¨è®¡æ•°æ³•.</li><li>æ–‡ä»¶å¥æŸ„å’Œé”è¿™ç±»èµ„æºå¯ä»¥é€‰æ‹©<strong>ç¦æ­¢å¤åˆ¶, æ”¯æŒç§»åŠ¨</strong>çš„ç­–ç•¥</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾13 ä»¥å¯¹è±¡ç®¡ç†èµ„æº</title>
    <link href="/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE13%20%E4%BB%A5%E5%AF%B9%E8%B1%A1%E7%AE%A1%E7%90%86%E8%B5%84%E6%BA%90/"/>
    <url>/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE13%20%E4%BB%A5%E5%AF%B9%E8%B1%A1%E7%AE%A1%E7%90%86%E8%B5%84%E6%BA%90/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾13-ä»¥å¯¹è±¡ç®¡ç†èµ„æº"><a href="#æ¡æ¬¾13-ä»¥å¯¹è±¡ç®¡ç†èµ„æº" class="headerlink" title="æ¡æ¬¾13 : ä»¥å¯¹è±¡ç®¡ç†èµ„æº"></a>æ¡æ¬¾13 : ä»¥å¯¹è±¡ç®¡ç†èµ„æº</h2><blockquote><p>æ‰€è°“èµ„æº, ä¸€æ—¦ç”¨äº†å®ƒ, å°†æ¥å¿…é¡»è¿˜ç»™ç³»ç»Ÿ. æœ¬æ¡æ¬¾åŠä»¥åå‡ é¡¹æ¡æ¬¾éƒ½è‡´åŠ›äºå®ç°ä¼˜ç§€çš„èµ„æºç®¡ç†, ä¸¥å®ˆè¿™äº›æ¡æ¬¾, å¯ä»¥å‡ ä¹æ¶ˆé™¤èµ„æºç®¡ç†é—®é¢˜.</p></blockquote><p>æœ¬æ¡æ¬¾ä¸»è¦æå‡º<strong>ä»¥å¯¹è±¡ç®¡ç†èµ„æº</strong>çš„æ€æƒ³, ä»¥åŠå¯¹<code>std</code>å†…ç½®çš„<code>auto_ptr</code>å’Œ<code>smart_prt</code>çš„ä½¿ç”¨ç­–ç•¥åšäº†åˆ†æ.</p><p>ä¹¦ä¸­å¡‘æ¨¡äº†ä¸€ä¸ªæŠ•èµ„è¡Œä¸º, è®©æˆ‘ä»¬çœ‹çœ‹èµ„æºè¯¥å¦‚ä½•å¤„ç† : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Investment</span> &#123; ... &#125;;  <span class="hljs-comment">// ä¸€ä¸ªæŠ•èµ„ç±»</span><br><br><span class="hljs-function">Investment* <span class="hljs-title">createInvestment</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ªå·¥å‚å‡½æ•°, è¿”å›ä¸€ä¸ªåŠ¨æ€åˆ†é…çš„å¯¹è±¡, è¿™é‡Œä¸ºäº†ç®€åŒ–åˆ»æ„ä¸å†™å‚æ•°</span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  Investment *pInv = <span class="hljs-built_in">createInvestment</span>();         <br>  ...                                            <br>  <span class="hljs-keyword">delete</span> pInv;                                  <br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰èµ„æºç®¡ç†å¯¹è±¡, æˆ‘ä»¬æ­£å¸¸è¡Œä¸ºæ˜¯è¯·æ±‚æŒ‡é’ˆä½¿ç”¨åå†<strong>æ‰‹åŠ¨åˆ é™¤</strong>.</p><p>ä¹¦ä¸­æå‡ºäº†â€ä»¥å¯¹è±¡ç®¡ç†èµ„æºâ€çš„ä¸¤ä¸ªå…³é”®æƒ³æ³• : </p><ul><li><strong>è·å¾—èµ„æºåç«‹å³æ”¾è¿›ç®¡ç†å¯¹è±¡.</strong></li><li>**ç®¡ç†å¯¹è±¡è¿ç”¨ææ„å‡½æ•°ç¡®ä¿èµ„æºè¢«é‡Šæ”¾, **è¿™æ ·ä¾¿å¯å€šèµ– C++ çš„â€<strong>ææ„å‡½æ•°è‡ªåŠ¨è°ƒç”¨æœºåˆ¶</strong>â€œç¡®ä¿èµ„æºè¢«é‡Šæ”¾.</li></ul><p>è¿™ä¸¤ä¸ªæƒ³æ³•æ¥æºäºä¸€ç§èµ„æºç®¡ç†è§‚å¿µ : </p><ul><li><strong>RAII (Resoure Acquisition Is Initialization)</strong> <strong>: èµ„æºå–å¾—æ—¶æœºä¾¿æ˜¯åˆå§‹åŒ–æ—¶æœº .</strong></li></ul><p>é‚£ä¹ˆèµ„æºç®¡ç†ç±»è¯¥å¦‚ä½•ä½¿ç”¨ä¸å®ç°å‘¢ ? ä¸å¦¨çœ‹çœ‹C++æœ¬èº«ç»™æˆ‘ä»¬æä¾›çš„ä¸¤ä¸ªèµ„æºç®¡ç†ç±»(æ™ºèƒ½æŒ‡é’ˆ)å§. </p><hr><h3 id="auto-ptr"><a href="#auto-ptr" class="headerlink" title="auto_ptr"></a>auto_ptr</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-function">std::auto_ptr&lt;Investment&gt; <span class="hljs-title">pInv</span><span class="hljs-params">(createInvestment())</span></span>;  <span class="hljs-comment">// è¯·æ±‚å¯¹è±¡çš„åŒæ—¶ç›´æ¥å­˜å…¥auto_pträ¸­ </span><br>  ...                                                 <br>&#125;         <br></code></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å¯ä»¥ä¸€å¦‚æ—¢å¾€åœ°ä½¿ç”¨<code>pInv</code>, å½“å…¶ç¦»å¼€ä½œç”¨åŸŸæ—¶, ä¼šç»ç”±<code>auto_ptr</code>çš„ææ„å‡½æ•°è‡ªåŠ¨åˆ é™¤<code>pInv</code>.</p><p><code>auto_ptr</code>çš„ç‰¹æ€§ : å—<code>auto_ptr</code>ç®¡ç†çš„èµ„æºå¿…é¡»ç»å¯¹æ²¡æœ‰ä¸€ä¸ªä»¥ä¸Šçš„<code>auto_ptr</code>åŒæ—¶æŒ‡å‘å®ƒ.</p><p>ä¹Ÿå°±æ˜¯è¯´<code>auto_ptr</code>ä¿è¯ç‹¬å æŒ‡å‘çš„èµ„æº, å¦‚æœå‘ç”Ÿæ‹·è´ä¹Ÿä¼šè½¬äº¤ä½¿ç”¨æƒ, è¿™ç§ç‰¹æ€§ä½¿å¾—å…¶åœ¨éœ€æ±‚å…±äº«å†…å­˜çš„åœºé¢èµ·ä¸åˆ°ä½œç”¨, äºæ˜¯ä¹Ÿå°±æœ‰äº†æˆ‘ä»¬æ¥ä¸‹æ¥çš„<code>shared_ptr</code>.</p><hr><h3 id="shared-ptr"><a href="#shared-ptr" class="headerlink" title="shared_ptr"></a>shared_ptr</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-function">std::shared_ptr&lt;Investment&gt; <span class="hljs-title">pInv1</span><span class="hljs-params">(createInvestment())</span></span>;<br>  ...    <br>    std::<span class="hljs-function">tr1::shared_ptr&lt;Investment&gt;  <span class="hljs-title">pInv2</span><span class="hljs-params">(pInv1)</span></span>; <span class="hljs-comment">// å…è®¸æŒ‡å‘åŒä¸€å—å†…å­˜</span><br>  pInv1 = pInv2; <span class="hljs-comment">// å…è®¸èµ‹å€¼åŒæ—¶è·å¾—ä½¿ç”¨æƒ</span><br>&#125;          <br></code></pre></td></tr></table></figure><p><code>share_ptr</code>æ˜¯â€<strong>å¼•ç”¨è®¡æ•°å‹æ™ºèƒ½æŒ‡é’ˆ</strong>â€œ, å…¶è‡ªå·±å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªè®¡æ•°å™¨, ç”¨äºè®°å½•æŒ‡å‘åŒä¸€å—èµ„æºçš„æŒ‡é’ˆæœ‰å¤šå°‘, å½“å‘ç”Ÿæ‹·è´å’Œèµ‹å€¼æ—¶éƒ½ä¼šä½¿è®¡æ•°å™¨ + 1, å½“æœ‰æŒ‡å‘å…¶çš„æŒ‡é’ˆç¦»å¼€ä½œç”¨åŸŸæ—¶éƒ½ä¼šä½¿è®¡æ•°å™¨ - 1, å½“è®¡æ•°å™¨ä¸º0æ—¶æ‰è‡ªåŠ¨è§¦å‘çœŸæ­£çš„ææ„.</p><hr><p>è¯·æ³¨æ„ : <code>auto_ptr</code>å’Œ<code>shared_ptr</code>çš„ææ„å‡½æ•°å†…éƒ¨è°ƒç”¨çš„éƒ½æ˜¯ <code>delete</code>, è€Œé <code>delete[]</code>, è™½ç„¶æˆ‘ä»¬å¯ä»¥ <code>new []</code>, ä½†æ˜¯è¿™æ ·newå‡ºæ¥çš„æŒ‡é’ˆå°±è¯·ä¸è¦å­˜å…¥æ™ºèƒ½æŒ‡é’ˆäº†. </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">spi</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">100</span>])</span></span>; <span class="hljs-comment">// è¿™æ ·æ˜¯é”™è¯¯çš„!</span><br></code></pre></td></tr></table></figure><p>è‡³äºä¸ºä»€ä¹ˆæ²¡æœ‰<code>delete[]</code>ç‰ˆæœ¬çš„, é‚£æ˜¯å› ä¸º<code>vector</code>å’Œ<code>string</code>å‡ ä¹æ€»æ˜¯å¯ä»¥å–ä»£åŠ¨æ€åˆ†é…è€Œå¾—çš„æ•°ç»„, æ‰€ä»¥æ²¡å¿…è¦.</p><hr><p>ä»¥ä¸Šä¸“é—¨æè¿°äº†<code>auto_ptr</code>å’Œ<code>shared_ptr</code>, ä½†æ˜¯æœ¬æ¡æ¬¾å¹¶ä¸ä¸“é—¨é’ˆå¯¹å®ƒä»¬, è€Œæ˜¯åœ¨å¼ºè°ƒâ€<strong>ä»¥å¯¹è±¡ç®¡ç†èµ„æº</strong>â€œçš„é‡è¦æ€§, æœ‰æ—¶å€™æˆ‘ä»¬è¦ä½¿ç”¨çš„èµ„æºä¹Ÿè®¸æ˜¯è¿™äº›<strong>é¢„åˆ¶å¼classesæ— æ³•å¦¥å–„ç®¡ç†</strong>çš„, å°±éœ€è¦æˆ‘ä»¬æœ‰<strong>è‡ªå·±åˆ¶ä½œèµ„æºç®¡ç†ç±»</strong>çš„èƒ½åŠ›äº†, è‡³äºå…¶ä¸­è¦è€ƒè™‘çš„ç»†èŠ‚, åœ¨æ¥ä¸‹æ¥çš„æ¡æ¬¾14, 15ä¸­ä¼šæåŠ.</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>ä¸ºé˜²æ­¢èµ„æºæ³„éœ², è¯·ä½¿ç”¨<code>RAII</code>å¯¹è±¡, å®ƒä»¬åœ¨æ„é€ å‡½æ•°ä¸­è·å¾—èµ„æºå¹¶åœ¨ææ„å‡½æ•°ä¸­é‡Šæ”¾èµ„æº. </li><li>ä¼˜å…ˆä½¿ç”¨<code>shared_ptr</code>, <code>auto_ptr</code>æ¬¡ä¹‹, å¦‚æœæ•ˆæœæ— æ³•ä»¤ä½ æ»¡æ„, è¯·è‡ªå·±åˆ¶ä½œèµ„æºç®¡ç†ç±».</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾10-12 æ‹·è´ä¸èµ‹å€¼</title>
    <link href="/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE10-12%20%E6%8B%B7%E8%B4%9D%E4%B8%8E%E8%B5%8B%E5%80%BC/"/>
    <url>/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE10-12%20%E6%8B%B7%E8%B4%9D%E4%B8%8E%E8%B5%8B%E5%80%BC/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾10-ä»¤-operator-è¿”å›ä¸€ä¸ª-reference-to-this"><a href="#æ¡æ¬¾10-ä»¤-operator-è¿”å›ä¸€ä¸ª-reference-to-this" class="headerlink" title="æ¡æ¬¾10 : ä»¤ operator&#x3D; è¿”å›ä¸€ä¸ª reference to * this"></a>æ¡æ¬¾10 : ä»¤ operator&#x3D; è¿”å›ä¸€ä¸ª reference to * this</h2><blockquote><p>å¾ˆå¤šç±»éƒ½æœ‰é‡å†™operator&#x3D;å‡½æ•°çš„è¦æ±‚,  æœ¬è´¨æ˜¯ &#x3D; å·¦ä¾§è°ƒç”¨ operator&#x3D; å‡½æ•°, å³ä¾§ä½œä¸ºå‚æ•°ä¼ å…¥, å°†å³ä¾§å‚æ•°èµ‹å€¼ç»™å·¦ä¾§æˆå‘˜å˜é‡, å¹¶ä¸”ä¸ºäº†å®ç°è¿é”èµ‹å€¼, æˆ‘ä»¬è¿˜åº”å½“ä½¿ operator&#x3D; è¿”å›å½“å‰èµ‹å®Œå€¼çš„å¯¹è±¡.</p></blockquote><p>æœ¬æ¡æ¬¾çš„ç›®çš„æ˜¯<strong>å®ç°è¿é”èµ‹å€¼</strong>, æ¥ä¸‹æ¥çœ‹çœ‹å¦‚ä½• ä»¤ operator&#x3D; è¿”å›ä¸€ä¸ª reference to * this : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp">Widget&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> Widget&amp; rhs)     <span class="hljs-comment">// è¿”å›ä¸€ä¸ªå¼•ç”¨, ç¬¦åˆå³ä¾§å‚æ•°çš„ç±»å‹</span><br>&#123;          <br>    <span class="hljs-comment">// æ¡æ¬¾11, 12ä¼šå‘Šè¯‰æˆ‘ä»¬æ€æ ·å®ç°ä¸­é—´çš„æ‹·è´è¿‡ç¨‹</span><br>    ...<br>    <br>  <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;                        <span class="hljs-comment">// è¿”å›=å·¦ä¾§çš„å½“å‰å¯¹è±¡, ä½¿å…¶å¯ä»¥å……å½“ä¸‹ä¸€æ¬¡operator=çš„å³ä¾§å‚æ•°</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åŒæ—¶è¿™ä¸ªåè®®ä¸åªé€‚ç”¨äº &#x3D; , ä¹ŸåŒæ ·é€‚ç”¨äº +&#x3D;, -&#x3D;, *&#x3D; ç­‰è¿ç®—ç¬¦.</p><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>ä»¤èµ‹å€¼æ“ä½œç¬¦é‡è½½è¿”å›ä¸€ä¸ª reference to * this</li></ul><hr><h2 id="æ¡æ¬¾11-åœ¨-operator-ä¸­å¤„ç†â€è‡ªæˆ‘èµ‹å€¼â€"><a href="#æ¡æ¬¾11-åœ¨-operator-ä¸­å¤„ç†â€è‡ªæˆ‘èµ‹å€¼â€" class="headerlink" title="æ¡æ¬¾11 : åœ¨ operator&#x3D; ä¸­å¤„ç†â€è‡ªæˆ‘èµ‹å€¼â€"></a>æ¡æ¬¾11 : åœ¨ operator&#x3D; ä¸­å¤„ç†â€è‡ªæˆ‘èµ‹å€¼â€</h2><blockquote><p>æˆ‘ä»¬è®¾ç½®ä¸€ä¸ªå˜é‡w, ä»¤ w &#x3D; w , è¿™ç§è‡ªæˆ‘èµ‹å€¼çš„åšæ³•è™½ç„¶çœ‹ä¸Šå»å¾ˆæ„šè ¢, ä½†æ˜¯åˆæ³•, è¿™ç§ç¨‹åº¦çš„è‡ªç”±è¿˜æ˜¯åº”è¯¥æœ‰çš„, å¯æ˜¯è¿™åœ¨æˆ‘ä»¬æ‰‹åŠ¨é‡è½½operator&#x3D; æ—¶ä¹Ÿä¼šå¸¦æ¥ç›¸åº”çš„éº»çƒ¦, æœ‰ä¸€äº›æˆ‘ä»¬éœ€è¦æ³¨æ„çš„ç‚¹.</p></blockquote><p>æ­£å¸¸æ¥è¯´, å¦‚æœæˆ‘ä»¬çš„ç±»ä¸­åªæœ‰ä¸€äº›æ™®é€šçš„æœ¬åœ°å˜é‡, å…¶å®ä¸å¿…è€ƒè™‘è‡ªæˆ‘èµ‹å€¼çš„é—®é¢˜, å› ä¸ºåªè¦æŠŠæ­£å¸¸æƒ…å†µä¸‹çš„ operator&#x3D; å‡½æ•°å†™å¥½(æˆ–è€…ä½ ä¹Ÿå¯ä»¥è®©ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆ), æ˜¯æ²¡æœ‰ä»€ä¹ˆé—®é¢˜çš„, é—®é¢˜å‘ç”Ÿåœ¨<strong>éœ€è¦åŠ¨æ€ç®¡ç†å†…å­˜</strong>æ—¶.</p><p>å‡å¦‚æˆ‘ä»¬ä¸€ä¸ªç±»ä¸­æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡æ˜¯æŒ‡é’ˆ, è¯¥æŒ‡é’ˆæŒ‡å‘ä¸€å—åŠ¨æ€åˆ†é…çš„å†…å­˜, æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªç±»å¯¹è±¡ a å’Œ b , å…¶ä¸­çš„æŒ‡é’ˆéƒ½æŒ‡å‘ä¸åŒçš„å†…å­˜, å½“ä½¿ a &#x3D; b, ä»æ­£å¸¸è€ƒé‡æ¥è¯´, b èµ‹å€¼ç»™ a åº”å½“ä»£è¡¨ç€ a çš„æŒ‡é’ˆå°†æŒ‡å‘åŸå…ˆ b æ‰€æŒ‡å‘å†…å­˜, é‚£ä¹ˆ<strong>åŸå…ˆ a æ‰€æŒ‡å‘çš„å†…å­˜å°±åº”å½“deleteæ‰</strong>, ä»¥å®Œæˆæœ€åçš„èµ‹å€¼æ“ä½œ. ä¹¦ä¸­ä¸¾äº†ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘bitmapçš„ä¾‹å­ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Bitmap</span> &#123; ... &#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Widget</span> &#123;<br>  ...<br><span class="hljs-keyword">private</span>:<br>  Bitmap *pb; <br>&#125;;<br><br>Widget&amp; Widget::<span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> Widget&amp; rhs)              <span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ªæœ‰éšæ‚£çš„èµ‹å€¼é‡è½½</span><br>&#123;<br>  <span class="hljs-keyword">delete</span> pb;                                      <span class="hljs-comment">// deleteæ‰åŸæ¥æŒ‡å‘çš„åŠ¨æ€å†…å­˜</span><br>  pb = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Bitmap</span>(*rhs.pb);                       <span class="hljs-comment">// å†newä¸€å—ç”¨æ¥æ‹·è´rhså‰¯æœ¬çš„ç©ºé—´, pbé‡æ–°æ¥æ‰‹è¿™å—ç©ºé—´ </span><br><br>  <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;                                   <span class="hljs-comment">// è§æ¡æ¬¾10</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç çœ‹èµ·æ¥å¾ˆåˆç†, ä½†æ˜¯å¸¦å…¥è‡ªæˆ‘èµ‹å€¼çš„æƒ…å†µ, ä½ å°±ä¼šæƒŠå¥‡åœ°å‘ç°, new Bitmap(*rhs.pb)ç”¨æ¥æ‹·è´çš„å‰¯æœ¬ rhs.pb å·²ç»å› ä¸º delete pb è¢«é‡Šæ”¾äº†! æˆ‘ä»¬æ‰è¿›äº†â€<strong>åœ¨åœæ­¢ä½¿ç”¨èµ„æºä¹‹å‰å°±æ„å¤–é‡Šæ”¾äº†å®ƒ</strong>â€œçš„é™·é˜±! è™½ç„¶è‡ªæˆ‘èµ‹å€¼æ˜¯æ„šè ¢çš„æ“ä½œ, ä½†æˆ‘ä»¬ç¨‹åºå‘˜ä¹Ÿä¸èƒ½è®©æ„šè ¢çš„æ“ä½œäº§ç”Ÿæ„šè ¢çš„é”™è¯¯, æ‰€ä»¥æˆ‘ä»¬åº”å½“æå‰åˆ¤æ–­æ˜¯å¦æ˜¯è‡ªæˆ‘èµ‹å€¼ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp">Widget&amp; Widget::<span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> Widget&amp; rhs)<br>&#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> == &amp;rhs) <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;   <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ˜¯è‡ªæˆ‘èµ‹å€¼, æ˜¯å°±ç›´æ¥è¿”å›</span><br>  <span class="hljs-keyword">delete</span> pb;<br>  pb = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Bitmap</span>(*rhs.pb);<br><br>  <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥å¯¹è‡ªæˆ‘èµ‹å€¼çš„é—®é¢˜å®Œå…¨è§„é¿äº†! </p><hr><p>ä½†æ˜¯å…¶å®ç”±äºåŠ¨æ€å†…å­˜çš„å­˜åœ¨, è¿˜å‚¬ç”Ÿå‡ºäº†å¦ä¸€ä¸ªé—®é¢˜, å°±æ˜¯å…¶å®newä¸€ä¸ªå¯¹è±¡ä¹Ÿä¼šæœ‰äº§ç”Ÿå¼‚å¸¸çš„æƒ…å†µå‡ºç°, å¦‚æœç”³è¯·å†…å­˜å¤±è´¥, pbå°±æ˜¯æŠ˜äº†å­©å­åˆèµ”å…µ, åŸå…ˆçš„å†…å­˜é‡Šæ”¾äº†, æ–°ç”³è¯·çš„è¿˜å¤±è´¥äº†, è¿™ä¸ªé—®é¢˜å°±æ˜¯<strong>å¼‚å¸¸å®‰å…¨æ€§</strong>çš„é—®é¢˜äº†, ä»åŸç†ä¸Šæ¥è¯´è¿™å’Œæœ¬æ¡æ¬¾é‡ç‚¹é’ˆå¯¹çš„è‡ªæˆ‘èµ‹å€¼æ¯«æ— å…³è”, ä½†æ˜¯ä¹¦ä¸­å¾ˆé«˜å…´åœ°å‘Šè¯‰æˆ‘ä»¬ : </p><ul><li><strong>è®© operator&#x3D; å…·å¤‡â€å¼‚å¸¸å®‰å…¨æ€§â€å¾€å¾€ä¼šè‡ªåŠ¨è·å¾—â€è‡ªæˆ‘èµ‹å€¼å®‰å…¨â€çš„å›æŠ¥.</strong></li></ul><p>å› æ­¤ä½œè€…å‘Šè¯‰æˆ‘ä»¬å¯ä»¥æŠŠç„¦ç‚¹æ”¾åœ¨å®ç°å¼‚å¸¸å®‰å…¨æ€§ä¸Š, å¯¹è‡ªæˆ‘èµ‹å€¼é—®é¢˜å€¾å‘äºä¸ç®¡ç†. å°±æ˜¯è¯´è™½ç„¶ä¸¤ä¸ªé—®é¢˜æ¯«ä¸ç›¸å¹², ä½†ä½ è§£å†³ä¸€ä¸ªé—®é¢˜å´å¯ä»¥é¡ºå¸¦è§£å†³å¦ä¸€ä¸ªé—®é¢˜, ä½•ä¹è€Œä¸ä¸ºå‘¢?</p><p>é‚£ä¹ˆå¦‚ä½•å®ç°å¼‚å¸¸å®‰å…¨æ€§å‘¢? å¼‚å¸¸å®‰å…¨æ€§ä¼šåœ¨æ¡æ¬¾29ç€é‡è®²è§£, ä½†ä¸å¦¨æˆ‘ä»¬æå‰äº†è§£ : </p><p>ç®€è€Œè¨€ä¹‹å°±æ˜¯ : <strong>ä¸æ³„éœ²ä»»ä½•èµ„æº, ä¸å…è®¸æ•°æ®è´¥å, å¼ºçƒˆä¿è¯å¦‚æœå‡½æ•°æ²¡æœ‰æˆåŠŸå°±å›æ»šåˆ°å‡½æ•°è¢«è°ƒç”¨å‰çš„çŠ¶æ€</strong>.</p><p>æ”¾åœ¨æœ¬ä¾‹ä¸­, å°±æ˜¯<strong>å¦‚ä½•ç¡®ä¿newå¤±è´¥åpbå¯ä»¥ä¾æ—§æŒ‡å‘åŸå…ˆçš„å†…å­˜, è€Œä¸æ˜¯åŸå…ˆçš„å†…å­˜è¢«é‡Šæ”¾</strong>.</p><p>ç®€å•æ€è€ƒä¸€ä¸‹å°±å¯ä»¥å†™å‡ºå¦‚ä¸‹çš„ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp">Widget&amp; Widget::<span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> Widget&amp; rhs)<br>&#123;<br>  Bitmap *pOrig = pb;               <span class="hljs-comment">// ç”¨ä¸€ä¸ªå¤‡ä»½æŒ‡é’ˆè®°ä½åŸå…ˆçš„pbæŒ‡å‘çš„ç©ºé—´å…ˆä¸é‡Šæ”¾</span><br>  pb = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Bitmap</span>(*rhs.pb);         <span class="hljs-comment">// ä»¤å·¦è¾¹pbæŒ‡å‘å³è¾¹pbæ‰€æŒ‡å‘å†…å­˜çš„å‰¯æœ¬</span><br>  <span class="hljs-keyword">delete</span> pOrig;                     <span class="hljs-comment">// å¦‚æœnewæˆåŠŸäº†å†é‡Šæ”¾åŸå…ˆæŒ‡å‘çš„ç©ºé—´</span><br><br>  <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>äºæ˜¯å¼‚å¸¸å®‰å…¨æ€§çš„é—®é¢˜å°±è§£å†³å•¦, æˆ‘ä»¬è¿˜å¯ä»¥å‘ç°, ç¡®å®è‡ªæˆ‘å¤åˆ¶å®‰å…¨çš„é—®é¢˜ä¹Ÿè¢«è§£å†³äº†, å› ä¸ºpbä¸ä¼šè¢«æå‰é‡Šæ”¾, å°±ç®—æ˜¯å¯¹ç€è‡ªå·±å†å¤åˆ¶ä¸€éä¹Ÿå®Œå…¨æ²¡æœ‰é—®é¢˜, å”¯ä¸€çš„å˜åŒ–å°±æ˜¯æ¢äº†å—å†…å­˜è€Œå·².</p><p>ä¹¦ä¸­è¿˜æå‡ºäº†ä¸€ç§ç†å¿µç›¸åŒ, ä½†æ›´æ¨èçš„ç¼–å†™æ–¹æ³• : <strong>copy and swapæŠ€æœ¯</strong>;</p><p>ç®€è€Œè¨€ä¹‹å°±æ˜¯ : <strong>å¦‚æœå¯¹æŸå¯¹è±¡çš„æ“ä½œæœ‰å¼‚å¸¸é£é™©, å°±ç›´æ¥å…ˆcopyè¯¥å¯¹è±¡çš„å‰¯æœ¬, åœ¨è¯¥å¯¹è±¡çš„å‰¯æœ¬ä¸Šåšå‡ºæ‰€æœ‰æ“ä½œ, éšåswapåŸä»¶å’Œå‰¯æœ¬</strong>.</p><p>ä»£ç å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Widget</span> &#123;<br>  ...<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(Widget&amp; rhs)</span></span>; <br>  <span class="hljs-built_in">Widget</span>(<span class="hljs-type">const</span> Widget&amp; W);<br>  ...                       <br>&#125;;<br><br>Widget&amp; Widget::<span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> Widget&amp; rhs) <span class="hljs-comment">// å¤§å¤šæ•°èµ‹å€¼é‡è½½æœ€åç”¨çš„éƒ½æ˜¯è¿™ç§æ–¹æ³•</span><br>&#123;<br>  Widget <span class="hljs-built_in">temp</span>(rhs);             <span class="hljs-comment">// ä½¿ç”¨é‡å†™çš„æ‹·è´æ„é€ å‡½æ•°ç›´æ¥æ‹·è´å‰¯æœ¬</span><br>  <span class="hljs-built_in">swap</span>(temp);                   <span class="hljs-comment">// äº¤æ¢åŸä»¶å’Œå‰¯æœ¬</span><br>  <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™é‡Œå¯èƒ½æœ‰äº›äººä¼¼æ‡‚éæ‡‚, å‰ä¸€ä¸ªå‡½æ•°å¾ˆæ˜ç¡®è¦åœ¨æ‹·è´ç›®æ ‡å†…å­˜æˆåŠŸåå°±é‡Šæ”¾åŸå†…å­˜, è¿™ä¸ªæ˜¯æ€ä¹ˆå®ç°çš„å‘¢?</p><p>è¿™é‡Œçš„æ‹·è´æ„é€ å‡½æ•°æˆ‘ä»¬éœ€è¦é‡å†™, å®ç°å¯¹ bitmap çš„æ·±æ‹·è´, æ‹·è´å®Œçš„å¯¹è±¡å°±æ˜¯ temp , ç”±äº temp æ˜¯ä¸€ä¸ªä¸´æ—¶å¯¹è±¡, ç¦»å¼€è¿™ä¸ªå‡½æ•°çš„ä½œç”¨åŸŸå°±ä¼šææ„æ‰, æ­¤æ—¶æˆ‘ä»¬äº¤æ¢åŸå¯¹è±¡å’Œç›®æ ‡å¯¹è±¡, é‚£ä¹ˆæœ€åææ„æ‰çš„å°±æ˜¯å­˜åœ¨ temp ä¸­çš„åŸå¯¹è±¡, è€Œç›®æ ‡å¯¹è±¡ç•™åœ¨äº†æˆ‘ä»¬çš„å½“å‰å¯¹è±¡ä¸­.</p><hr><h3 id="è¯·è®°ä½-1"><a href="#è¯·è®°ä½-1" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>é€šè¿‡å®ç°å¼‚å¸¸å®‰å…¨æ€§é¡ºä¾¿è§£å†³è‡ªæˆ‘èµ‹å€¼çš„é—®é¢˜.</li><li>ç¡®ä¿æ“ä½œå¤šä¸ªå¯¹è±¡æ—¶, å…¶ä¸­å¤šä¸ªå¯¹è±¡å®è´¨ä¸Šæ˜¯åŒä¸€ä¸ªå¯¹è±¡æ—¶, å…¶è¡Œä¸ºä»ç„¶æ­£ç¡®.</li></ul><hr><h2 id="æ¡æ¬¾12-å¤åˆ¶å¯¹è±¡æ—¶å‹¿å¿˜å…¶æ¯ä¸€ä¸ªæˆåˆ†"><a href="#æ¡æ¬¾12-å¤åˆ¶å¯¹è±¡æ—¶å‹¿å¿˜å…¶æ¯ä¸€ä¸ªæˆåˆ†" class="headerlink" title="æ¡æ¬¾12 : å¤åˆ¶å¯¹è±¡æ—¶å‹¿å¿˜å…¶æ¯ä¸€ä¸ªæˆåˆ†"></a>æ¡æ¬¾12 : å¤åˆ¶å¯¹è±¡æ—¶å‹¿å¿˜å…¶æ¯ä¸€ä¸ªæˆåˆ†</h2><blockquote><p>copyingå‡½æ•° : æ‹·è´æ„é€  å’Œ èµ‹å€¼é‡è½½(operator&#x3D;) .</p><p>æ¡æ¬¾10&#x2F;11å‘Šè¯‰äº†æˆ‘ä»¬ operator&#x3D; å¦‚ä½•è¿”å›å€¼ å’Œ æ³¨æ„ operator&#x3D; è‡ªæˆ‘èµ‹å€¼, æœ¬æ¡æ¬¾ä¼šå‘Šè¯‰æˆ‘ä»¬ copyingå‡½æ•° åœ¨èµ‹å€¼è¿‡ç¨‹ä¸­åº”å½“æ³¨æ„äº›ä»€ä¹ˆ.</p></blockquote><p>ä¹¦ä¸­æå‡º, å¦‚æœæˆ‘ä»¬å†³å®šè‡ªå·±å®ç° copyingå‡½æ•°, ç¼–è¯‘å™¨ä¼šä»¿ä½›è¢«å†’çŠ¯ä¼¼çš„, ä»¥ä¸€ç§å¥‡æ€ªçš„æ–¹å¼å›æ•¬ : å½“ä½ çš„ä»£ç å¿…ç„¶å‡ºé”™æ—¶ä¹Ÿä¸ä¼šå‘Šè¯‰ä½ . </p><p>è¿™ä¹Ÿåœ¨è­¦å‘Šæˆ‘ä»¬, å¤åˆ¶å¯¹è±¡æ—¶å‹¿å¿˜å…¶æ¯ä¸€ä¸ªæˆåˆ†.</p><p>é¦–å…ˆæå‡ºçš„è§‚ç‚¹æ˜¯ : </p><ul><li><strong>å¦‚æœä½ ä¸ºclassæ·»åŠ ä¸€ä¸ªæˆå‘˜å˜é‡, ä½ å¿…é¡»åŒæ—¶ä¿®æ”¹copyingå‡½æ•°</strong>.</li></ul><p>è¿™ç‚¹å¾ˆå¥½ç†è§£, æ¯ä¸ªæˆå‘˜å˜é‡éƒ½å¿…é¡»å’Œæ‹·è´æ„é€ å’Œèµ‹å€¼æ‹·è´å…³è”.</p><p>æ¥ä¸‹çš„è§‚ç‚¹å°±æ¶‰åŠç»§æ‰¿å±‚é¢äº† : </p><ul><li><p><strong>åªè¦ä¸º derived class æ’°å†™ copyingå‡½æ•°, å¿…é¡»å¾ˆå°å¿ƒåœ°å¤åˆ¶å…¶ base class æˆåˆ†.</strong></p></li><li><p><strong>ä½ åº”å½“è®© derived class çš„ copyingå‡½æ•° è°ƒç”¨ç›¸åº”çš„ base classå‡½æ•°.</strong></p></li></ul><p>æˆ‘ä»¬æ¥çœ‹ä¹¦ä¸­çš„ä»£ç æ¥è¿›ä¸€æ­¥äº†è§£è¿™ä¸¤å¥è¯ : </p><p>ä¹¦ä¸­è®¾å®šäº†ä¸€ä¸ª<code>Customeré¡¾å®¢ç±»</code>, å…¶æ´¾ç”Ÿç±»æ˜¯<code>PriorityCustomerè´µå®¾ç±»</code>, è´µå®¾ç±»ä¸­local int å˜é‡ <code>priority</code>, ç”¨æ¥ç¡®å®šè´µå®¾çš„ä¼˜å…ˆåº¦.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">logCall</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; funcName)</span></span>;  <span class="hljs-comment">// ç”¨æ¥äº§ç”Ÿä¸€ä¸ªæ—¥å¿—é€šå‘Š</span><br><br><span class="hljs-comment">// Customer ç±»</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Customer</span> &#123;<span class="hljs-comment">// æ™®é€šå®¢æˆ·</span><br><span class="hljs-keyword">public</span>:<br>  ...<br>  <span class="hljs-built_in">Customer</span>(<span class="hljs-type">const</span> Customer&amp; rhs);<br>  Customer&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> Customer&amp; rhs);<br>  ...<br><br><span class="hljs-keyword">private</span>:<br>  std::string name;<br>&#125;;<br><br>Customer::<span class="hljs-built_in">Customer</span>(<span class="hljs-type">const</span> Customer&amp; rhs)<br>: <span class="hljs-built_in">name</span>(rhs.name)                                 <br>&#123;<br>  <span class="hljs-built_in">logCall</span>(<span class="hljs-string">&quot;Customer æ‹·è´æ„é€ è¢«è§¦å‘&quot;</span>);<br>&#125;<br><br>Customer&amp; Customer::<span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> Customer&amp; rhs)<br>&#123;<br>  <span class="hljs-built_in">logCall</span>(<span class="hljs-string">&quot;Customer èµ‹å€¼é‡è½½è¢«è§¦å‘&quot;</span>);<br>  name = rhs.name;                             <br>  <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;                                  <span class="hljs-comment">// è§æ¡æ¬¾10</span><br>&#125;<br><br><span class="hljs-comment">// PriorityCustomer ç±»</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PriorityCustomer</span>: <span class="hljs-keyword">public</span> Customer &#123;                  <span class="hljs-comment">// è´µå®¾å®¢æˆ·</span><br><span class="hljs-keyword">public</span>:<br>   ...<br>   <span class="hljs-built_in">PriorityCustomer</span>(<span class="hljs-type">const</span> PriorityCustomer&amp; rhs);<br>   PriorityCustomer&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> PriorityCustomer&amp; rhs);<br>  ...<br><br><span class="hljs-keyword">private</span>:<br>   <span class="hljs-type">int</span> priority;<br>&#125;;<br><br><span class="hljs-comment">// é‡ç‚¹çœ‹è¿™ä¸ªä¸¤ä¸ªå‡½æ•°</span><br>PriorityCustomer::<span class="hljs-built_in">PriorityCustomer</span>(<span class="hljs-type">const</span> PriorityCustomer&amp; rhs)<br>: <span class="hljs-built_in">priority</span>(rhs.priority)<br>&#123;<br>  <span class="hljs-built_in">logCall</span>(<span class="hljs-string">&quot;PriorityCustomer æ‹·è´æ„é€ è¢«è§¦å‘&quot;</span>);<br>&#125;<br><br>PriorityCustomer&amp;<br>PriorityCustomer::<span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> PriorityCustomer&amp; rhs)<br>&#123;<br>  <span class="hljs-built_in">logCall</span>(<span class="hljs-string">&quot;PriorityCustomer èµ‹å€¼é‡è½½è¢«è§¦å‘&quot;</span>);<br>  priority = rhs.priority;<br>  <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>çœ‹ä¼¼<code>PriorityCustomer</code>çš„æ„é€ å‡½æ•°å¥½åƒå¤åˆ¶äº†æ¯ä¸€æ ·ä¸œè¥¿, ä½†æ˜¯å…¶å®å®ƒæ‰€<strong>ç»§æ‰¿çš„Customeréƒ¨åˆ†å¹¶æœªè¿›è¡Œå¤åˆ¶</strong>, Customeréƒ¨åˆ†ä¸­çš„nameå˜é‡ä»æ—§æ˜¯æœªå®šä¹‰çš„, å½“æˆ‘ä»¬å†ä»”ç»†çœ‹çœ‹operator&#x3D;, é‡Œé¢çš„é—®é¢˜æ˜¯ä¸€æ ·çš„.</p><p>æ¥ä¸‹æ¥æ˜¯æ”¹è¿›åçš„ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs cpp">PriorityCustomer::<span class="hljs-built_in">PriorityCustomer</span>(<span class="hljs-type">const</span> PriorityCustomer&amp; rhs)<br>: <span class="hljs-built_in">Customer</span>(rhs)                   <span class="hljs-comment">// è°ƒç”¨ base class çš„ copyæ„é€ å‡½æ•°</span><br>  , <span class="hljs-built_in">priority</span>(rhs.priority)<br>&#123;<br>  <span class="hljs-built_in">logCall</span>(<span class="hljs-string">&quot;PriorityCustomer æ‹·è´æ„é€ è¢«è§¦å‘&quot;</span>);<br>&#125;<br><br>PriorityCustomer&amp;<br>PriorityCustomer::<span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> PriorityCustomer&amp; rhs)<br>&#123;<br>    <span class="hljs-built_in">logCall</span>(<span class="hljs-string">&quot;PriorityCustomer èµ‹å€¼é‡è½½è¢«è§¦å‘&quot;</span>);<br><br>  Customer::<span class="hljs-keyword">operator</span>=(rhs);           <span class="hljs-comment">// å¯¹ base class æˆåˆ†è¿›è¡Œèµ‹å€¼åŠ¨ä½œ</span><br>  priority = rhs.priority;<br><br>  <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·ä»£ç å°±å®Œç¾äº†! å†å»å›å‘³å‰é¢æå‡ºçš„ä¸¤å¥è¯, å…¶å®å°±æ˜¯åœ¨å‘Šè¯‰æˆ‘ä»¬<strong>æ˜¾å¼ä¸”æ­£ç¡®å¤„ç†åŸºç±»éƒ¨åˆ†çš„æ‹·è´å’Œèµ‹å€¼</strong>çš„é‡è¦æ€§.</p><p>æˆ‘ä»¬è¦ç¡®ä¿ : </p><ol><li>å¤åˆ¶æ‰€æœ‰çš„ local å˜é‡.</li><li>è°ƒç”¨æ‰€æœ‰ <code>base classes</code> å†…é€‚å½“çš„ <code>copyingå‡½æ•°</code>.</li></ol><hr><p>å¾ˆå¤šæ—¶å€™è¿™ä¸¤ä¸ª<code>copyingå‡½æ•°</code>å¾€å¾€æœ‰ç€è¿‘ä¼¼çš„å®ç°æœ¬ä½“, è¿™å¯èƒ½ä¼šè¯±ä½¿æˆ‘ä»¬ç”¨å…¶ä¸­ä¸€ä¸ªè°ƒç”¨å¦å¤–ä¸€ä¸ªä»¥å®ç°ä»£ç å¤ç”¨çš„æ•ˆæœ, ä½†æ˜¯ä¹¦ä¸­å‘Šè¯‰æˆ‘ä»¬è¿™æ ·åšé£é™©å¾ˆå¤§, å› ä¸ºæ‹·è´æ„é€ ç”¨æ¥åˆå§‹åŒ–æ–°å¯¹è±¡, è€Œèµ‹å€¼é‡è½½åªèƒ½æ–½è¡Œäºå·²åˆå§‹åŒ–çš„å¯¹è±¡ä¸Š, äºŒè€…çš„åº”ç”¨åœºæ™¯å°±ä¸åŒ, ä¸ç„¶ä¹Ÿå°±ä¸ä¼šåˆ†æˆä¸¤ä¸ªé»˜è®¤æˆå‘˜å‡½æ•°äº†, æ‰€ä»¥ä¹¦ä¸­å‘Šè¯‰æˆ‘ä»¬ : </p><ul><li><p><strong>ä½ ä¸è¯¥ä»¤ copy assignment æ“ä½œç¬¦è°ƒç”¨ copyæ„é€ å‡½æ•° .</strong></p></li><li><p><strong>ä»¤ copyæ„é€ å‡½æ•° è°ƒç”¨ copy assignment æ“ä½œç¬¦åŒæ ·æ— æ„ä¹‰.</strong></p></li><li><p><strong>çœŸæ­£æ˜æ™ºçš„åšæ³•æ˜¯å°†ç›¸è¿‘ä»£ç å°è£…è¿› init() å‡½æ•°, ç»™äºŒè€…è°ƒç”¨.</strong></p></li></ul><hr><h3 id="è¯·è®°ä½-2"><a href="#è¯·è®°ä½-2" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li><code>copyingå‡½æ•°</code>åº”å½“ç¡®ä¿å¤åˆ¶ â€œå¯¹è±¡å†…çš„æ‰€æœ‰æˆå‘˜å˜é‡â€ åŠ â€œæ‰€æœ‰<code>base class</code>æˆåˆ†â€.</li><li>ä¸è¦å°è¯•<code>copyingå‡½æ•°</code>ç›¸äº’è°ƒç”¨, åº”å½“å°è£…ä¸€ä¸ªå…±ç”¨å‡½æ•°å®ç°ä»£ç å¤ç”¨.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾9 ç»ä¸åœ¨æ„é€ å’Œææ„å‡½æ•°è¿‡ç¨‹ä¸­è°ƒç”¨</title>
    <link href="/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE9%20%E7%BB%9D%E4%B8%8D%E5%9C%A8%E6%9E%84%E9%80%A0%E5%92%8C%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0%E8%BF%87%E7%A8%8B%E4%B8%AD%E8%B0%83%E7%94%A8virtual%E5%87%BD%E6%95%B0/"/>
    <url>/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE9%20%E7%BB%9D%E4%B8%8D%E5%9C%A8%E6%9E%84%E9%80%A0%E5%92%8C%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0%E8%BF%87%E7%A8%8B%E4%B8%AD%E8%B0%83%E7%94%A8virtual%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾09-ç»ä¸åœ¨æ„é€ å’Œææ„å‡½æ•°è¿‡ç¨‹ä¸­è°ƒç”¨virtualå‡½æ•°"><a href="#æ¡æ¬¾09-ç»ä¸åœ¨æ„é€ å’Œææ„å‡½æ•°è¿‡ç¨‹ä¸­è°ƒç”¨virtualå‡½æ•°" class="headerlink" title="æ¡æ¬¾09 : ç»ä¸åœ¨æ„é€ å’Œææ„å‡½æ•°è¿‡ç¨‹ä¸­è°ƒç”¨virtualå‡½æ•°"></a>æ¡æ¬¾09 : ç»ä¸åœ¨æ„é€ å’Œææ„å‡½æ•°è¿‡ç¨‹ä¸­è°ƒç”¨virtualå‡½æ•°</h2><p>å¼€é—¨è§å±±é˜é‡Šæœ¬æ¡æ¬¾çš„é‡ç‚¹ : <strong>ä½ ä¸è¯¥åœ¨æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ä¸­è°ƒç”¨virtualå‡½æ•°</strong>.</p><p>ä¹¦ä¸­ç»™å‡ºäº†ä¸€ä¸ªä¾‹å­ : å‡å¦‚æˆ‘ä»¬è¦å¡‘è†œè‚¡å¸‚äº¤æ˜“è®¢å•æ¨¡å‹, è®¢å•å¯ä»¥åˆ†æˆä¹°å…¥, å–å‡ºç­‰ä¸åŒç±»å‹çš„è®¢å•, å½“æˆ‘ä»¬äº§ç”Ÿä¸åŒç±»å‹çš„è®¢å•, ä¹Ÿå°±æ˜¯æ„é€ ä¸åŒç±»å‹è®¢å•å¯¹è±¡æ—¶, æˆ‘ä»¬ä¹Ÿè®¸ä¼šæœ‰è®°å½•è®¢å•æ—¥å¿—çš„éœ€æ±‚, å¹¶æˆ‘ä»¬å¸Œæœ›è®¢å•æ ¹æ®ä¸åŒçš„è®¢å•ç±»å‹äº§ç”Ÿä¸åŒçš„è®¢å•æ—¥å¿—.</p><p>äºæ˜¯æˆ‘ä»¬å¯ä»¥æŠ½è±¡å‡ºä»¥ä¸Šéœ€æ±‚çš„ç±»æ„å»ºè¿‡ç¨‹, ä¸€ä¸ªè®¢å•åŸºç±», æ´¾ç”Ÿå‡ºä¸åŒçš„è®¢å•æ´¾ç”Ÿç±»(å¦‚ä¹°å…¥ç±», å–å‡ºç±»), åŸºç±»çš„æ„é€ å‡½æ•°è°ƒç”¨ä¸€ä¸ªè™šå‡½æ•°<code>logTransaction()</code>, æ´¾ç”Ÿç±»é‡å†™å‡ºä¸åŒçš„<code>logTransaction()</code>, å°±å¯ä»¥å®ç°æˆ‘ä»¬ä»¥ä¸Šçš„éœ€æ±‚.</p><p>ä»£ç å¦‚ä¸‹:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Transaction</span> &#123;                               <span class="hljs-comment">// åŸºç±»</span><br><span class="hljs-keyword">public</span>:                                           <br>  <span class="hljs-built_in">Transaction</span>()<br>  &#123;                                                 <br>  ...<br>  <span class="hljs-built_in">logTransaction</span>();                        <span class="hljs-comment">// è®¢å•æ„å»ºæ—¶ä¾æ®è®¢å•åŠ¨æ€ç±»å‹æ„å»ºå¯¹åº”æ—¥å¿—       </span><br>&#125;     <br><br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">logTransaction</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;     <span class="hljs-comment">// è¦æ±‚æ´¾ç”Ÿç±»é‡å†™</span><br>  ...<br>&#125;;                       <br>                                            <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BuyTransaction</span>: <span class="hljs-keyword">public</span> Transaction &#123;       <span class="hljs-comment">// ä¹°å…¥ç±»</span><br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">logTransaction</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;           <span class="hljs-comment">// æä¾›é‡å†™ç‰ˆæœ¬æ—¥å¿—</span><br>  ...<br>&#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SellTransaction</span>: <span class="hljs-keyword">public</span> Transaction &#123;      <span class="hljs-comment">// å–å‡ºç±»</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">logTransaction</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;          <br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç çœ‹ä¼¼å¾ˆå®Œç¾, ä½†æ˜¯çœŸæ­£è¿è¡Œèµ·æ¥æ˜¯æ— æ³•å®ç°çš„!</p><p>å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code>BuyTransaction</code>ç±»å¯¹è±¡<code>b</code>æ—¶, å¹¶ä¸ä¼šè°ƒç”¨<code>BuyTransaction</code>é‡å†™çš„<code>logTransaction()</code>, è€Œæ˜¯ä¼šè°ƒç”¨åŸºç±»<code>Transaction</code>çš„<code>logTransaction()</code>, ç„¶è€Œæˆ‘ä»¬åŸºç±»çš„<code>logTransaction()</code>è®¾ç½®ä¸ºçº¯è™šå‡½æ•°ç”šè‡³éƒ½æ²¡æœ‰å†™, å°±æ›´åˆ«è°ˆè¿è¡Œäº†. </p><p>ä¸ºä»€ä¹ˆ? ä¹¦ä¸­å‘Šè¯‰æˆ‘ä»¬, <strong>åœ¨base classæ„é€ æœŸé—´, virtualå‡½æ•°ä¸æ˜¯virtualå‡½æ•°</strong>, æ›´ç»†è‡´çš„è¯´å°±æ˜¯<strong>base classæ„é€ æœŸé—´virtualå‡½æ•°ç»ä¸ä¼šä¸‹é™åˆ°derived classé˜¶å±‚</strong>. åŸå› å¾ˆç›´è§‚, <strong>base class æ„é€ å‡½æ•°æ‰§è¡ŒæœŸé—´derived classçš„æˆå‘˜å˜é‡ä¸€å®šè¿˜æœªåˆå§‹åŒ–</strong>, å¦‚æœæ­¤åˆ»å°±å¯ä»¥é€šè¿‡virtualä¸‹é™åˆ°æ´¾ç”Ÿç±», æˆ‘ä»¬æ€ä¹ˆç¡®ä¿è¿™ä¸ªè™šå‡½æ•°ä¸ä¼šè°ƒç”¨æ´¾ç”Ÿç±»çš„æˆå‘˜å˜é‡å‘¢? å¤ªå±é™©äº†, æ‰€ä»¥C++ä¸ä¼šè®©ä½ èµ°è¿™æ¡è·¯.</p><p>è€Œä¸”ä¸æ­¢æ˜¯ä¸èƒ½åœ¨æ„é€ ææ„å‡½æ•°å†…è°ƒç”¨è™šå‡½æ•°, å½“ç„¶ä¹Ÿä¸èƒ½è°ƒç”¨åŒ…å«äº†è™šå‡½æ•°çš„æ™®é€šå‡½æ•°, è¿™æ˜¯æ˜¾è€Œæ˜“è§çš„, è¿™å°±åˆå›åˆ°äº†æˆ‘ä»¬å¼€å¤´è¯´çš„é‚£å¥è¯ : <strong>ç»ä¸åœ¨æ„é€ å’Œææ„å‡½æ•°è¿‡ç¨‹ä¸­è°ƒç”¨virtualå‡½æ•°</strong>, åªè¦è¿˜åœ¨è¿‡ç¨‹ä¸­, å°±ä¸è¦è°ƒç”¨.</p><hr><p>é‚£ä¹ˆæˆ‘ä»¬æœ€å¼€å§‹çš„éœ€æ±‚è¿˜æœ‰å…¶ä»–å®ç°çš„æ–¹å¼å—?</p><p>ä¹¦ä¸­æå‡ºä¸€ç§è§£å†³åŠæ³• : å°†<code>logTransaction()</code>æ”¹ä¸ºæ™®é€šå‡½æ•°, è¦æ±‚æ´¾ç”Ÿç±»æ„é€ å‡½æ•°ä¼ é€’å¿…è¦çš„æ—¥å¿—ä¿¡æ¯ç»™åŸºç±»çš„æ„é€ å‡½æ•°, åŸºç±»çš„æ„é€ å‡½æ•°å†æŠŠæ¥æ”¶åˆ°çš„æ—¥å¿—ä¿¡æ¯ä¼ å…¥<code>logTransaction()</code>, è¿™æ ·å°±å¯ä»¥äº†!</p><p>æˆ‘ä»¬å¯ä»¥å®è§‚åœ°ç†è§£ä¸€ä¸‹, æœ‰åŠ©äºæˆ‘ä»¬çš„æ€ç»´è¿›æ­¥. å…¶å®æ´¾ç”Ÿç±»çš„æ„é€ å‡½æ•°æ˜¯ä¸€ä¸ª<code>è‡ªåº•å‘ä¸Š</code>çš„è¿‡ç¨‹, ä¸€ç›´é€’å½’è°ƒç”¨åˆ°æœ€é¡¶å±‚çš„åŸºç±», å½“è°ƒç”¨åˆ°æœ€é¡¶å±‚å, æˆ‘ä»¬ä¸å¥½å¥¢æ±‚åŸºç±»å†è‡ªé¡¶å‘ä¸‹è°ƒç”¨æ´¾ç”Ÿç±»çš„é‡å†™å‡½æ•°, ä¸å¦‚åœ¨ä¸€å¼€å§‹è‡ªåº•å‘ä¸Šæ—¶å°±æŠŠå¿…è¦çš„ä¿¡æ¯ä¼ é€’è‡³åŸºç±»æ„é€ å‡½æ•°, è¿™æ ·æƒ³å°±éå¸¸é€šé¡ºäº†.</p><p>ä»£ç å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Transaction</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Transaction</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; logInfo)</span>  <span class="hljs-comment">// æ¥æ”¶ä¸‹å±‚çš„æ—¥å¿—ä¿¡æ¯</span></span><br><span class="hljs-function">  </span>&#123;<br>  ...<br>  <span class="hljs-built_in">logTransaction</span>(logInfo);<br>&#125;<br><br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">logTransaction</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; logInfo)</span> <span class="hljs-type">const</span></span>;   <span class="hljs-comment">// æ­¤æ—¶æ˜¯æ™®é€šå‡½æ•°</span><br>  ...<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BuyTransaction</span>: <span class="hljs-keyword">public</span> Transaction &#123;<br><span class="hljs-keyword">public</span>:<br><span class="hljs-built_in">BuyTransaction</span>(<span class="hljs-type">const</span> std::string&amp; parameters)<br>: <span class="hljs-built_in">Transaction</span>(<span class="hljs-built_in">createLogString</span>(parameters))             <span class="hljs-comment">// å°†logä¿¡æ¯ä¼ é€’ç»™ä¸Šå±‚</span><br>  &#123; ... &#125;                                                 <br>   ...                                                  <br><br><span class="hljs-keyword">private</span>:<br>  <span class="hljs-comment">// è¿™é‡Œåˆ©ç”¨ä¸€ä¸ªè¾…åŠ©å‡½æ•°åˆ›å»ºä¸€ä¸ªå€¼ä¼ ç»™base classæ„é€ å‡½æ•°å¾€å¾€æ¯”è¾ƒæ–¹ä¾¿ç¾è§‚å¯è¯»</span><br>  <span class="hljs-function"><span class="hljs-type">static</span> std::string <span class="hljs-title">createLogString</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; parameterss)</span></span>;<br>&#125;;<br></code></pre></td></tr></table></figure><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>ç»ä¸åœ¨æ„é€ å’Œææ„å‡½æ•°è¿‡ç¨‹ä¸­è°ƒç”¨<code>virtual</code>å‡½æ•°.</li><li>å¯¹è±¡åœ¨<code>derived classæ„é€ å‡½æ•°</code>å¼€å§‹æ‰§è¡Œå‰ä¸ä¼šæˆä¸ºä¸€ä¸ª<code>derived classå¯¹è±¡</code>.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾8 ææ„å‡½æ•°çš„å¼‚å¸¸ç®¡ç†</title>
    <link href="/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE8%20%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%BC%82%E5%B8%B8%E7%AE%A1%E7%90%86/"/>
    <url>/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE8%20%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%BC%82%E5%B8%B8%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾08-åˆ«è®©å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°"><a href="#æ¡æ¬¾08-åˆ«è®©å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°" class="headerlink" title="æ¡æ¬¾08 : åˆ«è®©å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°"></a>æ¡æ¬¾08 : åˆ«è®©å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°</h2><blockquote><p>æ—¥å¸¸ç¼–ç¨‹ä¸­ï¼Œå¸¸è§å¼‚å¸¸é€šå¸¸ç”±ä»¥ä¸‹åŸå› å¼•å‘ï¼š</p><ol><li><strong>èµ„æºç®¡ç†ä¸å½“</strong>ï¼ˆå¦‚å†…å­˜æ³„æ¼, æ–‡ä»¶æ“ä½œ, è¿æ¥æˆ–æ–­å¼€è¿æ¥å¤±è´¥ï¼‰ã€‚</li><li><strong>è¾¹ç•Œå’Œåˆæ³•æ€§æ£€æŸ¥ä¸è¶³</strong>ï¼ˆå¦‚æ•°ç»„è¶Šç•Œã€é™¤ä»¥é›¶ï¼‰ã€‚</li><li><strong>å¹¶å‘ç¼–ç¨‹é—®é¢˜</strong>ï¼ˆå¦‚æ­»é”ã€æ•°æ®ç«äº‰ï¼‰ã€‚</li><li><strong>ç±»å‹ä¸åŒ¹é…æˆ–é”™è¯¯çš„æ“ä½œ</strong>ã€‚</li></ol></blockquote><p>æœ¬æ¡æ¬¾ä¸»è¦è®¨è®ºçš„æ˜¯ææ„å‡½æ•°çš„å¼‚å¸¸ç®¡ç†, ä¸ºä»€ä¹ˆä¼šä¸å¸Œæœ›å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°, å› ä¸º<strong>ææ„å‡½æ•°æ˜¯ä¸€ä¸ªå¿…é¡»æ‰§è¡Œä¸”æœ‰å¯èƒ½å¤±è´¥çš„å‡½æ•°</strong>, å› ä¸ºå†…å­˜æ³„æ¼, æ–‡ä»¶æ“ä½œ, è¿æ¥æˆ–æ–­å¼€è¿æ¥å¤±è´¥ç­‰èµ„æºç®¡ç†è¡Œä¸ºçš„é”™è¯¯éƒ½æ˜¯å¾ˆéš¾é¿å…çš„, è€Œä¸”ç”±äº<strong>ææ„å‡½æ•°æ˜¯é€’å½’å¼è°ƒç”¨å¹¶ä¸”å¯èƒ½ä¸€æ¬¡æ€§é”€æ¯å¤§é‡ç»“æ„</strong>, åŒæ—¶äº§ç”Ÿå¤§é‡å¼‚å¸¸çš„æ¦‚ç‡å°±æé«˜äº†, ä¹¦ä¸­æŒ‡å‡º, <strong>å¦‚æœåŒæ—¶å­˜åœ¨å¤šä¸ªå¼‚å¸¸, ç¨‹åºä¸æ˜¯ç»“æŸæ‰§è¡Œå°±æ˜¯å¯¼è‡´ä¸æ˜ç¡®è¡Œä¸º</strong>, å› æ­¤å¯¹äºææ„å‡½æ•°çš„å¼‚å¸¸ç®¡ç†åœ¨æ‰€éš¾å….</p><hr><p>ä¹¦ä¸­ä¸¾å‡ºäº†ä¸€ä¸ªæ•°æ®åº“è¿æ¥çš„ä¾‹å­ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DBConnection</span> &#123;  <span class="hljs-comment">// æ•°æ®åº“è¿æ¥ç±»</span><br><span class="hljs-keyword">public</span>:<br>  ...<br>  <span class="hljs-function"><span class="hljs-type">static</span> DBConnection <span class="hljs-title">create</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">// è¿™ä¸ªå‡½æ•°è¿”å›åˆ›å»ºå‡ºæ¥çš„é™æ€æ•°æ®åº“è¿æ¥.                                     </span><br>  ...                                      <br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span></span>;   <span class="hljs-comment">// è°ƒç”¨æ­¤å‡½æ•°å…³é—­ä¸æ•°æ®åº“çš„è¿æ¥, è¿™é‡Œæœ‰æŠ›å‡ºå¼‚å¸¸çš„éšæ‚£         </span><br>&#125;;         <br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ç»å¸¸ä¼šè®¾è®¡ä¸€ä¸ªèµ„æºç®¡ç†ç±»æ¥æ§åˆ¶æ•°æ®åº“çš„è¿æ¥ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DBConn</span> &#123;                          <span class="hljs-comment">// æ•°æ®åº“è¿æ¥ç®¡ç†ç±»</span><br><span class="hljs-keyword">public</span>:<br>  ...<br>  ~<span class="hljs-built_in">DBConn</span>()<br>  &#123;<br>   db.<span class="hljs-built_in">close</span>();  <span class="hljs-comment">// è°ƒç”¨ææ„å‡½æ•°æ—¶æ–­å¼€æ•°æ®åº“è¿æ¥</span><br>  &#125;<br><span class="hljs-keyword">private</span>:<br>  DBConnection db;   <span class="hljs-comment">// RAIIé£æ ¼, ç”±DBConnç®¡ç†DBConnection, ç¦»å¼€ä½œç”¨åŸŸè‡ªåŠ¨è§¦å‘DBConnçš„ææ„å‡½æ•°æ–­å¼€è¿æ¥</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>äºæ˜¯æˆ‘ä»¬å°±å¯ä»¥å†™å‡ºä»¥ä¸‹ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp">&#123;<br>    ...<br><span class="hljs-function">DBConn <span class="hljs-title">dbc</span><span class="hljs-params">(DBConnection::create())</span></span>; <span class="hljs-comment">// ç›´æ¥å»ºç«‹DBConnectionå¯¹è±¡å¹¶äº¤ç”±DBConnå¯¹è±¡dbcç®¡ç†</span><br>    ... <span class="hljs-comment">// è¿›è¡Œæ•°æ®åº“çš„CURD, ç¦»å¼€ä½œç”¨åŸŸè‡ªåŠ¨æ–­å¼€è¿æ¥</span><br>&#125;<br></code></pre></td></tr></table></figure><hr><p>æœ‰äº†ä¸Šé¢ä¾‹å­çš„åŸºç¡€, æˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸‹å¦‚ä½•é¿å…å¼‚å¸¸æŠ›å‡ºå§.</p><p>ç«™åœ¨<code>DBConnææ„å‡½æ•°</code>çš„è§’åº¦, ä¹¦ä¸­ç»™å‡ºäº†ä¸¤ä¸ªä¸€èˆ¬çš„æ–¹æ³• : </p><ol><li><p>å¦‚æœclose()æŠ›å‡ºå¼‚å¸¸å°±åˆ©ç”¨abort()ç»“æŸç¨‹åº.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp">DBConn::~<span class="hljs-built_in">DBConn</span>()<br>&#123;<br><span class="hljs-keyword">try</span> &#123; db.<span class="hljs-built_in">close</span>(); &#125;<br><span class="hljs-built_in">catch</span> (...) &#123;<br>        <span class="hljs-comment">// è®°å½•æ—¥å¿—, è®°å½•å¯¹closeçš„è°ƒç”¨å¤±è´¥</span><br>   std::<span class="hljs-built_in">abort</span>(); <span class="hljs-comment">// ç›´æ¥ç»“æŸç¨‹åº</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç›´æ¥åä¸‹è¯¥å¼‚å¸¸.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp">DBConn::~<span class="hljs-built_in">DBConn</span>()<br>&#123;<br><span class="hljs-keyword">try</span> &#123; db.<span class="hljs-built_in">close</span>(); &#125;<br><span class="hljs-built_in">catch</span> (...) &#123;<br>      <span class="hljs-comment">// è®°å½•æ—¥å¿—, è®°å½•å¯¹closeçš„è°ƒç”¨å¤±è´¥</span><br>      <span class="hljs-comment">// ä¸åšå¤„ç†, ç›´æ¥åä¸‹</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><p>è¿™ä¸¤ä¸ªæ–¹æ³•å…¶å®éƒ½æ˜¯ä¿åº•æ–¹æ³•, ä¸€ä¸ªæ˜¯è‰ç‡ç»“æŸè¿›ç¨‹, ä¸€ä¸ªæ˜¯åæ‰å¼‚å¸¸é˜²æ­¢æ‰©æ•£, ä½†å…¶å®<code>DBConnææ„å‡½æ•°</code>ä¹Ÿå°±èƒ½åšè¿™ä¹ˆå¤šäº†.</p><hr><p>ç°åœ¨çš„é—®é¢˜æ˜¯<strong>æ²¡æœ‰åŠæ³•å¯¹â€å¯¼è‡´closeæŠ›å‡ºå¼‚å¸¸â€çš„æƒ…å†µåšå‡ºååº”</strong>, é—®é¢˜æ ¸å¿ƒåœ¨<code>close()</code>å‡½æ•°è¢«<code>DBConnææ„å‡½æ•°</code>æŒæ¡, åªèƒ½å…¶è‡ªå·±ç®¡ç†, ä¸Šä¸€å±‚æ— æ³•å¹²é¢„. é‚£ä¹ˆç”±æ­¤æˆ‘ä»¬å¯ä»¥å°†close()å‡½æ•°çš„ä½¿ç”¨æƒä¸Šäº¤, ä¹Ÿå°±æ˜¯è®©ä¸Šä¸€å±‚ç”¨æˆ·æœ‰æƒå†³å®šå¤„ç†<code>close()</code>æŠ¥é”™çš„æ–¹å¼. </p><p>è¾ƒä½³ç­–ç•¥æ˜¯<strong>é‡æ–°è®¾è®¡DBConnæ¥å£, ä½¿å®¢æˆ·æœ‰æœºä¼šå¯¹å¯èƒ½å‡ºç°çš„é—®é¢˜ä½œå‡ºååº”</strong>. </p><p>å…·ä½“åšæ³•å¦‚ä¸‹ : </p><ol><li><code>DBConn</code>è‡ªå·±ä¹Ÿæä¾›ä¸€ä¸ªcloseæ¥å£, å†…éƒ¨å°è£…ä¸Š<code>DBConnection</code>çš„<code>close()</code>.</li><li><code>DBConn</code>è‡ªå·±å¯¹<code>DBConnection</code>çš„<code>close()</code>æ˜¯å¦å·²ç»è§¦å‘è¿›è¡Œè¿½è¸ªç®¡ç†, å¦‚æœåˆ°æœ€åå®¢æˆ·éƒ½æ²¡æœ‰è‡ªè¡ŒcloseæˆåŠŸ, ç”±<code>DBConnææ„å‡½æ•°</code>è‡ªè¡Œå®Œæˆcloseçš„ä»»åŠ¡.</li></ol><p>æˆ‘ä»¬æ¥çœ‹ä¹¦ä¸­ç»™å‡ºçš„ä»£ç  : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DBConn</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  ...<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span>                                     <span class="hljs-comment">// æä¾›ç»™ä¸Šå±‚ç”¨æˆ·çš„closeå‡½æ•°</span></span><br><span class="hljs-function">  </span>&#123;                                       <br>    db.<span class="hljs-built_in">close</span>();<br>    closed = <span class="hljs-literal">true</span>;<br>  &#125;<br><br>  ~<span class="hljs-built_in">DBConn</span>()<br>  &#123;<br>      <span class="hljs-comment">// å¦‚æœåˆ°æœ€åéƒ½æ²¡æœ‰è§¦å‘close, å°±ä¼šå›åˆ°ææ„å‡½æ•°è°ƒç”¨closeçš„è€è·¯</span><br>      <span class="hljs-keyword">if</span> (!closed) &#123;<br>   <span class="hljs-keyword">try</span> &#123;                                           <br>     db.<span class="hljs-built_in">close</span>();                           <br>   &#125;<br>   <span class="hljs-built_in">catch</span> (...) &#123;                                    <br>     <span class="hljs-comment">// è®°å½•æ—¥å¿—, è®°å½•å¯¹closeçš„è°ƒç”¨å¤±è´¥  </span><br>     ...                                   <span class="hljs-comment">// ç›´æ¥ç»“æŸ æˆ– åä¸‹å¼‚å¸¸</span><br>   &#125;<br>      &#125;<br>  &#125;<br><br><span class="hljs-keyword">private</span>:<br>  DBConnection db;<br>  <span class="hljs-type">bool</span> closed;<span class="hljs-comment">// ç”¨å¸ƒå°”å˜é‡closedæ¥å¯¹close()è¿›è¡Œè¿½è¸ªç®¡ç†</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>äºæ˜¯å®¢æˆ·ä¾¿å¯åšå‡ºå¦‚ä¸‹æ“ä½œ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">UsingDB</span><span class="hljs-params">()</span> </span>&#123;<br>    DBConn dbConn;  <span class="hljs-comment">// åˆ›å»º DBConn å¯¹è±¡</span><br>    <br>    ...<br>    <br>    <span class="hljs-comment">// å®¢æˆ·è‡ªå·±åœ¨è®¤ä¸ºåˆé€‚çš„åœ°æ–¹è°ƒç”¨close()ç»“æŸè¿æ¥, å¹¶ç”¨try-catchè¯­å¥å°è¯•æ•è·å¼‚å¸¸</span><br>    <span class="hljs-keyword">try</span> &#123;<br>        dbConn.<span class="hljs-built_in">close</span>();  <span class="hljs-comment">// è¿™å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœå…³é—­å¤±è´¥</span><br>    &#125; <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> std::exception&amp; e) &#123;<br>        <span class="hljs-comment">// å®¢æˆ·ç«¯æ•è·ä» close() æŠ›å‡ºçš„å¼‚å¸¸</span><br>        <span class="hljs-comment">// ... å‡ºç°å¼‚å¸¸æ—¶çš„æ“ä½œ</span><br>    &#125;<br><br>    <span class="hljs-keyword">return</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœåªè€ƒè™‘æ•°æ®åº“æ–­å¼€è¿æ¥çš„åœºæ™¯, æˆ‘ä»¬å¯è¡Œçš„å…·ä½“æ“ä½œå¯ä»¥æ˜¯é‡è¯•å…³é—­æˆ–æ‰§è¡Œæ•°æ®åº“å›æ»š, ä»£ç å¦‚ä¸‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">UsingDB</span><span class="hljs-params">()</span> </span>&#123;<br>    DBConn dbConn;  <span class="hljs-comment">// åˆ›å»º DBConn å¯¹è±¡</span><br>    <br>    ...<br>    <br>    <span class="hljs-type">bool</span> success = <span class="hljs-literal">false</span>;<br><span class="hljs-type">int</span> attempts = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">while</span> (!success &amp;&amp; attempts &lt; <span class="hljs-number">3</span>) &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        dbConn.<span class="hljs-built_in">close</span>();<br>        success = <span class="hljs-literal">true</span>;<br>    &#125; <span class="hljs-built_in">catch</span> (...) &#123;<br>        std::cerr &lt;&lt; <span class="hljs-string">&quot;æ­£åœ¨å°è¯•æ–­å¼€æ•°æ®åº“è¿æ¥, æ¬¡æ•° :  &quot;</span> &lt;&lt; ++attempts &lt;&lt; std::endl;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">if</span> (!success) &#123;<br>    std::cerr &lt;&lt; <span class="hljs-string">&quot;å·²ç»å°è¯•ä¸‰æ¬¡æ–­å¼€æ•°æ®åº“è¿æ¥, ä½†éƒ½å‡ºç°å¼‚å¸¸, æ–­å¼€å¤±è´¥&quot;</span> &lt;&lt; std::endl;<br>        std::cerr &lt;&lt; <span class="hljs-string">&quot;è¿›è¡Œè¡¥å¿æ“ä½œ, å›æ»šæ•°æ®åº“&quot;</span> &lt;&lt; std::endl;<br>        dbConn.<span class="hljs-built_in">rollback</span>(); <span class="hljs-comment">// å†…éƒ¨è°ƒç”¨æ•°æ®åº“çš„å›æ»šå‡½æ•°</span><br>&#125;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å†æ¥æ‹ä¸€ä¸‹æµç¨‹, å…ˆæ˜¯å®¢æˆ·éœ€è¦è€ƒè™‘ä½•æ—¶è°ƒç”¨<code>close()</code>å¹¶å†™å‡ºåº”å¯¹å¼‚å¸¸çš„ä»£ç , å®é™…è¿è¡Œæ—¶å¦‚æœæ²¡æœ‰å¼‚å¸¸å°±ä¸‡äº‹å¤§å‰, æœ‰å¼‚å¸¸å°±è§¦å‘å®¢æˆ·çš„å¤„ç†é€»è¾‘, æœ€åææ„å‡½æ•°æ£€æŸ¥å®¢æˆ·æ˜¯å¦çœŸçš„æˆåŠŸè°ƒç”¨äº†<code>close()</code>, å¦‚æœè¿˜æ˜¯æ²¡æœ‰è°ƒç”¨, å°±è‡ªå·±è°ƒç”¨, è‡ªå·±è°ƒç”¨å¦‚æœè¿˜å‡ºé”™, å°±ç›´æ¥ç»“æŸç¨‹åºæˆ–åæ‰å¼‚å¸¸.</p><p>è‡³æ­¤æˆ‘ä»¬å°†è°ƒç”¨<code>close()</code>çš„è´£ä»»ä»<code>DBConnææ„å‡½æ•°</code>çš„æ‰‹ä¸Šç§»äº¤åˆ°äº†ä½¿ç”¨<code>DBConnå¯¹è±¡</code>çš„å®¢æˆ·æ‰‹ä¸Š, å¯ä»¥æ›´å¥½åœ°é¿å…å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°. æœ‰äººå¯èƒ½è¿™æ ·ä¼šåŠ å¤§å®¢æˆ·çš„æ“ä½œè´Ÿæ‹…, ä½†æ˜¯æ ¹æ®æˆ‘ä»¬å…ˆå‰çš„åˆ†æ, åªæœ‰å®¢æˆ·æ‰èƒ½æœ‰åŠæ³•å¯¹â€å¯¼è‡´closeæŠ›å‡ºå¼‚å¸¸â€çš„æƒ…å†µåšå‡ºååº”, è¿™æ ·åšæ˜¯ç»™å®¢æˆ·æä¾›ä¸€ä¸ªæ ¹æ®å®é™…æƒ…å†µå›é¿å¼‚å¸¸çš„æœºä¼š, è‡³äºæ˜¯å¦éœ€è¦å°±çœ‹å®¢æˆ·è‡ªå·±äº†.</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>ææ„å‡½æ•°ç»å¯¹ä¸è¦åå‡ºå¼‚å¸¸. å¦‚æœåˆ†æå‡ºä¸€ä¸ªææ„å‡½æ•°æœ‰æŠ›å‡ºå¼‚å¸¸çš„é£é™©, åº”å½“å…ˆæŠŠå¼‚å¸¸æ•æ‰ä¸‹æ¥, çœ‹æ˜¯å¦ç»“æŸç¨‹åºæˆ–åä¸‹å¼‚å¸¸.</li><li>ç»™å®¢æˆ·æä¾›è‡ªå·±å¤„ç†å¼‚å¸¸çš„æœºä¼š, è®©å®¢æˆ·å¯ä»¥æ ¹æ®å®é™…æƒ…å†µå¯¹å¼‚å¸¸åšå‡ºååº”.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾7 virtualææ„å‡½æ•°</title>
    <link href="/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE7%20virtual%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0/"/>
    <url>/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE7%20virtual%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾07-ä¸ºå¤šæ€åŸºç±»å£°æ˜virtualææ„å‡½æ•°"><a href="#æ¡æ¬¾07-ä¸ºå¤šæ€åŸºç±»å£°æ˜virtualææ„å‡½æ•°" class="headerlink" title="æ¡æ¬¾07 : ä¸ºå¤šæ€åŸºç±»å£°æ˜virtualææ„å‡½æ•°"></a>æ¡æ¬¾07 : ä¸ºå¤šæ€åŸºç±»å£°æ˜virtualææ„å‡½æ•°</h2><blockquote><p>è¯´åˆ°å¤šæ€, æˆ‘ä»¬åº”å½“éå¸¸äº†è§£å…¶è¿è¡Œæ—¶ç»‘å®šçš„æœºåˆ¶, ç®€å•æ¥è¯´å°±æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•æ—¶å€™æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚å°†åŸºç±»ç»‘å®šä¸ºä¸åŒçš„æ´¾ç”Ÿç±», ç”¨ç›¸åŒçš„æ“ä½œå®ç°ä¸åŒçš„æ•ˆæœ, è¿™å…¶ä¸­virtualå‡½æ•°èµ·åˆ°äº†è‡³å…³é‡è¦çš„ä½œç”¨, æ¯ä¸€ä¸ªå«æœ‰è™šå‡½æ•°çš„ç±»éƒ½ä¼šç»´æŠ¤ä¸€ä¸ªè™šè¡¨, ä»¥æ­¤å®ç°åŸºç±»åˆ°æ´¾ç”Ÿç±»çš„åŠ¨æ€ç»‘å®š. </p></blockquote><p>è¿™é‡Œä¹¦ä¸­æåˆ°äº†ä¸€ä¸ªé‡è¦åˆç»å¸¸å‘ç”Ÿçš„é—®é¢˜ : <strong>å¦‚æœ<code>drived class(æ´¾ç”Ÿç±»)</code>å¯¹è±¡ç»ç”±ä¸€ä¸ª<code>base class(åŸºç±»)</code>æŒ‡é’ˆè¢«åˆ é™¤, è€Œè¯¥base classå¸¦ç€ä¸€ä¸ªnon-virtualææ„å‡½æ•°, é‚£ä¹ˆç»“æœæ˜¯æœªå®šä¹‰çš„</strong>.</p><p>è¿™é‡Œçš„ç»“æœæœªå®šä¹‰, ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯åªä¼šè°ƒç”¨<code>base class</code>è‡ªå·±çš„ææ„å‡½æ•°, é”€æ¯çš„æ˜¯è¯¥å¯¹è±¡çš„<code>base class</code>éƒ¨åˆ†, è€Œ<code>drived class</code>éƒ¨åˆ†å´æ²¡æœ‰è¢«é”€æ¯, å°±é€ æˆäº†è¯¡å¼‚çš„â€å±€éƒ¨é”€æ¯â€ç°è±¡.</p><p>è€Œè§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•å°±æ˜¯ : <strong>ç»™ base class ä¸€ä¸ª virtualææ„å‡½æ•°</strong>.</p><p>å…ˆå›å¿†ä¸€ä¸‹æœ‰å…³æ´¾ç”Ÿç±»ææ„å‡½æ•°çš„çŸ¥è¯† : <strong>æ´¾ç”Ÿç±»çš„ææ„å‡½æ•°ä¼šé»˜è®¤å…ˆè°ƒç”¨ä¸Šä¸€å±‚çš„ææ„å‡½æ•°</strong>. ä¹Ÿå°±æ˜¯è¯´æ˜¯ä»å½“å‰æ´¾ç”Ÿç±»çš„ææ„å‡½æ•°å¼€å§‹, é€’å½’å¼è°ƒç”¨ä¸Šä¸€å±‚çš„ææ„å‡½æ•°, ç›´åˆ°åˆ°è¾¾æœ€æ·±å±‚çš„åŸºç±». </p><p>å†æ€è€ƒä¸Šé¢çš„è¯, å½“<code>base class</code>æŒ‡é’ˆåŠ¨æ€ç»‘å®š<code>drived class</code>å¯¹è±¡æ—¶, å¦‚æœæˆ‘ä»¬æƒ³åˆ é™¤è¿™ä¸ªå¯¹è±¡æ—¶, æ­£ç¡®çš„ç»“æœåº”è¯¥æ˜¯è°ƒç”¨åŠ¨æ€ç»‘å®šçš„<code>drived class</code>çš„ææ„å‡½æ•°, è¿™æ ·æ‰èƒ½æ­£ç¡®åœ°å…¨éƒ¨é”€æ¯, è€Œæƒ³è¿™æ ·è°ƒç”¨å°±åªèƒ½ä¾èµ–äºè™šå‡½æ•°æ¥å®ç°, ä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦æŠŠbase classçš„ææ„å‡½æ•°è®¾ç½®ä¸ºvirtual, åˆ é™¤æ—¶å°±ä¼šæ ¹æ®è™šè¡¨æ‰¾åˆ°å½“å‰åŠ¨æ€ç±»å‹ç»‘å®šçš„ææ„å‡½æ•°.</p><p>ä»¥ä¸‹æ˜¯ä¹¦ä¸­çš„ç»™å‡ºçš„æ ·ä¾‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TimeKeeper</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-built_in">TimeKeeper</span>();<br>  <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">TimeKeeper</span>();<br>  ...<br>&#125;;<br>TimeKeeper *ptk = <span class="hljs-built_in">getTimeKeeper</span>();<br>...<br><span class="hljs-keyword">delete</span> ptk;                         <span class="hljs-comment">// ç°åœ¨, è¡Œä¸ºæ­£ç¡®</span><br></code></pre></td></tr></table></figure><p>ä¹¦ä¸­å‘Šè¯‰æˆ‘ä»¬ : </p><ul><li><strong>virtual å‡½æ•°çš„ç›®çš„æ˜¯å…è®¸ derived class çš„å®ç°å¾—ä»¥å®¢åˆ¶åŒ–</strong>.</li><li><strong>ä»»ä½• class åªè¦å¸¦æœ‰ virtual å‡½æ•°éƒ½å‡ ä¹ç¡®å®šåº”è¯¥ä¹Ÿæœ‰ä¸€ä¸ª virtual ææ„å‡½æ•°</strong>.</li></ul><hr><p>å½“ç„¶, æ— ç«¯åœ°å°†æ‰€æœ‰çš„ classes çš„ææ„å‡½æ•°å£°æ˜ä¸º virtual, å°±åƒä»æœªå£°æ˜ä»–ä»¬ä¸º virtual ä¸€æ ·, éƒ½æ˜¯é”™è¯¯çš„.</p><p>å¦‚æœ class ä¸å« virtual å‡½æ•°, é€šå¸¸è¡¨ç¤ºå®ƒå¹¶ä¸æ„å›¾è¢«ç”¨ä½œä¸€ä¸ª base class, ä¹Ÿå°±å®Œå…¨ä¸éœ€è¦å£°æ˜virtualææ„å‡½æ•°.</p><p>æˆ‘ä»¬çŸ¥é“ä½¿ç”¨è™šå‡½æ•°æ˜¯è¦å¸¦æ¥é¢å¤–çš„èŠ±é”€çš„, åŒ…æ‹¬ç»´æŠ¤è™šè¡¨, è™šæŒ‡é’ˆè¡¨ç­‰ä¸€ç³»åˆ—ç¹æ‚çš„åŠ¨ä½œ, ä¼šå¸¦æ¥æ—¶é—´æˆæœ¬å’Œç©ºé—´æˆæœ¬, è€Œä¸”ä¹¦ä¸­è¿˜æåˆ°ç”±äºå¯¹è±¡å¤§å°çš„å¢åŠ ä¼šå½±å“å…¶å¯ç§»æ¤æ€§.</p><p>æ‰€ä»¥è¯·è®°ä½ä¸€ä¸ªå¿ƒå¾— : <strong>åªæœ‰å½“ class å†…å«è‡³å°‘ä¸€ä¸ª virtual å‡½æ•°, æ‰ä¸ºä»–å£°æ˜ virtualææ„å‡½æ•°</strong>.</p><hr><p><strong>è¯·ä¸è¦ä¼å›¾ç»§æ‰¿æˆ‘ä»¬ç¥åœ£çš„STLå®¹å™¨</strong>, æ­£å› ä¸ºè€ƒè™‘åˆ°ä¸Šé¢è™šå‡½æ•°æœ‰å…³æ—¶é—´, ç©ºé—´, å¯ç§»æ¤æ€§çš„é—®é¢˜, STLå®¹å™¨å¹¶æ²¡æœ‰è€ƒè™‘è¢«ç»§æ‰¿çš„æƒ…å†µ, å®ƒä»¬çš„ææ„å‡½æ•°éƒ½æ˜¯ non-virtual çš„!</p><hr><p>è¿™é‡Œä¹¦ä¸­æåˆ°äº†ä¸€ä¸ªæ„å»ºæŠ½è±¡ç±»çš„å°çªé—¨ : </p><p>æˆ‘ä»¬ä¸€èˆ¬ä¸å¸Œæœ›æŠ½è±¡ç±»è¢«å®ä½“åŒ–, å®ƒåªæä¾›ä¸€äº›æ¥å£ : </p><ol><li>è¢«å£°æ˜ä¸º<code>çº¯è™šå‡½æ•°</code>çš„æ¥å£æ‰€æœ‰æ´¾ç”Ÿç±»å¿…é¡»é‡å†™.</li><li>è¢«å£°æ˜ä¸º<code>è™šå‡½æ•°</code>çš„æ¥å£æä¾›é»˜è®¤è¡Œä¸ºåŒæ—¶ä¹Ÿå…è®¸æ´¾ç”Ÿç±»é‡å†™.</li><li>è¢«å£°æ˜ä¸º<code>æ™®é€šå‡½æ•°</code>çš„æ¥å£å¯ä»¥è¢«æ‰€æœ‰æ´¾ç”Ÿç±»ç»§æ‰¿, ä½¿ç”¨.</li></ol><p>æˆ‘ä»¬åœ¨è®¾è®¡ä¸€ä¸ªæŠ½è±¡ç±»æ—¶, ä¹Ÿè®¸å¹¶ä¸å¸Œæœ›æœ‰ä»€ä¹ˆç±»æ˜¯å¿…é¡»é‡å†™çš„, å°±æ˜¯ä¸å¸Œæœ›æœ‰çº¯è™šå‡½æ•°, åªéœ€è¦æä¾›è™šå‡½æ•°å’Œæ™®é€šå‡½æ•°å³å¯, ç„¶è€Œä¸€ä¸ªç±»æƒ³è¦ä¸è¢«å®ä½“åŒ–, <strong>å¿…é¡»å­˜åœ¨ä¸€ä¸ªçº¯è™šå‡½æ•°</strong>, é‚£ä¹ˆå“ªé‡Œæ‰¾ä¸€ä¸ªçº¯è™šå‡½æ•°å‘¢? </p><p><strong>å¦‚æœä½ æ‹¿ä¸å®šä¸»æ„, é€‰ææ„å‡½æ•°å°±å¥½äº†!</strong> æ¯•ç«ŸæŠ½è±¡ç±»ä¸€å®šæœ‰å¤šæ€çš„éœ€æ±‚, åªè¦æœ‰å¤šæ€çš„éœ€æ±‚, ææ„å‡½æ•°å°±å¿…é¡»æ˜¯ virtual çš„, å·²ç»æ˜¯è™šå‡½æ•°äº†, å˜æˆçº¯è™šå‡½æ•°ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜, è€Œä¸”å½“æˆ‘ä»¬çš„æ´¾ç”Ÿç±»æ²¡æœ‰æ–°å¢åŠ¨æ€èµ„æºæ—¶, å°±ç®—æˆ‘ä»¬ä¸æ‰‹åŠ¨é‡å†™ææ„å‡½æ•°ä¹Ÿæ²¡å…³ç³»! å› ä¸ºç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬ç”Ÿæˆ! è¿™æ ·æ—¢æ»¡è¶³äº†å¿…é¡»æœ‰ä¸€ä¸ªçº¯è™šå‡½æ•°çš„è¦æ±‚, åˆä¸éœ€è¦æˆ‘ä»¬é¡¾åŠçº¯è™šå‡½æ•°å¿…é¡»é‡å†™çš„é—®é¢˜, å¤šä¹ˆå®Œç¾ !</p><p>ä¸è¿‡æœ‰ä¸€ä¸ªå°ç»†èŠ‚å¿…é¡»è¦æ³¨æ„, æ‰€æœ‰æ´¾ç”Ÿç±»ææ„å‡½æ•°æœ€åéƒ½ä¼šè°ƒç”¨åˆ°æœ€åº•å±‚åŸºç±»çš„ææ„å‡½æ•°, æ‰€ä»¥æˆ‘ä»¬<strong>éœ€è¦å¯¹çº¯è™šææ„å‡½æ•°è¿›è¡Œå®šä¹‰</strong>!</p><p>çº¯è™šææ„å‡½æ•°çœŸçš„èƒ½å®šä¹‰å—? ç­”æ¡ˆæ˜¯èƒ½çš„, è™½ç„¶å¤§å¤šæ•°æƒ…å†µä¸‹çº¯è™šå‡½æ•°éƒ½ä¸ç”¨å®šä¹‰, ä½†æ˜¯çœŸè¦å®šä¹‰è¿˜æ˜¯å¯ä»¥çš„.</p><p>ä»¥ä¸‹æ˜¯ä¹¦ä¸­çš„ç¤ºä¾‹ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AWOV</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">AWOV</span>() = <span class="hljs-number">0</span>;  <span class="hljs-comment">// çº¯è™šå‡½æ•°</span><br>  <span class="hljs-comment">// ...</span><br>&#125;;<br>AWOV::~<span class="hljs-built_in">AWOV</span>()  <span class="hljs-comment">// çº¯è™šå‡½æ•°çš„å®šä¹‰</span><br>&#123;<br>    <span class="hljs-comment">// delete ...</span><br>&#125;                    <br></code></pre></td></tr></table></figure><hr><p>å†æ¬¡é‡ç”³, æœ¬ç« çš„ä¸»è¦è§‚ç‚¹  <strong>ç»™ base class ä¸€ä¸ª virtualææ„å‡½æ•°</strong> åªé€‚ç”¨äºå¤šæ€ç”¨é€”, è¿™ç§<code>base class</code>çš„è®¾è®¡ç›®çš„å°±æ˜¯ä¸ºäº†<strong>ç”¨æ¥é€šè¿‡ <code>base class</code> æ¥å£å¤„ç† <code>drived class</code> å¯¹è±¡</strong>.</p><p>æˆ‘ä»¬ä¹Ÿåº”å½“çŸ¥é“å¾ˆå¤š class çš„è®¾è®¡å°±ä¸æ˜¯ä¸ºäº†ä½œä¸º base class æ¥ä½¿ç”¨, ä¹Ÿå¹¶éæ‰€æœ‰çš„ base class çš„è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†å¤šæ€ç”¨é€”, å°±åƒæˆ‘ä»¬ä¸Šä¸€ä¸ªæ¡æ¬¾çš„<code>Uncopyable</code>ç±», å®ƒè¢«ä½œä¸ºåŸºç±»å°±ä¸æ˜¯ä¸ºäº†å¤šæ€, è€Œæ˜¯ä¸ºäº†èµ‹äºˆæ´¾ç”Ÿç±»ä¸å¯æ‹·è´çš„å±æ€§, å°±ä¸éœ€è¦ä½¿ç”¨åŸºç±»æ¥å£, ä½¿ç”¨ä¹Ÿåªæ˜¯ä½¿ç”¨æ´¾ç”Ÿç±», ä½¿ç”¨ virtualææ„å‡½æ•°å°±æ²¡å¿…è¦äº†.</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>è¯·ä¸ºå¤šæ€æ€§è´¨çš„<code>base class</code>è®¾ç½® virtualææ„å‡½æ•°, åä¹‹è¯·ä¸è¦.</li><li>ä¸è¦è¯•å›¾ç»§æ‰¿<code>STL</code>å®¹å™¨.</li><li>æƒ³è®¾è®¡æŠ½è±¡ç±»åˆä¸çŸ¥é“çº¯è™šå‡½æ•°é€‰è°æ—¶, é€‰ææ„å‡½æ•°å½“çº¯è™šå‡½æ•°.</li></ul><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾5-6 é»˜è®¤æˆå‘˜å‡½æ•°</title>
    <link href="/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE5%20-%206%20%E9%BB%98%E8%AE%A4%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0/"/>
    <url>/2024/11/30/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE5%20-%206%20%E9%BB%98%E8%AE%A4%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾05-äº†è§£C-é»˜é»˜ç¼–å†™å¹¶è°ƒç”¨å“ªäº›å‡½æ•°"><a href="#æ¡æ¬¾05-äº†è§£C-é»˜é»˜ç¼–å†™å¹¶è°ƒç”¨å“ªäº›å‡½æ•°" class="headerlink" title="æ¡æ¬¾05 äº†è§£C++é»˜é»˜ç¼–å†™å¹¶è°ƒç”¨å“ªäº›å‡½æ•°"></a>æ¡æ¬¾05 äº†è§£C++é»˜é»˜ç¼–å†™å¹¶è°ƒç”¨å“ªäº›å‡½æ•°</h2><blockquote><p>ç¼–è¯‘å™¨ä¼šé»˜è®¤ä¸ºclassåˆ›å»ºdefaultæ„é€ å‡½æ•°, ææ„å‡½æ•°, copyæ„é€ å‡½æ•°, èµ‹å€¼æ“ä½œç¬¦é‡è½½, è¿™ç®—æ˜¯æˆ‘ä»¬C++è¯­è¨€åŸºç¡€å­¦ä¹ ä¸­çš„é‡ä¸­ä¹‹é‡, è¿™é‡Œå°±ä¸å†è¿‡å¤šé˜é‡Š.</p></blockquote><p>ä¹¦ä¸­æå‡ºä¸€ç‚¹ : å¦‚æœæˆ‘ä»¬åœ¨å®é™…ä½¿ç”¨ä¸­ç¡®å®æ²¡æœ‰ä½¿ç”¨åˆ°æŸäº›é»˜è®¤æˆå‘˜å‡½æ•°, ç¼–è¯‘å™¨å¾ˆå¤§å¯èƒ½ä¹Ÿä¸ä¼šè‡ªåŠ¨åˆ›å»ºå¯¹åº”çš„é»˜è®¤å‡½æ•°(ä¾‹å¦‚copyæ„é€ å‡½æ•°, èµ‹å€¼æ“ä½œç¬¦é‡è½½).</p><hr><p>ä¹¦ä¸­è¿˜æå‡ºäº†ä¸‰ç§ç¼–è¯‘å™¨æ‹’ç»è‡ªåŠ¨ç”Ÿæˆèµ‹å€¼æ“ä½œç¬¦é‡è½½çš„æƒ…æ™¯ : </p><ol><li>å†…å«<code>reference(å¼•ç”¨)</code>æˆå‘˜å˜é‡çš„ç±».</li><li>å†…å«<code>const</code>æˆå‘˜å˜é‡çš„ç±»</li><li>åŸºç±»å°†èµ‹å€¼æ“ä½œç¬¦é‡è½½å£°æ˜ä¸ºprivateçš„æ´¾ç”Ÿç±»</li></ol><p>åŸå› éƒ½æ˜¯æ˜¾è€Œæ˜“è§çš„, <code>reference</code>ä¸å¯æ”¹æŒ‡ä¸åŒå¯¹è±¡, <code>const</code>ä¸å¯è¢«æ›´æ”¹, æ´¾ç”Ÿç±»åŸºäºåŸºç±».</p><hr><p>è¿™é‡Œé¢å¤–æä¸€ä¸ªå°ç‚¹, å°±æ˜¯é»˜è®¤ç”Ÿæˆçš„æ‹·è´å‡½æ•°å’Œè¾…åŠ©æ“ä½œç¬¦é‡è½½é»˜è®¤éƒ½æ˜¯æµ…æ‹·è´, å°±æ˜¯åªæŠŠç±»ç±»å¯¹è±¡çš„æ‰€æœ‰å€¼è¿›è¡Œå¤åˆ¶, å¦‚æœæœ‰æŒ‡é’ˆ, ä¸ä¼šæ·±å…¥æ‹·è´æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹, åªæ˜¯å•çº¯æŠŠæŒ‡é’ˆæœ¬èº«æ‹·è´.</p><h2 id="æ¡æ¬¾6-è‹¥ä¸æƒ³ä½¿ç”¨ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°-å°±è¯¥æ˜ç¡®æ‹’ç»"><a href="#æ¡æ¬¾6-è‹¥ä¸æƒ³ä½¿ç”¨ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°-å°±è¯¥æ˜ç¡®æ‹’ç»" class="headerlink" title="æ¡æ¬¾6 : è‹¥ä¸æƒ³ä½¿ç”¨ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°, å°±è¯¥æ˜ç¡®æ‹’ç»"></a>æ¡æ¬¾6 : è‹¥ä¸æƒ³ä½¿ç”¨ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°, å°±è¯¥æ˜ç¡®æ‹’ç»</h2><blockquote><p>è™½ç„¶å¤§å¤šæƒ…å†µä¸‹ä¸€ä¸ªç±»å¯¹è±¡åº”å½“æœ‰å¤–ç½®çš„æ„é€ &#x2F;ææ„&#x2F;æ‹·è´æ¥å£, ä½†æ˜¯æ€»ä¼šæœ‰ä¸€äº›ç‹¬ä¸€æ— äºŒçš„ä¸œè¥¿åº”å½“æ˜¯ä¸å¯å¤åˆ¶çš„, å°±æƒ³å¤©ä¸‹æ²¡æœ‰ç¬¬äºŒä¸ªä½ ä¸€æ ·, å¦‚æœä¸ºä½ è‡ªå·±è®¾è®¡ä¸€ä¸ªç±», ä½ è‚¯å®šä¹Ÿä¸å¸Œæœ›æœ‰ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„æ‹·è´å‡½æ•°å¯ä»¥æ‹·è´å‡ºæ— æ•°ä¸ªä½ å§.</p></blockquote><p>å› æ­¤, è‹¥ä¸æƒ³ä½¿ç”¨ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°, å°±è¯¥æ˜ç¡®æ‹’ç».</p><p>æ‰€ä»¥æ€ä¹ˆæ‹’ç»å‘¢?</p><ol><li>å°†è¯¥å‡½æ•°å†™å…¥privateä¸­, å¹¶ä¸”æ•…æ„ä¸å®ç°å®ƒ.</li><li>å°†è¯¥å‡½æ•°ååŠ ä¸Š<code>= delete</code>.</li></ol><p>å‡å®šæˆ‘ä»¬è¦å†™ä¸€ä¸ªæˆ¿äº§ä¹°å–çš„ç±»<code>HomeForSale</code>, ä¼—æ‰€å‘¨çŸ¥æ¯ä¸€å¥—æˆ¿äº§éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„.</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹æ€ä¹ˆå®ç° :</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// æ–¹æ³•ä¸€</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HomeForSale</span><br>&#123;<br><span class="hljs-keyword">public</span>:<br>    ...<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-comment">// privateæˆå‘˜å‡½æ•°</span><br>    <span class="hljs-built_in">HomeForSale</span>(<span class="hljs-type">const</span> HomeForSale&amp;); <br>    HomeForSale&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> HomeForSale&amp;); <span class="hljs-comment">// è¿™æ ·æ‹·è´å‡½æ•°æ— æ³•åœ¨å¤–éƒ¨ä½¿ç”¨å°±ç›¸å½“äºç¦ç”¨</span><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-comment">// privateæˆå‘˜å˜é‡</span><br>&#125;;<br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// æ–¹æ³•äºŒ</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HomeForSale</span><br>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">HomeForSale</span>(<span class="hljs-type">const</span> HomeForSale&amp;) = <span class="hljs-keyword">delete</span>; <span class="hljs-comment">// ç›´æ¥å£°æ˜ç¦ç”¨, å…¶å®åœ¨å“ªå£°æ˜éƒ½å¯ä»¥</span><br>    HomeForSale&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> HomeForSale&amp;) = <span class="hljs-keyword">delete</span>;<br><span class="hljs-keyword">private</span>:<br>   ...<br>&#125;;<br></code></pre></td></tr></table></figure><hr><h4 id="è®¾è®¡ä¸€ä¸ªä¸“é—¨ä¸ºäº†é˜»æ­¢copyingåŠ¨ä½œçš„base-class"><a href="#è®¾è®¡ä¸€ä¸ªä¸“é—¨ä¸ºäº†é˜»æ­¢copyingåŠ¨ä½œçš„base-class" class="headerlink" title="è®¾è®¡ä¸€ä¸ªä¸“é—¨ä¸ºäº†é˜»æ­¢copyingåŠ¨ä½œçš„base class"></a>è®¾è®¡ä¸€ä¸ªä¸“é—¨ä¸ºäº†é˜»æ­¢copyingåŠ¨ä½œçš„base class</h4><p>é’ˆå¯¹æŸäº›å¯¹è±¡ç‹¬ä¸€æ— äºŒçš„æƒ…å†µ, æˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ä¸ªä¸“é—¨ä¸ºäº†é˜»æ­¢copyingåŠ¨ä½œçš„base class, è®©æ‰€æœ‰æœ‰æ­¤éœ€æ±‚çš„ç±»ç»§æ‰¿è‡ªè¯¥ç±», å°±å¯ä»¥å®Œå…¨ä¸ç”¨åœ¨ä¸“é—¨å¤„ç†é˜»æ­¢copyingåŠ¨ä½œäº†.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Uncopyable</span> &#123;<br><span class="hljs-keyword">protected</span>:              <span class="hljs-comment">// å…è®¸æ„é€ å’Œææ„</span><br>  <span class="hljs-built_in">Uncopyable</span>() &#123;&#125;                            <br>  ~<span class="hljs-built_in">Uncopyable</span>() &#123;&#125;                           <br><br><span class="hljs-keyword">private</span>:<br>  <span class="hljs-built_in">Uncopyable</span>(<span class="hljs-type">const</span> Uncopyable&amp;);   <span class="hljs-comment">// é˜»æ­¢copying</span><br>  Uncopyable&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> Uncopyable&amp;);<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HomeForSale</span>: <span class="hljs-keyword">private</span> Uncopyable &#123;     <br>  ...    <span class="hljs-comment">// è‡ªæ­¤HomeForSaleä¸éœ€è¦å†è¿›è¡Œä»»ä½•åŠ¨ä½œå°±å¯ä»¥å®ç°é˜»æ­¢copying</span><br>&#125;;  <br></code></pre></td></tr></table></figure><p>ed : ä¹Ÿè®¸æœ‰äººè§‰å¾—è¿™æ ·å­åè€Œå¤šå†™çš„, ä½†åœ¨æ—¥å¸¸æƒ…å†µä¸‹<code>Uncopyable</code>å®Œå…¨å¯ä»¥æ˜¯æˆ‘ä»¬æå‰å¤‡å¥½çš„, ctrl + vå½“ç„¶æ–¹ä¾¿å¾ˆå¤š. å†è¯´åˆ°ä¸ºä»€ä¹ˆæ˜¯<code>privateç»§æ‰¿</code>, åœ¨åé¢çš„æ¡æ¬¾ä¸­æˆ‘ä»¬ä¼šæ˜ç™½, <code>privateç»§æ‰¿</code>æ„å‘³ç€<code>has-a(æœ‰ä¸€ä¸ª)</code>çš„å…³ç³», å°±æ˜¯è¯´, æ´¾ç”Ÿç±»æœ‰ç€åŸºç±»çš„éƒ¨åˆ†æ€§è´¨, è€Œä¸ç­‰äºåŸºç±», ç¬¦åˆæ­¤å¤„<code>HomeForSale</code>å’Œ<code>Uncopyable</code>çš„å…³ç³».</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½:"></a>è¯·è®°ä½:</h3><ul><li>ç¼–è¯‘å™¨ä¼šé»˜è®¤ä¸ºclassåˆ›å»º<code>defaultæ„é€ å‡½æ•°</code>, <code>ææ„å‡½æ•°</code>, <code>copyæ„é€ å‡½æ•°</code>, <code>èµ‹å€¼æ“ä½œç¬¦é‡è½½</code>.</li><li>æ‹’ç»ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°, å¯ä»¥å°†å…¶å†™åœ¨å°†è¯¥å‡½æ•°å†™å…¥privateä¸­, å¹¶ä¸”æ•…æ„ä¸å®ç°å®ƒ, æˆ–è€…ç›´æ¥åŠ ä¸Š<code>= delete</code></li><li>å¯ä»¥å†™ä¸€äº›é€šç”¨ç±»å¦‚<code>Uncopyable</code>, å°†åŠŸèƒ½å’Œå®ç°è§£è€¦.</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾4 åˆå§‹åŒ–</title>
    <link href="/2024/11/29/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE4/"/>
    <url>/2024/11/29/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE4/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾04-ç¡®å®šå¯¹è±¡è¢«ä½¿ç”¨å‰å·²å…ˆè¢«åˆå§‹åŒ–"><a href="#æ¡æ¬¾04-ç¡®å®šå¯¹è±¡è¢«ä½¿ç”¨å‰å·²å…ˆè¢«åˆå§‹åŒ–" class="headerlink" title="æ¡æ¬¾04 ç¡®å®šå¯¹è±¡è¢«ä½¿ç”¨å‰å·²å…ˆè¢«åˆå§‹åŒ–"></a>æ¡æ¬¾04 ç¡®å®šå¯¹è±¡è¢«ä½¿ç”¨å‰å·²å…ˆè¢«åˆå§‹åŒ–</h2><blockquote><p>æœ¬æ¡è®¨è®ºå¦‚ä½•å®‰å…¨é«˜æ•ˆåœ°å®ç°åˆå§‹åŒ–, å½“ç„¶ä¹Ÿæœ‰ä¸€äº›æ¡ä»¶å¥‡è‘©çš„åˆå§‹åŒ–å€¼å¾—æˆ‘ä»¬å»è®¨è®º</p></blockquote><h3 id="æ™®é€šå˜é‡åˆå§‹åŒ–"><a href="#æ™®é€šå˜é‡åˆå§‹åŒ–" class="headerlink" title="æ™®é€šå˜é‡åˆå§‹åŒ–"></a>æ™®é€šå˜é‡åˆå§‹åŒ–</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> x = <span class="hljs-number">0</span>;<br>cont <span class="hljs-type">char</span> text[] = <span class="hljs-string">&quot;hello&quot;</span>;<br><br><span class="hljs-type">double</span> d;<br>cin &gt;&gt; d;    <span class="hljs-comment">// è¿™ç§ä¹Ÿå«åˆå§‹åŒ–</span><br></code></pre></td></tr></table></figure><h3 id="ç±»å†…å˜é‡åˆå§‹åŒ–"><a href="#ç±»å†…å˜é‡åˆå§‹åŒ–" class="headerlink" title="ç±»å†…å˜é‡åˆå§‹åŒ–"></a>ç±»å†…å˜é‡åˆå§‹åŒ–</h3><p>ç±»å†…å˜é‡çš„åˆå§‹åŒ–ä¸€èˆ¬å°±æ˜¯ä¸‰ç§, <code>ç±»å†…è®¾ç½®åˆå§‹å€¼</code>, <code>ç¼ºçœå€¼</code> , <code>åˆå§‹å€¼åˆ—è¡¨</code>. </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Stu</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Stu</span>(<span class="hljs-type">const</span> string&amp; name = <span class="hljs-string">&quot;å°çº¢&quot;</span>, <span class="hljs-type">const</span> <span class="hljs-type">int</span>&amp; age = <span class="hljs-string">&quot;17&quot;</span>, <span class="hljs-type">const</span> string&amp; sex = <span class="hljs-string">&quot;å¥³&quot;</span>) <span class="hljs-comment">// è®¾ç½®ç¼ºçœå€¼ (æ¬¡ä¹‹)</span><br>    :_name(name.<span class="hljs-built_in">c_str</span>())<br>        ,_age(age)<br>        ,_sex(sex.<span class="hljs-built_in">c_str</span>())<span class="hljs-comment">// åˆå§‹åŒ–åˆ—è¡¨ (ä¼˜å…ˆ)</span><br>    &#123;&#125;<br>    <br><span class="hljs-keyword">private</span> : <br><span class="hljs-type">char</span> _name[<span class="hljs-number">10</span>] = <span class="hljs-string">&quot;å°æ˜&quot;</span>;<br>    <span class="hljs-type">int</span> _age = <span class="hljs-number">18</span>;<br>    <span class="hljs-type">char</span> _sex[<span class="hljs-number">5</span>] = <span class="hljs-string">&quot;ç”·&quot;</span>;  <span class="hljs-comment">// ç±»å†…è®¾ç½®åˆå§‹å€¼ (æœ€æ¬¡)</span><br>&#125;<br><br>Stu s1;  <span class="hljs-comment">// å°çº¢ 17 å¥³</span><br><span class="hljs-function">Stu <span class="hljs-title">s2</span><span class="hljs-params">(<span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>, <span class="hljs-number">35</span>, <span class="hljs-string">&quot;ç”·&quot;</span>)</span></span>;    <span class="hljs-comment">// å¼ ä¸‰ 35 ç”· </span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œè™½ç„¶çœ‹èµ·æ¥ä¸‰ç§æ–¹å¼éƒ½å¯ä»¥, ä½†æ˜¯åªæ¨èå…¨éƒ¨ä½¿ç”¨åˆå§‹å€¼åˆ—è¡¨, å½“æœ‰ç‰¹åˆ«æƒ³è¦è®¾ç½®çš„é»˜è®¤å€¼æ—¶è®¾ç½®ç¼ºçœå€¼.</p><h3 id="åˆå§‹å€¼åˆ—è¡¨"><a href="#åˆå§‹å€¼åˆ—è¡¨" class="headerlink" title="åˆå§‹å€¼åˆ—è¡¨"></a>åˆå§‹å€¼åˆ—è¡¨</h3><h4 id="ä¼˜åŠ¿æè¿°"><a href="#ä¼˜åŠ¿æè¿°" class="headerlink" title="ä¼˜åŠ¿æè¿° :"></a>ä¼˜åŠ¿æè¿° :</h4><p>ä¸ºäº†æè¿°åˆå§‹å€¼åˆ—è¡¨çš„ä¼˜åŠ¿, è¯·å…ˆé˜…è¯»ä»¥ä¸‹å¦ä¸€ç‰ˆæœ¬çš„æ„é€ å‡½æ•°:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">Stu</span>(<span class="hljs-type">const</span> string&amp; name, <span class="hljs-type">const</span> <span class="hljs-type">int</span>&amp; age, <span class="hljs-type">const</span> string&amp; sex)<br>&#123;<br>_name = name.<span class="hljs-built_in">c_str</span>();<br>    _age = age;<br>    _sex = sex.<span class="hljs-built_in">c_str</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºè¿™æ ·å­å†™æ„é€ å‡½æ•°å…¶å®å’Œæˆ‘ä»¬å†™åˆå§‹å€¼åˆ—è¡¨çš„æœ€ç»ˆç»“æœæ˜¯ä¸€æ ·çš„, è€Œä¸”ç›¸å¯¹ç›´è§‚.</p><p><strong>ä½†æ˜¯</strong>, è¯¥ç‰ˆæœ¬åœ¨åº•å±‚æ¯ä¸ªå˜é‡å…¶å®æ˜¯å…ˆè¿›è¡Œäº†ä¸€æ¬¡defaultçš„æ„é€ , å†è¿›è¡Œäº†ä¸€æ¬¡copyæ“ä½œ, å…¶æœ¬è´¨æ˜¯<code>åˆå§‹åŒ– + èµ‹å€¼</code>.</p><p>è€Œ<code>åˆå§‹å€¼åˆ—è¡¨</code>åœ¨åº•å±‚åªè¿›è¡Œäº†ä¸€æ¬¡copyæ„é€ , æ¯”å‰è€…é«˜æ•ˆå¾—å¤š, æœ¬è´¨å°±æ˜¯<code>åˆå§‹åŒ–</code>.</p><h4 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹ :"></a>æ³¨æ„äº‹é¡¹ :</h4><ul><li>æœ€å¥½åœ¨åˆå§‹å€¼åˆ—è¡¨ä¸­åˆå§‹åŒ–æ‰€æœ‰çš„æˆå‘˜å˜é‡, è¿™æ ·èµ·ç ä¸ä¼šå¿˜è®°æ²¡æœ‰åˆå§‹åŒ–çš„å˜é‡.</li><li>C++ä¸­æˆå‘˜å˜é‡çš„åˆå§‹åŒ–é¡ºåºæ˜¯æŒ‰ç…§ç±»ä¸­å£°æ˜çš„æ¬¡åº, è€Œéåˆå§‹å€¼åˆ—è¡¨ä¸­çš„é¡ºåº! (å¦‚æœæœ‰ç»§æ‰¿å…³ç³», åŸºç±»ä¸€å®šæ—©äºæ´¾ç”Ÿç±»åˆå§‹åŒ–)</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Example</span>(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)<br>        : _b(b), _a(a) <span class="hljs-comment">// å°½ç®¡åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­æ˜¯_båœ¨å‰, ä½†æ˜¯ä¾æ—§æ˜¯å…ˆåˆå§‹åŒ–_a</span><br>    &#123;&#125;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">int</span> _a; <span class="hljs-comment">// _a åœ¨ _b ä¹‹å‰å£°æ˜</span><br>    <span class="hljs-type">int</span> _b; <span class="hljs-comment">// _b åœ¨ _a ä¹‹åå£°æ˜</span><br>&#125;;<br><span class="hljs-comment">// ----------------------------------------------------------//</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Red</span> &#123;&#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Blue</span> &#123;&#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Purple</span>&#123; <span class="hljs-comment">// ç´«è‰²éœ€è¦ç±»å‹ä¸ºçº¢è‰²å’Œè“è‰²çš„å˜é‡</span><br><span class="hljs-keyword">public</span>:<br><span class="hljs-built_in">Purple</span>(<span class="hljs-type">const</span> Red&amp; red, <span class="hljs-type">const</span> Blue&amp; blue)<br>        :<span class="hljs-built_in">r</span>(red) ,<span class="hljs-built_in">b</span>(blue)<br>    &#123;&#125;<br><span class="hljs-keyword">private</span>:<br>    Red r;<br>    Blue b;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Color</span> <span class="hljs-comment">// Colorç±»å­˜å‚¨ä¸‰ç§é¢œè‰², å¹¶ä¸”å¯ä»¥ç”¨çº¢è“é…å‡ºç´«</span><br>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Color</span>(<span class="hljs-type">const</span> Red&amp; red, <span class="hljs-type">const</span> Blue&amp; blue)<br>        :<span class="hljs-built_in">r</span>(red)<br>        :<span class="hljs-built_in">b</span>(blue)<br>        :<span class="hljs-built_in">purper</span>(r, b)<br>    &#123;&#125;<br><span class="hljs-keyword">private</span>:<br>    Red r;           <span class="hljs-comment">//purple p;</span><br>    Blue b; <span class="hljs-comment">//Red r;</span><br>    Purple p; <span class="hljs-comment">//Blue b; å‡å¦‚æ˜¯æ³¨é‡Šä¸­çš„æƒ…å†µ, å°†æ— æ³•ç¼–è¯‘é€šè¿‡, å› ä¸ºpéœ€è¦r,béƒ½åˆå§‹åŒ–å®Œæ‰èƒ½åˆå§‹åŒ–</span><br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="ä¸åŒç¼–è¯‘å•å…ƒå†…å®šä¹‰non-local-staticå¯¹è±¡-çš„åˆå§‹åŒ–æ¬¡åº"><a href="#ä¸åŒç¼–è¯‘å•å…ƒå†…å®šä¹‰non-local-staticå¯¹è±¡-çš„åˆå§‹åŒ–æ¬¡åº" class="headerlink" title="[ ä¸åŒç¼–è¯‘å•å…ƒå†…å®šä¹‰non-local staticå¯¹è±¡ ] çš„åˆå§‹åŒ–æ¬¡åº"></a>[ ä¸åŒç¼–è¯‘å•å…ƒå†…å®šä¹‰non-local staticå¯¹è±¡ ] çš„åˆå§‹åŒ–æ¬¡åº</h3><p>åˆçœ‹ç¬¬ä¸€çœ¼æ ¹æœ¬å°±ä¸çŸ¥é“æ˜¯ä»€ä¹ˆä¸œè¥¿(å†çœ‹ä¹Ÿä¸çŸ¥é“), æ‰€ä»¥å…ˆä»‹ç»ä¸€ä¸‹å®šä¹‰:</p><ul><li><p>ç¼–è¯‘å•å…ƒ : å¯ä»¥ç®€å•ç†è§£ä¸ºä¸€ä¸ªå•ç‹¬çš„<code>.cpp</code>æ–‡ä»¶æˆ–<code>.h</code>æ–‡ä»¶ç­‰, å°±æ˜¯æœ‰ä¸€å®šçš„éš”ç¦»æ€§.</p></li><li><p><code>local static</code>(å±€éƒ¨é™æ€å˜é‡) : ç”Ÿå‘½å‘¨æœŸä¸ºæ•´ä¸ªç¨‹åº, <strong>åœ¨å±€éƒ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶åˆå§‹åŒ–</strong>, ä¹‹åéƒ½æ˜¯ç”¨è¿™ä¸ª.</p></li><li><p><code>non-local static</code>(å…¨å±€é™æ€å˜é‡) : ç”Ÿå‘½å‘¨æœŸä¹Ÿä¸ºæ•´ä¸ªç¨‹åº, <strong>ç¨‹åºå¯åŠ¨æ—¶åˆå§‹åŒ–</strong>, ä¹‹åéƒ½æ˜¯ç”¨è¿™ä¸ª.(ä¾‹å¦‚å…¨å±€å˜é‡)</p></li></ul><p><code>local static</code>å’Œ<code>non-local static</code>çš„åŒºåˆ«ç®€å•æ¥çœ‹å°±åœ¨äºåˆå§‹åŒ–çš„æ—¶æœº.</p><hr><p>å†ä¸¾ä¸€ä¸ªä¾‹å­, å¦‚æœæˆ‘åœ¨<code>a.h</code>ä¸­å®šä¹‰äº†<code>class A</code>, åœ¨<code>b.h</code>ä¸­å®šä¹‰äº†<code>class B</code>, åˆåœ¨<code>c.cpp</code>ä¸­è¦æ±‚ä½¿ç”¨ç±»å‹ä¸ºAå’Œç±»å‹ä¸ºBçš„<code>non-local static</code>å˜é‡, é‚£ä¹ˆè¿™ä¸¤ä¸ªå˜é‡çš„åˆå§‹åŒ–æ¬¡åºæ˜¯æ€æ ·çš„?</p><p>ç­”æ¡ˆæ˜¯<strong>æ— æ³•åˆ¤æ–­</strong>, ä½ çœ‹ä¸Šé¢çš„å®šä¹‰, <code>non-local static</code>å¯¹è±¡éƒ½æ˜¯åœ¨ç¨‹åºå¯åŠ¨æ—¶åˆå§‹åŒ–, C++æ ¹æœ¬æ²¡æœ‰æ‰‹æ®µåˆ¤æ–­åº”è¯¥å…ˆåˆå§‹åŒ–å“ªä¸ª,æ‰€ä»¥è¿™å°±æ˜¯æ²¡æœ‰å®šä¹‰çš„è¡Œä¸º!</p><hr><p>è¯´äº†è¿™ä¹ˆå¤š, é‚£è¿™æ ·ä¼šå¸¦æ¥ä»€ä¹ˆéšæ‚£å‘¢? </p><p>å¦‚æœä¸¤ä¸ªç¼–è¯‘å•å…ƒä¸­çš„ç±»æœ‰ä¾èµ–å…³ç³»çš„è¯, åˆå§‹åŒ–æ¬¡åºçš„ä¸ç¡®å®šæ€§å°±ä¼šå¯¼è‡´é—®é¢˜!</p><p>å‡å¦‚è¯´Bç±»staticå˜é‡ä¸­ä½¿ç”¨åˆ°äº†Aç±»staticå˜é‡çš„è¯, å¦‚æœåœ¨<code>c.cpp</code>ä¸­å…ˆåˆå§‹åŒ–äº†Bç±»staticå˜é‡, å¯æ˜¯Aç±»staticå˜é‡è¿˜æ²¡åˆå§‹åŒ–, é‚£ä¹ˆå°±åªæœ‰æŠ¥é”™ä¸€æ¡è·¯äº†. </p><hr><p>å¯èƒ½çœ‹åˆ°è¿™é‡Œæœ‰äººä¸å¤ªç†è§£è¿™ç§æƒ…å†µæœ‰ä»€ä¹ˆåº”ç”¨åœºæ™¯, é‚£ä¹ˆæˆ‘åœ¨è¿™é‡Œå¼•å…¥ä¸€ä¸ªå®šä¹‰ :</p><ul><li>å†…ç½®å‹å¯¹è±¡ : è¿™ä¸ªå¯¹è±¡æœ¬èº«å¹¶æ²¡æœ‰å¤ªå¤§æ„ä¹‰, ç›®çš„æ˜¯ä¸ºäº†å¼•å‡ºç±»ä¸­çš„å„ç§åŠŸèƒ½æ€§å‡½æ•°, ä¸€èˆ¬æ˜¯non-local staticçš„.</li></ul><p><strong>è¿›ä¸€æ­¥è§£é‡Š</strong> : æœ‰äº›ç±»ä¸­ä¼šæœ‰è®¸å¤šåº”ç”¨å®é™…åœºæ™¯çš„æ–¹æ³•å‡½æ•°, å¦‚æœéœ€è¦ä½¿ç”¨è¿™äº›å‡½æ•°, å°±éœ€è¦å®¢æˆ·æ„é€ ä¸€ä¸ªç±»å¯¹è±¡,å†ç”¨è¿™ä¸ªå¯¹è±¡ä½¿ç”¨å‡½æ•°, é‚£ä¹ˆæˆ‘ä»¬å°±å¹²è„†åœ¨ç±»çš„å¤´æ–‡ä»¶ä¸­å£°æ˜ä¸€ä¸ªç±»å¯¹è±¡, è¦æ±‚ä½¿ç”¨è¿™ä¸ªå¤´æ–‡ä»¶çš„å®¢æˆ·å¿…é¡»è®°å¾—ç”Ÿæˆä¸€ä¸ªå¯¹åº”å¯¹è±¡, è€Œè¿™ä¸ªå¯¹è±¡ä¸€èˆ¬æ˜¯non-local staticçš„. </p><p>å‡å¦‚æœ‰ä¸€ä¸ªé’Ÿè¡¨ç±», å†…éƒ¨éœ€è¦ç”¨åˆ°ä¸€ä¸ªè®¡æ—¶å™¨çš„ç±», äºæ˜¯ä½¿ç”¨äº†è®¡æ—¶å™¨ç±»çš„å†…ç½®å¯¹è±¡, å½“ç”¨æˆ·åˆ›å»ºä¸€ä¸ªnon-local staticç±»å‹çš„é’Ÿè¡¨ç±»å¯¹è±¡æ—¶, ä½ æ— æ³•ç¡®å®šè®¡æ—¶å™¨ç±»çš„å†…ç½®å¯¹è±¡å’Œé’Ÿè¡¨ç±»å¯¹è±¡å“ªä¸ªå…ˆåˆå§‹åŒ–.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// TimeKeeper.h   è¿™æ˜¯ä¸€ä¸ªè®¡æ—¶å™¨ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TimeKeeper</span><br>&#123;<br><span class="hljs-keyword">public</span>:<br>    ....<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">GetTime</span><span class="hljs-params">()</span></span>;<br>    ....<br>&#125;;<br><span class="hljs-keyword">extern</span> TimeKeeper tk;<br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Clock.hè¿™æ˜¯ä¸€ä¸ªé’Ÿè¡¨ç±»</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;TimeKeeper&quot;</span></span><br>......<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Clock</span><br>&#123;<br><span class="hljs-keyword">public</span>: <br>    <span class="hljs-built_in">Clock</span>()<br>        :<span class="hljs-built_in">time</span>(tk.<span class="hljs-built_in">GetTime</span>()) <span class="hljs-comment">// è¿™é‡Œç”¨tkè·å–å½“å‰æ—¶é—´æ¥åˆå§‹åŒ–time</span><br>    &#123;&#125;<br>    <br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">int</span> time;<br>&#125;;<br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// user.cpp</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Clock.h&quot;</span></span><br>...<br>Clock clock; <span class="hljs-comment">// å¦‚æœç”¨æˆ·è®¾ç½®ä¸€ä¸ªå…¨å±€å˜é‡çš„Clockç±»å¯¹è±¡clock, æ­¤æ—¶æ— æ³•ç¡®å®šclockå’Œtkçš„åˆå§‹åŒ–æ¬¡åº!</span><br>...<br></code></pre></td></tr></table></figure><h4 id="è§£å†³æ–¹æ³•-ä»¥local-staticå¯¹è±¡æ›¿æ¢non-local-staticå¯¹è±¡"><a href="#è§£å†³æ–¹æ³•-ä»¥local-staticå¯¹è±¡æ›¿æ¢non-local-staticå¯¹è±¡" class="headerlink" title="è§£å†³æ–¹æ³• : ä»¥local staticå¯¹è±¡æ›¿æ¢non-local staticå¯¹è±¡"></a>è§£å†³æ–¹æ³• : ä»¥local staticå¯¹è±¡æ›¿æ¢non-local staticå¯¹è±¡</h4><p>è¿™ä¸ªè§£å†³æ–¹æ³•ç”¨åˆ°äº†è®¾è®¡æ¨¡å¼ä¸­æœ€ç»å…¸çš„<code>å•ä¾‹æ¨¡å¼</code>çš„è®¾è®¡æ€æƒ³ : å»¶è¿Ÿåˆå§‹åŒ–.</p><p>æ€è·¯ç®€å•æ¥è¯´å°±æ˜¯, æ—¢ç„¶ç»™å‡ºä¸€ä¸ªnon-local staticå¯¹è±¡æœ‰é£é™©çš„è¯, æˆ‘å°±ä¸ç»™è¿™ä¸ªnon-local staticå¯¹è±¡äº†, æˆ‘ç›´æ¥ä½¿ç”¨ä¸€ä¸ªå‡½æ•°, å½“å®¢æˆ·æœ‰ä½¿ç”¨å†…ç½®å‹å¯¹è±¡ç›¸åº”éœ€æ±‚çš„æ—¶å€™, å½“çœŸæ­£å®¢æˆ·è°ƒç”¨è¿™ä¸ªå‡½æ•°æ—¶, æ‰ä¼šä½¿ç”¨å‡½æ•°å†…éƒ¨çš„ä»£ç è‡ªå·±ç”Ÿæˆä¸€ä¸ªlocal staticå¯¹è±¡ä¾›è‡ªå·±ä½¿ç”¨, è¿™æ ·åˆå§‹åŒ–æ¬¡åºå°±æœ‰äº†ä¿éšœ.</p><p>æ›´é€šä¿—æ˜“æ‡‚åœ°æè¿°ä¸€ä¸‹, å°±æ˜¯è™½ç„¶ä¸å¥½ç›´æ¥ä½¿ç”¨å†…ç½®å‹å¯¹è±¡, ä½†æ˜¯å¯ä»¥æŠŠå‡½æ•°è¿”å›å€¼å½“æˆå†…ç½®å‹å¯¹è±¡æ¥ä½¿ç”¨,  å› ä¸ºåœ¨å‡½æ•°å†…ç”Ÿæˆçš„å¯¹è±¡æ—¶æ˜¯local staticå¯¹è±¡, æ²¡æœ‰åˆå§‹åŒ–æ¬¡åºçš„é—®é¢˜.</p><p>çœ‹ä¸€çœ‹æ¥ä¸‹æ¥çš„ä»£ç å§ : </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// TimeKeeper.h   è¿™æ˜¯ä¸€ä¸ªè®¡æ—¶å™¨ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TimeKeeper</span><br>&#123;<br><span class="hljs-keyword">public</span>:<br>    ....<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">GetTime</span><span class="hljs-params">()</span></span>;<br>    <br>    <span class="hljs-function">TimeKeeper&amp; <span class="hljs-title">tk</span><span class="hljs-params">()</span> <span class="hljs-comment">// è¿™é‡Œç”¨tkå‡½æ•°æ›¿ä»£å†…ç½®å‹å¯¹è±¡tk</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-type">static</span> TimeKeeper timekeeper;  <span class="hljs-comment">// å½“ç”¨æˆ·çœŸæ­£è°ƒç”¨tk()æ—¶, æ‰ä¼šåœ¨å‡½æ•°å†…éƒ¨ç”Ÿæˆä¸€ä¸ªå±€éƒ¨é™æ€å˜é‡(local static)</span><br>        <span class="hljs-keyword">return</span> timekeeper;<br>    &#125;<br>    ....<br>&#125;;<br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Clock.hè¿™æ˜¯ä¸€ä¸ªé’Ÿè¡¨ç±»</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;TimeKeeper&quot;</span></span><br>......<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Clock</span><br>&#123;<br><span class="hljs-keyword">public</span>: <br>    <span class="hljs-built_in">Clock</span>()<br>        :<span class="hljs-built_in">time</span>(<span class="hljs-built_in">tk</span>().<span class="hljs-built_in">GetTime</span>()) <span class="hljs-comment">// è¿™é‡Œåªæ˜¯ç®€å•åœ°å°†tkæ¢æˆäº†tk(), ä»è°ƒç”¨å¯¹è±¡æ”¹ä¸ºè°ƒç”¨å‡½æ•°è€Œå·²</span><br>    &#123;&#125;<br>    <br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">int</span> time;<br>&#125;;<br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// user.cpp</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Clock.h&quot;</span></span><br>...<br>Clock clock; <br><span class="hljs-comment">// è®¾ç½®ä¸€ä¸ªå…¨å±€å˜é‡çš„Clockç±»å¯¹è±¡clock, æ­¤æ—¶ä¸€å®šæ˜¯clockå¼€å§‹åˆå§‹åŒ–, å½“åˆå§‹åŒ–æ—¶è°ƒç”¨åˆ°tk()å†è¿›è¡Œtimekeeperçš„åˆå§‹åŒ–</span><br>...<br></code></pre></td></tr></table></figure><h4 id="å¤šçº¿ç¨‹æƒ…å†µä¸‹çš„å®‰å…¨æ€§"><a href="#å¤šçº¿ç¨‹æƒ…å†µä¸‹çš„å®‰å…¨æ€§" class="headerlink" title="å¤šçº¿ç¨‹æƒ…å†µä¸‹çš„å®‰å…¨æ€§ :"></a>å¤šçº¿ç¨‹æƒ…å†µä¸‹çš„å®‰å…¨æ€§ :</h4><p>ä¹¦ä¸­æŒ‡æ˜, <code>å†…æ¶µstaticå¯¹è±¡</code>åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ä¼šå¸¦æœ‰çº¿ç¨‹å®‰å…¨çš„é—®é¢˜, ç­‰å¾…æŸäº‹å‘ç”Ÿéƒ½ä¼šæœ‰éº»çƒ¦.</p><p>å¦‚æœåŒæ—¶è°ƒç”¨tk(), æ²¡åŠæ³•ä¿è¯åªæœ‰ä¸€ä¸ªtimekeeperç”Ÿæˆ, é™¤éç”¨é”, ä½†é‚£æ ·èŠ±é”€å¤ªå¤§å¾—ä¸å¿å¤±.</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨çº¿ç¨‹çš„å•çº¿ç¨‹å¯åŠ¨é˜¶æ®µ<code>æ‰‹å·¥è°ƒç”¨</code>æ‰€æœ‰çš„åˆå§‹åŒ–å‡½æ•°(ä¾‹å¦‚tk()), è¿™æ ·åœ¨å¤šçº¿ç¨‹æ¥ä¸´å‰å°±å¯ä»¥ç¡®ä¿åˆå§‹åŒ–å®Œæ¯•.</p><hr><h3 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½ :"></a>è¯·è®°ä½ :</h3><ul><li>å¯¹å†…ç½®å‹å¯¹è±¡è¿›è¡Œæ‰‹å·¥åˆå§‹åŒ–, C++æœ¬èº«å¹¶ä¸ä¼šä¿è¯æ­£ç¡®åˆå§‹åŒ–ä»–ä»¬.</li><li>æœ€å¥½ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨, å¹¶ä¸”æ’åºè¦å’Œç±»å†…çš„å£°æ˜é¡ºåºä¸€è‡´.</li><li>å¦‚æœæœ‰è·¨ç¼–è¯‘å•å…ƒçš„åˆå§‹åŒ–æ¬¡åºé—®é¢˜, è¯·ä»¥local staticå¯¹è±¡æ›¿æ¢non-local staticå¯¹è±¡.</li></ul><p>åˆšå¼€å§‹å†™åšå®¢, å¦‚æœ‰é”™è¯¯æ„Ÿè°¢æŒ‡æ­£!</p><p>by å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾3 const</title>
    <link href="/2024/11/29/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE3/"/>
    <url>/2024/11/29/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE3/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¡æ¬¾03-å°½å¯èƒ½ä½¿ç”¨const"><a href="#æ¡æ¬¾03-å°½å¯èƒ½ä½¿ç”¨const" class="headerlink" title="æ¡æ¬¾03 : å°½å¯èƒ½ä½¿ç”¨const"></a>æ¡æ¬¾03 : å°½å¯èƒ½ä½¿ç”¨const</h2><blockquote><p><code>const</code>(ä¸å¯è¢«æ”¹åŠ¨), æ˜¯ä¸€ç§éå¸¸æœ‰æ•ˆä¸”å¤šæ ·çš„è¯­ä¹‰çº¦æŸ, æœ‰äº†è¿™é¡¹çº¦æŸ, æˆ‘ä»¬å¯ä»¥å€Ÿç”¨ç¼–è¯‘å™¨ä¹‹æ‰‹è§„èŒƒæˆ‘ä»¬çš„ä»£ç , ä»¥å…å¸¦æ¥æ„æƒ³ä¸åˆ°çš„é”™è¯¯, æ¯•ç«Ÿä»»ä½•çš„æ”¹åŠ¨éƒ½ä¼šä¼´éšç€ä¸€å®šçš„é£é™©, å¦‚æœå¯ä»¥æå‰è§„é¿, æˆ‘ä»¬ä½•ä¹è€Œä¸ä¸ºå‘¢? </p></blockquote><p><code>const</code>åœ¨å®é™…è¡¨ç°ä¸Šæ˜¯å¤šæ‰å¤šè‰ºçš„, ä»–å¯ä»¥ä¿®é¥°å¯¹è±¡, å¯¹è±¡æŒ‡é’ˆ, ç”šè‡³æˆå‘˜å‡½æ•°, æ¥ä¸‹æ¥é€ä¸€ä»‹ç» :</p><h3 id="const-ä¿®é¥°å˜é‡"><a href="#const-ä¿®é¥°å˜é‡" class="headerlink" title="const ä¿®é¥°å˜é‡"></a>const ä¿®é¥°å˜é‡</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-type">const</span> <span class="hljs-type">int</span> N = <span class="hljs-number">200010</span>; <span class="hljs-comment">// è¿™æ ·å­å®šä¹‰çš„Nåˆè¢«ç§°ä¸ºå¸¸å˜é‡, å…¶å®ä¹Ÿå°±æ˜¯å¸¸é‡äº†(å› ä¸ºä¸å¯è¢«æ”¹åŠ¨)</span><br></code></pre></td></tr></table></figure><h3 id="const-ä¿®é¥°æŒ‡é’ˆ"><a href="#const-ä¿®é¥°æŒ‡é’ˆ" class="headerlink" title="const ä¿®é¥°æŒ‡é’ˆ"></a>const ä¿®é¥°æŒ‡é’ˆ</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-type">char</span> arr[] = <span class="hljs-string">&quot;hello&quot;</span>; <span class="hljs-comment">// ä¼—æ‰€å‘¨çŸ¥, arræ•°ç»„åæ˜¯ä¸€ä¸ªæŒ‡é’ˆ</span><br><span class="hljs-type">char</span>* a = arr;<span class="hljs-comment">// aæŒ‡é’ˆå¯ä¿®æ”¹, æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹å¯ä¿®æ”¹</span><br><span class="hljs-type">const</span> <span class="hljs-type">char</span>* b = arr;<span class="hljs-comment">// bæŒ‡é’ˆä¸å¯ä¿®æ”¹, æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹å¯ä¿®æ”¹</span><br><span class="hljs-type">char</span>* <span class="hljs-type">const</span> c = arr;<span class="hljs-comment">// cæŒ‡é’ˆå¯ä¿®æ”¹, æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ä¸å¯ä¿®æ”¹</span><br><span class="hljs-type">const</span> <span class="hljs-type">char</span>* <span class="hljs-type">const</span> d = arr;<span class="hljs-comment">// dæŒ‡é’ˆä¸å¯ä¿®æ”¹, æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ä¸å¯ä¿®æ”¹</span><br></code></pre></td></tr></table></figure><p>è°ˆåˆ°æŒ‡é’ˆå°±ä¸å¯é¿å…çš„å°±ä¼šæƒ³åˆ°<code> è¿­ä»£å™¨</code>, æ¯•ç«Ÿ<code>è¿­ä»£å™¨</code>å°±æ˜¯æŒ‡é’ˆçš„å°è£…å˜›.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//çœ‹çœ‹ä¸‹é¢ä¸¤ç§è¿­ä»£å™¨çš„å®šä¹‰, å°±å¯ä»¥å¯¹åº”ä¸Šé¢æŒ‡é’ˆçš„æƒ…å†µ</span><br><span class="hljs-type">const</span> vector&lt;<span class="hljs-type">int</span>&gt;::iterator iter = v.<span class="hljs-built_in">begin</span>(); <br><span class="hljs-comment">// è¿­ä»£å™¨æœ¬èº«æ˜¯constçš„, ä¹Ÿå°±æ˜¯è¯´æœ¬èº«ä¸å¯ä¿®æ”¹, ç›¸å½“äºæŒ‡é’ˆåœ¨*å‰åŠ const</span><br><span class="hljs-comment">// æ­¤æ—¶æ— æ³•è¿›è¡Œ ++iter ç­‰æ“ä½œ</span><br><br>vector&lt;<span class="hljs-type">int</span>&gt;::const_iterator citer = v.<span class="hljs-built_in">begin</span>();<br><span class="hljs-comment">// è¯­è¨€è‡ªå¸¦çš„const_iteratoræœ¬èº«å°±æ˜¯ä¸ºäº†å¯¹è¿­ä»£å™¨æŒ‡å‘çš„å†…å®¹è®¾ç½®åªè¯», æœ¬èº«å¯ä»¥è¿›è¡Œè¿ç®—æ“ä½œ, ç›¸å½“äºåœ¨*ååŠ const </span><br></code></pre></td></tr></table></figure><h3 id="const-ä¿®é¥°æˆå‘˜å‡½æ•°"><a href="#const-ä¿®é¥°æˆå‘˜å‡½æ•°" class="headerlink" title="const ä¿®é¥°æˆå‘˜å‡½æ•°"></a>const ä¿®é¥°æˆå‘˜å‡½æ•°</h3><blockquote><p>å…ˆæ˜ç¡®<code>const</code>æˆå‘˜å‡½æ•°çš„æ„ä¹‰ : å‘ŠçŸ¥ç¼–è¯‘å™¨è¿™ä¸ªå‡½æ•°å†…éƒ¨çš„å¯¹è±¡ä¸åº”è¢«æ”¹åŠ¨.</p><p>ä¸æ˜¯è¯´æ˜å‡½æ•°æœ¬èº«ä¸å¯æ”¹åŠ¨!!!</p></blockquote><ul><li>é‚£ä¹ˆå¯¹æˆå‘˜å‡½æ•°å£°æ˜<code>const</code>çš„æ„ä¹‰ä½•åœ¨?</li></ul><ol><li><strong>ä½¿è¿™ä¸ªå‡½æ•°æ¥å£æ›´å®¹æ˜“è¢«ç†è§£</strong>, ä¸€ä¸ªå‡½æ•°æ˜¯å¦å¯ä»¥æ”¹å˜ç±»å†…å˜é‡çš„å…·ä½“æ•°å€¼ä¼šå¾ˆå¤§ç¨‹åº¦ä¸Šå½±å“æˆ‘ä»¬å¯¹è¿™ä¸ªå‡½æ•°çš„å®šä½åˆ¤æ–­.</li><li><strong>ä½¿æ“ä½œ<code>const</code>å¯¹è±¡æˆä¸ºå¯èƒ½</strong>, é¦–å…ˆæˆ‘ä»¬è¦æ˜æ™°<code>const</code>å¯¹è±¡æ˜¯ä»€ä¹ˆ, å°±æ˜¯ç±»å®šä¹‰å‡ºçš„<code>const</code>å¯¹è±¡(ä¾‹å¦‚ const Stu stu(å°æ˜, 18);), å½“æˆ‘ä»¬å£°æ˜ä¸€ä¸ªç±»å¯¹è±¡ä¸º<code>const</code>æ—¶, è¿™ä¸ªå¯¹è±¡å¯¹è±¡åªèƒ½è°ƒç”¨<code>const</code>æˆå‘˜å‡½æ•°, è°ƒç”¨çš„ä»»ä½•<code>non-const</code>æˆå‘˜å‡½æ•°éƒ½æ— æ³•é€šè¿‡ç¼–è¯‘çš„, å› æ­¤å¦‚æœä½ æ‰€è®¾è®¡çš„ç±»æœ‰éœ€æ±‚<code>const</code>çš„æƒ…æ™¯æ—¶, è¯·è®¾è®¡<code>const</code>æˆå‘˜å‡½æ•°.</li></ol><hr><ul><li>è¿™é‡Œä¹¦ä¸­ç»™å‡ºäº†ä¸€ä¸ªäº‹å® : <strong>ä¸¤ä¸ªæˆå‘˜å‡½æ•°å¦‚æœåªæ˜¯å¸¸é‡æ€§ä¸åŒ(const &#x2F; non-const), ä¹Ÿå¯ä»¥è¢«é‡è½½.</strong></li></ul><p>â€‹è¿™å…¶å®å°±å‘Šè¯‰æˆ‘ä»¬å¦‚æœæƒ³è¦é€‚é…<code>const</code>ç‰ˆæœ¬çš„è¯, <strong>non-constç‰ˆæœ¬å’Œconstç‰ˆæœ¬å„å†™ä¸€ä¸ªå°±å¥½äº†</strong>, ç¼–è¯‘å™¨ä¼šæ ¹æ®å¯¹è±¡æ˜¯å¦ä¸º<code>const</code>æ¥é€‰æ‹©ä½¿ç”¨å“ªä¸ªå‡½æ•°, æ ·ä¾‹å¦‚ä¸‹:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TextBlock</span> &#123;<br><span class="hljs-keyword">public</span>:<br> ...<br> <span class="hljs-type">const</span> <span class="hljs-type">char</span>&amp; <span class="hljs-keyword">operator</span>[](<span class="hljs-type">const</span> std::<span class="hljs-type">size_t</span> position) <span class="hljs-type">const</span>  <span class="hljs-comment">// 1</span><br> &#123; <span class="hljs-keyword">return</span> text[position]; &#125;   <span class="hljs-comment">// 2</span><br> <span class="hljs-type">char</span>&amp; <span class="hljs-keyword">operator</span>[](<span class="hljs-type">const</span> std::<span class="hljs-type">size_t</span> position)<br> &#123; <span class="hljs-keyword">return</span> text[position]; &#125;<br><span class="hljs-keyword">private</span>:<br>   std::string text;<br>&#125;;<br><br><span class="hljs-function">TextBlock <span class="hljs-title">tb</span><span class="hljs-params">(<span class="hljs-string">&quot;hello&quot;</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-type">const</span> TextBlock <span class="hljs-title">ctb</span><span class="hljs-params">(<span class="hljs-string">&quot;hello&quot;</span>)</span></span>;<br>cout &lt;&lt; tb[<span class="hljs-number">0</span>];<span class="hljs-comment">// è°ƒç”¨å‡½æ•°2</span><br>cout &lt;&lt; ctb[<span class="hljs-number">0</span>];<span class="hljs-comment">// è°ƒç”¨å‡½æ•°1</span><br></code></pre></td></tr></table></figure><hr><ul><li>æ¥ä¸‹æ¥éœ€è¦ä»‹ç»ä¸¤ç§å¯¹<code> æˆå‘˜å‡½æ•°ä¸ºconst</code>æ—¶åº”æœ‰è¡Œä¸ºçš„æµæ´¾æ¦‚å¿µ:</li></ul><h4 id="bitwise-const"><a href="#bitwise-const" class="headerlink" title="bitwise const :"></a>bitwise const :</h4><p>â€‹è¿™ä¸ªæµæ´¾è®¤ä¸ºå¦‚æœä¸€ä¸ªæˆå‘˜å‡½æ•°ä¸º<code>const</code>, åº”å½“<strong>ä¸æ”¹å˜å¯¹è±¡ä¸­çš„ä»»ä½•å˜é‡</strong>, ä¹Ÿå°±æ˜¯ç‰©ç†ä¸Šæ²¡æœ‰1bitè¢«æ”¹å˜.</p><h4 id="logical-const"><a href="#logical-const" class="headerlink" title="logical const :"></a>logical const :</h4><p>â€‹è¿™ä¸ªæµæ´¾è®¤ä¸ºå¦‚æœä¸€ä¸ªæˆå‘˜å‡½æ•°ä¸º<code>const</code>, <strong>å¯ä»¥æ”¹å˜å¯¹è±¡ä¸­çš„æŸäº›å˜é‡</strong>, <strong>ä½†æ˜¯ä¸èƒ½å¯¹å¯¹è±¡çš„ä¸»è¦é€»è¾‘äº§ç”Ÿå½±å“</strong>, ä¹Ÿå°±æ˜¯è¯´å¯¹è±¡åœ¨é€»è¾‘ä¸Šæ²¡æœ‰è¢«æ”¹å˜, æ”¹å˜çš„éƒ¨åˆ†åªæ˜¯èµ·è¾…åŠ©ä¼˜åŒ–ä½œç”¨, ä¾‹å¦‚ä¿®æ”¹æ—¥å¿—, å¯¹è®¡ç®—ç»“æœè¿›è¡Œç¼“å­˜, è®°å½•å½“å‰å®¹å™¨å¤§å°ç­‰, è¿™äº›å·¥ä½œå¯¹ä¸»é€»è¾‘å¹¶æ²¡æœ‰ä»»ä½•å½±å“, å´å¯ä»¥å¤§å¤§æé«˜ä¸»é€»è¾‘çš„å·¥ä½œæ•ˆç‡.</p><hr><ul><li>é‚£ä¹ˆC++å®é™…ä¸Šæ˜¯æ€ä¹ˆå®šä¹‰<code>const</code>æˆå‘˜å‡½æ•°çš„è¡Œä¸ºçš„å‘¢?</li></ul><p>â€‹C++åœ¨<strong>ä¸€èˆ¬æƒ…å†µä¸‹çš„å®šä¹‰æŒ‰ç…§<code>bitwise const</code>çš„è§„åˆ™è¿›è¡Œ</strong>, ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ª<code>const</code>æˆå‘˜å‡½æ•°æ— æ³•æ”¹å˜å¯¹è±¡ä¸­ä»»ä½•å˜é‡.</p><p>â€‹ä½†æ˜¯è¿™å…¶ä¸­æœ‰ä¸€ä¸ªC++æœ¬èº«ä¸å¥½å†³æ–­çš„æƒ…å†µéœ€è¦äº†è§£ :</p><p>â€‹è¿˜è®°å¾—ä¸Šé¢ä»£ç ä¸­å®šä¹‰çš„[]é‡è½½å‡½æ•°å— ? const char&amp; operator[](const std::size_t position) const </p><p>â€‹å‡å¦‚æˆ‘æŠŠè¿”å›å€¼æ”¹ä¸ºchar&amp; : char&amp; operator[](const std::size_t position) const</p><p>â€‹é‚£ä¹ˆè¿™æ ·å°±ä¼šäº§ç”Ÿä¸€ä¸ªå¥‡æ€ªçš„æƒ…å†µ :</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TextBlock</span> &#123;<br><span class="hljs-keyword">public</span>:<br> ...<br><span class="hljs-type">char</span>&amp; <span class="hljs-keyword">operator</span>[](<span class="hljs-type">const</span> std::<span class="hljs-type">size_t</span> position) <span class="hljs-type">const</span>  <br> &#123; <span class="hljs-keyword">return</span> text[position]; &#125;   <br><span class="hljs-keyword">private</span>:<br>   std::string text;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">const</span> TextBlock <span class="hljs-title">ctb</span><span class="hljs-params">(<span class="hljs-string">&quot;hello&quot;</span>)</span></span>;<br><span class="hljs-type">char</span>* pc = &amp;<span class="hljs-built_in">cbt</span>(<span class="hljs-number">0</span>);<span class="hljs-comment">// è¿”å›çš„æŒ‡é’ˆæ²¡æœ‰const</span><br>*pc = <span class="hljs-string">&#x27;j&#x27;</span>;<span class="hljs-comment">// &quot;hello&quot;è¢«å˜æˆäº†&quot;jello&quot;!!!</span><br></code></pre></td></tr></table></figure><p>â€‹é€šè¿‡ä»¥ä¸Šçš„æƒ…å†µæˆ‘ä»¬å¯ä»¥å‘ç°, C++è™½ç„¶ç¡®ä¿åœ¨<code>const</code>æˆå‘˜å‡½æ•°å†…éƒ¨ä¸ä¼šæ”¹å˜ä»»ä½•å¯¹è±¡, ä½†æ˜¯å¹¶ä¸ä¼šæ£€æŸ¥è¿”å›å¯¹è±¡æ‰€æŒ‡å‘çš„å†…å®¹æ˜¯å¦æ˜¯ä¸å¯æ”¹å˜çš„, C++å¯èƒ½è®¤ä¸ºåœ¨å‡½æ•°å¤–çš„è¡Œä¸ºæ˜¯ç¨‹åºå‘˜çš„è‡ªç”±å§, æ‰€ä»¥æˆ‘ä»¬åº”å½“æ³¨æ„è¿™ä¸€ç‚¹.</p><hr><ul><li>é‚£ä¹ˆé—®é¢˜åˆæ¥äº†, æ—¢ç„¶<code>logical const</code>ä¹Ÿæœ‰å…¶é“ç†æ‰€åœ¨, C++æ˜¯å¦‚ä½•è§£å†³çš„å‘¢?</li></ul><p>â€‹C++å¼•å…¥äº†ä¸€ä¸ªä¸<code>const</code>ç›¸å…³çš„æ‘†åŠ¨åœº : <strong>mutable(å¯å˜çš„).</strong></p><p>â€‹<code>mutable</code> çš„ä¸»è¦ç”¨é€”æ˜¯åœ¨ <code>const</code> æˆå‘˜å‡½æ•°ä¸­å…è®¸å¯¹ç‰¹å®šæˆå‘˜å˜é‡çš„ä¿®æ”¹, è¿™æ ·<code>logical const</code>çš„è¯‰æ±‚å°±å¯ä»¥æ»¡è¶³äº†ã€‚</p><p>â€‹è¯·é˜…è¯»ä»¥ä¸‹ä»£ç  : </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">text</span> &#123;<br><br><span class="hljs-keyword">public</span>:<br><span class="hljs-comment">//...</span><br>        <br><span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">updateLength</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">if</span> (!lengthIsValid)<br>&#123;<br><span class="hljs-comment">// ä»¥ä¸‹ä¸¤å¥å°±æ˜¯å› ä¸ºmutableå¾—ä»¥é€šè¿‡</span><br>length = pText.<span class="hljs-built_in">size</span>(); <span class="hljs-comment">// é‡æ–°æ›´æ–°textçš„é•¿åº¦</span><br>lengthIsValid = <span class="hljs-literal">true</span>;  <span class="hljs-comment">// å®šä¹‰å½“å‰lengthå¯ç”¨</span><br>&#125;<br><span class="hljs-keyword">return</span> length;<br>&#125;<br>    <br><span class="hljs-keyword">private</span>:<br>string pText;<br><br><span class="hljs-comment">// mutable å…³é”®å­—å¯ä»¥ä½¿æŸä¸ªæˆå‘˜å˜é‡åœ¨constæˆå‘˜å‡½æ•°è¢«ä¿®æ”¹</span><br><span class="hljs-comment">// ä½œç”¨æ˜¯åœ¨ä¸æ”¹å˜å†…éƒ¨å˜é‡çš„åŸºç¡€é€»è¾‘çš„æƒ…å†µä¸‹, å¯ä»¥å¼•å…¥å°‘é‡å˜é‡å¯ä»¥è¢«æ”¹å˜, ä¸°å¯Œé€»è¾‘</span><br><span class="hljs-comment">// ä¿è¯å‡½æ•°çš„å®‰å…¨, ä½¿ç”¨mutableæ„å‘³ç€åœ¨constæˆå‘˜å‡½æ•°ä¸­åªèƒ½æ”¹å˜mutableå˜é‡, å…¶ä»–å˜é‡ä¸ä¼šè¢«æ”¹å˜</span><br><span class="hljs-keyword">mutable</span> <span class="hljs-type">size_t</span> length;<br><span class="hljs-keyword">mutable</span> <span class="hljs-type">bool</span> lengthIsValid;<br>&#125;;<br><br></code></pre></td></tr></table></figure><p>â€‹ä»¥ä¸Šä»£ç å°†<code>lenth</code>å’Œ<code>lengthIsValid</code>èµ‹äºˆ<code>mutable</code>ç‰¹æ€§, ä½¿å…¶åœ¨<code>const</code>æˆå‘˜å‡½æ•°ä¸­å¯ä»¥æ”¹å˜, ä»è€Œå¯ä»¥ç”¨éå¸¸å°çš„ä»£ä»·æ›´æ–°<code>text</code>çš„é•¿åº¦, æ–¹ä¾¿å…¶ä»–éœ€è¦ä½¿ç”¨texté•¿åº¦çš„å‡½æ•°, è¿™ä¸¤ä¸ªå˜é‡å‡å¯¹<code>text</code>å­˜å‚¨å­—ç¬¦ä¸²çš„ä¸»é€»è¾‘æ²¡æœ‰å½±å“.</p><hr><p>â€‹æœ€åè¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒæœ‰ä»·å€¼çš„è§‚ç‚¹ : æˆ‘ä»¬çŸ¥é“è¦é€‚é…<code>const</code>ç‰ˆæœ¬éœ€è¦å†™ä¸¤ä¸ªç±»ä¼¼çš„å‡½æ•°, ä¸€ä¸ªå¤„ç†<code>const</code>å¯¹è±¡, ä¸€ä¸ªå¤„ç†<code>non-const</code>å¯¹è±¡, ä½†æ˜¯æˆ‘ä»¬ä¹Ÿåº”å½“å‘ç°è¿™ä¸¤ä¸ªå‡½æ•°å…¶å®éå¸¸ç›¸ä¼¼, é‚£ä¹ˆè¿™å°±å¸¦æ¥äº†ä¸€äº›é—®é¢˜:</p><ol><li><strong>ä»£ç é‡å¤</strong>, è¿™ä¼šå¸¦æ¥é˜…è¯»æ€§é™ä½, ç»´æŠ¤æˆæœ¬æé«˜çš„è´Ÿé¢ä½œç”¨.</li><li>æˆ‘ä»¬åœ¨ä»¥åçš„æ¡æ¬¾å­¦ä¹ ä¸­ä¼šçŸ¥é“, ç¼–è¯‘å™¨ä¸€èˆ¬ä¼šæŠŠæˆå‘˜å‡½æ•°æ›¿æ¢ä¸º<code>inline</code>å‡½æ•°, è¿™åœ¨ä¸€èˆ¬æƒ…å†µä¸‹è‚¯å®šæ˜¯æ›´é«˜æ•ˆçš„, ä½†æ˜¯<code>inline</code>å‡½æ•°ä¸­çš„ä»£ç è¶Šå¤š, ä¼šå¸¦æ¥ä¸€ç³»åˆ—å¦‚ä»£ç è†¨èƒ€ä¹‹ç±»çš„é—®é¢˜, è¿™ç‚¹æˆ‘ä»¬åº”å½“é¿å….</li></ol><ul><li>ä¹¦ä¸­æå‡ºäº†è¿™æ ·çš„è§£å†³æ–¹æ¡ˆ : <strong>ä»¤<code>non-const</code>ç‰ˆæœ¬è°ƒç”¨<code>const</code>ç‰ˆæœ¬</strong>.</li></ul><p>â€‹è¿™æ ·å­åšçš„å‰ææ˜¯ä¸¤ä¸ªç‰ˆæœ¬çš„å†…å®¹ä¸€å®šç›¸ç­‰, æˆ–è€…è¯´<code>non-const</code>ç‰ˆæœ¬ä¸èƒ½ä¿®æ”¹å¯¹è±¡å†…çš„å˜é‡, æ¯•ç«Ÿå¦‚æœä¿®æ”¹äº†é‚£å’Œ<code>const</code>ç‰ˆæœ¬å°±ä¸€å®šä¸ä¸€æ ·äº†, æˆ‘ä»¬æ¥æ”¹å†™ä¸Šé¢[]é‡è½½çš„ä¸¤ä¸ªç‰ˆæœ¬.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-type">const</span> <span class="hljs-type">char</span>&amp; <span class="hljs-keyword">operator</span>[](<span class="hljs-type">const</span> std::<span class="hljs-type">size_t</span> position) <span class="hljs-type">const</span>  <br>&#123; <br>    <span class="hljs-comment">//æˆ‘ä»¬å‡å®š[]é‡è½½åœ¨è¿”å›ä¸‹æ ‡å¼•ç”¨ä¹‹å‰è¿˜è¦åšè®¸å¤šå·¥ä½œ, ä»£ç é‡å·¨å¤§</span><br>    <span class="hljs-comment">// ...è¾¹ç•Œæ£€éªŒ</span><br>    <span class="hljs-comment">// ...å°†æ•°æ®è®¿é—®çš„è¡Œä¸ºåŠ å…¥æ—¥å¿—</span><br>    <span class="hljs-comment">// ...æ£€éªŒæŒ‡å‘å†…å®¹æ•°æ®çš„å®Œæ•´æ€§</span><br>    <span class="hljs-keyword">return</span> text[position]; <br>&#125;<br><br><span class="hljs-type">char</span>&amp; <span class="hljs-keyword">operator</span>[](<span class="hljs-type">const</span> std::<span class="hljs-type">size_t</span> position)<br>&#123; <br>    <span class="hljs-comment">// è¿™æ®µä»£ç å®ç°äº†ä¸¤æ¬¡ç±»å‹è½¬æ¢, ç›®çš„æ˜¯è°ƒç”¨constç‰ˆæœ¬çš„operator[]å‡½æ•°å¹¶è¿”å›non-constçš„char&amp;</span><br><span class="hljs-keyword">return</span> <span class="hljs-built_in">const_cast</span>&lt;<span class="hljs-type">char</span>&amp;&gt;(<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">const</span> text&amp;&gt;(*<span class="hljs-keyword">this</span>)[pos]);<br>    <span class="hljs-comment">/* æˆ‘ä»¬æŠŠè¿™æ®µä»£ç æ‹†åˆ†å¼€æ¥è§£è¯»</span><br><span class="hljs-comment">    return const_cast&lt;char&amp;&gt;(    // 3. å°†[]è¿”å›ç»“æœç”±constç‰ˆæœ¬é€šè¿‡const_castè½¬æ¢ä¸ºnon-constç‰ˆæœ¬</span><br><span class="hljs-comment">        static_cast&lt;const text&amp;&gt;(*this)  // 1. å…ˆå°†thisæŒ‡é’ˆé€šè¿‡static_castè½¬æ¢ä¸ºconst text&amp;</span><br><span class="hljs-comment">        [pos] // 2. const text&amp;ç±»å‹è°ƒç”¨[]é‡è½½, è‡ªç„¶ä½¿ç”¨çš„æ˜¯constç‰ˆæœ¬çš„[]é‡è½½</span><br><span class="hljs-comment">    );</span><br><span class="hljs-comment">    */</span><br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹ç»è¿‡ä»¥ä¸Šçš„æ“ä½œ, æ— è®º<code>const</code>ç‰ˆæœ¬éœ€è¦å¤šå°‘è¡Œä»£ç , <code>non-const</code>ç‰ˆæœ¬éƒ½åªéœ€è¦ä¸€è¡Œä»£ç å³å¯, ç›¸å½“å®ç”¨.</p><p>â€‹å¦å¤–å¦‚æœåœ¨<code>non-const</code>ç‰ˆæœ¬è™½ç„¶å’Œ<code>const</code>ç‰ˆæœ¬ååˆ†ç›¸ä¼¼, ä½†æ˜¯è¿˜æ˜¯æƒ³è¦ä¿®æ”¹ä¸€éƒ¨åˆ†çš„æ•°æ®, ä¹Ÿå¯ä»¥åœ¨è°ƒç”¨å®Œé‡è½½ç‰ˆæœ¬åä¸è¿”å›, å†è¿›è¡Œä¸€äº›ä¿®æ”¹æ“ä½œå†è¿”å›.</p><ul><li>å°é—®é¢˜ : ä¸ºä»€ä¹ˆä¸ç”¨<code>const</code>ç‰ˆæœ¬è°ƒç”¨<code>non-const</code>ç‰ˆæœ¬?  å› ä¸º<code>non-const</code>ç‰ˆæœ¬ä¸ä¼šé™åˆ¶ä¿®æ”¹è¡Œä¸º, æ— æ³•ç›‘ç£<code>const</code>å®ç°.</li></ul><hr><h2 id="è¯·è®°ä½"><a href="#è¯·è®°ä½" class="headerlink" title="è¯·è®°ä½"></a>è¯·è®°ä½</h2><ul><li>å°†æŸäº›ä¸œè¥¿å£°æ˜ä¸º<code>const</code>å¯ä»¥å¸®åŠ©ç¼–è¯‘å™¨æ£€æŸ¥å‡ºé”™è¯¯è¯­æ³•, <code>const</code>å¯è¢«æ–½åŠ äºä»»ä½•å¯¹è±¡, å‡½æ•°å‚æ•°, å‡½æ•°è¿”å›å€¼, æˆå‘˜å‡½æ•°</li><li>C++åœ¨<code>const</code>æˆå‘˜å‡½æ•°å®šä¹‰ä¸Šé»˜è®¤æ”¯æŒ<code>bitwise const</code>æµæ´¾, ä½†æ˜¯ä¹Ÿé€šè¿‡å…³é”®å­—<code>mutable</code>å˜ç›¸æ”¯æŒäº†<code>logical const</code>æµæ´¾</li><li>å½“<code>non-const</code>ç‰ˆæœ¬å’Œ<code>const</code>ç‰ˆæœ¬ç­‰ä»·å®è´¨æ—¶, å¯ä»¥ç”¨<code>non-const</code>ç‰ˆæœ¬è°ƒç”¨<code>const</code>ç‰ˆæœ¬</li></ul><p>ä½œè€… : å¤©ç›®ä¸­äº‘</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Effective C++ æ¡æ¬¾1-2</title>
    <link href="/2024/11/29/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE1-2/"/>
    <url>/2024/11/29/%5BEffective%20C++%5D%E6%9D%A1%E6%AC%BE1-2/</url>
    
    <content type="html"><![CDATA[<h3 id="æ¡æ¬¾01-è§†C-ä¸ºä¸€ä¸ªè¯­è¨€è”é‚¦"><a href="#æ¡æ¬¾01-è§†C-ä¸ºä¸€ä¸ªè¯­è¨€è”é‚¦" class="headerlink" title="æ¡æ¬¾01 : è§†C++ä¸ºä¸€ä¸ªè¯­è¨€è”é‚¦"></a>æ¡æ¬¾01 : è§†C++ä¸ºä¸€ä¸ªè¯­è¨€è”é‚¦</h3><blockquote><p>ä¸åƒJavaå¯¹å„ç§èµ„æºéƒ½è¿›è¡Œäº†æ•´åˆå†…èš, C++æ›´åƒæ˜¯ç”±å››ç§æ¬¡è¯­è¨€ç»„åˆè€Œæˆçš„è¯­è¨€è”é‚¦, æ¯ç§æ¬¡è¯­è¨€éƒ½æœ‰è‡ªå·±çš„è§„çº¦, ä¹Ÿéƒ½æœ‰ä¸åŒçš„ç”¨æ­¦ä¹‹åœ°, æ¯ä¸ªéƒ½å¯ä»¥ç»™C++è¿™é—¨è¯­è¨€å¸¦æ¥ç‹¬ç‰¹çš„ä¼˜åŠ¿.</p><ul><li><h4 id="C-C-çš„åŸºç¡€-åŒ…å«æŒ‡é’ˆ-å†…ç½®æ•°æ®ç±»å‹ç­‰åŸºç¡€æ€æƒ³"><a href="#C-C-çš„åŸºç¡€-åŒ…å«æŒ‡é’ˆ-å†…ç½®æ•°æ®ç±»å‹ç­‰åŸºç¡€æ€æƒ³" class="headerlink" title="C  :  C++çš„åŸºç¡€, åŒ…å«æŒ‡é’ˆ&#x2F;å†…ç½®æ•°æ®ç±»å‹ç­‰åŸºç¡€æ€æƒ³."></a>C  :  C++çš„åŸºç¡€, åŒ…å«æŒ‡é’ˆ&#x2F;å†…ç½®æ•°æ®ç±»å‹ç­‰åŸºç¡€æ€æƒ³.</h4></li></ul></blockquote><ul><li><h4 id="Object-Oriented-C-é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ ¸å¿ƒ-å®ç°å°è£…-ç»§æ‰¿-å¤šæ€"><a href="#Object-Oriented-C-é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ ¸å¿ƒ-å®ç°å°è£…-ç»§æ‰¿-å¤šæ€" class="headerlink" title="Object-Oriented C++  :  é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ ¸å¿ƒ, å®ç°å°è£…&#x2F;ç»§æ‰¿&#x2F;å¤šæ€."></a>Object-Oriented C++  :  é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ ¸å¿ƒ, å®ç°å°è£…&#x2F;ç»§æ‰¿&#x2F;å¤šæ€.</h4></li><li><h4 id="Template-C-æ³›å‹ç¼–ç¨‹"><a href="#Template-C-æ³›å‹ç¼–ç¨‹" class="headerlink" title="Template C++  :  æ³›å‹ç¼–ç¨‹."></a>Template C++  :  æ³›å‹ç¼–ç¨‹.</h4></li><li><h4 id="STL-ä¸€å¥—templateçš„ç¨‹åºåº“-åŒ…å«å„ç§æ•°æ®ç»“æ„ä¸ç®—æ³•"><a href="#STL-ä¸€å¥—templateçš„ç¨‹åºåº“-åŒ…å«å„ç§æ•°æ®ç»“æ„ä¸ç®—æ³•" class="headerlink" title="STL  :  ä¸€å¥—templateçš„ç¨‹åºåº“, åŒ…å«å„ç§æ•°æ®ç»“æ„ä¸ç®—æ³•."></a>STL  :  ä¸€å¥—templateçš„ç¨‹åºåº“, åŒ…å«å„ç§æ•°æ®ç»“æ„ä¸ç®—æ³•.</h4><p>  è¿™å››ä¸ªæ–¹å‘æˆ‘ä»¬éƒ½åº”ç†Ÿè¯†æŒæ¡, ä½†æ˜¯å¯ä»¥ç»™è‡ªå·±è¿™æ ·ä¸€ä¸ªå°è±¡ : C++å¹¶ä¸æ˜¯ä¸€ä¸ªä¸€ä½“çš„è¯­è¨€, ç¼–ç¨‹æ—¶çš„æ€æƒ³è§„èŒƒåº”å½“éšä½ ä½¿ç”¨C++çš„å¯¹åº”éƒ¨åˆ†è€Œæ”¹å˜.</p></li></ul><hr><h3 id="æ¡æ¬¾02-å°½é‡ä»¥cnost-enum-inline-æ›¿æ¢-define"><a href="#æ¡æ¬¾02-å°½é‡ä»¥cnost-enum-inline-æ›¿æ¢-define" class="headerlink" title="æ¡æ¬¾02 : å°½é‡ä»¥cnost, enum, inline æ›¿æ¢ #define"></a>æ¡æ¬¾02 : å°½é‡ä»¥cnost, enum, inline æ›¿æ¢ #define</h3><blockquote><p>ç”± â€˜#â€™ å¼•å‡ºçš„è¯­å¥ä¸€èˆ¬ä¸Cçš„é¢„å¤„ç†æœºåˆ¶ç›¸å…³, æˆ‘ä»¬å¾ˆéœ€è¦é¢„å¤„ç†æœºåˆ¶ä¸­çš„ #include å’Œ #ifdef, å‰è€…ä¿è¯åº“çš„å¼•å…¥, åè€…å¯ä»¥é’ˆå¯¹ä¸åŒçš„ç¯å¢ƒè¿›è¡Œæ¡ä»¶ç¼–è¯‘, è€Œ #define å´åœ¨è¯­è¨€çš„å‘å±•ä¸‹æ˜¾å¾—æœ‰äº›ä¸æ—¶ä»£è„±èŠ‚äº†, ç°åœ¨æˆ‘ä»¬åº”å½“æœ‰å¿ƒå‡å°‘ #define çš„ä½¿ç”¨.</p></blockquote><p>ä»¥ä¸‹åˆ—ä¸¾ #define æ‰€å¸¦æ¥çš„ä¸€äº›é—®é¢˜:</p><ol><li>ä¹¦å†™ä»£ç æ—¶å¾ˆéš¾è‡ªåŠ¨æ˜¾ç¤ºé”™è¯¯</li><li>ç¼–è¯‘é”™è¯¯æ—¶æ˜¾ç¤ºçš„ä¿¡æ¯å¹¶ä¸ç›´è§‚</li><li>#defineå¹¶ä¸é‡è§†ä½œç”¨åŸŸ, é¢å‘å…¨å±€ç”Ÿæ•ˆ, è¿™ä¸æˆ‘ä»¬åº”å½“åšæŒçš„å°è£…æ€æƒ³ç›¸æ‚–</li></ol><p>ç®€è€Œè¨€ä¹‹, å°±æ˜¯#defineå¯èƒ½å¸¦æ¥ä¸€äº›ä¸å¯é¢„æ–™çš„è¡Œä¸ºå¹¶ä¸”æ— æ³•ä¿è¯ç±»å‹å®‰å…¨, è€Œå¦‚ä»Šæˆ‘ä»¬ç”±è¶³å¤Ÿå¤šçš„æ–¹æ³•å¯ä»¥å®‰å…¨æœ‰æ•ˆåœ°æ›¿ä»£#defineçš„åŠŸèƒ½, æ¯”å¦‚constå’Œenumå¯ä»¥æ›¿ä»£#defineåœ¨å¸¸é‡å®šä¹‰ä¸ŠåŠŸèƒ½, inlineåˆå¯ä»¥æ›¿ä»£#defineåœ¨å®å‡½æ•°ä¸Šçš„åŠŸèƒ½.</p><h4 id="const"><a href="#const" class="headerlink" title="const"></a>const</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">define</span> N 100 <span class="hljs-comment">// è¿™ä¸ªæ­¥éª¤åœ¨é¢„å¤„ç†é˜¶æ®µå®ç°</span></span><br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N = <span class="hljs-number">100</span>;<span class="hljs-comment">// è¿™ä¸ªæ­¥éª¤åœ¨ç¼–è¯‘é˜¶æ®µå®ç°</span><br></code></pre></td></tr></table></figure><h4 id="enum"><a href="#enum" class="headerlink" title="enum"></a>enum</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// è¿™é‡Œæˆ‘ä»¬æƒ³å®šä¹‰ä¸‰å…ƒè‰²çš„å¯¹åº”æ•°å€¼</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> RED = 1</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> GREEN = 2</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> BLUE = 3</span><br><br><span class="hljs-keyword">enum</span> <span class="hljs-title class_">Color</span>&#123;<br>    RED = <span class="hljs-number">1</span>, <br>    GREEN = <span class="hljs-number">2</span>,<br>    BLUE = <span class="hljs-number">3</span><br>&#125;<span class="hljs-comment">// ä½¿ç”¨enumæšä¸¾ç±»å‹åœ¨å¢å¼ºä»£ç çš„å¯è¯»æ€§çš„åŒæ—¶ä¹Ÿæå‡äº†å¯ç»´æŠ¤æ€§</span><br><br><span class="hljs-comment">//-----------------------------------------------------//</span><br><span class="hljs-keyword">enum</span> Action&#123;<br>    RUN = <span class="hljs-number">0x0001</span>,    <span class="hljs-comment">// ç¬¬ä¸€ä½</span><br>    JUMP = <span class="hljs-number">0x0002</span>, <span class="hljs-comment">// ç¬¬äºŒä½</span><br>    SAY = <span class="hljs-number">0x0004</span>, <span class="hljs-comment">// ç¬¬ä¸‰ä½</span><br>    SLEEP = <span class="hljs-number">0x0008</span> <span class="hljs-comment">// ç¬¬å››ä½</span><br>&#125;<span class="hljs-comment">// ä½¿ç”¨enumè¿˜å¯ä»¥å®ç°æ¯”ç‰¹çº§åˆ«çš„çŠ¶æ€åˆ¤æ–­</span><br><br><span class="hljs-type">void</span> <span class="hljs-built_in">CheckAction</span>(<span class="hljs-type">int</span> action);   <span class="hljs-comment">// å‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªæ£€æŸ¥è¿åŠ¨çŠ¶æ€çš„å‡½æ•°, é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åªæ¥å—ä¸€ä¸ªintå°±å¯ä»¥åˆ¤æ–­å¤æ•°çš„çŠ¶æ€</span><br><span class="hljs-built_in">CheckAction</span>(RUN | JUMP | SAY);<span class="hljs-comment">// è¿™é‡Œçš„çŠ¶æ€å°± è·‘ + è·³ + è¯´è¯</span><br></code></pre></td></tr></table></figure><h4 id="inline"><a href="#inline" class="headerlink" title="inline"></a>inline</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// åŠ å…¥æˆ‘ä»¬æƒ³å®ç°çš„MAX(a, b), æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å®ç°</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX(a, b)  (a) &gt; (b) ? (a) : (b)</span><br><br><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;</span><br><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">MAX</span><span class="hljs-params">(<span class="hljs-type">const</span> T&amp; a, <span class="hljs-type">const</span> T&amp; b)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> a &gt; b ? a : b;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ç”¨æ¨¡æ¿ + inlineå°±å¯ä»¥å®Œå…¨ä»£æ›¿å®å‡½æ•°çš„ä½œç”¨, é¦–å…ˆinlineçš„ä¹¦å†™æ¨¡å¼æ›´åŠ è‡ªç„¶, å¦å¤–è¿˜ä¿è¯äº†ç±»å‹å®‰å…¨, è§„é¿äº†#defineçš„å±é™©æ€§.</p>]]></content>
    
    
    
    <tags>
      
      <tag>Effective C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
